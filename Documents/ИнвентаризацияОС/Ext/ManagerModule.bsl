
Функция ПечатьСличительнойВедомости(Ссылка) Экспорт 
	
	ТабДокумент	= Новый ТабличныйДокумент;
	
	
	ТабДокумент.ИмяПараметровПечати = "ПараметрыПечати_ИнвентаризацияОС_СличительнаяВедомость";
	
	Если Ссылка.ИзменениеСуммовойОценки  = Истина Тогда
		Макет = Документы.ИнвентаризацияОС.ПолучитьМакет("СличительнаяВедомостьСуммоваяОценка");
		ВыводитьСуммы = Истина;
	Иначе 	
		Макет = Документы.ИнвентаризацияОС.ПолучитьМакет("СличительнаяВедомость");
		ВыводитьСуммы = Ложь;
	КонецЕсли;	
		
	ОбластьМакета = Макет.ПолучитьОбласть("Шапка");
	ТекНомер = Ссылка.Номер;
	Пока Лев(ТекНомер, 1) = "0" Цикл
		ТекНомер = Сред(ТекНомер, 2);
	КонецЦикла;
    ОбластьМакета.Параметры.Номер 	= ТекНомер;
    ОбластьМакета.Параметры.Дата 	= Формат(Ссылка.Дата, "ДЛФ=Д");
    ОбластьМакета.Параметры.Склад 	= ?(ЗначениеЗаполнено(Ссылка.Склад), СокрЛП(Ссылка.Склад.Наименование), "");
    ОбластьМакета.Параметры.ЦФО 	= СокрЛП(Ссылка.ЦФО.Наименование);
	ТабДокумент.Вывести(ОбластьМакета);
	
	мДатаНовогоУчетаСчетовОС = Константы.ДатаИзмененияУчетаПоСчетамОС.Получить();
	ЕстьНовыйУчетСчетовОС = (НЕ Ссылка.Дата < мДатаНовогоУчетаСчетовОС);	
	
	МСФО = АК_ОсновныеСредства.УчетМСФО(Ссылка.Дата);
	
	Если МСФО Тогда

		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	ИнвентаризацияОСОС.Ссылка,
			|	ИнвентаризацияОСОС.НомерСтроки,
			|	ИнвентаризацияОСОС.ОсновноеСредство,
			|	ИнвентаризацияОСОС.ИнвентарныйНомер,
			|	ИнвентаризацияОСОС.ЗаводскойНомер,
			|	ИнвентаризацияОСОС.Количество КАК КоличествоФакт,
			|	ИнвентаризацияОСОС.Сумма КАК СуммаФакт,
			|	ИнвентаризацияОСОС.Амортизация,
			|	ИнвентаризацияОСОС.Местоположение,
			|	ИнвентаризацияОСОС.КоличествоУчет КАК КоличествоУчет,
			|	ИнвентаризацияОСОС.Количество - ИнвентаризацияОСОС.КоличествоУчет КАК КоличествоРасхождение,
			|	ИнвентаризацияОСОС.СуммаУчет КАК СуммаУчет,
			|	ИнвентаризацияОСОС.Сумма - ИнвентаризацияОСОС.СуммаУчет КАК СуммаРасхождение,
			|	ИнвентаризацияОСОС.АмортизацияУчет
			|ИЗ
			|	Документ.ИнвентаризацияОС.ОС КАК ИнвентаризацияОСОС
			|ГДЕ
			|	ИнвентаризацияОСОС.Ссылка = &Ссылка";

		Запрос.УстановитьПараметр("Ссылка", Ссылка);	
		
	Иначе
		Если НЕ Ссылка.ОтражатьВУправленческомУчете Тогда
			
            Запрос = Новый Запрос;
			ТекВидГраницы = ?(Ссылка.Проведен, ВидГраницы.Включая, ВидГраницы.Исключая);
			Запрос.Параметры.Вставить("ДатаСреза"	, Новый Граница(Ссылка.МоментВремени(), ТекВидГраницы));
			Запрос.Параметры.Вставить("Ссылка"		, Ссылка);
			Запрос.Параметры.Вставить("Склад"		, Ссылка.Склад);
			Запрос.Параметры.Вставить("ЦФО"			, Ссылка.ЦФО);
			Запрос.УстановитьПараметр("СчетУчета"	, Ссылка.СчетУчета);

			ТекстЗапроса =
			"ВЫБРАТЬ РАЗРЕШЕННЫЕ
			|	ФинансовыйОстатки.Субконто3 КАК ОсновноеСредство,
			|	ВЫРАЗИТЬ(ФинансовыйОстатки.Субконто3 КАК Справочник.ОсновныеСредства).ИнвентарныйНомер КАК ИнвентарныйНомер,
			|	0 КАК Количество,
			|	0 КАК Сумма,
			|	ФинансовыйОстатки.КоличествоОстаток КАК КоличествоУчет,
			|	ФинансовыйОстатки.СуммаОстаток КАК СуммаУчет
			|ПОМЕСТИТЬ ВТОсновная
			|ИЗ
			|	РегистрБухгалтерии.Финансовый.Остатки(
			|			&ДатаСреза,
			|			Счет = &СчетУчета,
			|			,
			|			Субконто2 = &Склад
			|				И &УсловиеПоЦФО) КАК ФинансовыйОстатки
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ТЧОС.ОсновноеСредство,
			|	ТЧОС.ОсновноеСредство.ИнвентарныйНомер,
			|	ТЧОС.Количество,
			|	ТЧОС.Сумма,
			|	0,
			|	0
			|ИЗ
			|	Документ.ИнвентаризацияОС.ОС КАК ТЧОС
			|ГДЕ
			|	ТЧОС.Ссылка = &Ссылка
			|
			|ИНДЕКСИРОВАТЬ ПО
			|	ИнвентарныйНомер
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ВТОсновная.ОсновноеСредство КАК ОсновноеСредство,
			|	ВТОсновная.ИнвентарныйНомер КАК ИнвентарныйНомер,
			|	СУММА(ВТОсновная.Количество) КАК КоличествоФакт,
			|	СУММА(ВТОсновная.КоличествоУчет) КАК КоличествоУчет,
			|	СУММА(ВТОсновная.КоличествоУчет) - СУММА(ВТОсновная.Количество) КАК КоличествоРасхождение,
			|	СУММА(ВТОсновная.Сумма) КАК СуммаФакт,
			|	СУММА(ВТОсновная.СуммаУчет) КАК СуммаУчет,
			|	СУММА(ВТОсновная.СуммаУчет) - СУММА(ВТОсновная.Сумма) КАК СуммаРасхождение
			|ИЗ
			|	ВТОсновная КАК ВТОсновная
			|
			|СГРУППИРОВАТЬ ПО
			|	ВТОсновная.ОсновноеСредство,
			|	ВТОсновная.ИнвентарныйНомер
			|
			|УПОРЯДОЧИТЬ ПО
			|	ВТОсновная.ОсновноеСредство.Наименование,
			|	ВТОсновная.ИнвентарныйНомер
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|УНИЧТОЖИТЬ ВТОсновная";
			
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "
			|				И &УсловиеПоЦФО",
				?(НЕ ЕстьНовыйУчетСчетовОС, "
			|				И Субконто1 = &ЦФО", ""));
			
			Запрос.Текст = ТекстЗапроса;
		Иначе
			Возврат ТабДокумент;
		КонецЕсли;	
	КонецЕсли;
	
	
	
	//Иначе
	//	
	//	Запрос.Текст =
	//	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	//	|	ФинансовыйОстатки.Субконто3 КАК ОсновноеСредство
	//	|ПОМЕСТИТЬ ВТОсновныеСредства
	//	|ИЗ
	//	|	РегистрБухгалтерии.Финансовый.Остатки(
	//	|			&ДатаСреза,
	//	|			Счет = &СчетУчета,
	//	|			,
	//	|			Субконто1 = &ЦФО
	//	|				И Субконто2 = &Склад) КАК ФинансовыйОстатки
	//	|;
	//	|
	//	|////////////////////////////////////////////////////////////////////////////////
	//	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	//	|	УчетОсновныхСредствОстатки.ОсновноеСредство КАК ОсновноеСредство,
	//	|	УчетОсновныхСредствОстатки.ОсновноеСредство.ИнвентарныйНомер КАК ИнвентарныйНомер,
	//	|	0 КАК Количество,
	//	|	0 КАК Сумма,
	//	|	УчетОсновныхСредствОстатки.КоличествоОстаток КАК КоличествоУчет,
	//	|	УчетОсновныхСредствОстатки.СуммаОстаток КАК СуммаУчет
	//	|ПОМЕСТИТЬ ВТОсновная
	//	|ИЗ
	//	|	РегистрНакопления.УчетОсновныхСредств.Остатки(
	//	|			&ДатаСреза,
	//	|			ЦФО = &ЦФО
	//	|				И Склад = &Склад) КАК УчетОсновныхСредствОстатки
	//	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОсновныеСредства КАК ВТОсновныеСредства
	//	|		ПО (ВТОсновныеСредства.ОсновноеСредство = УчетОсновныхСредствОстатки.ОсновноеСредство)
	//	|
	//	|ОБЪЕДИНИТЬ ВСЕ
	//	|
	//	|ВЫБРАТЬ
	//	|	ТЧОС.ОсновноеСредство,
	//	|	ТЧОС.ОсновноеСредство.ИнвентарныйНомер,
	//	|	ТЧОС.Количество,
	//	|	ТЧОС.Сумма,
	//	|	0,
	//	|	0
	//	|ИЗ
	//	|	Документ.ИнвентаризацияОС.ОС КАК ТЧОС
	//	|ГДЕ
	//	|	ТЧОС.Ссылка = &Ссылка
	//	|
	//	|ИНДЕКСИРОВАТЬ ПО
	//	|	ИнвентарныйНомер
	//	|;
	//	|
	//	|////////////////////////////////////////////////////////////////////////////////
	//	|ВЫБРАТЬ
	//	|	ВТОсновная.ОсновноеСредство КАК ОсновноеСредство,
	//	|	ВТОсновная.ИнвентарныйНомер КАК ИнвентарныйНомер,
	//	|	СУММА(ВТОсновная.Количество) КАК КоличествоФакт,
	//	|	СУММА(ВТОсновная.КоличествоУчет) КАК КоличествоУчет,
	//	|	СУММА(ВТОсновная.Количество) - СУММА(ВТОсновная.КоличествоУчет) КАК КоличествоРасхождение,
	//	|	СУММА(ВТОсновная.Сумма) КАК СуммаФакт,
	//	|	СУММА(ВТОсновная.СуммаУчет) КАК СуммаУчет,
	//	|	СУММА(ВТОсновная.Сумма) - СУММА(ВТОсновная.СуммаУчет) КАК СуммаРасхождение
	//	|ИЗ
	//	|	ВТОсновная КАК ВТОсновная
	//	|
	//	|СГРУППИРОВАТЬ ПО
	//	|	ВТОсновная.ОсновноеСредство,
	//	|	ВТОсновная.ИнвентарныйНомер
	//	|
	//	|УПОРЯДОЧИТЬ ПО
	//	|	ВТОсновная.ИнвентарныйНомер
	//	|;
	//	|
	//	|////////////////////////////////////////////////////////////////////////////////
	//	|УНИЧТОЖИТЬ ВТОсновная";
	//	
	//КонецЕсли;
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	НомерСтроки = 0;
	
	ИтСуммаУчет = 0;
	ИтСуммаРасх = 0;
	
 	ОбластьМакета = Макет.ПолучитьОбласть("Строка");
	Пока Выборка.Следующий() Цикл

		НомерСтроки = НомерСтроки + 1;
		
		ОбластьМакета.Параметры.Заполнить(Выборка);
		ОбластьМакета.Параметры.НомерСтроки = Формат(НомерСтроки, "ЧГ=");
    	ТабДокумент.Вывести(ОбластьМакета);

		Если ВыводитьСуммы Тогда
			ИтСуммаУчет = ИтСуммаУчет + Выборка.СуммаУчет;
			ИтСуммаРасх = ИтСуммаРасх + Выборка.СуммаРасхождение;
		КонецЕсли;
		
	КонецЦикла;
	
 	ОбластьМакета = Макет.ПолучитьОбласть("Подвал");
	
	Если ВыводитьСуммы Тогда
		ОбластьМакета.Параметры.СуммаУчет 			= ИтСуммаУчет;
		ОбластьМакета.Параметры.СуммаРасхождение 	= ИтСуммаРасх;
	КонецЕсли;	
	ТабДокумент.Вывести(ОбластьМакета);

	ТабДокумент.АвтоМасштаб 		= Истина;
	ТабДокумент.ФиксацияСверху 		= 8;
	ТабДокумент.ОтображатьСетку 	= Ложь;
	ТабДокумент.Защита 				= Ложь;
	ТабДокумент.ТолькоПросмотр 		= Ложь;
	ТабДокумент.ОтображатьЗаголовки = Ложь;
	
	Возврат ТабДокумент;
	
КонецФункции
