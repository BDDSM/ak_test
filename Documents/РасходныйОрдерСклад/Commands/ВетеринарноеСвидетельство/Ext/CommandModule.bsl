&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	Если НЕ ПолучитьПризкакПроведенности(ПараметрКоманды) Тогда
		ОбщегоНазначения.СообщитьИнформациюПользователю("Документ не проведен! Для печати необходимо провести документ!");
		Возврат;
	КонецЕсли;
	
	//+++АК SaMi 13.12.2017 
	Если ЕстьВСДВВетисе(ПараметрКоманды) Тогда
		Сообщить("Выписка ВСД по документу производилась через систему ""Ветис"". Печать запрещена!");
		Возврат;
	КонецЕсли;
	
	//---АК SaMi  13.12.2017 
	
	СтрукПечФорм=Новый Структура;
	Печать(ПараметрКоманды,СтрукПечФорм);
	Для каждого ЭлСтрук Из СтрукПечФорм Цикл
		Для каждого Эл Из ЭлСтрук.Значение Цикл
		      Эл.Показать(ЭлСтрук.Ключ);
		КонецЦикла; 
	КонецЦикла; 
	ОповеститьОбИзменении(ПараметрКоманды);
	Оповестить("АК_ПеречитатьРасходник");
КонецПроцедуры

&НаСервере
Функция Печать(ПараметрКоманды,МассивПечФорм)
	
	Если ПараметрКоманды.ВетДокументНапечатан Тогда
		Сообщить("Ветеринарный документ уже был напечатан");	
	КонецЕсли; 
	//+++АК BELN 2018.11.06 ИП-00019252 
	УстановитьПривилегированныйРежим(Истина);
	Если НЕ Документы.РасходныйОрдерСклад.ДоступнаПечать() Тогда
		Сообщить("Нет права на печать");
		Возврат Неопределено;
	КонецЕсли; 
	//---АК BELN 2018.11.06	
	
	МасДок=Новый Массив;
	МасДок.Добавить(ПараметрКоманды);
	Документы.РасходныйОрдерСклад.ПечатьВетСвидетельство(МасДок,МассивПечФорм);
	Если ПараметрКоманды.ВетДокументНапечатан=Ложь Тогда
		УстановитьПривилегированныйРежим(Истина);
		
		ОбъектДокумента=ПараметрКоманды.ПолучитьОбъект();
		ОбъектДокумента.ВетДокументНапечатан=Истина;
		ОбъектДокумента.Записать();	
	КонецЕсли; 
КонецФункции
                                                                  
&НаСервере
Функция ПолучитьПризкакПроведенности(СсылкаНаОбъект)
	
	Возврат СсылкаНаОбъект.Проведен;
	
КонецФункции

&НаСервере
Функция ЕстьВСДВВетисе(СсылкаНаОбъект)
	
	Запрос = Новый Запрос("ВЫБРАТЬ
	                      |	ВетСвидетельстваПоступлений.UUID_ВСД
	                      |ИЗ
	                      |	РегистрСведений.ВетСвидетельстваПоступлений КАК ВетСвидетельстваПоступлений
	                      |ГДЕ
	                      |	ВетСвидетельстваПоступлений.ДокПоступления = &ДокПоступления
	                      |	И ВетСвидетельстваПоступлений.UUID_ВСД <> """"");
	
	Запрос.УстановитьПараметр("ДокПоступления", СсылкаНаОбъект);
	
	Возврат НЕ Запрос.Выполнить().Пустой();
	
КонецФункции
