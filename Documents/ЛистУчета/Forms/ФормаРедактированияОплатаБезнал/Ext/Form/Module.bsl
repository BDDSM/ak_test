
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Данные.Загрузить(ЗначениеИзСтрокиВнутр(Параметры.ТаблицаДанные));
	ДатаЛиста = Параметры.ДатаЛиста;
	
	ПеречитатьРабочиеМеста();
	
КонецПроцедуры

&НаКлиенте
Процедура Принять(Команда)
	
	МассивСтроки = Новый Массив();
	Для Каждого СтрокаТаб Из Данные Цикл
		МассивСтроки.Добавить(Новый Структура("Терминал, Сумма, СуммаДоставка, СуммаВозврата, РабочееМестоВСкл", СтрокаТаб.Терминал, СтрокаТаб.Сумма, СтрокаТаб.СуммаДоставка, СтрокаТаб.СуммаВозврата, СтрокаТаб.РабочееМестоВСкл));
	КонецЦикла;	
	
	Закрыть(МассивСтроки);
	
КонецПроцедуры

&НаСервере
Процедура ПеречитатьРабочиеМеста()
	
	Запрос = Новый Запрос();
	Запрос.УстановитьПараметр("ДатаЛиста", КонецДня(ДатаЛиста));
	Запрос.УстановитьПараметр("Терминалы", Данные.Выгрузить().ВыгрузитьКолонку("Терминал"));
	Запрос.Текст = "ВЫБРАТЬ
	               |	ПривязкиОборудованияКРабочимМестамСрезПоследних.РабочееМесто,
	               |	ПривязкиОборудованияКРабочимМестамСрезПоследних.Терминал
	               |ИЗ
	               |	РегистрСведений.ПривязкиОборудованияКРабочимМестам.СрезПоследних(&ДатаЛиста, Терминал В (&Терминалы)) КАК ПривязкиОборудованияКРабочимМестамСрезПоследних
	               |ГДЕ
	               |	ПривязкиОборудованияКРабочимМестамСрезПоследних.Терминал В(&Терминалы)";
				   
	ТабРабМеста = Запрос.Выполнить().Выгрузить();
	
	Для Каждого СтрокаТаб Из Данные Цикл
		СтрокаРМ = ТабРабМеста.Найти(СтрокаТаб.Терминал, "Терминал");
		СтрокаТаб.РабочееМесто = ?(СтрокаРМ = Неопределено, Справочники.РабочиеМеста.ПустаяСсылка(), СтрокаРМ.РабочееМесто);
	КонецЦикла;	
	
КонецПроцедуры

&НаКлиенте
Процедура НаличкаККМПриИзменении(Элемент)
	
	ПеречитатьРабочиеМеста();
	
КонецПроцедуры
