
Функция ПолучитьТаблицуДоставкиСервер()
	
	Возврат ЭтаФорма.Доставка.Выгрузить();
	
КонецФункции

&НаКлиенте
Процедура СохранитьИЗакрыть(Команда)
	
	Перем СтруктураПараметров;
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("ТаблицаДоставки"			, ПолучитьТаблицуДоставкиСервер());//мТаблицаДоставки);
	СтруктураПараметров.Вставить("ДоставкаСкорректирована"	, ЭтаФорма.ДоставкаСкорректирована);
	
	ЭтаФорма.Закрыть(СтруктураПараметров);
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ТекТаблица = ЭтаФорма.Параметры.Доставка;
	ТекТаблица.Колонки.Добавить("ТекстРазницыНал");
	ТекТаблица.Колонки.Добавить("ТекстРазницыБН");
	Для Каждого СтрокаТаблицы Из ТекТаблица Цикл
		СтрокаТаблицы.ТекстРазницыНал 	= Формат(СтрокаТаблицы.СуммаНал	, "ЧДЦ=2;ЧН=") + " (" + Формат(СтрокаТаблицы.СуммаНалИсходная	, "ЧДЦ=2;ЧН=") + ")";
		СтрокаТаблицы.ТекстРазницыБН 	= Формат(СтрокаТаблицы.СуммаБН	, "ЧДЦ=2;ЧН=") + " (" + Формат(СтрокаТаблицы.СуммаБНИсходная	, "ЧДЦ=2;ЧН=") + ")";
	КонецЦикла;
	
	ЭтаФорма.Доставка.Загрузить(ТекТаблица);
	
КонецПроцедуры

&НаКлиенте
Процедура ДоставкаПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	
	ЭтаФорма.ДоставкаСкорректирована = Истина;
	
	ТекДанные = Элементы.Доставка.ТекущиеДанные;
	ТекДанные.ТекстРазницыНал 	= Формат(ТекДанные.СуммаНал	, "ЧДЦ=2;ЧН=") + " (" + Формат(ТекДанные.СуммаНалИсходная	, "ЧДЦ=2;ЧН=") + ")";
	ТекДанные.ТекстРазницыБН 	= Формат(ТекДанные.СуммаБН	, "ЧДЦ=2;ЧН=") + " (" + Формат(ТекДанные.СуммаБНИсходная	, "ЧДЦ=2;ЧН=") + ")";
	
КонецПроцедуры
