
Процедура ЗаполнитьПоМаршрутуСервер(мСтруктураПериода)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ДатаНачала"		, мСтруктураПериода.ДатаНачала);
	Запрос.УстановитьПараметр("ДатаОкончания"	, КонецДня(мСтруктураПериода.ДатаОкончания));
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	МаршрутныйЛист.Ссылка,
	|	МаршрутныйЛист.Маршрут,
	|	МаршрутныйЛист.Проведен
	|ИЗ
	|	Документ.МаршрутныйЛист КАК МаршрутныйЛист
	|ГДЕ
	|	МаршрутныйЛист.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|	И НЕ МаршрутныйЛист.Маршрут = ЗНАЧЕНИЕ(Справочник.Маршруты.ПустаяСсылка)
	|
	|УПОРЯДОЧИТЬ ПО
	|	МаршрутныйЛист.МоментВремени";
	
	РезультатЗапроса = Запрос.Выполнить();
	Если РезультатЗапроса.Пустой() Тогда
		Возврат;
	КонецЕсли;
	
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		
		ОбъектДокумента = Выборка.Ссылка.ПолучитьОбъект();
		
		ЗаполнитьЗначенияСвойств(ОбъектДокумента, Выборка.Маршрут, "Организация, СтруктурноеПодразделение, Перевозчик, Сумма, ВариантРасчетаНДС, СтавкаНДС, СуммаНДС");
		ОбъектДокумента.Сумма = 0;
		
		ОбъектДокумента.ТорговыеТочки.Загрузить(Выборка.Маршрут.ТорговыеТочки.Выгрузить());
		Для Каждого СтрокаТЧ Из ОбъектДокумента.ТорговыеТочки Цикл
			СтрокаТЧ.Стоимость = 0;
		КонецЦикла;
		
		Попытка
			ОбъектДокумента.Записать(?(Выборка.Проведен, РежимЗаписиДокумента.Проведение, РежимЗаписиДокумента.Запись));
			Сообщить("Документ """ + ОбъектДокумента + """ заполнен");
		Исключение
			Сообщить("Не удалось записать документ """ + ОбъектДокумента + """" + ОписаниеОшибки());
		КонецПопытки;
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьПоМаршруту(Команда)
	
	Перем мФормаВводаПериода;
	
	мФормаВводаПериода = ПолучитьФорму("Документ.МаршрутныйЛист.Форма.ФормаВыбораПериода");	
	
	мСтруктураПериода = мФормаВводаПериода.ОткрытьМодально();
	Если мСтруктураПериода = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	//
	ЗаполнитьПоМаршрутуСервер(мСтруктураПериода);
	
КонецПроцедуры

&НаКлиенте
Процедура СформироватьДоставкуНаСклад(Команда)
	
	Перем ФормаОбработки, ПараметрыФормы;
	
	ФормаОбработки = ПолучитьФорму("Обработка.ФормированиеТранспортныхРасходовДоставкаНаСклад.Форма.Форма", ПараметрыФормы, ЭтаФорма);
	ФормаОбработки.Объект.ФормироватьМаршрутныеЛисты = Истина;
	ФормаОбработки.Элементы.ФормироватьТранспортныеРасходы.Видимость 	= Ложь;
	//ФормаОбработки.Элементы.Поставщик.Видимость 						= Ложь;
	ФормаОбработки.ОткрытьМодально();
	
КонецПроцедуры

&НаКлиенте
Процедура СформироватьДоставкуНаТТ(Команда)
	
	Перем ФормаОбработки, ПараметрыФормы;
	
	ФормаОбработки = ПолучитьФорму("Обработка.ФормированиеДокументовДоставкиНаТТ.Форма.Форма", ПараметрыФормы, ЭтаФорма);
	ФормаОбработки.ОткрытьМодально();
	
КонецПроцедуры

&НаКлиенте
Процедура ПакетнаяПечать(Команда)
	
	МассивДокументов = Новый Массив;
	Для Каждого СтрокаСписка Из Элементы.Список.ВыделенныеСтроки Цикл
		МассивДокументов.Добавить(СтрокаСписка.Ссылка);
	КонецЦикла;
	
	ПараметрыФормы = Новый Структура("МаршрутныеЛисты", МассивДокументов);
	ОткрытьФормуМодально("Документ.МаршрутныйЛист.Форма.ФормаВыбораВидаПечатныхФорм", ПараметрыФормы, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ГрупповоеПрикреплениеСканов(Команда)
	
	МассивДоки = Новый Массив();
	Для Каждого ВыдСтрока Из Элементы.Список.ВыделенныеСтроки Цикл
		МассивДоки.Добавить(ВыдСтрока);
	КонецЦикла;	
	
	ОткрытьФорму("Документ.МаршрутныйЛист.Форма.ФормаПрикрепленияСканов", Новый Структура("МассивДоки", МассивДоки));
	
КонецПроцедуры

&НаКлиенте
Процедура СформироватьОтчётРасходныеОрдераБезРейсов(Команда)
	
	Перем ФормаОтчёта, ПараметрыФормы;
	
	ФормаОтчёта = ПолучитьФорму("Отчет.АК_РасходныеОрдераБезРейсов.Форма.ФормаОтчета", ПараметрыФормы, ЭтаФорма);
	ФормаОтчёта.Открыть();
	
КонецПроцедуры

&НаКлиенте
Процедура СформироватьОтчётРейсыБезРасходныхОрдеров(Команда)
	
	Перем ФормаОтчёта, ПараметрыФормы;
	
	ФормаОтчёта = ПолучитьФорму("Отчет.АК_РейсыБезРасходныхОрдеров.Форма.ФормаОтчета", ПараметрыФормы, ЭтаФорма);
	ФормаОтчёта.Открыть();
	
КонецПроцедуры
