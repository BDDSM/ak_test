Перем ОперацияАпдекс; //+++АК sils 07.06.2018 ИП-00018876

Процедура ПослеЗаписи()
	Оповестить("ОбновлениеТекстаПроСчетФактуру", ДокументОснование)
КонецПроцедуры

//+++ AK suvv 10.05.2018 ИП-00018025.02
Функция СоздатьФайлХранения(СтрокаТаблицы, РасширениеРезультата)
	
	СпрОбъект = Справочники.Файлы.СоздатьЭлемент();
	СпрОбъект.Наименование 	= СтрокаТаблицы.Представление;
	СпрОбъект.Расширение 	= РасширениеРезультата;
	Если Лев(НРег(РасширениеРезультата),4)=".doc" Тогда
		СпрОбъект.ДополнительныеСвойства.Вставить("Хранилище", Новый ХранилищеЗначения(СтрокаТаблицы.ДанныеКартинки));
	Иначе	
		СпрОбъект.ДополнительныеСвойства.Вставить("Хранилище", Новый ХранилищеЗначения(Новый Картинка(СтрокаТаблицы.ДанныеКартинки)));
	КонецЕсли;		
	СпрОбъект.Записать();
	
	Возврат СпрОбъект.Ссылка;
	
КонецФункции //AK suvv

//+++ AK suvv 10.05.2018 ИП-00018025.02
Процедура ФайлНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДиалогОткрытияФайла.ПолноеИмяФайла 		= "";
	ДиалогОткрытияФайла.МножественныйВыбор 	= Ложь;
	ДиалогОткрытияФайла.Заголовок 			= "Выберите файл";
	Если ДиалогОткрытияФайла.Выбрать() Тогда
		МассивФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;
		Для Каждого ИмяФайла Из МассивФайлов Цикл
			ВыбФайл = Новый Файл(ИмяФайла);
			Если НЕ ВыбФайл.Существует() Тогда				
				Сообщить("Не существует файл. " + ИмяФайла);
				Продолжить;
			КонецЕсли;
			Файл = СоздатьФайлХранения(Новый Структура("Представление, ДанныеКартинки", ВыбФайл.Имя, Новый ДвоичныеДанные(ИмяФайла)), ВыбФайл.Расширение);
		КонецЦикла;	
	КонецЕсли;	
	
КонецПроцедуры  //--- AK suvv

Процедура ФайлОткрытие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Если ЗначениеЗаполнено(Файл) = Истина Тогда
		ПутьКФайлу = Справочники.Файлы.ПолучитьИмяФайлаДляОбъекта(Файл);		
		ЗапуститьПриложение(ПутьКФайлу);
	КонецЕсли;	
КонецПроцедуры

Процедура ПриОткрытии()
	Если НастройкаПравДоступа.ДокументВЗакрытомПериоде(ДокументОбъект) 
		И НастройкаПравДоступа.ДокументВЗакрытомПериодеНДС(ДокументОбъект) Тогда
		ЭтаФорма.ТолькоПросмотр = Истина;
	КонецЕсли;
	
	УправлениеВидимостью();	
	//+++АК sils 08.06.2018 ИП-00018466
	APDEX_ОценкаПроизводительностиКлиентСервер.ЗакончитьЗамерВремени(ОперацияАпдекс, ?(ЭтоНовый(), "Новый документ", "" + ЭтотОбъект));
	//---АК
КонецПроцедуры

Процедура УправлениеВидимостью()
	ЭлементыФормы.НомерИсправления.Доступность = Исправление;
	ЭлементыФормы.ДатаИсправления.Доступность  = Исправление;
	ЭлементыФормы.НомерИсправления.АвтоОтметкаНезаполненного = Исправление И НЕ ЗначениеЗаполнено(НомерИсправления);
	ЭлементыФормы.НомерИсправления.ОтметкаНезаполненного     = Исправление И НЕ ЗначениеЗаполнено(НомерИсправления);
	ЭлементыФормы.ДатаИсправления.АвтоОтметкаНезаполненного  = Исправление И НЕ ЗначениеЗаполнено(ДатаИсправления);
	ЭлементыФормы.ДатаИсправления.ОтметкаНезаполненного      = Исправление И НЕ ЗначениеЗаполнено(ДатаИсправления);
КонецПроцедуры	


Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)	
	РаботаСДиалогами.ПоказатьСтруктуруПодчиненностиДокумента(ЭтотОбъект.Ссылка);
КонецПроцедуры

Процедура ИсправлениеПриИзменении(Элемент)
	УправлениеВидимостью();
	
	Если НЕ Исправление Тогда
		НомерИсправления = 0;
		ДатаИсправления = '00010101';
	Иначе
		
	КонецЕсли;
	
КонецПроцедуры

//+++АК Susk (Суслин К.В.) 2018.02.12 ИП-00017908
Процедура ДействияФормыВыгрузитьВБПНов(Кнопка)
	
	Если НЕ ОбменСБП2_0.ПроверкаПередВыгрузкой(Ссылка.Пустая(), Модифицированность) Тогда
		Возврат;
	КонецЕсли;	
		
	ОбменСБП2_0.ВыгрузитьДокументВБП("СчетФактураПолученный", "СчетФактураПолученный", Ссылка); 
	
КонецПроцедуры

//++ АК LUZA 13.02.2018
//Запрет создания дублей
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	Если ЭтоНовый() 
		И ДополнительныеСвойства.Свойство("НайденСуществующийСчетФактура")
		И ДополнительныеСвойства.НайденСуществующийСчетФактура Тогда
		
		Отказ = Истина;  
	КонецЕсли;
	//+++АК sils 08.06.2018 ИП-00018466
	ОперацияАпдекс = APDEX_ОценкаПроизводительностиКлиентСервер.ПолучитьОперацию("Открытие документа Счет фактура полученный");
	APDEX_ОценкаПроизводительностиКлиентСервер.НачатьЗамерВремени(ОперацияАпдекс);
	//---АК
КонецПроцедуры
//-- АК LUZA 13.02.2018


//++ АК LUZA 13.02.2018
//Запрет создания дублей
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	//+++АК SUVV 2018.03.15 ИП-00018025
	//Если НЕ ЗначениеЗаполнено(ДокументОснование) Тогда
	//+++АК SUVV 2018.03.15 ИП-00018025
	Если НЕ ЗначениеЗаполнено(ДокументОснование) или ТипЗнч(ДокументОснование) = Тип("ДокументСсылка.НачислениеАренднойПлатыОтАрендодателей") Тогда
	//---АК SUVV
		возврат;
	КонецЕсли; 
			
	СтрокаСообщения = ПроверитьВозможностьЗаписиСФ(Отказ);
	
	Если Отказ Тогда
		Предупреждение(СтрокаСообщения);
	КонецЕсли; 

КонецПроцедуры
//-- АК LUZA 13.02.2018

 