
&НаКлиенте
Процедура УстановитьФлажки(Команда)
	
	Для Каждого СтрокаТаб Из ТаблицаДокументы Цикл
		СтрокаТаб.Выбран = Истина;
	КонецЦикла;	
	
КонецПроцедуры

&НаКлиенте
Процедура СнятьФлажки(Команда)
	
	Для Каждого СтрокаТаб Из ТаблицаДокументы Цикл
		СтрокаТаб.Выбран = Ложь;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура Выбрать(Команда)
	
	МассивДокументов = Новый Массив();
	Для Каждого СтрокаТаб Из ТаблицаДокументы Цикл
		Если СтрокаТаб.Выбран = Истина Тогда
			МассивДокументов.Добавить(СтрокаТаб.Документ);
		КонецЕсли;
	КонецЦикла;	
	
	Закрыть(МассивДокументов);
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Заголовок = "Подбор заказов по поставщику: " + Параметры.Поставщик;
	
	Запрос = Новый Запрос();
	Запрос.Текст = "ВЫБРАТЬ
	               |	ЗаказПоставщику.Ссылка,
	               |	ЗаказПоставщику.Номер,
	               |	ЗаказПоставщику.ДатаПоступления КАК ДатаПоступления,
	               |	ДОБАВИТЬКДАТЕ(ЗаказПоставщику.ДатаПоступления, ДЕНЬ, -1) КАК ДатаПоступленияНаСклад,
	               |	ЗаказПоставщику.Склад,
	               |	ЗаказПоставщику.Поставщик,
	               |	ЗаказПоставщику.ЗаказПоступилПолностью,
	               |	ИСТИНА КАК Выбран,
	               |	ЗаказПоставщику.Автор
	               |ИЗ
	               |	Документ.ЗаказПоставщику КАК ЗаказПоставщику
	               |ГДЕ
	               |	ЗаказПоставщику.Проведен = ИСТИНА
	               |	И ЗаказПоставщику.Поставщик = &Поставщик
				   |	И ЗаказПоставщику.Организация = &Организация
	               |	И ЗаказПоставщику.ДатаПоступления = &Дата
	               |	И ЗаказПоставщику.Склад = &Владелец
	               |	И (НЕ ЗаказПоставщику.ЗаказПоступилПолностью
	               |				И &ТолькоАктуальные
	               |			ИЛИ НЕ &ТолькоАктуальные)
	               |	И ЗаказПоставщику.Статус <> &Статус
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	ДатаПоступления УБЫВ";
				   
	Запрос.УстановитьПараметр("Поставщик", Параметры.Поставщик);
	//+++АК KIRN 2018.03.30  ИП-00018240
	Запрос.УстановитьПараметр("Организация", Параметры.Организация);
	//---АК KIRN 
	
	//Запрос.УстановитьПараметр("ДатаНач", ДобавитьМесяц(Параметры.Дата, -6));
	//Запрос.УстановитьПараметр("ДатаКон", ДобавитьМесяц(Параметры.Дата, 1));
	Запрос.УстановитьПараметр("Дата", Параметры.Дата);
	Запрос.УстановитьПараметр("Владелец", Параметры.Склад.Владелец);
	Запрос.УстановитьПараметр("ТолькоАктуальные", Параметры.ТолькоАктуальные);
	//Если Параметры.ОжидаемДляРаспределения=Истина Тогда
	//	Запрос.УстановитьПараметр("Статус", Перечисления.СтатусыЗаказовНаПоставку.ОжидаемДляРаспределения);
	//	Запрос.УстановитьПараметр("БезФильтраПоСтатусам", Ложь);
	//Иначе
	//	Запрос.УстановитьПараметр("Статус", Перечисления.СтатусыЗаказовНаПоставку.ПустаяСсылка());
	//	Запрос.УстановитьПараметр("БезФильтраПоСтатусам", Истина);
	//КонецЕсли;	
	Запрос.УстановитьПараметр("Статус", Перечисления.СтатусыЗаказовНаПоставку.ОтказОтПоставки);
	Запрос.УстановитьПараметр("ДатаАктуальностиЗаказов", НачалоДня(Параметры.Дата-24*60*60*Константы.СрокАктуальностиЗаказовПоставщикам.Получить()));
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		СтрокаТаб = ТаблицаДокументы.Добавить();
		СтрокаТаб.Выбран = Выборка.Выбран;
		СтрокаТаб.Номер = Выборка.Номер;
		СтрокаТаб.ДатаПоступления = Выборка.ДатаПоступления;
		СтрокаТаб.ДатаПоступленияНаСклад = Выборка.ДатаПоступленияНаСклад;
		СтрокаТаб.Склад = Выборка.Склад;
		СтрокаТаб.Поставщик = Выборка.Поставщик;
		СтрокаТаб.ЗаказПоступилПолностью = Выборка.ЗаказПоступилПолностью;
		СтрокаТаб.Документ = Выборка.Ссылка;
		СтрокаТаб.Автор=Выборка.Автор;
	КонецЦикла;	
	
КонецПроцедуры
