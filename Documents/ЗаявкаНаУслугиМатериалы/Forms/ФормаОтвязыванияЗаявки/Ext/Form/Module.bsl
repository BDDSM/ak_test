
&НаКлиенте
Процедура ОтвязатьОтЗаявки(Команда)
	Режим = РежимДиалогаВопрос.ДаНет;
	Текст = "Открепить документ от заявки?";
	Ответ = Вопрос(Текст, Режим, 0);
	Если Ответ = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли;
	ОткрепитьДокументСервер();
КонецПроцедуры

&НаСервере
Процедура ОткрепитьДокументСервер()
	БезКонтроля = УправлениеДопПравамиПользователей.ПолучитьПравоПользователяУпр(ПланыВидовХарактеристик.ПраваПользователей.ПрикреплениеЗаявкиКДокументамВЗакрытомПериоде, Ложь);
	Если Не БезКонтроля Тогда
		Сообщить("У вас нет прав на отвязывание заявок от поступлений");
	КонецЕсли;	
	ВыбДок = ДокПоступления;
	Если Не ЗначениеЗаполнено(ВыбДок) Тогда
		Возврат;
	КонецЕсли;
	Док=ВыбДок.ПолучитьОбъект();
	Если ТипЗнч(ВыбДок) = Тип("ДокументСсылка.ПоступлениеДопРасходов") Тогда
		Если Док.ДокументОснование = Док.ЗаявкаНаРсходованиеСредств Тогда
			Док.ДокументОснование = Неопределено;
		КонецЕсли;	
		Док.ЗаявкаНаРсходованиеСредств = Неопределено;
			
	Иначе
		Если Док.ДокументОснование = Док.Заявка Тогда
			Док.ДокументОснование = Неопределено;
		КонецЕсли;
		Док.Заявка = Неопределено;
								
	КонецЕсли;	
	Док.ОбменДанными.Загрузка = Истина;
	Док.Записать(РежимЗаписиДокумента.Запись);
	Сообщить("Документ откреплен от заявки");
КонецПроцедуры	
