
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ДатаСчета = Параметры.ДатаСчета;
	НомерСчета = Параметры.НомерСчета;
	Контрагент = Параметры.Контрагент;
	СчетКонтрагента = Параметры.СчетКонтрагента;
	СчетНаОплату = Параметры.СчетНаОплату;
	Если Не ЗначениеЗаполнено(СчетКонтрагента) Тогда
		СчетКонтрагента = Контрагент.ОсновнойБанковскийСчет;
		Если Не ЗначениеЗаполнено(СчетКонтрагента) Тогда
			ТекстЗапроса="ВЫБРАТЬ
			             |	БанковскиеСчета.Ссылка
			             |ИЗ
			             |	Справочник.БанковскиеСчета КАК БанковскиеСчета
			             |ГДЕ
			             |	БанковскиеСчета.Владелец = &Владелец
			             |	И БанковскиеСчета.ДатаЗакрытия = ДАТАВРЕМЯ(1, 1, 1)
			             |	И БанковскиеСчета.ПометкаУдаления = ЛОЖЬ";
			Запрос = Новый Запрос(ТекстЗапроса);
			Запрос.УстановитьПараметр("Владелец",Контрагент);
			Выборка = Запрос.Выполнить().Выбрать();
			Если Выборка.Следующий() Тогда
				СчетКонтрагента = Выборка.Ссылка;
			КонецЕсли;	
		КонецЕсли;	
	КонецЕсли;	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	СтруктураКартинки = ПолучитьРеквизитыСохраненияКартинки(СчетНаОплату);
	ИмяФайла = ПолучитьИмяВременногоФайла(СтруктураКартинки.Расширение);
	Если ПолучитьФайл(СтруктураКартинки.АдресКартинки, ИмяФайла, Ложь) = Истина Тогда
		ЗапуститьПриложение(ИмяФайла);
	КонецЕсли;

КонецПроцедуры

Функция ПолучитьРеквизитыСохраненияКартинки(ФайлСсылка)
	Если Лев(НРег(ФайлСсылка.Расширение),4)=".doc" Тогда
		Картинка = Новый ДвоичныеДанные(Справочники.Файлы.ПолучитьИмяФайлаДляОбъекта(ФайлСсылка));
	Иначе	
		Картинка = Новый Картинка(Справочники.Файлы.ПолучитьИмяФайлаДляОбъекта(ФайлСсылка));
	КонецЕсли;	
	
	Возврат Новый Структура("АдресКартинки, Расширение", ПоместитьВоВременноеХранилище(Картинка), ФайлСсылка.Расширение);
	
КонецФункции

&НаКлиенте
Процедура Подтверждаю(Команда)
	Закрыть(ИСТИНА)
КонецПроцедуры
