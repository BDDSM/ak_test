//+++АК VERT 2018.03.21 ИП-00018128
// Проверка на наличие исключения в регистре сведений ИсключенияКонтроляПоЗаявкамНаУслугиМатериалы для данного документа и статьи ДДС
// Если СтатьяДДС или документ в регистре - тогда истина, иначе ложь
// Параметры:
//  Документ  - ДокументСсылка.ЗаявкаНаУслугиМатериалы- документ, для которого контролируется исключение
//                 <продолжение описания параметра>
//  СтатьяДДС  - справочникссылка.СтатьиДвиженияДенежныхСредств> - СтатьяДДС, для которой выполняется контроль
//
// Возвращаемое значение:
//   булево   - СтатьяДДС или документ в регистре - тогда истина, иначе ложь
//
Функция ИсключениеКонтроля(Документ, СтатьяДДС) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	ИсключенияКонтроляПоЗаявкамНаУслугиМатериалы.СтатьяДДС
		|ИЗ
		|	РегистрСведений.ИсключенияКонтроляПоЗаявкамНаУслугиМатериалы КАК ИсключенияКонтроляПоЗаявкамНаУслугиМатериалы
		|ГДЕ
		|	(ИсключенияКонтроляПоЗаявкамНаУслугиМатериалы.СтатьяДДС = &СтатьяДДС
		|			ИЛИ ИсключенияКонтроляПоЗаявкамНаУслугиМатериалы.Документ = &Документ
		|				И ИсключенияКонтроляПоЗаявкамНаУслугиМатериалы.Документ <> ЗНАЧЕНИЕ(Документ.ЗаявкаНаУслугиМатериалы.ПустаяСсылка))";
	
	Запрос.УстановитьПараметр("Документ", Документ);
	Запрос.УстановитьПараметр("СтатьяДДС", СтатьяДДС);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Возврат Не РезультатЗапроса.Пустой();
КонецФункции // ИсключениеКонтроля()

//+++АК VERT 2018.03.21 ИП-00018128
Функция ПроверитьКорректностьРеквизитов(Объект ) Экспорт
	
	Результат = Новый Структура;
	
	Результат.Вставить("Контрагент",Объект.Контрагент);
	Результат.Вставить("Договор",Объект.ДоговорКонтрагента);
	Результат.Вставить("ДатаПроверки",?(ЗначениеЗаполнено(Объект.Дата),Объект.Дата,ТекущаяДата()));
	
	СтруктураОшибок = ПроверкаРеквизитов.СтруктураОшибокРеквизитов();	
	ЗаполнитьЗначенияСвойств(СтруктураОшибок,ПроверкаРеквизитов.ПроверитьСрокДоговора(Результат.Договор,Результат.ДатаПроверки));
	ЗаполнитьЗначенияСвойств(СтруктураОшибок,ПроверкаРеквизитов.ПроверитьРекомендацииКонтрагента(Результат.Контрагент,Результат.ДатаПроверки));
	//+++АК POZM 2018.10.12 ИП-00020020.01       
	#Область АК_ОтключенныйКод 
	////+++АК sils 03.09.2018 ИП-00019634
	////ЗаполнитьЗначенияСвойств(СтруктураОшибок,ПроверкаРеквизитов.ПроверитьСтопОплату(Результат.Контрагент,Результат.ДатаПроверки));
	//Если ЗначениеЗаполнено(Объект.Организация) Тогда
	//	ЗаполнитьЗначенияСвойств(СтруктураОшибок,ПроверкаРеквизитов.ПроверитьСтопОплату(Результат.Контрагент,Результат.ДатаПроверки, Объект.Организация));
	//Иначе
	//	ЗаполнитьЗначенияСвойств(СтруктураОшибок,ПроверкаРеквизитов.ПроверитьСтопОплату(Результат.Контрагент,Результат.ДатаПроверки));
	//КонецЕсли;
	////---АК
	#КонецОбласти 
	//---АК POZM 
	
	Результат.Вставить("ЕстьОшибки", ПроверкаРеквизитов.ЕстьОшибки(СтруктураОшибок));
	Результат.Вставить("СтруктураОшибок", СтруктураОшибок); //+++АК VERT 2018.03.19 ИП-00018128
	Результат.Вставить("ИсключениеИзПравил", Документы.ЗаявкаНаУслугиМатериалы.ИсключениеКонтроля(Объект.Ссылка, Объект.СтатьяДДС));
	
	ИсключениеИзПравил = Документы.ЗаявкаНаУслугиМатериалы.ИсключениеКонтроля(Объект.Ссылка, Объект.СтатьяДДС);

	Возврат Результат
	
КонецФункции

//+++АК LAGP 2018.06.05 ИП-00018530 Настройка контроля соответствия получателя ИП и номера счета для ИП
Функция СчётИПКорректный(Контрагент, СчётКонтрагента) Экспорт
	
	Если НЕ (ЗначениеЗаполнено(Контрагент) И ЗначениеЗаполнено(СчётКонтрагента)) Тогда
		Возврат Истина;	
	КонецЕсли;	
	
	Если НЕ (ТипЗнч(Контрагент) = Тип("СправочникСсылка.Контрагенты") И ТипЗнч(СчётКонтрагента) = Тип("СправочникСсылка.БанковскиеСчета")) Тогда
		Возврат Истина;
	КонецЕсли;	
		
	ОКОПФ 		= ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Контрагент, "ОКОПФ");	
	ЮрФизЛицо 	= ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Контрагент, "ЮрФизЛицо");
	
	Если ЮрФизЛицо = Перечисления.ЮрФизЛицо.ФизЛицо И ОКОПФ = Справочники.КлассификаторОКОПФ.НайтиПоКоду("91") Тогда // ОКОПФ = ИП		
		Если НЕ Лев(СчётКонтрагента, 5) = "40802" Тогда
			Возврат Ложь;	
		КонецЕсли;
	КонецЕсли;	
	
	Возврат Истина;
	
КонецФункции	