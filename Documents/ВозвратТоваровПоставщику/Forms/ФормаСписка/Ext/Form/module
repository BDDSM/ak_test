Процедура ДействияФормыПроводкиДтКт(Кнопка)

	ТекДанные = ЭлементыФормы.ДокументСписок.ТекущиеДанные;
	Если ТекДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;

	//
	БухгалтерскийУчет.ОткрытьЖурналПроводок(ТекДанные.Ссылка);

КонецПроцедуры

// Процедура вызывается при выборе пункта подменю "Структура подчиненности" меню "Перейти".
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	
	ТекДанные = ЭлементыФормы.ДокументСписок.ТекущиеДанные;
	Если ТекДанные = Неопределено тогда
		Возврат
	КонецЕсли;
	
	//
	РаботаСДиалогами.ПоказатьСтруктуруПодчиненностиДокумента(ТекДанные.Ссылка);
	
КонецПроцедуры

Процедура ДокументСписокПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		
		ВозвратТоваров = ОформлениеСтроки.ДанныеСтроки.Ссылка;
		
		Если ОтличиеОрдеровИВозвратов(ВозвратТоваров)
				И ОформлениеСтроки.ДанныеСтроки.Ссылка.Проведен Тогда
			
			ОформлениеСтроки.ЦветФона = WebЦвета.ЛососьСветлый;	
			
		КонецЕсли;
		
		Если ОформлениеСтроки.ДанныеСтроки.Ссылка.СогласованноСПоставщиком Тогда
			ОформлениеСтроки.Ячейки.СогласованноСПоставщиком.УстановитьКартинку(БиблиотекаКартинок.ВыполненоУспешно32);
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры
 
//+++ АК
Функция ОтличиеОрдеровИВозвратов(ВозвратТоваров)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ВозвратТоваров);
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВозвратТоваровПоставщикуРасходныеОрдера.РасходныйОрдер
	|ПОМЕСТИТЬ РасходныеОрдера
	|ИЗ
	|	Документ.ВозвратТоваровПоставщику.РасходныеОрдера КАК ВозвратТоваровПоставщикуРасходныеОрдера
	|ГДЕ
	|	ВозвратТоваровПоставщикуРасходныеОрдера.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасходныйОрдерТовары.Номенклатура,
	|	СУММА(РасходныйОрдерТовары.Количество) КАК Количество
	|ПОМЕСТИТЬ ТЗ_КоличествоВДокументах
	|ИЗ
	|	РасходныеОрдера КАК РасходныеОрдера
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерТовары
	|		ПО РасходныеОрдера.РасходныйОрдер = РасходныйОрдерТовары.Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	РасходныйОрдерТовары.Номенклатура
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВозвратТоваровПоставщикуТовары.Номенклатура,
	|	-СУММА(ВозвратТоваровПоставщикуТовары.ПоРасходнымОрдерам)
	|ИЗ
	|	Документ.ВозвратТоваровПоставщику.Товары КАК ВозвратТоваровПоставщикуТовары
	|ГДЕ
	|	ВозвратТоваровПоставщикуТовары.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	ВозвратТоваровПоставщикуТовары.Номенклатура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТЗ_КоличествоВДокументах.Номенклатура КАК Отличие
	|ИЗ
	|	ТЗ_КоличествоВДокументах КАК ТЗ_КоличествоВДокументах
	|
	|СГРУППИРОВАТЬ ПО
	|	ТЗ_КоличествоВДокументах.Номенклатура
	|
	|ИМЕЮЩИЕ
	|	СУММА(ТЗ_КоличествоВДокументах.Количество) <> 0";
	
	Возврат НЕ Запрос.Выполнить().Пустой();	
	
КонецФункции
//--- АК
