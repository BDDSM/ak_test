<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Сделка</dataPath>
			<field>Сделка</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДатаПлатежа</dataPath>
			<field>ДатаПлатежа</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Комплектация</dataPath>
			<field>Комплектация</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>УИН_СтрокиКомплектации</dataPath>
			<field>УИН_СтрокиКомплектации</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>УИН_Этапа</dataPath>
			<field>УИН_Этапа</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВерсияДанных</dataPath>
			<field>ВерсияДанных</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Дата</dataPath>
			<field>Дата</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПометкаУдаления</dataPath>
			<field>ПометкаУдаления</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НомерСтроки</dataPath>
			<field>НомерСтроки</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Номер</dataPath>
			<field>Номер</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Проведен</dataPath>
			<field>Проведен</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВариантРасчетаНДС</dataPath>
			<field>ВариантРасчетаНДС</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДатаАкта</dataPath>
			<field>ДатаАкта</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДатаГотовности</dataPath>
			<field>ДатаГотовности</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДатаГотовностиТЧ</dataPath>
			<field>ДатаГотовностиТЧ</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Количество</dataPath>
			<field>Количество</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Комментарий</dataPath>
			<field>Комментарий</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Контрагент</dataPath>
			<field>Контрагент</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Магазин</dataPath>
			<field>Магазин</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Номенклатура</dataPath>
			<field>Номенклатура</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НомерАкта</dataPath>
			<field>НомерАкта</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Оплачено</dataPath>
			<field>Оплачено</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОсталосьОплатить</dataPath>
			<field>ОсталосьОплатить</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Ответственный</dataPath>
			<field>Ответственный</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Предпоступление</dataPath>
			<field>Предпоступление</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Сумма</dataPath>
			<field>Сумма</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаНДС</dataPath>
			<field>СуммаНДС</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>УИН_Строки</dataPath>
			<field>УИН_Строки</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>УИН_СтрокиСделки</dataPath>
			<field>УИН_СтрокиСделки</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Цена</dataPath>
			<field>Цена</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КПоступлению</dataPath>
			<field>КПоступлению</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Поступление</dataPath>
			<field>Поступление</field>
			<role>
				<dcscom:periodNumber>1</dcscom:periodNumber>
				<dcscom:periodType>Main</dcscom:periodType>
			</role>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	ВложенныйЗапрос.УИН_СтрокиКомплектации,
	СУММА(ВложенныйЗапрос.СуммаОстаток) КАК СуммаОстаток,
	ВложенныйЗапрос.Комплектация
ПОМЕСТИТЬ Остатки
ИЗ
	(ВЫБРАТЬ
		РасчетыПоСделкамСПоставщикамиОстатки.УИН_СтрокиКомплектации КАК УИН_СтрокиКомплектации,
		СУММА(РасчетыПоСделкамСПоставщикамиОстатки.СуммаОстаток) КАК СуммаОстаток,
		РасчетыПоСделкамСПоставщикамиОстатки.Комплектация КАК Комплектация
	ИЗ
		РегистрНакопления.РасчетыПоСделкамСПоставщиками.Остатки(, Комплектация ССЫЛКА Документ.ПредпоступлениеПоКомплектации) КАК РасчетыПоСделкамСПоставщикамиОстатки
	ГДЕ
		РасчетыПоСделкамСПоставщикамиОстатки.Комплектация.Магазин = &amp;Магазин
	
	СГРУППИРОВАТЬ ПО
		РасчетыПоСделкамСПоставщикамиОстатки.УИН_СтрокиКомплектации,
		РасчетыПоСделкамСПоставщикамиОстатки.Комплектация
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		РасчетыПоСделкамСПоставщиками.УИН_СтрокиКомплектации,
		СУММА(РасчетыПоСделкамСПоставщиками.Сумма),
		РасчетыПоСделкамСПоставщиками.Комплектация
	ИЗ
		РегистрНакопления.РасчетыПоСделкамСПоставщиками.Остатки(, Комплектация ССЫЛКА Документ.ПоступлениеТоваровУслуг) КАК РасчетыПоСделкамСПоставщикамиОстатки
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровУслуг.Оборудование КАК ПоступлениеТоваровУслугОборудование
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
					ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
					ПО РасчетыПоСделкамСПоставщиками.Комплектация = ПредпоступлениеПоКомплектацииТовары.Ссылка
						И РасчетыПоСделкамСПоставщиками.УИН_СтрокиКомплектации = ПредпоступлениеПоКомплектацииТовары.УИН_Строки
				ПО ПоступлениеТоваровУслугОборудование.Ссылка = РасчетыПоСделкамСПоставщиками.Регистратор
					И (РасчетыПоСделкамСПоставщиками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход))
					И ПоступлениеТоваровУслугОборудование.Сделка = РасчетыПоСделкамСПоставщиками.Сделка
			ПО РасчетыПоСделкамСПоставщикамиОстатки.Комплектация = ПоступлениеТоваровУслугОборудование.Ссылка
	ГДЕ
		ПредпоступлениеПоКомплектацииТовары.Ссылка.Магазин = &amp;Магазин
	
	СГРУППИРОВАТЬ ПО
		РасчетыПоСделкамСПоставщиками.Комплектация,
		РасчетыПоСделкамСПоставщиками.УИН_СтрокиКомплектации
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		РасчетыПоСделкамСПоставщиками.УИН_СтрокиКомплектации,
		СУММА(РасчетыПоСделкамСПоставщиками.Сумма),
		РасчетыПоСделкамСПоставщиками.Комплектация
	ИЗ
		РегистрНакопления.РасчетыПоСделкамСПоставщиками.Остатки(, Комплектация ССЫЛКА Документ.ПоступлениеДопРасходов) КАК РасчетыПоСделкамСПоставщикамиОстатки
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПоступлениеДопРасходов.НоменклатураДопОборудование КАК ПоступлениеТоваровУслугОборудование
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
					ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
					ПО РасчетыПоСделкамСПоставщиками.Комплектация = ПредпоступлениеПоКомплектацииТовары.Ссылка
						И РасчетыПоСделкамСПоставщиками.УИН_СтрокиКомплектации = ПредпоступлениеПоКомплектацииТовары.УИН_Строки
				ПО ПоступлениеТоваровУслугОборудование.Ссылка = РасчетыПоСделкамСПоставщиками.Регистратор
					И (РасчетыПоСделкамСПоставщиками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход))
					И ПоступлениеТоваровУслугОборудование.Сделка = РасчетыПоСделкамСПоставщиками.Сделка
			ПО РасчетыПоСделкамСПоставщикамиОстатки.Комплектация = ПоступлениеТоваровУслугОборудование.Ссылка
	ГДЕ
		ПредпоступлениеПоКомплектацииТовары.Ссылка.Магазин = &amp;Магазин
	
	СГРУППИРОВАТЬ ПО
		РасчетыПоСделкамСПоставщиками.Комплектация,
		РасчетыПоСделкамСПоставщиками.УИН_СтрокиКомплектации) КАК ВложенныйЗапрос

СГРУППИРОВАТЬ ПО
	ВложенныйЗапрос.УИН_СтрокиКомплектации,
	ВложенныйЗапрос.Комплектация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ВложенныйЗапрос.СуммаРасход) КАК СуммаРасход,
	ВложенныйЗапрос.УИН_СтрокиКомплектации,
	ВложенныйЗапрос.Комплектация
ПОМЕСТИТЬ Оплаты
ИЗ
	(ВЫБРАТЬ
		СУММА(РасчетыПоСделкамСПоставщикамиОбороты.СуммаРасход) КАК СуммаРасход,
		РасчетыПоСделкамСПоставщикамиОбороты.УИН_СтрокиКомплектации КАК УИН_СтрокиКомплектации,
		РасчетыПоСделкамСПоставщикамиОбороты.Комплектация КАК Комплектация
	ИЗ
		РегистрНакопления.РасчетыПоСделкамСПоставщиками.Обороты(
				,
				,
				Регистратор,
				Комплектация ССЫЛКА Документ.ПредпоступлениеПоКомплектации
					И Комплектация.Магазин = &amp;Магазин) КАК РасчетыПоСделкамСПоставщикамиОбороты
	ГДЕ
		РасчетыПоСделкамСПоставщикамиОбороты.Комплектация.Магазин = &amp;Магазин
		И РасчетыПоСделкамСПоставщикамиОбороты.Регистратор ССЫЛКА Документ.РасходИзБанка
	
	СГРУППИРОВАТЬ ПО
		РасчетыПоСделкамСПоставщикамиОбороты.УИН_СтрокиКомплектации,
		РасчетыПоСделкамСПоставщикамиОбороты.Комплектация
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		РасчетыПоСделкамСПоставщиками.Сумма,
		ПредпоступлениеПоКомплектацииТовары.УИН_Строки,
		ПредпоступлениеПоКомплектацииТовары.Ссылка
	ИЗ
		РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровУслуг.Оборудование КАК ПоступлениеТоваровУслугОборудование
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
				ПО ПоступлениеТоваровУслугОборудование.Предпоступление = ПредпоступлениеПоКомплектацииТовары.Ссылка
					И ПоступлениеТоваровУслугОборудование.Номенклатура = ПредпоступлениеПоКомплектацииТовары.Номенклатура
					И ПоступлениеТоваровУслугОборудование.Сделка = ПредпоступлениеПоКомплектацииТовары.Сделка
			ПО РасчетыПоСделкамСПоставщиками.Комплектация = ПоступлениеТоваровУслугОборудование.Ссылка
	ГДЕ
		ПредпоступлениеПоКомплектацииТовары.Ссылка.Магазин = &amp;Магазин
		И РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.РасходИзБанка
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		РасчетыПоСделкамСПоставщиками.Сумма,
		ПредпоступлениеПоКомплектацииТовары.УИН_Строки,
		ПредпоступлениеПоКомплектацииТовары.Ссылка
	ИЗ
		РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПоступлениеДопРасходов.НоменклатураДопОборудование КАК ПоступлениеТоваровУслугОборудование
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
				ПО ПоступлениеТоваровУслугОборудование.Предпоступление = ПредпоступлениеПоКомплектацииТовары.Ссылка
					И ПоступлениеТоваровУслугОборудование.Номенклатура = ПредпоступлениеПоКомплектацииТовары.Номенклатура
					И ПоступлениеТоваровУслугОборудование.Сделка = ПредпоступлениеПоКомплектацииТовары.Сделка
			ПО РасчетыПоСделкамСПоставщиками.Комплектация = ПоступлениеТоваровУслугОборудование.Ссылка
	ГДЕ
		ПредпоступлениеПоКомплектацииТовары.Ссылка.Магазин = &amp;Магазин
		И РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.РасходИзБанка) КАК ВложенныйЗапрос

СГРУППИРОВАТЬ ПО
	ВложенныйЗапрос.УИН_СтрокиКомплектации,
	ВложенныйЗапрос.Комплектация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТМЦКПоступлениюОстатки.Предпоступление,
	ТМЦКПоступлениюОстатки.Номенклатура,
	ТМЦКПоступлениюОстатки.КоличествоОстаток
ПОМЕСТИТЬ КПоступлению
ИЗ
	РегистрНакопления.ТМЦКПоступлению.Остатки КАК ТМЦКПоступлениюОстатки
ГДЕ
	ТМЦКПоступлениюОстатки.Предпоступление.Магазин = &amp;Магазин
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТМЦКПоступлению.Номенклатура,
	ТМЦКПоступлению.Сделка,
	ТМЦКПоступлению.Предпоступление,
	СУММА(ТМЦКПоступлению.Количество) КАК Количество,
	ТМЦКПоступлению.Регистратор КАК Поступление
ПОМЕСТИТЬ Поступления
ИЗ
	РегистрНакопления.ТМЦКПоступлению КАК ТМЦКПоступлению
ГДЕ
	ТМЦКПоступлению.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	И (ТМЦКПоступлению.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
			ИЛИ ТМЦКПоступлению.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов)

СГРУППИРОВАТЬ ПО
	ТМЦКПоступлению.Номенклатура,
	ТМЦКПоступлению.Сделка,
	ТМЦКПоступлению.Предпоступление,
	ТМЦКПоступлению.Регистратор
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредпоступлениеПоКомплектации.Ссылка КАК Предпоступление,
	ПредпоступлениеПоКомплектации.ВерсияДанных,
	ПредпоступлениеПоКомплектации.ПометкаУдаления,
	ПредпоступлениеПоКомплектации.Номер,
	ПредпоступлениеПоКомплектации.Дата,
	ПредпоступлениеПоКомплектации.Проведен,
	ПредпоступлениеПоКомплектации.Магазин,
	ВложенныйЗапрос.Контрагент,
	ПредпоступлениеПоКомплектации.ВариантРасчетаНДС,
	ПредпоступлениеПоКомплектации.ДатаАкта,
	ПредпоступлениеПоКомплектации.НомерАкта,
	ПредпоступлениеПоКомплектации.ДатаГотовности,
	ПредпоступлениеПоКомплектации.Ответственный,
	ПредпоступлениеПоКомплектации.Комментарий,
	ПредпоступлениеПоКомплектацииТовары.НомерСтроки,
	ПредпоступлениеПоКомплектацииТовары.Номенклатура,
	ПредпоступлениеПоКомплектацииТовары.Количество,
	ПредпоступлениеПоКомплектацииТовары.Цена,
	ПредпоступлениеПоКомплектацииТовары.Сделка,
	ПредпоступлениеПоКомплектацииТовары.УИН_СтрокиСделки,
	ПредпоступлениеПоКомплектацииТовары.УИН_Строки,
	ПредпоступлениеПоКомплектацииТовары.СуммаНДС,
	ПредпоступлениеПоКомплектацииТовары.Сумма,
	ПредпоступлениеПоКомплектацииТовары.ДатаГотовности КАК ДатаГотовностиТЧ,
	ЕСТЬNULL(Остатки.СуммаОстаток, 0) КАК ОсталосьОплатить,
	Оплаты.СуммаРасход КАК Оплачено,
	КПоступлению.КоличествоОстаток КАК КПоступлению,
	Поступления.Поступление
ИЗ
	(ВЫБРАТЬ
		СделкаСПоставщиком.Контрагент КАК Контрагент
	ИЗ
		Документ.СделкаСПоставщиком КАК СделкаСПоставщиком
	ГДЕ
		СделкаСПоставщиком.Проведен
	
	СГРУППИРОВАТЬ ПО
		СделкаСПоставщиком.Контрагент) КАК ВложенныйЗапрос
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации КАК ПредпоступлениеПоКомплектации
			ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
				ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
				ПО ПредпоступлениеПоКомплектацииТовары.УИН_Строки = Остатки.УИН_СтрокиКомплектации
					И ПредпоступлениеПоКомплектацииТовары.Ссылка = Остатки.Комплектация
				ЛЕВОЕ СОЕДИНЕНИЕ КПоступлению КАК КПоступлению
				ПО ПредпоступлениеПоКомплектацииТовары.Номенклатура = КПоступлению.Номенклатура
					И ПредпоступлениеПоКомплектацииТовары.Ссылка = КПоступлению.Предпоступление
				ЛЕВОЕ СОЕДИНЕНИЕ Поступления КАК Поступления
				ПО ПредпоступлениеПоКомплектацииТовары.Ссылка = Поступления.Предпоступление
					И ПредпоступлениеПоКомплектацииТовары.Сделка = Поступления.Сделка
					И ПредпоступлениеПоКомплектацииТовары.Номенклатура = Поступления.Номенклатура
				ЛЕВОЕ СОЕДИНЕНИЕ Оплаты КАК Оплаты
				ПО ПредпоступлениеПоКомплектацииТовары.УИН_Строки = Оплаты.УИН_СтрокиКомплектации
					И ПредпоступлениеПоКомплектацииТовары.Ссылка = Оплаты.Комплектация
			ПО (ПредпоступлениеПоКомплектацииТовары.Ссылка = ПредпоступлениеПоКомплектации.Ссылка)
		ПО ВложенныйЗапрос.Контрагент = ПредпоступлениеПоКомплектации.Контрагент
ГДЕ
	ПредпоступлениеПоКомплектации.Магазин = &amp;Магазин</query>
	</dataSet>
	<dataSet xsi:type="DataSetQuery">
		<name>ОплатыПоТТ</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДокументПоступления</dataPath>
			<field>ДокументПоступления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Документ поступления</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Услуга</dataPath>
			<field>Услуга</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Услуга</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Заявка</dataPath>
			<field>Заявка</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Заявка</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Магазин</dataPath>
			<field>Магазин</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Магазин</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаОплаты</dataPath>
			<field>СуммаОплаты</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сумма оплаты</v8:content>
				</v8:item>
			</title>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РасходИзБанка</dataPath>
			<field>РасходИзБанка</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Расход из банка</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:periodNumber>1</dcscom:periodNumber>
				<dcscom:periodType>Main</dcscom:periodType>
			</role>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	РасчетыПоСделкамСПоставщиками.Сделка,
	РасчетыПоСделкамСПоставщиками.Сумма КАК СуммаОплаты,
	РасчетыПоСделкамСПоставщиками.Регистратор КАК ПлатёжныйДокумент,
	ИСТИНА КАК ЭтоАванс,
	СделкаСПоставщикомГрафикОплат.Номенклатура,
	СделкаСПоставщикомГрафикОплат.СтруктурнаяЕдиница,
	СделкаСПоставщикомГрафикОплат.НомерСтрокиГрафика
ПОМЕСТИТЬ Авансы
ИЗ
	РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СделкаСПоставщиком.ГрафикОплат КАК СделкаСПоставщикомГрафикОплат
		ПО РасчетыПоСделкамСПоставщиками.Сделка = СделкаСПоставщикомГрафикОплат.Ссылка
			И РасчетыПоСделкамСПоставщиками.УИН_Этапа = СделкаСПоставщикомГрафикОплат.УИН_Строки
ГДЕ
	(РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.РасходИзБанка
			ИЛИ РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.ЗаявкаНаРасходованиеСредств)
	И РасчетыПоСделкамСПоставщиками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	И РасчетыПоСделкамСПоставщиками.Комплектация = НЕОПРЕДЕЛЕНО
	И РасчетыПоСделкамСПоставщиками.Период МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СделкаСПоставщикомГрафикОплат.Ссылка,
	СУММА(СделкаСПоставщикомГрафикОплат.СуммаОплаты) КАК СуммаОплаты,
	СделкаСПоставщикомГрафикОплат.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
	СделкаСПоставщикомГрафикОплат.Номенклатура,
	СделкаСПоставщикомГрафикОплат.Количество,
	СделкаСПоставщикомГрафикОплат.УИН_ПервойСтроки
ПОМЕСТИТЬ Сделки
ИЗ
	Документ.СделкаСПоставщиком.ГрафикОплат КАК СделкаСПоставщикомГрафикОплат
ГДЕ
	СделкаСПоставщикомГрафикОплат.Ссылка.Проведен

СГРУППИРОВАТЬ ПО
	СделкаСПоставщикомГрафикОплат.Ссылка,
	СделкаСПоставщикомГрафикОплат.СтруктурнаяЕдиница,
	СделкаСПоставщикомГрафикОплат.Номенклатура,
	СделкаСПоставщикомГрафикОплат.Количество,
	СделкаСПоставщикомГрафикОплат.УИН_ПервойСтроки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ПредпоступлениеПоКомплектацииТовары.Номенклатура,
	ПредпоступлениеПоКомплектацииТовары.Ссылка.Магазин КАК СтруктурнаяЕдиница,
	СУММА(ПредпоступлениеПоКомплектацииТовары.Сумма) КАК Сумма,
	ПредпоступлениеПоКомплектацииТовары.Сделка
ПОМЕСТИТЬ БазаРаспределенияАвансов
ИЗ
	Сделки КАК Сделки
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
		ПО Сделки.Ссылка = ПредпоступлениеПоКомплектацииТовары.Сделка
			И Сделки.Номенклатура = ПредпоступлениеПоКомплектацииТовары.Номенклатура
			И (ПредпоступлениеПоКомплектацииТовары.Ссылка.Проведен)

СГРУППИРОВАТЬ ПО
	ПредпоступлениеПоКомплектацииТовары.Сделка,
	ПредпоступлениеПоКомплектацииТовары.Номенклатура,
	ПредпоступлениеПоКомплектацииТовары.Ссылка.Магазин

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	Сделки.Номенклатура,
	Сделки.СтруктурнаяЕдиница,
	Сделки.СуммаОплаты - СУММА(ПредпоступлениеПоКомплектацииТовары.Сумма),
	Сделки.Ссылка
ИЗ
	Сделки КАК Сделки
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
		ПО Сделки.Ссылка = ПредпоступлениеПоКомплектацииТовары.Сделка
			И Сделки.Номенклатура = ПредпоступлениеПоКомплектацииТовары.Номенклатура
			И (ПредпоступлениеПоКомплектацииТовары.Ссылка.Проведен)

СГРУППИРОВАТЬ ПО
	Сделки.СтруктурнаяЕдиница,
	Сделки.Ссылка,
	Сделки.Номенклатура,
	Сделки.Количество,
	Сделки.СуммаОплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	БазаРаспределенияАвансов.Сделка,
	БазаРаспределенияАвансов.Номенклатура,
	СУММА(БазаРаспределенияАвансов.Сумма) КАК Сумма
ПОМЕСТИТЬ ИтогиПоБазе
ИЗ
	БазаРаспределенияАвансов КАК БазаРаспределенияАвансов

СГРУППИРОВАТЬ ПО
	БазаРаспределенияАвансов.Номенклатура,
	БазаРаспределенияАвансов.Сделка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	БазаРаспределенияАвансов.Номенклатура,
	БазаРаспределенияАвансов.СтруктурнаяЕдиница КАК СтруктурнаяЕдиница,
	БазаРаспределенияАвансов.Сумма,
	БазаРаспределенияАвансов.Сделка,
	ВЫРАЗИТЬ(ЕСТЬNULL(СУММА(БазаРаспределенияАвансов1.Сумма), 0) КАК ЧИСЛО(15, 2)) КАК СуммаНакопленная
ПОМЕСТИТЬ БазаАвансовДанныеСНакоплением
ИЗ
	БазаРаспределенияАвансов КАК БазаРаспределенияАвансов
		ЛЕВОЕ СОЕДИНЕНИЕ БазаРаспределенияАвансов КАК БазаРаспределенияАвансов1
		ПО БазаРаспределенияАвансов.Номенклатура = БазаРаспределенияАвансов1.Номенклатура
			И БазаРаспределенияАвансов.Сделка = БазаРаспределенияАвансов1.Сделка
			И БазаРаспределенияАвансов.СтруктурнаяЕдиница &gt; БазаРаспределенияАвансов1.СтруктурнаяЕдиница

СГРУППИРОВАТЬ ПО
	БазаРаспределенияАвансов.Номенклатура,
	БазаРаспределенияАвансов.СтруктурнаяЕдиница,
	БазаРаспределенияАвансов.Сумма,
	БазаРаспределенияАвансов.Сделка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Авансы.Сделка,
	Авансы.Номенклатура,
	Авансы.ПлатёжныйДокумент КАК ПлатёжныйДокумент,
	Авансы.ЭтоАванс,
	Авансы.НомерСтрокиГрафика,
	БазаАвансовДанныеСНакоплением.СтруктурнаяЕдиница,
	(ВЫРАЗИТЬ(Авансы.СуммаОплаты * (БазаАвансовДанныеСНакоплением.СуммаНакопленная + БазаАвансовДанныеСНакоплением.Сумма) / ИтогиПоБазе.Сумма КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(Авансы.СуммаОплаты * БазаАвансовДанныеСНакоплением.СуммаНакопленная / ИтогиПоБазе.Сумма КАК ЧИСЛО(15, 2))) КАК СуммаОплаты
ПОМЕСТИТЬ АвансыРаспределенные
ИЗ
	Авансы КАК Авансы
		ЛЕВОЕ СОЕДИНЕНИЕ БазаАвансовДанныеСНакоплением КАК БазаАвансовДанныеСНакоплением
			ПОЛНОЕ СОЕДИНЕНИЕ ИтогиПоБазе КАК ИтогиПоБазе
			ПО (ИтогиПоБазе.Сделка = БазаАвансовДанныеСНакоплением.Сделка)
				И (ИтогиПоБазе.Номенклатура = БазаАвансовДанныеСНакоплением.Номенклатура)
		ПО Авансы.Сделка = БазаАвансовДанныеСНакоплением.Сделка
			И Авансы.Номенклатура = БазаАвансовДанныеСНакоплением.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	АвансыРаспределенные.Сделка,
	АвансыРаспределенные.СуммаОплаты КАК СуммаОплаты,
	АвансыРаспределенные.ПлатёжныйДокумент КАК ПлатёжныйДокумент,
	АвансыРаспределенные.ЭтоАванс КАК ЭтоАванс,
	АвансыРаспределенные.Номенклатура,
	АвансыРаспределенные.СтруктурнаяЕдиница,
	АвансыРаспределенные.НомерСтрокиГрафика
ПОМЕСТИТЬ ОплатаАдресная
ИЗ
	АвансыРаспределенные КАК АвансыРаспределенные

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	РасчетыПоСделкамСПоставщиками.Сделка,
	РасчетыПоСделкамСПоставщиками.Сумма,
	РасчетыПоСделкамСПоставщиками.Регистратор,
	ЛОЖЬ,
	ПредпоступлениеПоКомплектацииТовары.Номенклатура,
	ПредпоступлениеПоКомплектацииТовары.Ссылка.Магазин,
	СделкаСПоставщикомГрафикОплат.НомерСтрокиГрафика
ИЗ
	РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПредпоступлениеПоКомплектации.Товары КАК ПредпоступлениеПоКомплектацииТовары
		ПО РасчетыПоСделкамСПоставщиками.Сделка = ПредпоступлениеПоКомплектацииТовары.Сделка
			И РасчетыПоСделкамСПоставщиками.Комплектация = ПредпоступлениеПоКомплектацииТовары.Ссылка
			И РасчетыПоСделкамСПоставщиками.УИН_СтрокиКомплектации = ПредпоступлениеПоКомплектацииТовары.УИН_Строки
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СделкаСПоставщиком.ГрафикОплат КАК СделкаСПоставщикомГрафикОплат
		ПО РасчетыПоСделкамСПоставщиками.Сделка = СделкаСПоставщикомГрафикОплат.Ссылка
			И РасчетыПоСделкамСПоставщиками.УИН_Этапа = СделкаСПоставщикомГрафикОплат.УИН_Строки
ГДЕ
	(РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.РасходИзБанка
			ИЛИ РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.ЗаявкаНаРасходованиеСредств)
	И РасчетыПоСделкамСПоставщиками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	И РасчетыПоСделкамСПоставщиками.Комплектация ССЫЛКА Документ.ПредпоступлениеПоКомплектации
	И РасчетыПоСделкамСПоставщиками.Период МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РасчетыПоСделкамСПоставщиками.Сделка,
	РасчетыПоСделкамСПоставщиками.Комплектация КАК Поступление,
	РасчетыПоСделкамСПоставщиками.Сумма,
	РасчетыПоСделкамСПоставщиками.Регистратор КАК ПлатёжныйДокумент,
	ЛОЖЬ КАК ЭтоАванс
ПОМЕСТИТЬ ОплатаПоПоступлениям
ИЗ
	РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
ГДЕ
	(РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.РасходИзБанка
			ИЛИ РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.ЗаявкаНаРасходованиеСредств)
	И РасчетыПоСделкамСПоставщиками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	И (РасчетыПоСделкамСПоставщиками.Комплектация ССЫЛКА Документ.ПоступлениеТоваровУслуг
			ИЛИ РасчетыПоСделкамСПоставщиками.Комплектация ССЫЛКА Документ.ПоступлениеДопРасходов)
	И РасчетыПоСделкамСПоставщиками.Период МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РасчетыПоСделкамСПоставщиками.Регистратор КАК Поступление,
	РасчетыПоСделкамСПоставщиками.Сделка,
	СделкаСПоставщикомГрафикОплат.НомерСтрокиГрафика,
	СделкаСПоставщикомГрафикОплат.Номенклатура,
	РасчетыПоСделкамСПоставщиками.Комплектация.Магазин КАК СтруктурнаяЕдиница,
	РасчетыПоСделкамСПоставщиками.Сумма
ПОМЕСТИТЬ РасшифровкаПоступлений
ИЗ
	РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СделкаСПоставщиком.ГрафикОплат КАК СделкаСПоставщикомГрафикОплат
		ПО РасчетыПоСделкамСПоставщиками.Сделка = СделкаСПоставщикомГрафикОплат.Ссылка
			И РасчетыПоСделкамСПоставщиками.УИН_Этапа = СделкаСПоставщикомГрафикОплат.УИН_Строки
ГДЕ
	РасчетыПоСделкамСПоставщиками.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	И (РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
			ИЛИ РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РасшифровкаПоступлений.Поступление,
	РасшифровкаПоступлений.Сделка,
	РасшифровкаПоступлений.СтруктурнаяЕдиница,
	СУММА(РасшифровкаПоступлений.Сумма) КАК Сумма
ПОМЕСТИТЬ ИтогиРасшифровкиПоступлений
ИЗ
	РасшифровкаПоступлений КАК РасшифровкаПоступлений

СГРУППИРОВАТЬ ПО
	РасшифровкаПоступлений.СтруктурнаяЕдиница,
	РасшифровкаПоступлений.Поступление,
	РасшифровкаПоступлений.Сделка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	РасшифровкаПоступлений.Поступление,
	РасшифровкаПоступлений.Сделка,
	РасшифровкаПоступлений.СтруктурнаяЕдиница,
	РасшифровкаПоступлений.Сумма,
	РасшифровкаПоступлений.НомерСтрокиГрафика,
	РасшифровкаПоступлений.Номенклатура,
	ЕСТЬNULL(СУММА(РасшифровкаПоступлений1.Сумма), 0) КАК СуммаНакопленная
ПОМЕСТИТЬ РасшифровкаПоступленийСНакоплением
ИЗ
	РасшифровкаПоступлений КАК РасшифровкаПоступлений
		ЛЕВОЕ СОЕДИНЕНИЕ РасшифровкаПоступлений КАК РасшифровкаПоступлений1
		ПО РасшифровкаПоступлений.Сделка = РасшифровкаПоступлений1.Сделка
			И РасшифровкаПоступлений.СтруктурнаяЕдиница = РасшифровкаПоступлений1.СтруктурнаяЕдиница
			И РасшифровкаПоступлений.Поступление = РасшифровкаПоступлений1.Поступление
			И РасшифровкаПоступлений.Номенклатура &gt; РасшифровкаПоступлений1.Номенклатура

СГРУППИРОВАТЬ ПО
	РасшифровкаПоступлений.Поступление,
	РасшифровкаПоступлений.Сделка,
	РасшифровкаПоступлений.СтруктурнаяЕдиница,
	РасшифровкаПоступлений.Сумма,
	РасшифровкаПоступлений.НомерСтрокиГрафика,
	РасшифровкаПоступлений.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатаПоПоступлениям.Сделка,
	ОплатаПоПоступлениям.Поступление,
	ОплатаПоПоступлениям.ПлатёжныйДокумент,
	ОплатаПоПоступлениям.ЭтоАванс,
	РасшифровкаПоступленийСНакоплением.СтруктурнаяЕдиница,
	РасшифровкаПоступленийСНакоплением.НомерСтрокиГрафика КАК НомерЭтапа,
	(ВЫРАЗИТЬ(ОплатаПоПоступлениям.Сумма * (РасшифровкаПоступленийСНакоплением.СуммаНакопленная + РасшифровкаПоступленийСНакоплением.Сумма) / ИтогиРасшифровкиПоступлений.Сумма КАК ЧИСЛО(15, 2))) - (ВЫРАЗИТЬ(ОплатаПоПоступлениям.Сумма * РасшифровкаПоступленийСНакоплением.СуммаНакопленная / ИтогиРасшифровкиПоступлений.Сумма КАК ЧИСЛО(15, 2))) КАК СуммаОплаты,
	РасшифровкаПоступленийСНакоплением.Номенклатура
ПОМЕСТИТЬ ОплатаПоступленийРаспределенная
ИЗ
	ОплатаПоПоступлениям КАК ОплатаПоПоступлениям
		ЛЕВОЕ СОЕДИНЕНИЕ ИтогиРасшифровкиПоступлений КАК ИтогиРасшифровкиПоступлений
			ЛЕВОЕ СОЕДИНЕНИЕ РасшифровкаПоступленийСНакоплением КАК РасшифровкаПоступленийСНакоплением
			ПО ИтогиРасшифровкиПоступлений.Поступление = РасшифровкаПоступленийСНакоплением.Поступление
				И ИтогиРасшифровкиПоступлений.Сделка = РасшифровкаПоступленийСНакоплением.Сделка
				И ИтогиРасшифровкиПоступлений.СтруктурнаяЕдиница = РасшифровкаПоступленийСНакоплением.СтруктурнаяЕдиница
		ПО ОплатаПоПоступлениям.Сделка = ИтогиРасшифровкиПоступлений.Сделка
			И ОплатаПоПоступлениям.Поступление = ИтогиРасшифровкиПоступлений.Поступление
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатаПоступленийРаспределенная.Сделка,
	ОплатаПоступленийРаспределенная.Поступление,
	ОплатаПоступленийРаспределенная.ПлатёжныйДокумент,
	ОплатаПоступленийРаспределенная.ЭтоАванс,
	ОплатаПоступленийРаспределенная.СтруктурнаяЕдиница,
	ОплатаПоступленийРаспределенная.НомерЭтапа,
	ОплатаПоступленийРаспределенная.СуммаОплаты,
	ОплатаПоступленийРаспределенная.Номенклатура КАК Номенклатура,
	"Оплата" КАК ВидОперации,
	ОплатаПоступленийРаспределенная.ПлатёжныйДокумент.Дата КАК ДатаОперации,
	ОплатаПоступленийРаспределенная.ПлатёжныйДокумент КАК Документ
ПОМЕСТИТЬ ВсеОплаты
ИЗ
	ОплатаПоступленийРаспределенная КАК ОплатаПоступленийРаспределенная

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ОплатаАдресная.Сделка,
	NULL,
	ОплатаАдресная.ПлатёжныйДокумент,
	ОплатаАдресная.ЭтоАванс,
	ОплатаАдресная.СтруктурнаяЕдиница,
	ОплатаАдресная.НомерСтрокиГрафика,
	ОплатаАдресная.СуммаОплаты,
	ОплатаАдресная.Номенклатура,
	"Оплата",
	ОплатаАдресная.ПлатёжныйДокумент.Дата,
	ОплатаАдресная.ПлатёжныйДокумент
ИЗ
	ОплатаАдресная КАК ОплатаАдресная
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВсеОплаты.Сделка,
	ЕСТЬNULL(ВложенныйЗапрос.РасходИзБанка, ВсеОплаты.ПлатёжныйДокумент) КАК РасходИзБанка,
	ВсеОплаты.ЭтоАванс,
	ВсеОплаты.СтруктурнаяЕдиница,
	СУММА(ВсеОплаты.СуммаОплаты) КАК СуммаОплаты,
	ВсеОплаты.Номенклатура
ПОМЕСТИТЬ ОплатыПоСДелкам
ИЗ
	ВсеОплаты КАК ВсеОплаты
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			МАКСИМУМ(РасходИзБанка.Ссылка) КАК РасходИзБанка,
			ЗаявкаНаРасходованиеСредствДок.Ссылка КАК Заявка
		ИЗ
			РегистрНакопления.РасчетыПоСделкамСПоставщиками КАК РасчетыПоСделкамСПоставщиками
				ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РасходИзБанка КАК РасходИзБанка
					ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаРасходованиеСредств КАК ЗаявкаНаРасходованиеСредствДок
					ПО РасходИзБанка.ЗаявкаНаРасходованиеСредств = ЗаявкаНаРасходованиеСредствДок.Ссылка
				ПО (РасчетыПоСделкамСПоставщиками.Регистратор = ЗаявкаНаРасходованиеСредствДок.Ссылка)
		ГДЕ
			РасходИзБанка.Проведен
			И ЗаявкаНаРасходованиеСредствДок.Проведен
			И РасчетыПоСделкамСПоставщиками.Регистратор ССЫЛКА Документ.ЗаявкаНаРасходованиеСредств
		
		СГРУППИРОВАТЬ ПО
			ЗаявкаНаРасходованиеСредствДок.Ссылка) КАК ВложенныйЗапрос
		ПО ВсеОплаты.ПлатёжныйДокумент = ВложенныйЗапрос.Заявка

СГРУППИРОВАТЬ ПО
	ВсеОплаты.СтруктурнаяЕдиница,
	ВсеОплаты.ЭтоАванс,
	ВсеОплаты.Сделка,
	ВсеОплаты.Номенклатура,
	ЕСТЬNULL(ВложенныйЗапрос.РасходИзБанка, ВсеОплаты.ПлатёжныйДокумент)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОплатыПоСДелкам.Сделка КАК ЗаявкаС,
	ОплатыПоСДелкам.РасходИзБанка КАК РасходИзБанкаС,
	ОплатыПоСДелкам.ЭтоАванс КАК ЭтоАвансС,
	ОплатыПоСДелкам.СтруктурнаяЕдиница КАК МагазинС,
	ОплатыПоСДелкам.СуммаОплаты КАК СуммаС,
	ОплатыПоСДелкам.Номенклатура КАК УслугаС,
	МАКСИМУМ(ЕСТЬNULL(ПоступлениеТоваровУслугОборудование.Ссылка, ПоступлениеДопРасходовНоменклатураДопОборудование.Ссылка)) КАК ДокументПоступленияС,
	ОплатыПоСДелкам.РасходИзБанка.ДатаОплаты КАК ДатаОплатыС,
	ОплатыПоСДелкам.РасходИзБанка.СтатьяДвиженияДенежныхСредств КАК СтатьяДДСС,
	ОплатыПоСДелкам.РасходИзБанка.Организация КАК ОрганизацияС,
	ОплатыПоСДелкам.РасходИзБанка.Контрагент КАК КонтрагентС,
	ОплатыПоСДелкам.РасходИзБанка.ДоговорКонтрагента КАК ДоговорКонтрагентаС
ПОМЕСТИТЬ ВыборкаВсего
ИЗ
	ОплатыПоСДелкам КАК ОплатыПоСДелкам
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровУслуг.Оборудование КАК ПоступлениеТоваровУслугОборудование
		ПО ОплатыПоСДелкам.Сделка = ПоступлениеТоваровУслугОборудование.Сделка
			И ОплатыПоСДелкам.Номенклатура = ПоступлениеТоваровУслугОборудование.Номенклатура
			И ОплатыПоСДелкам.СтруктурнаяЕдиница = ПоступлениеТоваровУслугОборудование.Предпоступление.Магазин
			И (ПоступлениеТоваровУслугОборудование.Предпоступление.Проведен)
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеДопРасходов.НоменклатураДопОборудование КАК ПоступлениеДопРасходовНоменклатураДопОборудование
		ПО ОплатыПоСДелкам.Сделка = ПоступлениеДопРасходовНоменклатураДопОборудование.Сделка
			И ОплатыПоСДелкам.Номенклатура = ПоступлениеДопРасходовНоменклатураДопОборудование.Номенклатура
			И ОплатыПоСДелкам.СтруктурнаяЕдиница = ПоступлениеДопРасходовНоменклатураДопОборудование.Предпоступление.Магазин
			И (ПоступлениеДопРасходовНоменклатураДопОборудование.Предпоступление.Проведен)
ГДЕ
	ОплатыПоСДелкам.РасходИзБанка.Дата МЕЖДУ &amp;НачалоПериода И &amp;КонецПериода

СГРУППИРОВАТЬ ПО
	ОплатыПоСДелкам.Сделка,
	ОплатыПоСДелкам.РасходИзБанка,
	ОплатыПоСДелкам.ЭтоАванс,
	ОплатыПоСДелкам.СтруктурнаяЕдиница,
	ОплатыПоСДелкам.СуммаОплаты,
	ОплатыПоСДелкам.Номенклатура,
	ОплатыПоСДелкам.РасходИзБанка.ДатаОплаты,
	ОплатыПоСДелкам.РасходИзБанка.СтатьяДвиженияДенежныхСредств,
	ОплатыПоСДелкам.РасходИзБанка.Организация,
	ОплатыПоСДелкам.РасходИзБанка.Контрагент,
	ОплатыПоСДелкам.РасходИзБанка.ДоговорКонтрагента
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВложенныйЗапрос.ЗаявкаС КАК Заявка,
	ВложенныйЗапрос.МагазинС КАК Магазин,
	ВложенныйЗапрос.УслугаС КАК Услуга,
	ВложенныйЗапрос.ДокументПоступленияС КАК ДокументПоступления,
	ВложенныйЗапрос.СуммаС КАК СуммаОплаты,
	ВложенныйЗапрос.РасходИзБанкаС КАК РасходИзБанка
ИЗ
	(ВЫБРАТЬ
		ВыборкаВсего.ЗаявкаС КАК ЗаявкаС,
		ВыборкаВсего.МагазинС КАК МагазинС,
		ВыборкаВсего.УслугаС КАК УслугаС,
		ВыборкаВсего.ДокументПоступленияС КАК ДокументПоступленияС,
		ВыборкаВсего.СуммаС КАК СуммаС,
		ВыборкаВсего.РасходИзБанкаС КАК РасходИзБанкаС
	ИЗ
		ВыборкаВсего КАК ВыборкаВсего) КАК ВложенныйЗапрос
ГДЕ
	ВложенныйЗапрос.МагазинС = &amp;Магазин</query>
	</dataSet>
	<dataSetLink>
		<sourceDataSet>НаборДанных1</sourceDataSet>
		<destinationDataSet>ОплатыПоТТ</destinationDataSet>
		<sourceExpression>Сделка</sourceExpression>
		<destinationExpression>Заявка</destinationExpression>
	</dataSetLink>
	<dataSetLink>
		<sourceDataSet>НаборДанных1</sourceDataSet>
		<destinationDataSet>ОплатыПоТТ</destinationDataSet>
		<sourceExpression>Номенклатура</sourceExpression>
		<destinationExpression>Услуга</destinationExpression>
	</dataSetLink>
	<dataSetLink>
		<sourceDataSet>НаборДанных1</sourceDataSet>
		<destinationDataSet>ОплатыПоТТ</destinationDataSet>
		<sourceExpression>Поступление</sourceExpression>
		<destinationExpression>ДокументПоступления</destinationExpression>
	</dataSetLink>
	<calculatedField>
		<dataPath>ОсталосьОплатитьРасч</dataPath>
		<expression>Сумма - СуммаОплаты</expression>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Осталось оплатить</v8:content>
			</v8:item>
		</title>
	</calculatedField>
	<totalField>
		<dataPath>Оплачено</dataPath>
		<expression>Сумма(Оплачено)</expression>
	</totalField>
	<totalField>
		<dataPath>ОсталосьОплатить</dataPath>
		<expression>Сумма(ОсталосьОплатить)</expression>
	</totalField>
	<totalField>
		<dataPath>Сумма</dataPath>
		<expression>Сумма(Сумма)</expression>
	</totalField>
	<totalField>
		<dataPath>СуммаНДС</dataPath>
		<expression>Сумма(СуммаНДС)</expression>
	</totalField>
	<totalField>
		<dataPath>КПоступлению</dataPath>
		<expression>Сумма(КПоступлению)</expression>
	</totalField>
	<totalField>
		<dataPath>СуммаОплаты</dataPath>
		<expression>Сумма(СуммаОплаты)</expression>
	</totalField>
	<totalField>
		<dataPath>ОсталосьОплатитьРасч</dataPath>
		<expression>Сумма(Сумма) - Сумма(СуммаОплаты)</expression>
	</totalField>
	<parameter>
		<name>Магазин</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Магазин</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.СтруктурныеЕдиницы</v8:Type>
		</valueType>
		<value xsi:type="xs:string">8352d08b-e723-11e7-8260-005056a0779c</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>НачалоПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">2016-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>КонецПериода</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Конец периода</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">2018-12-31T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Контрагент</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Предпоступление</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Номенклатура</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Количество</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Цена</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Сумма</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДатаАкта</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>НомерАкта</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДатаГотовностиТЧ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Сделка</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаОплаты</dcsset:field>
					<dcsset:lwsTitle>
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Оплачено</v8:content>
						</v8:item>
					</dcsset:lwsTitle>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ОсталосьОплатитьРасч</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КПоступлению</dcsset:field>
					<dcsset:lwsTitle>
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Осталось поступить</v8:content>
						</v8:item>
					</dcsset:lwsTitle>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Поступление</dcsset:field>
					<dcsset:lwsTitle>
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Документ поступления</v8:content>
						</v8:item>
					</dcsset:lwsTitle>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:conditionalAppearance>
				<dcsset:item>
					<dcsset:selection>
						<dcsset:item>
							<dcsset:field>Предпоступление</dcsset:field>
						</dcsset:item>
					</dcsset:selection>
					<dcsset:filter>
						<dcsset:item xsi:type="dcsset:FilterItemComparison">
							<dcsset:left xsi:type="dcscor:Field">Предпоступление.ДатаАкта</dcsset:left>
							<dcsset:comparisonType>Filled</dcsset:comparisonType>
						</dcsset:item>
					</dcsset:filter>
					<dcsset:appearance>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>ЦветФона</dcscor:parameter>
							<dcscor:value xsi:type="v8ui:Color">#CCFFCC</dcscor:value>
						</dcscor:item>
					</dcsset:appearance>
				</dcsset:item>
				<dcsset:item>
					<dcsset:selection>
						<dcsset:item>
							<dcsset:field>Предпоступление</dcsset:field>
						</dcsset:item>
					</dcsset:selection>
					<dcsset:filter>
						<dcsset:item xsi:type="dcsset:FilterItemComparison">
							<dcsset:left xsi:type="dcscor:Field">Предпоступление.ДатаАкта</dcsset:left>
							<dcsset:comparisonType>NotFilled</dcsset:comparisonType>
						</dcsset:item>
					</dcsset:filter>
					<dcsset:appearance>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>ЦветФона</dcscor:parameter>
							<dcscor:value xsi:type="v8ui:Color">#FF9900</dcscor:value>
						</dcscor:item>
					</dcsset:appearance>
				</dcsset:item>
				<dcsset:item>
					<dcsset:selection/>
					<dcsset:filter>
						<dcsset:item xsi:type="dcsset:FilterItemComparison">
							<dcsset:left xsi:type="dcscor:Field">ОсталосьОплатить</dcsset:left>
							<dcsset:comparisonType>Equal</dcsset:comparisonType>
							<dcsset:right xsi:type="xs:decimal">0</dcsset:right>
						</dcsset:item>
					</dcsset:filter>
					<dcsset:appearance>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>ЦветФона</dcscor:parameter>
							<dcscor:value xsi:type="v8ui:Color">#CCFFCC</dcscor:value>
						</dcscor:item>
					</dcsset:appearance>
				</dcsset:item>
			</dcsset:conditionalAppearance>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:groupItems>
					<dcsset:item xsi:type="dcsset:GroupItemField">
						<dcsset:field>Контрагент</dcsset:field>
						<dcsset:groupType>Items</dcsset:groupType>
						<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
						<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
						<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
					</dcsset:item>
				</dcsset:groupItems>
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
				<dcsset:item xsi:type="dcsset:StructureItemGroup">
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>Предпоступление</dcsset:field>
							<dcsset:groupType>Items</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
					<dcsset:item xsi:type="dcsset:StructureItemGroup">
						<dcsset:order>
							<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
						</dcsset:order>
						<dcsset:selection>
							<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
						</dcsset:selection>
					</dcsset:item>
				</dcsset:item>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>