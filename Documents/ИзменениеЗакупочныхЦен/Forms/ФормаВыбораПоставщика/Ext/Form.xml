<?xml version="1.0" encoding="UTF-8"?>
<Form xmlns="http://v8.1c.ru/8.3/xcf/logform" xmlns:app="http://v8.1c.ru/8.2/managed-application/core" xmlns:cfg="http://v8.1c.ru/8.1/data/enterprise/current-config" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:ent="http://v8.1c.ru/8.1/data/enterprise" xmlns:lf="http://v8.1c.ru/8.2/managed-application/logform" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows" xmlns:xr="http://v8.1c.ru/8.3/xcf/readable" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="2.4">
	<Title>
		<v8:item>
			<v8:lang>ru</v8:lang>
			<v8:content>Выбор поставщика</v8:content>
		</v8:item>
	</Title>
	<WindowOpeningMode>LockOwnerWindow</WindowOpeningMode>
	<AutoTitle>false</AutoTitle>
	<AutoCommandBar name="ФормаКоманднаяПанель" id="-1">
		<Autofill>false</Autofill>
	</AutoCommandBar>
	<Events>
		<Event name="ChoiceProcessing">ОбработкаВыбора</Event>
		<Event name="OnOpen">ПриОткрытии</Event>
		<Event name="OnCreateAtServer">ПриСозданииНаСервере</Event>
	</Events>
	<ChildItems>
		<Table name="ДоступныеПоставщики" id="26">
			<UseAlternationRowColor>true</UseAlternationRowColor>
			<EnableStartDrag>true</EnableStartDrag>
			<DataPath>ДоступныеПоставщики</DataPath>
			<RowPictureDataPath>ДоступныеПоставщики.DefaultPicture</RowPictureDataPath>
			<AutoRefresh>false</AutoRefresh>
			<AutoRefreshPeriod>60</AutoRefreshPeriod>
			<Period>
				<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
				<v8:startDate>0001-01-01T00:00:00</v8:startDate>
				<v8:endDate>0001-01-01T00:00:00</v8:endDate>
			</Period>
			<ChoiceFoldersAndItems>Items</ChoiceFoldersAndItems>
			<RestoreCurrentRow>false</RestoreCurrentRow>
			<TopLevelParent xsi:nil="true"/>
			<ShowRoot>true</ShowRoot>
			<AllowRootChoice>false</AllowRootChoice>
			<UpdateOnDataChange>Auto</UpdateOnDataChange>
			<ContextMenu name="ДоступныеПоставщикиКонтекстноеМеню" id="27"/>
			<AutoCommandBar name="ДоступныеПоставщикиКоманднаяПанель" id="28">
				<Autofill>false</Autofill>
				<ChildItems>
					<Button name="ДоступнаяНоменклатураНайти" id="71">
						<Type>CommandBarButton</Type>
						<CommandName>Form.Item.ДоступныеПоставщики.StandardCommand.Find</CommandName>
						<ExtendedTooltip name="ДоступнаяНоменклатураНайтиРасширеннаяПодсказка" id="72"/>
					</Button>
					<Button name="ДоступнаяНоменклатураОтменитьПоиск" id="73">
						<Type>CommandBarButton</Type>
						<CommandName>Form.Item.ДоступныеПоставщики.StandardCommand.CancelSearch</CommandName>
						<ExtendedTooltip name="ДоступнаяНоменклатураОтменитьПоискРасширеннаяПодсказка" id="74"/>
					</Button>
					<Button name="ДоступныеПоставщикиВсеПоставщики" id="75">
						<Type>CommandBarButton</Type>
						<UserVisible>
							<xr:Common>false</xr:Common>
							<xr:Value name="Role.РуководительЗапросИзмененияЦен">true</xr:Value>
						</UserVisible>
						<CommandName>Form.Command.ВсеПоставщики</CommandName>
						<ExtendedTooltip name="ДоступныеПоставщикиВсеПоставщикиРасширеннаяПодсказка" id="76"/>
					</Button>
				</ChildItems>
			</AutoCommandBar>
			<ExtendedTooltip name="ДоступныеПоставщикиРасширеннаяПодсказка" id="29"/>
			<SearchStringAddition name="ДоступныеПоставщикиСтрокаПоиска" id="30">
				<AdditionSource>
					<Item>ДоступныеПоставщики</Item>
					<Type>SearchStringRepresentation</Type>
				</AdditionSource>
				<Width>9</Width>
				<ContextMenu name="ДоступныеПоставщикиСтрокаПоискаКонтекстноеМеню" id="31"/>
				<ExtendedTooltip name="ДоступныеПоставщикиСтрокаПоискаРасширеннаяПодсказка" id="32"/>
			</SearchStringAddition>
			<ViewStatusAddition name="ДоступныеПоставщикиСостояниеПросмотра" id="33">
				<AdditionSource>
					<Item>ДоступныеПоставщики</Item>
					<Type>ViewStatusRepresentation</Type>
				</AdditionSource>
				<ContextMenu name="ДоступныеПоставщикиСостояниеПросмотраКонтекстноеМеню" id="34"/>
				<ExtendedTooltip name="ДоступныеПоставщикиСостояниеПросмотраРасширеннаяПодсказка" id="35"/>
			</ViewStatusAddition>
			<SearchControlAddition name="ДоступныеПоставщикиУправлениеПоиском" id="36">
				<AdditionSource>
					<Item>ДоступныеПоставщики</Item>
					<Type>SearchControl</Type>
				</AdditionSource>
				<ContextMenu name="ДоступныеПоставщикиУправлениеПоискомКонтекстноеМеню" id="37"/>
				<ExtendedTooltip name="ДоступныеПоставщикиУправлениеПоискомРасширеннаяПодсказка" id="38"/>
			</SearchControlAddition>
			<Events>
				<Event name="ValueChoice">ДоступнаяНоменклатураВыборЗначения</Event>
				<Event name="Selection">ДоступнаяНоменклатураВыбор</Event>
			</Events>
			<ChildItems>
				<LabelField name="ДоступныеПоставщикиСсылка" id="60">
					<DataPath>ДоступныеПоставщики.Ссылка</DataPath>
					<Title>
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Поставщик</v8:content>
						</v8:item>
					</Title>
					<ContextMenu name="ДоступныеПоставщикиСсылкаКонтекстноеМеню" id="61"/>
					<ExtendedTooltip name="ДоступныеПоставщикиСсылкаРасширеннаяПодсказка" id="62"/>
				</LabelField>
				<LabelField name="ДоступныеПоставщикиКод" id="45">
					<DataPath>ДоступныеПоставщики.Код</DataPath>
					<Title>
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Код</v8:content>
						</v8:item>
					</Title>
					<ContextMenu name="ДоступныеПоставщикиКодКонтекстноеМеню" id="46"/>
					<ExtendedTooltip name="ДоступныеПоставщикиКодРасширеннаяПодсказка" id="47"/>
				</LabelField>
				<LabelField name="ДоступныеПоставщикиНаименование" id="48">
					<DataPath>ДоступныеПоставщики.Наименование</DataPath>
					<Visible>false</Visible>
					<ContextMenu name="ДоступныеПоставщикиНаименованиеКонтекстноеМеню" id="49"/>
					<ExtendedTooltip name="ДоступныеПоставщикиНаименованиеРасширеннаяПодсказка" id="50"/>
					<Events>
						<Event name="Click">ДоступнаяНоменклатураНаименованиеНажатие</Event>
					</Events>
				</LabelField>
			</ChildItems>
		</Table>
	</ChildItems>
	<Attributes>
		<Attribute name="ДоступныеПоставщики" id="1">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доступные поставщики</v8:content>
				</v8:item>
			</Title>
			<Type>
				<v8:Type>cfg:DynamicList</v8:Type>
			</Type>
			<Settings xsi:type="DynamicList">
				<AutoFillAvailableFields>false</AutoFillAvailableFields>
				<ManualQuery>true</ManualQuery>
				<DynamicDataRead>false</DynamicDataRead>
				<QueryText>ВЫБРАТЬ РАЗРЕШЕННЫЕ
	Таб_Итоговая.Ссылка,
	Таб_Итоговая.Наименование,
	Таб_Итоговая.Код,
	Таб_Итоговая.НаименованиеСортировка КАК НаименованиеСортировка
ИЗ
	(ВЫБРАТЬ
		Таб_Поставщики.Поставщик КАК Ссылка,
		Таб_Поставщики.Поставщик.Наименование КАК Наименование,
		Таб_Поставщики.Поставщик.Код КАК Код,
		ВЫРАЗИТЬ(Таб_Поставщики.Поставщик.Наименование КАК СТРОКА(500)) КАК НаименованиеСортировка
	ИЗ
		(ВЫБРАТЬ РАЗЛИЧНЫЕ
			ВЫРАЗИТЬ(ДоступныеХарактеристики.Объект КАК Справочник.ХарактеристикиНоменклатуры).Владелец КАК Номенклатура,
			ДоступныеХарактеристики.Объект КАК Характеристика
		ИЗ
			(ВЫБРАТЬ
				СоответствиеОбъектРольСрезПоследних.Объект КАК Характеристика
			ИЗ
				(ВЫБРАТЬ
					РолиПользователейСоставРоли.Ссылка КАК ФункциональнаяРоль
				ИЗ
					Справочник.Пользователи КАК Пользователи
						ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.СоставРоли КАК РолиПользователейСоставРоли
							ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.ТипыРолей КАК РолиПользователейТипыРолей
							ПО (РолиПользователейТипыРолей.Ссылка = РолиПользователейСоставРоли.Ссылка)
						ПО Пользователи.ФизЛицо = РолиПользователейСоставРоли.Сотрудник
				ГДЕ
					РолиПользователейТипыРолей.ТипРоли.Код = "TechnologPoKachestvu"
					И ВЫБОР
							КОГДА &amp;ОтборПоПользователю
								ТОГДА Пользователи.Ссылка = &amp;ТекущийПользователь
							ИНАЧЕ ИСТИНА
						КОНЕЦ
					И &amp;ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар)
				
				СГРУППИРОВАТЬ ПО
					РолиПользователейСоставРоли.Ссылка
				
				ОБЪЕДИНИТЬ
				
				ВЫБРАТЬ
					РолиПользователейТипыРолей.Ссылка.Родитель
				ИЗ
					Справочник.Пользователи КАК Пользователи
						ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.СоставРоли КАК РолиПользователейСоставРоли
							ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.ТипыРолей КАК РолиПользователейТипыРолей
							ПО (РолиПользователейТипыРолей.Ссылка = РолиПользователейСоставРоли.Ссылка)
						ПО Пользователи.ФизЛицо = РолиПользователейСоставРоли.Сотрудник
				ГДЕ
					ИСТИНА
					И ВЫБОР
							КОГДА &amp;ОтборПоПользователю
								ТОГДА Пользователи.Ссылка = &amp;ТекущийПользователь
							ИНАЧЕ ИСТИНА
						КОНЕЦ
					И &amp;ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар)
				
				СГРУППИРОВАТЬ ПО
					РолиПользователейТипыРолей.Ссылка.Родитель) КАК Таб_ФункциональныеРоли
					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СоответствиеОбъектРоль.СрезПоследних(
							&amp;Период,
							ТипРолиID = "TechnologPoKachestvu"
								И Объект ССЫЛКА Справочник.ХарактеристикиНоменклатуры) КАК СоответствиеОбъектРольСрезПоследних
					ПО Таб_ФункциональныеРоли.ФункциональнаяРоль = СоответствиеОбъектРольСрезПоследних.РольПользователя) КАК Таб_ДоступныеХарактеристики
				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ДоступныеХарактеристики
				ПО Таб_ДоступныеХарактеристики.Характеристика = ДоступныеХарактеристики.Объект
					И (ДоступныеХарактеристики.Объект ССЫЛКА Справочник.ХарактеристикиНоменклатуры)
		ГДЕ
			ВЫРАЗИТЬ(ДоступныеХарактеристики.Объект КАК Справочник.ХарактеристикиНоменклатуры).Неактивная = ЛОЖЬ
		
		СГРУППИРОВАТЬ ПО
			ВЫРАЗИТЬ(ДоступныеХарактеристики.Объект КАК Справочник.ХарактеристикиНоменклатуры).Владелец,
			ДоступныеХарактеристики.Объект
		
		ОБЪЕДИНИТЬ
		
		ВЫБРАТЬ
			ВЫРАЗИТЬ(ДоступныеХарактеристики.Объект КАК Справочник.ХарактеристикиНоменклатуры).Владелец,
			ДоступныеХарактеристики.Объект
		ИЗ
			(ВЫБРАТЬ
				СоответствиеОбъектРольСрезПоследних.Объект КАК Контрагент
			ИЗ
				(ВЫБРАТЬ
					РолиПользователейСоставРоли.Ссылка КАК ФункциональнаяРоль
				ИЗ
					Справочник.Пользователи КАК Пользователи
						ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.СоставРоли КАК РолиПользователейСоставРоли
							ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.ТипыРолей КАК РолиПользователейТипыРолей
							ПО (РолиПользователейТипыРолей.Ссылка = РолиПользователейСоставРоли.Ссылка)
						ПО Пользователи.ФизЛицо = РолиПользователейСоставРоли.Сотрудник
				ГДЕ
					РолиПользователейТипыРолей.ТипРоли.Код = "TechnologPoKachestvu"
					И ВЫБОР
							КОГДА &amp;ОтборПоПользователю
								ТОГДА Пользователи.Ссылка = &amp;ТекущийПользователь
							ИНАЧЕ ИСТИНА
						КОНЕЦ
					И &amp;ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар)
				
				СГРУППИРОВАТЬ ПО
					РолиПользователейСоставРоли.Ссылка
				
				ОБЪЕДИНИТЬ
				
				ВЫБРАТЬ
					РолиПользователейТипыРолей.Ссылка.Родитель
				ИЗ
					Справочник.Пользователи КАК Пользователи
						ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.СоставРоли КАК РолиПользователейСоставРоли
							ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.ТипыРолей КАК РолиПользователейТипыРолей
							ПО (РолиПользователейТипыРолей.Ссылка = РолиПользователейСоставРоли.Ссылка)
						ПО Пользователи.ФизЛицо = РолиПользователейСоставРоли.Сотрудник
				ГДЕ
					ИСТИНА
					И ВЫБОР
							КОГДА &amp;ОтборПоПользователю
								ТОГДА Пользователи.Ссылка = &amp;ТекущийПользователь
							ИНАЧЕ ИСТИНА
						КОНЕЦ
					И &amp;ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар)
				
				СГРУППИРОВАТЬ ПО
					РолиПользователейТипыРолей.Ссылка.Родитель) КАК Таб_ФункциональныеРоли
					ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СоответствиеОбъектРоль.СрезПоследних(
							&amp;Период,
							ТипРолиID = "TechnologPoKachestvu"
								И Объект ССЫЛКА Справочник.Контрагенты) КАК СоответствиеОбъектРольСрезПоследних
					ПО Таб_ФункциональныеРоли.ФункциональнаяРоль = СоответствиеОбъектРольСрезПоследних.РольПользователя) КАК Таб_ДоступныеКонтрагенты
				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ДоступныеХарактеристики
				ПО Таб_ДоступныеКонтрагенты.Контрагент = ДоступныеХарактеристики.Значение
					И (ДоступныеХарактеристики.Объект ССЫЛКА Справочник.ХарактеристикиНоменклатуры)
		ГДЕ
			ВЫРАЗИТЬ(ДоступныеХарактеристики.Объект КАК Справочник.ХарактеристикиНоменклатуры).Неактивная = ЛОЖЬ
		
		СГРУППИРОВАТЬ ПО
			ВЫРАЗИТЬ(ДоступныеХарактеристики.Объект КАК Справочник.ХарактеристикиНоменклатуры).Владелец,
			ДоступныеХарактеристики.Объект) КАК Таб_ДоступнаяНоменклатура
			ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
				ЦеныПоставщиковСрезПоследних.Номенклатура КАК Номенклатура,
				ЦеныПоставщиковСрезПоследних.Характеристика КАК Характеристика,
				ЦеныПоставщиковСрезПоследних.Поставщик КАК Поставщик
			ИЗ
				РегистрСведений.ЦеныПоставщиков.СрезПоследних(&amp;Период, ) КАК ЦеныПоставщиковСрезПоследних
			
			СГРУППИРОВАТЬ ПО
				ЦеныПоставщиковСрезПоследних.Номенклатура,
				ЦеныПоставщиковСрезПоследних.Характеристика,
				ЦеныПоставщиковСрезПоследних.Поставщик) КАК Таб_Поставщики
			ПО Таб_ДоступнаяНоменклатура.Номенклатура = Таб_Поставщики.Номенклатура
				И Таб_ДоступнаяНоменклатура.Характеристика = Таб_Поставщики.Характеристика
	ГДЕ
		Таб_Поставщики.Поставщик &lt;&gt; ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
		И НЕ Таб_Поставщики.Поставщик.ПометкаУдаления
	
	ОБЪЕДИНИТЬ
	
	ВЫБРАТЬ
		Контрагенты.Ссылка,
		Контрагенты.Наименование,
		Контрагенты.Код,
		ВЫРАЗИТЬ(Контрагенты.Наименование КАК СТРОКА(500))
	ИЗ
		Справочник.Контрагенты КАК Контрагенты
	ГДЕ
		ВЫБОР
				КОГДА &amp;ВсеКонтрагенты
					ТОГДА ИСТИНА
				ИНАЧЕ ЛОЖЬ
			КОНЕЦ
		И НЕ Контрагенты.ПометкаУдаления
	
	ОБЪЕДИНИТЬ
	
	ВЫБРАТЬ
		ЦеныПоставщиковСрезПоследних.Поставщик,
		ЦеныПоставщиковСрезПоследних.Поставщик.Наименование,
		ЦеныПоставщиковСрезПоследних.Поставщик.Код,
		ВЫРАЗИТЬ(ЦеныПоставщиковСрезПоследних.Поставщик.Наименование КАК СТРОКА(500))
	ИЗ
		РегистрСведений.ЦеныПоставщиков.СрезПоследних(
				&amp;Период,
				НЕ &amp;ВсеКонтрагенты
					И &amp;ВидНоменклатуры &lt;&gt; ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар)
					И ВЫБОР
						КОГДА &amp;ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Материал)
							ТОГДА Номенклатура.ТипТовара = ЗНАЧЕНИЕ(Перечисление.ТипыТоваров.Упаковка)
						ИНАЧЕ Номенклатура.ВидНоменклатуры = &amp;ВидНоменклатуры
					КОНЕЦ) КАК ЦеныПоставщиковСрезПоследних
	
	СГРУППИРОВАТЬ ПО
		ЦеныПоставщиковСрезПоследних.Поставщик,
		ЦеныПоставщиковСрезПоследних.Поставщик.Наименование,
		ЦеныПоставщиковСрезПоследних.Поставщик.Код,
		ВЫРАЗИТЬ(ЦеныПоставщиковСрезПоследних.Поставщик.Наименование КАК СТРОКА(500))) КАК Таб_Итоговая

СГРУППИРОВАТЬ ПО
	Таб_Итоговая.Наименование,
	Таб_Итоговая.НаименованиеСортировка,
	Таб_Итоговая.Код,
	Таб_Итоговая.Ссылка

УПОРЯДОЧИТЬ ПО
	НаименованиеСортировка</QueryText>
				<ListSettings>
					<dcsset:filter>
						<dcsset:viewMode>Normal</dcsset:viewMode>
						<dcsset:userSettingID>dfcece9d-5077-440b-b6b3-45a5cb4538eb</dcsset:userSettingID>
					</dcsset:filter>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemField">
							<dcsset:field>НаименованиеСортировка</dcsset:field>
							<dcsset:orderType>Asc</dcsset:orderType>
						</dcsset:item>
						<dcsset:viewMode>Normal</dcsset:viewMode>
						<dcsset:userSettingID>88619765-ccb3-46c6-ac52-38e9c992ebd4</dcsset:userSettingID>
					</dcsset:order>
					<dcsset:conditionalAppearance>
						<dcsset:viewMode>Normal</dcsset:viewMode>
						<dcsset:userSettingID>b75fecce-942b-4aed-abc9-e6a02e460fb3</dcsset:userSettingID>
					</dcsset:conditionalAppearance>
				</ListSettings>
			</Settings>
		</Attribute>
		<Attribute name="ТекущееЗначение" id="2">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Текущее значение</v8:content>
				</v8:item>
			</Title>
			<Type>
				<v8:Type>cfg:CatalogRef.Контрагенты</v8:Type>
			</Type>
		</Attribute>
		<Attribute name="ОсновнойЗапрос" id="3">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Основной запрос</v8:content>
				</v8:item>
			</Title>
			<Type>
				<v8:Type>xs:string</v8:Type>
				<v8:StringQualifiers>
					<v8:Length>0</v8:Length>
					<v8:AllowedLength>Variable</v8:AllowedLength>
				</v8:StringQualifiers>
			</Type>
		</Attribute>
	</Attributes>
	<Commands>
		<Command name="Отмена" id="1">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Отмена</v8:content>
				</v8:item>
			</Title>
			<ToolTip>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Отмена</v8:content>
				</v8:item>
			</ToolTip>
			<Action>Отмена</Action>
		</Command>
		<Command name="ВсеПоставщики" id="2">
			<Title>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Все контрагенты</v8:content>
				</v8:item>
			</Title>
			<ToolTip>
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Все поставщики</v8:content>
				</v8:item>
			</ToolTip>
			<Action>ВсеПоставщики</Action>
		</Command>
	</Commands>
</Form>