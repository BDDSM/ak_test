
Функция ПолучитьДанные(Ссылки)
	
	Запрос = Новый Запрос();
	Запрос.Текст = "ВЫБРАТЬ
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	ПриходныйОрдерСкладТовары.Характеристика,
	               |	ПриходныйОрдерСкладТовары.Количество,
	               |	ЕСТЬNULL(ЗначенияСвойствОбъектов.Значение, 0) КАК КолвоВКоробке,
	               |	ПриходныйОрдерСкладТовары.ДатаПроизводства
	               |ИЗ
	               |	Документ.ПриходныйОрдерСклад.Товары КАК ПриходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
	               |		ПО ПриходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Объект
	               |			И (ЗначенияСвойствОбъектов.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	ПриходныйОрдерСкладТовары.Ссылка В(&Ссылка)";
				   
	Запрос.УстановитьПараметр("Ссылка", Ссылки);
	
	ТабДанные = Запрос.Выполнить().Выгрузить();
	ТабДанные.Колонки.Добавить("КоличествоКоробок");
	Для Каждого СтрокаТаб Из ТабДанные Цикл
		СтрокаТаб.КоличествоКоробок = ?(СтрокаТаб.КолвоВКоробке = 0, 0, Цел(СтрокаТаб.Количество / СтрокаТаб.КолвоВКоробке));
		Если СтрокаТаб.КоличествоКоробок <> ?(СтрокаТаб.КолвоВКоробке = 0, 0, Цел(СтрокаТаб.Количество / СтрокаТаб.КолвоВКоробке)) Тогда
			СтрокаТаб.КоличествоКоробок = СтрокаТаб.КоличествоКоробок + 1;
		КонецЕсли;	
		Если СтрокаТаб.КоличествоКоробок = 0 Тогда
			СтрокаТаб.КоличествоКоробок = 1;
		КонецЕсли;	
	КонецЦикла;
	ТабДанные.Свернуть("Номенклатура, Характеристика, ДатаПроизводства, КолвоВКоробке", "КоличествоКоробок");
	МассивДанные = Новый Массив();
	Для Каждого СтрокаТаб Из ТабДанные Цикл
		МассивДанные.Добавить(Новый Структура("Номенклатура, Характеристика, ДатаПроизводства, КолвоВКоробке, КоличествоКоробок", СтрокаТаб.Номенклатура, СтрокаТаб.Характеристика, СтрокаТаб.ДатаПроизводства, СтрокаТаб.КолвоВКоробке, СтрокаТаб.КоличествоКоробок));
	КонецЦикла;
	
	Возврат МассивДанные;
	
КонецФункции	

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	МассивДанные = ПолучитьДанные(ПараметрКоманды);
	
	Форма = ПолучитьФорму("Обработка.ФормированиеШтрихКодаУпаковок.Форма.Форма", Новый Структура("СформирвоатьПриОткрытии", Истина));
	Для Каждого ЭлементМассива Из МассивДанные Цикл
		СтрокаДоб = Форма.ТаблицаТоваров.Добавить();
		СтрокаДоб.Номенклатура = ЭлементМассива.Номенклатура;
		СтрокаДоб.Характеристика = ЭлементМассива.Характеристика;
		СтрокаДоб.КоличествоВУпаковке = ЭлементМассива.КолвоВКоробке;
		СтрокаДоб.КоличествоКопий = ?(ЭлементМассива.КоличествоКоробок < 1, 1, ЭлементМассива.КоличествоКоробок);
	КонецЦикла;	
	
	Форма.Открыть();
	
КонецПроцедуры
