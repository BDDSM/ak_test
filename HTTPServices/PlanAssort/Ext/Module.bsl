
Функция ИдеиGET(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
	
	Ответ = Новый HTTPСервисОтвет(200);	
	КодМенеджера = Запрос.ПараметрыЗапроса.Получить("manager");
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ПолучитьИдеи(КодМенеджера));
	Возврат Ответ;
	
КонецФункции

Функция ИдеиPOST(Запрос)
		
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
	
	Ответ = Новый HTTPСервисОтвет(200);
	ТекстJSON = Запрос.ПолучитьТелоКакСтроку();
	РаботаСПлановымАссортиментом.ЗаписьВЛог(Запрос.ОтносительныйURL, "ideas", "POST", ТекстJSON);
	Данные = РаботаСПлановымАссортиментом.ПрочитатьJSONИзСтроки(ТекстJSON);
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.СоздатьИдею(Данные));
	Возврат Ответ;
	
КонецФункции

Функция КатегорииGET(Запрос)
		
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
	
	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ПолучитьКатегории());
	Возврат Ответ;
	
КонецФункции

Функция СотрудникиGET(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ПолучитьСотрудников());
	Возврат Ответ;
	
КонецФункции

Функция РабочиеГруппыGET(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;	

	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ПолучитьРабочиеГруппы());
	Возврат Ответ;
	
КонецФункции

Функция ИдеяGET(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	Ответ = Новый HTTPСервисОтвет(200);
	НомерИдеи = Запрос.ПараметрыURL.Получить("id");
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ПолучитьИдеи(,НомерИдеи));
	Возврат Ответ;
	
КонецФункции

Функция ИдеяPATCH(Запрос)
	Ответ = Новый HTTPСервисОтвет(200);
	НомерИдеи = Запрос.ПараметрыURL.Получить("id");
	ТекстJSON = Запрос.ПолучитьТелоКакСтроку();
	РаботаСПлановымАссортиментом.ЗаписьВЛог(Запрос.ОтносительныйURL, "ideas", "PATCH", ТекстJSON);	
	Данные = РаботаСПлановымАссортиментом.ПрочитатьJSONИзСтроки(ТекстJSON);
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ИзменитьИдею(НомерИдеи, Данные));	
	Возврат Ответ;
КонецФункции

Функция ИдеяDELETE(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	НомерИдеи = Запрос.ПараметрыURL.Получить("id");
	Удалено = РаботаСПлановымАссортиментом.УдалитьИдею(НомерИдеи);
	Если ЗначениеЗаполнено(Удалено) Тогда
		Ответ = Новый HTTPСервисОтвет(200);
		Ответ.УстановитьТелоИзСтроки(Удалено);	
	Иначе
		Ответ = Новый HTTPСервисОтвет(204);
	КонецЕсли;
	Возврат Ответ;
	
КонецФункции

Функция ОбразцыGET(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	Ответ = Новый HTTPСервисОтвет(200);
	НомерИдеи = Запрос.ПараметрыЗапроса.Получить("idea_id");
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ПолучитьОбразцы(НомерИдеи));	
	Возврат Ответ;
	
КонецФункции

Функция ОбразцыPOST(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	Ответ = Новый HTTPСервисОтвет(200);
	ТекстJSON = Запрос.ПолучитьТелоКакСтроку();
	РаботаСПлановымАссортиментом.ЗаписьВЛог(Запрос.ОтносительныйURL, "samples", "POST", ТекстJSON);		
	Данные = РаботаСПлановымАссортиментом.ПрочитатьJSONИзСтроки(ТекстJSON);
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.СоздатьОбразец(Данные));
	Возврат Ответ;
	
КонецФункции

Функция ОбразецGET(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	Ответ = Новый HTTPСервисОтвет(200);
	НомерОбразца = Запрос.ПараметрыURL.Получить("id");
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ПолучитьОбразцы(,НомерОбразца));
	Возврат Ответ;
	
КонецФункции

Функция ОбразецPATCH(Запрос)
	
	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	Ответ = Новый HTTPСервисОтвет(200);
	НомерОбразца = Запрос.ПараметрыURL.Получить("id");
	ТекстJSON = Запрос.ПолучитьТелоКакСтроку();
	РаботаСПлановымАссортиментом.ЗаписьВЛог(Запрос.ОтносительныйURL, "samples", "PATCH", ТекстJSON);			
	Данные = РаботаСПлановымАссортиментом.ПрочитатьJSONИзСтроки(ТекстJSON);
	Ответ.УстановитьТелоИзСтроки(РаботаСПлановымАссортиментом.ИзменитьОбразец(НомерОбразца, Данные));	
	Возврат Ответ;
	
КонецФункции

Функция ОбразецDELETE(Запрос)

	Если НЕ Запрос.Заголовки.Получить("1S_AUTH_TOKEN") = РаботаСПлановымАссортиментом.Токен() Тогда
		Ответ = Новый HTTPСервисОтвет(403);
		Ответ.УстановитьТелоИзСтроки("Authorization error");
		Возврат Ответ;
	КонецЕсли;
		
	НомерОбразца = Запрос.ПараметрыURL.Получить("id");
	Удалено = РаботаСПлановымАссортиментом.УдалитьОбразец(НомерОбразца);
	Если ЗначениеЗаполнено(Удалено) Тогда
		Ответ = Новый HTTPСервисОтвет(200);
		Ответ.УстановитьТелоИзСтроки(Удалено);	
	Иначе
		Ответ = Новый HTTPСервисОтвет(204);
	КонецЕсли;
	Возврат Ответ;	
	
КонецФункции
