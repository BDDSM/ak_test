
Процедура ПолеТабличногоДокумента1Выбор(Элемент, Область, СтандартнаяОбработка)
	
	
КонецПроцедуры

Процедура ПолеРасшифровкиОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	
КонецПроцедуры

Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	//???ZEZA
	//Если ТипЗнч(Расшифровка) = Тип("Структура") Тогда	
	//	СтандартнаяОбработка = Ложь;
	//	ФормаОперации = Расшифровка.Документ.ПолучитьФорму();
	//	СтатьяДР = Справочники.СтатьиДоходовРасходов.НайтиПоКоду(Строка(СтатьяДР_Код));
	//	Если Расшифровка.Сумма < 0 Тогда
	//		ФормаОперации.ЭлементыФормы.ТабличноеПолеДвижения.ОтборСтрок.СубконтоКт2.Установить(СтатьяДР);
	//	Иначе
	//		ФормаОперации.ЭлементыФормы.ТабличноеПолеДвижения.ОтборСтрок.СубконтоДт2.Установить(СтатьяДР);
	//	КонецЕсли;
	//	ФормаОперации.Открыть();
	//КонецЕсли;
КонецПроцедуры







//
//
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	
	//
	ПостроительОтчета.Текст = "ВЫБРАТЬ
	                          |	Таблица.Регистратор КАК Регистратор,
	                          |	""Переменные затраты"" КАК ГруппаУр1,
	                          |	ВЫРАЗИТЬ(Таблица.Субконто2 КАК Справочник.СтатьиДоходовРасходов).Родитель КАК ГруппаУр2,
	                          |	НАЧАЛОПЕРИОДА(Таблица.Период, МЕСЯЦ) КАК Период,
	                          |	НАЧАЛОПЕРИОДА(ЕСТЬNULL(Таблица.Регистратор.ДатаВходящегоДокумента, ДАТАВРЕМЯ(1, 1, 1)), МЕСЯЦ) КАК МесяцПоРегистратору,
	                          |	ЕСТЬNULL(Таблица.Регистратор.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)) КАК ОрганизацияПоРегистратору,
	                          |	МЕСЯЦ(Таблица.Период) КАК Месяц,
	                          |	ГОД(Таблица.Период) КАК Год,
	                          |	Таблица.Счет,
	                          |	Таблица.Субконто1 КАК ТорговыеТочки,
	                          |	Таблица.Субконто2 КАК Статья,
	                          |	Таблица.Субконто3 КАК ЦФО,
	                          |	Таблица.Регистратор.Дата КАК РегистраторДата,
	                          |	Таблица.Регистратор.Контрагент КАК Контрагент,
	                          |	СУММА(Таблица.СуммаОборот) КАК Сумма
	                          |ИЗ
	                          |	РегистрБухгалтерии.Финансовый.Обороты(
	                          |			&НачалоПериода,
	                          |			&КонецПериода,
	                          |			Запись,
	                          |			Счет В ИЕРАРХИИ (&Счет44)
	                          |				И Счет <> &Счет442,
	                          |			,
	                          |			НЕ Субконто2 В ИЕРАРХИИ (&ЗатратыПостоянные)
	                          |				И НЕ Субконто2 В ИЕРАРХИИ (&УЕК)
	                          |				И Субконто2 <> &КорСубконто2
	                          |				И (&Проект = ЗНАЧЕНИЕ(Перечисление.ТипыРозничныхТочек.ПустаяСсылка)
	                          |					ИЛИ &Проект = НЕОПРЕДЕЛЕНО
	                          |					ИЛИ Субконто1.ТипРозничнойТочки = &Проект),
	                          |			НЕ КорСчет В ИЕРАРХИИ (&СчетПродажи),
	                          |			) КАК Таблица
	                          |
	                          |СГРУППИРОВАТЬ ПО
	                          |	Таблица.Регистратор,
	                          |	Таблица.Счет,
	                          |	Таблица.Субконто1,
	                          |	Таблица.Субконто2,
	                          |	Таблица.Субконто3,
	                          |	Таблица.Регистратор.Дата,
	                          |	Таблица.Регистратор.Контрагент,
	                          |	НАЧАЛОПЕРИОДА(Таблица.Период, МЕСЯЦ),
	                          |	НАЧАЛОПЕРИОДА(ЕСТЬNULL(Таблица.Регистратор.ДатаВходящегоДокумента, ДАТАВРЕМЯ(1, 1, 1)), МЕСЯЦ),
	                          |	ЕСТЬNULL(Таблица.Регистратор.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)),
	                          |	МЕСЯЦ(Таблица.Период),
	                          |	ГОД(Таблица.Период)
	                          |
	                          |ОБЪЕДИНИТЬ
	                          |
	                          |ВЫБРАТЬ
	                          |	Таблица.Регистратор,
	                          |	""Постоянные затраты"",
	                          |	ВЫРАЗИТЬ(Таблица.Субконто2 КАК Справочник.СтатьиДоходовРасходов).Родитель,
	                          |	НАЧАЛОПЕРИОДА(Таблица.Период, МЕСЯЦ),
	                          |	НАЧАЛОПЕРИОДА(ЕСТЬNULL(Таблица.Регистратор.ДатаВходящегоДокумента, ДАТАВРЕМЯ(1, 1, 1)), МЕСЯЦ),
	                          |	ЕСТЬNULL(Таблица.Регистратор.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)),
	                          |	МЕСЯЦ(Таблица.Период),
	                          |	ГОД(Таблица.Период),
	                          |	Таблица.Счет,
	                          |	Таблица.Субконто1,
	                          |	Таблица.Субконто2,
	                          |	Таблица.Субконто3,
	                          |	Таблица.Регистратор.Дата,
	                          |	Таблица.Регистратор.Контрагент,
	                          |	СУММА(Таблица.СуммаОборот)
	                          |ИЗ
	                          |	РегистрБухгалтерии.Финансовый.Обороты(
	                          |			&НачалоПериода,
	                          |			&КонецПериода,
	                          |			Запись,
	                          |			Счет В ИЕРАРХИИ (&Счет44)
	                          |				И Счет <> &Счет442,
	                          |			,
	                          |			(Субконто2 В ИЕРАРХИИ (&ЗатратыПостоянные)
	                          |				ИЛИ Субконто2 В ИЕРАРХИИ (&УЕК))
	                          |				И (&Проект = ЗНАЧЕНИЕ(Перечисление.ТипыРозничныхТочек.ПустаяСсылка)
	                          |					ИЛИ &Проект = НЕОПРЕДЕЛЕНО
	                          |					ИЛИ Субконто1.ТипРозничнойТочки = &Проект),
	                          |			НЕ КорСчет В ИЕРАРХИИ (&СчетПродажи),
	                          |			) КАК Таблица
	                          |
	                          |СГРУППИРОВАТЬ ПО
	                          |	Таблица.Регистратор,
	                          |	Таблица.Счет,
	                          |	Таблица.Субконто1,
	                          |	Таблица.Субконто2,
	                          |	Таблица.Субконто3,
	                          |	Таблица.Регистратор.Дата,
	                          |	Таблица.Регистратор.Контрагент,
	                          |	НАЧАЛОПЕРИОДА(Таблица.Период, МЕСЯЦ),
	                          |	НАЧАЛОПЕРИОДА(ЕСТЬNULL(Таблица.Регистратор.ДатаВходящегоДокумента, ДАТАВРЕМЯ(1, 1, 1)), МЕСЯЦ),
	                          |	ЕСТЬNULL(Таблица.Регистратор.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)),
	                          |	МЕСЯЦ(Таблица.Период),
	                          |	ГОД(Таблица.Период)
	                          |
	                          |ОБЪЕДИНИТЬ
	                          |
	                          |ВЫБРАТЬ
	                          |	Таблица.Регистратор,
	                          |	""Общие расходы"",
	                          |	ВЫРАЗИТЬ(Таблица.Субконто2 КАК Справочник.СтатьиДоходовРасходов).Родитель,
	                          |	НАЧАЛОПЕРИОДА(Таблица.Период, МЕСЯЦ),
	                          |	НАЧАЛОПЕРИОДА(ЕСТЬNULL(Таблица.Регистратор.ДатаВходящегоДокумента, ДАТАВРЕМЯ(1, 1, 1)), МЕСЯЦ),
	                          |	ЕСТЬNULL(Таблица.Регистратор.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)),
	                          |	МЕСЯЦ(Таблица.Период),
	                          |	ГОД(Таблица.Период),
	                          |	Таблица.Счет,
	                          |	Таблица.Субконто1,
	                          |	Таблица.Субконто2,
	                          |	Таблица.Субконто3,
	                          |	Таблица.Регистратор.Дата,
	                          |	Таблица.Регистратор.Контрагент,
	                          |	СУММА(Таблица.СуммаОборот)
	                          |ИЗ
	                          |	РегистрБухгалтерии.Финансовый.Обороты(
	                          |			&НачалоПериода,
	                          |			&КонецПериода,
	                          |			Регистратор,
	                          |			Счет = &Счет442,
	                          |			,
	                          |			Субконто2 <> &КорСубконто2
	                          |				И ВЫРАЗИТЬ(Субконто2 КАК Справочник.СтатьиДоходовРасходов).Код <> ""35018""
	                          |				И (&Проект = ЗНАЧЕНИЕ(Перечисление.ТипыРозничныхТочек.ПустаяСсылка)
	                          |					ИЛИ &Проект = НЕОПРЕДЕЛЕНО
	                          |					ИЛИ Субконто1.ТипРозничнойТочки = &Проект),
	                          |			НЕ КорСчет В ИЕРАРХИИ (&СчетПродажи),
	                          |			) КАК Таблица
	                          |
	                          |СГРУППИРОВАТЬ ПО
	                          |	Таблица.Регистратор,
	                          |	Таблица.Счет,
	                          |	Таблица.Субконто1,
	                          |	Таблица.Субконто2,
	                          |	Таблица.Субконто3,
	                          |	Таблица.Регистратор.Дата,
	                          |	Таблица.Регистратор.Контрагент,
	                          |	НАЧАЛОПЕРИОДА(Таблица.Период, МЕСЯЦ),
	                          |	НАЧАЛОПЕРИОДА(ЕСТЬNULL(Таблица.Регистратор.ДатаВходящегоДокумента, ДАТАВРЕМЯ(1, 1, 1)), МЕСЯЦ),
	                          |	ЕСТЬNULL(Таблица.Регистратор.Организация, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)),
	                          |	МЕСЯЦ(Таблица.Период),
	                          |	ГОД(Таблица.Период)
	                          |
	                          |УПОРЯДОЧИТЬ ПО
	                          |	Период,
	                          |	РегистраторДата,
	                          |	Регистратор";
							  
							  
	//
	ПостроительОтчета.ЗаполнитьНастройки();
	
	//Парметры данных
	СтруктураПараметрыДанных = СтруктураПараметров.СтруктураПараметрыДанных;
	Для Каждого ЭлементСтруктуры Из СтруктураПараметрыДанных Цикл
		
		//
		ПостроительОтчета.Параметры.Вставить(ЭлементСтруктуры.Ключ, ЭлементСтруктуры.Значение);
		
	КонецЦикла;	
	
	//Отборы
	СтруктураЗначенийРасшифровки = СтруктураПараметров.СтруктураЗначенийРасшифровки;
	Для Каждого ЭлементСтруктуры Из СтруктураЗначенийРасшифровки Цикл
		
		//
		Попытка
			ЭлементОтбора = ПостроительОтчета.Отбор.Добавить(ЭлементСтруктуры.Ключ);
		Исключение
			Продолжить;
		КонецПопытки;	
		
		//
		Если ТипЗнч(ЭлементСтруктуры.Значение) = Тип("СписокЗначений") Тогда
			
			//
			ЭлементОтбора.ВидСравнения = ВидСравнения.ВСписке;
			ЭлементОтбора.Значение = ЭлементСтруктуры.Значение;
			
		ИначеЕсли ТипЗнч(ЭлементСтруктуры.Значение) = Тип("Массив") Тогда	
			
			//
			СписокЗначений = Новый СписокЗначений;
			СписокЗначений.ЗагрузитьЗначения(ЭлементСтруктуры.Значение);
			
			//
			ЭлементОтбора.ВидСравнения = ВидСравнения.ВСписке;
			ЭлементОтбора.Значение = СписокЗначений;
			
		Иначе	
			
			//
			ЭлементОтбора.Значение = ЭлементСтруктуры.Значение;
			ЭлементОтбора.ВидСравнения = ВидСравнения.Равно;
			
		КонецЕсли;	
		
		//
		ЭлементОтбора.Использование = Истина;	
		
	КонецЦикла;	
	
	//
	Макет = ПолучитьМакет("РасшифровкаПоДокументам_Универсальный");
	
	//
	ОбластьМакета = Макет.ПолучитьОбласть("Шапка");
	
	//
	ОбластьМакета.Параметры.ДатаНач = Формат(ПостроительОтчета.Параметры.НачалоПериода, "ДФ=dd.MM.yy");
	ОбластьМакета.Параметры.ДатаКон = Формат(ПостроительОтчета.Параметры.КонецПериода, "ДФ=dd.MM.yy");
	
	//
	ОбластьМакета.Параметры.ОтборПредставление = ПостроительОтчета.Отбор;
	
	//
	ЭлементыФормы.Результат.Вывести(ОбластьМакета);
	
	//
	ПостроительОтчета.Выполнить();
	
	//
	СуммаИтого = 0;
	
	//
	Выборка = ПостроительОтчета.Результат.Выбрать();
	Пока Выборка.Следующий() Цикл
		
		//
		ОбластьМакета = Макет.ПолучитьОбласть("Строка");
		
		//
		ОбластьМакета.Параметры.Документ = Выборка.Регистратор;
		ОбластьМакета.Параметры.Контрагент = Выборка.Контрагент;
		
		//
		Попытка
			ОбластьМакета.Параметры.Комментарий = Выборка.Регистратор.Комментарий;
		Исключение
		КонецПопытки;	
		
		//
		Попытка
			Автор = Выборка.Регистратор.Автор;
		Исключение
		КонецПопытки;
		
		//
		Если НЕ ЗначениеЗаполнено(Автор) Тогда
			
			//
			Попытка
				Автор = Выборка.Регистратор.Ответственный;
			Исключение
			КонецПопытки;
			
		КонецЕсли;	
		
		//
		ОбластьМакета.Параметры.Автор = Автор;
		
		//
		ОбластьМакета.Параметры.Сумма = Выборка.Сумма;
		
		//
		СуммаИтого = СуммаИтого + Выборка.Сумма;
		
		//
		ЭлементыФормы.Результат.Вывести(ОбластьМакета);
		
	КонецЦикла;	
	
	//
	ОбластьМакета = Макет.ПолучитьОбласть("Итоги");
	ОбластьМакета.Параметры.Сумма = СуммаИтого;
	
	//
	ЭлементыФормы.Результат.Вывести(ОбластьМакета);
	
КонецПроцедуры
