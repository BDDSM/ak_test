
//+++АК LATV 2018.07.01 ИП-00019011
Функция КодДляВыполненияВПериодическихЗаданиях(ТекущаяОбработка, ОтправитьТолькоМенеджерамИзСписка = Ложь) Экспорт

	ЗапросПолучателей = Новый Запрос();
	ЗапросПолучателей.Текст =
		"ВЫБРАТЬ
		|	ПериодическиеЗаданияПолучателиРассылки.ФизЛицо КАК ФизЛицо
		|ИЗ
		|	Справочник.ПериодическиеЗадания.ПолучателиРассылки КАК ПериодическиеЗаданияПолучателиРассылки
		|ГДЕ
		|	ПериодическиеЗаданияПолучателиРассылки.Ссылка = &Задание";
	
	ЗапросПолучателей.УстановитьПараметр("Задание", ТекущаяОбработка);
	Получатели = ЗапросПолучателей.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизЛицо");
	
	// Выполнение отчета
	ВыполняемыйОтчет = Отчеты.ОтчетПоПросроченнымДепозитам.Создать();
	
	ВариантДляРассылки = ВыполняемыйОтчет.СхемаКомпоновкиДанных.ВариантыНастроек.Найти("ДляРассылки");
	ВыполняемыйОтчет.КомпоновщикНастроек.ЗагрузитьНастройки(ВариантДляРассылки.Настройки);
	
	ВыполняемыйОтчет.КомпоновщикНастроек.ФиксированныеНастройки.ДополнительныеСвойства.Вставить("РежимРассылки");
	ВыполняемыйОтчет.КомпоновщикНастроек.ФиксированныеНастройки.ДополнительныеСвойства.Вставить("Получатели", Получатели);
	
	Если ОтправитьТолькоМенеджерамИзСписка Тогда
		ВыполняемыйОтчет.КомпоновщикНастроек.ФиксированныеНастройки.ДополнительныеСвойства.Вставить("ОтправитьТолькоМенеджерамИзСписка");
	КонецЕсли;
	
	ВыполняемыйОтчет.СкомпоноватьРезультат(Новый ТабличныйДокумент, Неопределено);

КонецФункции
