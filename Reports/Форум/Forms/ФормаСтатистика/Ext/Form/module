
////////////////////////////////////////////////////////////////////////////////
// СОБЫТИЯ ФОРМЫ
////////////////////////////////////////////////////////////////////////////////

Процедура ПриОткрытии()
	
	НачПериода = ДобавитьМесяц(ТекущаяДата(), -12);
	КонПериода = ТекущаяДата();
	
	УстановитьПараметрыЗапросов();
	
	СформироватьОтчет();
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ
////////////////////////////////////////////////////////////////////////////////

Процедура НачПериодаПриИзменении(Элемент)
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("НачПериода").Значение = Элемент.Значение;
КонецПроцедуры // НачПериодаПриИзменении()

Процедура КонПериодаПриИзменении(Элемент)
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("КонПериода").Значение = Элемент.Значение;
КонецПроцедуры // КонПериодаПриИзменении()


////////////////////////////////////////////////////////////////////////////////
// НАЖАТИЕ КНОПОК
////////////////////////////////////////////////////////////////////////////////

Процедура СформироватьОтчет()
	
	ЭлементыФормы.Результат.Очистить();
	
	УстановитьПараметрыЗапросов();
	
	КомпоновщикМакета 			= Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновкиДанных 		= КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных,КомпоновщикНастроек.Настройки,ДанныеРасшифровки);
	ПроцессорКомпоновкиДанных 	= Новый ПроцессорКомпоновкиДанных;
	
	//Здесь, при необходимости, следует добавить инициализацию внешних данных, если используется источник данных типа Объект.
	//ТЗВнешниеДанные.Очистить();
	//ВнешниеНаборыДанных = Новый Структура;
	//ВнешниеНаборыДанных.Вставить("ВнешниеДанные", ТЗВнешниеДанные);
	//ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновкиДанных,ВнешниеНаборыДанных,ДанныеРасшифровки,Истина);
	
	ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновкиДанных,,ДанныеРасшифровки,Истина);
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ЭлементыФормы.Результат);
	ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);
	//Если СвернутьГруппировки Тогда
	//	ЭлементыФормы.Результат.ПоказатьУровеньГруппировокСтрок(0);
	//КонецЕсли;
	
	ЭлементыФормы.Результат.ФиксацияСверху 	= 3;
	ЭлементыФормы.Результат.ФиксацияСлева  	= 0;
	
	//ЭлементыФормы.Результат.Очистить();
	//ВнешниеНаборыДанных = Новый Структура;
	//ВнешниеНаборыДанных.Вставить("ВнешниеДанные", ВнешниеДанные);
	//КомпоновщикМакета 	= Новый КомпоновщикМакетаКомпоновкиДанных;
	//Настройки 			= КомпоновщикНастроек.ПолучитьНастройки();
	//МакетКомпоновки 	= КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, Настройки, ДанныеРасшифровки);
	//ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	//ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, ВнешниеНаборыДанных, ДанныеРасшифровки);
	//ДокументРезультат 	= ЭлементыФормы.Результат;
	//ПроцессорВывода 	= Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	//ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
	//ПроцессорВывода.НачатьВывод();
	//Пока Истина Цикл
	//	ЭлементРезультата = ПроцессорКомпоновки.Следующий();
	//	Если ЭлементРезультата = Неопределено Тогда
	//		Прервать;
	//	Иначе
	//		ПроцессорВывода.ВывестиЭлемент(ЭлементРезультата);
	//	КонецЕсли;
	//КонецЦикла;
	//ПроцессорВывода.ЗакончитьВывод();
	//ДокументРезультат.ФиксацияСверху 		= 1;
	//ДокументРезультат.ФиксацияСлева  		= 1;
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода =' 0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал 	= Истина;
	НастройкаПериода.РедактироватьКакПериод 	= Истина;
	НастройкаПериода.ВариантНастройки 			= ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
		КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("НачПериода").Значение = НачПериода;
		КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("КонПериода").Значение = КонПериода;
	КонецЕсли;
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ВСПОМОГАТЕЛЬНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ
////////////////////////////////////////////////////////////////////////////////

Процедура УстановитьПараметрыЗапросов()
	
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("НачПериода").Значение 	 = НачалоДня(НачПериода);
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("НачПериода").Использование = Истина;
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("КонПериода").Значение 	 = КонецДня(КонПериода);
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("КонПериода").Использование = Истина;
	
КонецПроцедуры
