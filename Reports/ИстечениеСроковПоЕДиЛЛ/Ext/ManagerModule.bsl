Функция КодДляВыполненияВПериодическихЗаданиях(ТекущаяОбработка) Экспорт

	ЗапросПолучателей = Новый Запрос();
	ЗапросПолучателей.Текст =
		"ВЫБРАТЬ
		|	ПериодическиеЗаданияПолучателиРассылки.ФизЛицо КАК ФизЛицо
		|ИЗ
		|	Справочник.ПериодическиеЗадания.ПолучателиРассылки КАК ПериодическиеЗаданияПолучателиРассылки
		|ГДЕ
		|	ПериодическиеЗаданияПолучателиРассылки.Ссылка = &Задание";
	
	ЗапросПолучателей.УстановитьПараметр("Задание", ТекущаяОбработка);
	Получатели = ЗапросПолучателей.Выполнить().Выгрузить().ВыгрузитьКолонку("ФизЛицо");
	
	// Выполнение отчета
	ВыполняемыйОтчет = Отчеты.ИстечениеСроковПоЕДиЛЛ.Создать();
	
	НеобходимаяСКД = ВыполняемыйОтчет.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных");
	ВыполняемыйОтчет.СхемаКомпоновкиДанных = НеобходимаяСКД;
	ВыполняемыйОтчет.КомпоновщикНастроек.ЗагрузитьНастройки(ВыполняемыйОтчет.СхемаКомпоновкиДанных.НастройкиПоУмолчанию);	
	ВыполняемыйОтчет.КомпоновщикНастроек.ФиксированныеНастройки.ДополнительныеСвойства.Вставить("РежимРассылки");
	ВыполняемыйОтчет.КомпоновщикНастроек.ФиксированныеНастройки.ДополнительныеСвойства.Вставить("Получатели", Получатели);
	ВыполняемыйОтчет.КомпоновщикНастроек.Настройки.ПараметрыДанных.УстановитьЗначениеПараметра("ДатаОтчета", КонецДня(ТекущаяДата()));
	ВыполняемыйОтчет.СкомпоноватьРезультат(Новый ТабличныйДокумент, Неопределено);
	
	НеобходимаяСКД = ВыполняемыйОтчет.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных1");
	ВыполняемыйОтчет.СхемаКомпоновкиДанных = НеобходимаяСКД;
	ВыполняемыйОтчет.КомпоновщикНастроек.ЗагрузитьНастройки(ВыполняемыйОтчет.СхемаКомпоновкиДанных.НастройкиПоУмолчанию);	
	ВыполняемыйОтчет.КомпоновщикНастроек.ФиксированныеНастройки.ДополнительныеСвойства.Вставить("РежимРассылки");
	ВыполняемыйОтчет.КомпоновщикНастроек.ФиксированныеНастройки.ДополнительныеСвойства.Вставить("Получатели", Получатели);
	ВыполняемыйОтчет.КомпоновщикНастроек.Настройки.ПараметрыДанных.УстановитьЗначениеПараметра("ДатаОтчета", КонецДня(ТекущаяДата()));
	ВыполняемыйОтчет.СкомпоноватьРезультат(Новый ТабличныйДокумент, Неопределено);

КонецФункции
