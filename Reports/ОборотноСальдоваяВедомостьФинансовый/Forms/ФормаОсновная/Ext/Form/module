Перем ВысотаЗаголовка;

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

// Обновляет таблицу отчета
//
// Параметры:
//	Нет.
//
Процедура ОбновитьОтчет() Экспорт
	
	СформироватьОтчет(ЭлементыФормы.ДокументРезультат, ПоказыватьЗаголовок, ВысотаЗаголовка);

	ЭтаФорма.ТекущийЭлемент = ЭлементыФормы.ДокументРезультат;
	
	БухгалтерскиеОтчеты.УправлениеПометкамиКнопокЗаголовковКоманднойПанели(ЭтаФорма, ПоказыватьЗаголовок);
	
КонецПроцедуры // ОбновитьОтчет()

//  Управляет выводом заголовка
//
// Параметры:
//	Нет.
//
Процедура ВыводЗаголовка()

	БухгалтерскиеОтчеты.ОбработатьВыводЗаголовка(ЭтаФорма, ЭтотОбъект, ВысотаЗаголовка, ПоказыватьЗаголовок);

КонецПроцедуры // ВыводЗаголовка()

// Формирует заголовок формы
//
// Параметры:
//	Нет.
//
Процедура СформироватьЗаголовокФормы()

	ОписаниеПериода = БухгалтерскиеОтчеты.СформироватьСтрокуОграниченийПоДатамДляФормы(ДатаНач, ДатаКон);

	Заголовок = ЗаголовокОтчета()+" (" + ОписаниеПериода + ") " +  ?(ЗначениеЗаполнено(Организация.НаименованиеПолное), Организация.НаименованиеПолное, Организация);

КонецПроцедуры // СформироватьЗаголовокФормы()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ДЕЙСТВИЯ КОМАНДНЫХ ПАНЕЛЕЙ ФОРМЫ

Процедура КнопкаНастройкаПериодаНажатие(Элемент)

	РаботаСДиалогами.ОбработчикНастройкаПериодаНажатие(ДатаНач, ДатаКон);

КонецПроцедуры // КнопкаНастройкаПериодаНажатие()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ НАЖАТИЯ КНОПОК КОМАНДНОЙ ПАНЕЛИ

Процедура КоманднаяПанельФормыНастройка(Кнопка)

	ФормаНастройка = ПолучитьФорму("ФормаНастройка", ЭтаФорма);
	
	Если ФормаНастройка.ОткрытьМодально() =  Истина Тогда

		ОбновитьОтчет();

	КонецЕсли;

КонецПроцедуры // КоманднаяПанельФормыНастройка()

Процедура КоманднаяПанельФормыСформировать(Кнопка)

	ОбновитьОтчет();

КонецПроцедуры // КоманднаяПанельФормыСформировать()

Процедура КоманднаяПанельЗаголовок(Кнопка)

	ПоказыватьЗаголовок = Не ПоказыватьЗаголовок;
	ВыводЗаголовка();

КонецПроцедуры // КоманднаяПанельЗаголовок()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПриЗакрытии()

	СтруктураОбщихПараметров = Новый Структура;
	СтруктураОбщихПараметров.Вставить("Организация", Организация);
	СтруктураОбщихПараметров.Вставить("ВыводитьРазвернутроеСальдо", ВыводитьРазвернутоеСальдо);
	СтруктураОбщихПараметров.Вставить("ДатаНач", ДатаНач);
	СтруктураОбщихПараметров.Вставить("ДатаКон", ДатаКон);
	СтруктураОбщихПараметров.Вставить("ПоЗабалансовымСчетам", ПоЗабалансовымСчетам);
	СтруктураОбщихПараметров.Вставить("ПоВалютам", ПоВалютам);
	СтруктураОбщихПараметров.Вставить("ПоСубсчетамИСубконто", ПоСубсчетамИСубконто);
	СтруктураОбщихПараметров.Вставить("ПоказыватьЗаголовок", ПоказыватьЗаголовок);
	СтруктураОбщихПараметров.Вставить("ПравилаВыводаИтогов", ПравилаВыводаИтогов);
	СтруктураОбщихПараметров.Вставить("ПравилаРазвернутогоСальдо", ПравилаРазвернутогоСальдо);

	СохранитьЗначение("ОбщиеПараметрыОтчетов"+ИмяРегистраБухгалтерии, СтруктураОбщихПараметров);

КонецПроцедуры // ПриЗакрытии()

Процедура ОбновлениеОтображения()

	СформироватьЗаголовокФормы();

КонецПроцедуры // ОбновлениеОтображения()

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)

	ТиповыеОтчеты.НазначитьФормеУникальныйКлючИдентификации(ЭтаФорма);
	
	Если РегламентированнаяОтчетность.ИДКонфигурации() <> "БП" Тогда
		// Проверка ведения однофирменности
		УчетПоВсемОрганизациям = Истина;
	КонецЕсли;

	СтруктураОбщихПараметров = ВосстановитьЗначение("ОбщиеПараметрыОтчетов"+ИмяРегистраБухгалтерии);
	Если ТипЗнч(СтруктураОбщихПараметров) = Тип("Структура") Тогда
		
		//СтруктураОбщихПараметров.Свойство("Организация", Организация);
		СтруктураОбщихПараметров.Свойство("ВыводитьРазвернутроеСальдо", ВыводитьРазвернутоеСальдо);
		СтруктураОбщихПараметров.Свойство("ПоСубсчетамИСубконто",    ПоСубсчетамИСубконто);
		СтруктураОбщихПараметров.Свойство("ПоЗабалансовымСчетам", ПоЗабалансовымСчетам);
		//СтруктураОбщихПараметров.Свойство("ПоВалютам",      ПоВалютам);
		СтруктураОбщихПараметров.Свойство("ДатаНач", ДатаНач);
		СтруктураОбщихПараметров.Свойство("ДатаКон", ДатаКон);
		
		БухгалтерскиеОтчеты.ЗаполнитьТаблицуНастроекСвойств(ЭтотОбъект, "ПравилаВыводаИтогов",       СтруктураОбщихПараметров);
		БухгалтерскиеОтчеты.ЗаполнитьТаблицуНастроекСвойств(ЭтотОбъект, "ПравилаРазвернутогоСальдо", СтруктураОбщихПараметров);
		
	КонецЕсли;

	ПоказыватьЗаголовок = Истина;
	
	ВысотаЗаголовка = 0;
	
	БухгалтерскиеОтчеты.ПоддержкаОднофирменностиДляБухОтчетов(ЭтаФорма, Организация, УчетПоВсемОрганизациям);

КонецПроцедуры // ПередОткрытием()

Процедура ПриОткрытии()
	
	ОбновитьОтчет();
	СформироватьЗаголовокФормы();	

КонецПроцедуры // ПриОткрытии()

Процедура ДокументРезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	БухгалтерскиеОтчеты.ДокументРезультатОбработкаРасшифровкиОборотноСальдовойВедомости(Элемент, Расшифровка, 
		СтандартнаяОбработка, ПоказыватьЗаголовок);

КонецПроцедуры // ДокументРезультатОбработкаРасшифровки()

Процедура ПередСохранениемЗначений(Отказ)

	СохраняемыеРеквизиты = Новый Структура;

	СохраняемыеРеквизиты.Вставить("Организация", Организация);
	СохраняемыеРеквизиты.Вставить("ПоВалютам", ПоВалютам);
	СохраняемыеРеквизиты.Вставить("ПоЗабалансовымСчетам", ПоЗабалансовымСчетам);
	СохраняемыеРеквизиты.Вставить("ПоСубсчетамИСубконто", ПоСубсчетамИСубконто);
	СохраняемыеРеквизиты.Вставить("ВыводитьРазвернутоеСальдо", ВыводитьРазвернутоеСальдо);
	СохраняемыеРеквизиты.Вставить("ПравилаВыводаИтогов", ПравилаВыводаИтогов.Скопировать());
	СохраняемыеРеквизиты.Вставить("ПравилаРазвернутогоСальдо",  ПравилаРазвернутогоСальдо.Скопировать());

КонецПроцедуры // ПередСохранениемЗначений()

Процедура ПослеВосстановленияЗначений()
	
	// Тип восстановленного значения должен быть Структура
	Если НЕ ТипЗнч(СохраняемыеРеквизиты) = Тип("Структура") Тогда 
		Возврат;
	КонецЕсли;

	СохраняемыеРеквизиты.Свойство("Организация", Организация);
	СохраняемыеРеквизиты.Свойство("ПоВалютам", ПоВалютам);
	СохраняемыеРеквизиты.Свойство("ПоЗабалансовымСчетам", ПоЗабалансовымСчетам);
	СохраняемыеРеквизиты.Свойство("ПоСубсчетамИСубконто", ПоСубсчетамИСубконто);
	СохраняемыеРеквизиты.Свойство("ВыводитьРазвернутоеСальдо", ВыводитьРазвернутоеСальдо);
	
	БухгалтерскиеОтчеты.ЗаполнитьТаблицуНастроекСвойств(ЭтотОбъект, "ПравилаВыводаИтогов",       СохраняемыеРеквизиты);
	БухгалтерскиеОтчеты.ЗаполнитьТаблицуНастроекСвойств(ЭтотОбъект, "ПравилаРазвернутогоСальдо", СохраняемыеРеквизиты);

КонецПроцедуры // ПослеВосстановленияЗначений()

