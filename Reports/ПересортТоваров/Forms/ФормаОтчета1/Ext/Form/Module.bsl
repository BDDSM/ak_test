/////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ

// Процедура - обработчик события "ПриОткрытии" формы.
//
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ОтчетОбъект = РеквизитФормыВЗначение("Отчет");
	АдресХранилищаСКД = ПоместитьВоВременноеХранилище(ОтчетОбъект.СхемаКомпоновкиДанных, Новый УникальныйИдентификатор);
	
КонецПроцедуры // ПриСозданииНаСервере()

///////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ТАБЛИЧНОГО ПОЛЯ

&НаКлиенте
Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Если ПредставлениеТекущегоВарианта = "По номенклатуре" Тогда
		ТабДок = Расшифровать_ПоНоменклатуре(Расшифровка);	
	ИначеЕсли ПредставлениеТекущегоВарианта = "По группе номенклатуры" Тогда
		ТабДок = Расшифровать_ПоГруппеНоменклатуры(Расшифровка);
	ИначеЕсли ПредставлениеТекущегоВарианта = "По дате" Тогда
		ТабДок = Расшифровать_ПоДате(Расшифровка);
	ИначеЕсли ПредставлениеТекущегоВарианта = "По комплектовщику и номенклатуре" Тогда
		ТабДок = Расшифровать_ПоКомплектовщикуИНоменклатуре(Расшифровка);
	ИначеЕсли ПредставлениеТекущегоВарианта = "По комплетовщику, номенклатуре и складу" Тогда
		ТабДок = Расшифровать_ПоКомплектовщикуИНоменклатуреИСкладу(Расшифровка);	
	ИначеЕсли ПредставлениеТекущегоВарианта = "По комплетовщику" Тогда
		ТабДок = Расшифровать_ПоКомплектовщику(Расшифровка);
	ИначеЕсли ПредставлениеТекущегоВарианта = "По складу" Тогда
		ТабДок = Расшифровать_ПоСкладу(Расшифровка);
	ИначеЕсли ПредставлениеТекущегоВарианта = "По ТТ" Тогда
		ТабДок = Расшифровать_ПоТТ(Расшифровка);
	ИначеЕсли ПредставлениеТекущегоВарианта = "По ТТ, номенклатуре и складу" Тогда
		ТабДок = Расшифровать_ПоТТНоменклатуреИСкладу(Расшифровка);	
	ИначеЕсли ПредставлениеТекущегоВарианта = "По складу и номенклатуре" Тогда
		ТабДок = Расшифровать_ПоСкладуНоменклатуре(Расшифровка)	
	Иначе
		Сообщить("Необходимо выбрать вариант отчета!", СтатусСообщения.Важное);
		Возврат;
	КонецЕсли;
	ТабДок.ТолькоПросмотр = Истина;
	ТабДок.Показать();

КонецПроцедуры // РезультатОбработкаРасшифровки()

&НаСервере
Функция Расшифровать_ПоНоменклатуре(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	
	НоменклатураСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	
	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";

	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, НоменклатураСсылка);	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 

	
	Запрос = Новый Запрос;
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,
	               |	ТаблицаПоПоступлению.День,ТаблицаПоПоступлению.Расходник
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(
	               |			&НачалоПериода,
	               |			&КонецПериода,
	               |			День,
	               |			,
	               |			&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |				ИЛИ Номенклатура = &Номенклатура) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ))
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День) И РасходныйОрдерСкладТовары.Ссылка=ТаблицаДанныхПоПоступлению.Расходник
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура)
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции

&НаСервере
Функция Расшифровать_ПоСкладу(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	//КомплектовщикСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0]].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	СкладСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;

	
	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасходныйОрдерСкладТовары.Склад = &Склад
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";
	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	Запрос.УстановитьПараметр("Склад", СкладСсылка);
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, );	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата И Стр.Номенклатура=ТЗВыручка[Сч].Номенклатура);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	
	Запрос = Новый Запрос;
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(&НачалоПериода, &КонецПериода, День, , Склад = &Склад) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И РасходныйОрдерСкладТовары.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Склад", СкладСсылка);
	//Запрос.УстановитьПараметр("Сборщик", КомплектовщикСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции

&НаСервере
Функция Расшифровать_ПоСкладуНоменклатуре(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	//КомплектовщикСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0]].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	//СкладСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
    Попытка 
		СкладСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	Исключение
		СкладСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Справочники.Номенклатура.ПустаяСсылка();
	КонецПопытки;
	
	
	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасходныйОрдерСкладТовары.Склад = &Склад
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";

	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("Склад", СкладСсылка);
	
	
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, НоменклатураСсылка);	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	
	Запрос = Новый Запрос;
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	ПриходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТоварыП
	               |ИЗ
	               |	Документ.ПриходныйОрдерСклад.Товары КАК ПриходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО ПриходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И ПриходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(ПриходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО ПриходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	(ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП1
	               |			ИЛИ ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП2)
	               |	И НЕ ПриходныйОрдерСкладТовары.Номенклатура В
	               |				(ВЫБРАТЬ
	               |					Номенклатура.Ссылка
	               |				ИЗ
	               |					Справочник.Номенклатура КАК Номенклатура
	               |				ГДЕ
	               |					Номенклатура.СлужебныйТовар = ИСТИНА)
	               |	И НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |				ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ПриходныйОрдерСкладТовары.Ссылка.ВремяЗаездаМашины МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |	И ПриходныйОрдерСкладТовары.Номенклатура = &Номенклатура
	               |	И ПриходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	ПриходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	СУММА(ПриходныйОрдерСкладТовары.Количество) КАК КоличествоПоздноПришло,
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад,
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |			КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |			ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |		КОНЕЦ, ДЕНЬ) КАК Дата,
	               |	МАКСИМУМ(ТабТоварыП.КоличествоВУпаковке) КАК КоличествоВУпаковке,
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад.Владелец.ТипСтруктурнойЕдиницы,
	               |	СУММА(ВЫБОР
	               |			КОГДА (ВЫРАЗИТЬ(ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |				ТОГДА 1 + (ВЫРАЗИТЬ(ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |			ИНАЧЕ ВЫРАЗИТЬ(ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |		КОНЕЦ) КАК КоличествоПоздноПришлоУпаковок
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ПриходныйОрдерСклад.Товары КАК ПриходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТоварыП КАК ТабТоварыП
	               |		ПО ПриходныйОрдерСкладТовары.Номенклатура = ТабТоварыП.Номенклатура
	               |			И ПриходныйОрдерСкладТовары.Ссылка = ТабТоварыП.Ссылка
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |				ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП1
	               |			ИЛИ ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП2)
	               |	И НЕ ПриходныйОрдерСкладТовары.Номенклатура В
	               |				(ВЫБРАТЬ
	               |					Номенклатура.Ссылка
	               |				ИЗ
	               |					Справочник.Номенклатура КАК Номенклатура
	               |				ГДЕ
	               |					Номенклатура.СлужебныйТовар = ИСТИНА)
	               |	И ПриходныйОрдерСкладТовары.Ссылка.ВремяЗаездаМашины МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |	И ПриходныйОрдерСкладТовары.Номенклатура = &Номенклатура
	               |	И ПриходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад,
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |			КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |			ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |		КОНЕЦ, ДЕНЬ),
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад.Владелец.ТипСтруктурнойЕдиницы
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(
	               |			&НачалоПериода,
	               |			&КонецПериода,
	               |			День,
	               |			,
	               |			(&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |				ИЛИ Номенклатура = &Номенклатура)
	               |				И Склад = &Склад) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
	               |	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
	               |	СУММА(РасходныйОрдерСкладТовары.КоличествоТТ) КАК КоличествоТТ,
	               |	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТЗ_ТоварыСвернутые
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура)
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Ссылка,
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_ТоварыСвернутые.Номенклатура КАК Товар,
	               |	ТЗ_ТоварыСвернутые.Количество,
	               |	ТЗ_ТоварыСвернутые.КоличествоУРЗ,
	               |	ТЗ_ТоварыСвернутые.ЗаявкаНаСклад,
	               |	ТЗ_ТоварыСвернутые.Отклонение,
	               |	ТЗ_ТоварыСвернутые.Ссылка.Сборщик КАК Комплектовщик,
	               |	ТЗ_ТоварыСвернутые.Ссылка.Склад,
	               |	ТЗ_ТоварыСвернутые.Ссылка.Получатель КАК ТТ,
	               |	ТЗ_ТоварыСвернутые.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(ТЗ_ТоварыСвернутые.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	ТЗ_ТоварыСвернутые.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(ТЗ_ТоварыСвернутые.Ссылка.Дата) КАК Месяц,
	               |	ГОД(ТЗ_ТоварыСвернутые.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(ТЗ_ТоварыСвернутые.Ссылка.Дата) КАК Неделя,
	               |	ТЗ_ТоварыСвернутые.Номенклатура.Родитель КАК ГруппаТов,
	               |	ТЗ_ТоварыСвернутые.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ПоздноПришло.КоличествоПоздноПришлоУпаковок КАК ПоздноПришло
	               |ИЗ
	               |	ТЗ_ТоварыСвернутые КАК ТЗ_ТоварыСвернутые
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО ТЗ_ТоварыСвернутые.Номенклатура = ТабТовары.Номенклатура
	               |			И ТЗ_ТоварыСвернутые.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО ТЗ_ТоварыСвернутые.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И ТЗ_ТоварыСвернутые.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И ТЗ_ТоварыСвернутые.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО ТЗ_ТоварыСвернутые.Номенклатура = Остатки.Номенклатура
	               |			И ТЗ_ТоварыСвернутые.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО ТЗ_ТоварыСвернутые.Ссылка.Склад = ПоздноПришло.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Дата)
	               |			И ТЗ_ТоварыСвернутые.Номенклатура = ПоздноПришло.Номенклатура
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (ТЗ_ТоварыСвернутые.Ссылка.ПровереноОператором ИЛИ ТЗ_ТоварыСвернутые.Ссылка.СборкаТерминаломЗакончена)
	               |	И ТЗ_ТоварыСвернутые.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ ТЗ_ТоварыСвернутые.Номенклатура = &Номенклатура)
	               |	И ТЗ_ТоварыСвернутые.Ссылка.Склад = &Склад
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("ВидОперацииП1", Перечисления.ВидыОперацийПриходСкладскойУчет.Перемещение);			   
    Запрос.УстановитьПараметр("ВидОперацииП2", Перечисления.ВидыОперацийПриходСкладскойУчет.ОтПоставщика);
	
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Склад", СкладСсылка);
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции

&НаСервере
Функция Расшифровать_ПоКомплектовщикуИНоменклатуре(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	Попытка 
		КомплектовщикСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	Исключение
		КомплектовщикСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Справочники.Номенклатура.ПустаяСсылка();
	КонецПопытки;
	
	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасходныйОрдерСкладТовары.Сборщик = &Сборщик
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";

	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	Запрос.УстановитьПараметр("Сборщик", (КомплектовщикСсылка));			   
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, НоменклатураСсылка);	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(
	               |			&НачалоПериода,
	               |			&КонецПериода,
	               |			День,
	               |			,
	               |			&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |				ИЛИ Номенклатура = &Номенклатура) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура)
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И РасходныйОрдерСкладТовары.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура)
	               |	И РасходныйОрдерСкладТовары.Ссылка.Сборщик = &Сборщик
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("ВидОперацииП1", Перечисления.ВидыОперацийПриходСкладскойУчет.Перемещение);			   
    Запрос.УстановитьПараметр("ВидОперацииП2", Перечисления.ВидыОперацийПриходСкладскойУчет.ОтПоставщика);			   
	
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("Сборщик", КомплектовщикСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции

&НаСервере
Функция Расшифровать_ПоКомплектовщикуИНоменклатуреИСкладу(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	Попытка 
		КомплектовщикСсылка = Данные.Элементы[Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		 
		СкладСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	Исключение
		КомплектовщикСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		СкладСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Справочники.Номенклатура.ПустаяСсылка();
	КонецПопытки;
	
	
	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасходныйОрдерСкладТовары.Склад = &Склад
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";

	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	Запрос.УстановитьПараметр("Склад", (СкладСсылка));			   
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, НоменклатураСсылка);	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	                |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |	И РасходныйОрдерСкладТовары.Ссылка.Сборщик = &Сборщик
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	ПриходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТоварыП
	               |ИЗ
	               |	Документ.ПриходныйОрдерСклад.Товары КАК ПриходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО ПриходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И ПриходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(ПриходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО ПриходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	(ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП1
	               |			ИЛИ ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП2)
	               |	И НЕ ПриходныйОрдерСкладТовары.Номенклатура В
	               |				(ВЫБРАТЬ
	               |					Номенклатура.Ссылка
	               |				ИЗ
	               |					Справочник.Номенклатура КАК Номенклатура
	               |				ГДЕ
	               |					Номенклатура.СлужебныйТовар = ИСТИНА)
	               |	И НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |				ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ПриходныйОрдерСкладТовары.Ссылка.ВремяЗаездаМашины МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |	И ПриходныйОрдерСкладТовары.Номенклатура = &Номенклатура
	               |	И ПриходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	ПриходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	СУММА(ПриходныйОрдерСкладТовары.Количество) КАК КоличествоПоздноПришло,
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад,
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |			КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |			ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |		КОНЕЦ, ДЕНЬ) КАК Дата,
	               |	МАКСИМУМ(ТабТоварыП.КоличествоВУпаковке) КАК КоличествоВУпаковке,
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад.Владелец.ТипСтруктурнойЕдиницы,
	               |	СУММА(ВЫБОР
	               |			КОГДА (ВЫРАЗИТЬ(ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |				ТОГДА 1 + (ВЫРАЗИТЬ(ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |			ИНАЧЕ ВЫРАЗИТЬ(ПриходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТоварыП.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |		КОНЕЦ) КАК КоличествоПоздноПришлоУпаковок
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ПриходныйОрдерСклад.Товары КАК ПриходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТоварыП КАК ТабТоварыП
	               |		ПО ПриходныйОрдерСкладТовары.Номенклатура = ТабТоварыП.Номенклатура
	               |			И ПриходныйОрдерСкладТовары.Ссылка = ТабТоварыП.Ссылка
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |				ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП1
	               |			ИЛИ ПриходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперацииП2)
	               |	И НЕ ПриходныйОрдерСкладТовары.Номенклатура В
	               |				(ВЫБРАТЬ
	               |					Номенклатура.Ссылка
	               |				ИЗ
	               |					Справочник.Номенклатура КАК Номенклатура
	               |				ГДЕ
	               |					Номенклатура.СлужебныйТовар = ИСТИНА)
	               |	И ПриходныйОрдерСкладТовары.Ссылка.ВремяЗаездаМашины МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |	И ПриходныйОрдерСкладТовары.Номенклатура = &Номенклатура
	               |	И ПриходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПриходныйОрдерСкладТовары.Номенклатура,
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад,
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |			КОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины <> ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ПриходныйОрдерСкладТовары.Ссылка.ДатаВремяЗаездаМашины
	               |			ИНАЧЕ ПриходныйОрдерСкладТовары.Ссылка.Дата
	               |		КОНЕЦ, ДЕНЬ),
	               |	ПриходныйОрдерСкладТовары.Ссылка.Склад.Владелец.ТипСтруктурнойЕдиницы
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(
	               |			&НачалоПериода,
	               |			&КонецПериода,
	               |			День,
	               |			,
	               |			(&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |				ИЛИ Номенклатура = &Номенклатура)
	               |				И Склад = &Склад) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
	               |	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
	               |	СУММА(РасходныйОрдерСкладТовары.КоличествоТТ) КАК КоличествоТТ,
	               |	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТЗ_ТоварыСвернутые
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура)
	               |	И РасходныйОрдерСкладТовары.Ссылка.Сборщик = &Сборщик
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Ссылка,
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_ТоварыСвернутые.Номенклатура КАК Товар,
	               |	ТЗ_ТоварыСвернутые.Количество,
	               |	ТЗ_ТоварыСвернутые.КоличествоУРЗ,
	               |	ТЗ_ТоварыСвернутые.ЗаявкаНаСклад,
	               |	ТЗ_ТоварыСвернутые.Отклонение,
	               |	ТЗ_ТоварыСвернутые.Ссылка.Сборщик КАК Комплектовщик,
	               |	ТЗ_ТоварыСвернутые.Ссылка.Склад,
	               |	ТЗ_ТоварыСвернутые.Ссылка.Получатель КАК ТТ,
	               |	ТЗ_ТоварыСвернутые.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(ТЗ_ТоварыСвернутые.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	ТЗ_ТоварыСвернутые.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(ТЗ_ТоварыСвернутые.Ссылка.Дата) КАК Месяц,
	               |	ГОД(ТЗ_ТоварыСвернутые.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(ТЗ_ТоварыСвернутые.Ссылка.Дата) КАК Неделя,
	               |	ТЗ_ТоварыСвернутые.Номенклатура.Родитель КАК ГруппаТов,
	               |	ТЗ_ТоварыСвернутые.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((ТЗ_ТоварыСвернутые.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТЗ_ТоварыСвернутые.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ПоздноПришло.КоличествоПоздноПришлоУпаковок КАК ПоздноПришло
	               |ИЗ
	               |	ТЗ_ТоварыСвернутые КАК ТЗ_ТоварыСвернутые
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО ТЗ_ТоварыСвернутые.Номенклатура = ТабТовары.Номенклатура
	               |			И ТЗ_ТоварыСвернутые.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО ТЗ_ТоварыСвернутые.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И ТЗ_ТоварыСвернутые.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И ТЗ_ТоварыСвернутые.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО ТЗ_ТоварыСвернутые.Номенклатура = Остатки.Номенклатура
	               |			И ТЗ_ТоварыСвернутые.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО ТЗ_ТоварыСвернутые.Ссылка.Склад = ПоздноПришло.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Дата)
	               |			И ТЗ_ТоварыСвернутые.Номенклатура = ПоздноПришло.Номенклатура
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА ТЗ_ТоварыСвернутые.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ ТЗ_ТоварыСвернутые.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (ТЗ_ТоварыСвернутые.Ссылка.ПровереноОператором ИЛИ ТЗ_ТоварыСвернутые.Ссылка.СборкаТерминаломЗакончена)
	               |	И ТЗ_ТоварыСвернутые.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ ТЗ_ТоварыСвернутые.Номенклатура = &Номенклатура)
	               |	И ТЗ_ТоварыСвернутые.Ссылка.Сборщик = &Сборщик
	               |	И ТЗ_ТоварыСвернутые.Ссылка.Склад = &Склад
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("ВидОперацииП1", Перечисления.ВидыОперацийПриходСкладскойУчет.Перемещение);			   
    Запрос.УстановитьПараметр("ВидОперацииП2", Перечисления.ВидыОперацийПриходСкладскойУчет.ОтПоставщика);			   

	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("Сборщик", КомплектовщикСсылка);
	Запрос.УстановитьПараметр("Склад", СкладСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции
     
&НаСервере
Функция Расшифровать_ПоДате(Расшифровка);
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	
	ДатаАнализа = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;

	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";
	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, );	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата  И Стр.Номенклатура=ТЗВыручка[Сч].Номенклатура);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	
	
	Запрос = Новый Запрос;
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(&НачалоПериода, &КонецПериода, День, , ) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И РасходныйОрдерСкладТовары.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И РасходныйОрдерСкладТовары.Ссылка.Дата = &Дата
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Дата", ДатаАнализа);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции

&НаСервере
Функция Расшифровать_ПоКомплектовщику(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	КомплектовщикСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	//НоменклатураСсылка = ;

	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасходныйОрдерСкладТовары.Сборщик = &Сборщик
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";
	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	Запрос.УстановитьПараметр("Сборщик", КомплектовщикСсылка);
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, );	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата И Стр.Номенклатура=ТЗВыручка[Сч].Номенклатура);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(&НачалоПериода, &КонецПериода, День, , ) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И РасходныйОрдерСкладТовары.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И РасходныйОрдерСкладТовары.Ссылка.Сборщик = &Сборщик
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	//Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("Сборщик", КомплектовщикСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции

&НаСервере
Функция Расшифровать_ПоТТ(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	ТТСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	//НоменклатураСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;

	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасходныйОрдерСкладТовары.Получатель = &Получатель
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";
	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	Запрос.УстановитьПараметр("Получатель", ТТСсылка);
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, );	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата И Стр.Номенклатура=ТЗВыручка[Сч].Номенклатура);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	
	
	Запрос = Новый Запрос;
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(&НачалоПериода, &КонецПериода, День, , ) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И РасходныйОрдерСкладТовары.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И РасходныйОрдерСкладТовары.Ссылка.Получатель = &ТТ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	//Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("ТТ", ТТСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции

&НаСервере
Функция Расшифровать_ПоТТНоменклатуреИСкладу(Расшифровка)
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	Попытка 
		ТТСсылка = Данные.Элементы[Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		 
		СкладСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	Исключение
		ТТСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьРодителей()[0].Идентификатор].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		СкладСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
		НоменклатураСсылка = Справочники.Номенклатура.ПустаяСсылка();
	КонецПопытки;
	
	
	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|	И РасходныйОрдерСкладТовары.Склад = &Склад
		|	И РасходныйОрдерСкладТовары.Получатель = &Получатель
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";

	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("Склад", СкладСсылка);
	Запрос.УстановитьПараметр("Получатель", ТТСсылка);
	
	
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, НоменклатураСсылка);	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата И Стр.Номенклатура=ТЗВыручка[Сч].Номенклатура);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(
	               |			&НачалоПериода,
	               |			&КонецПериода,
	               |			День,
	               |			,
	               |			(&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |				ИЛИ Номенклатура = &Номенклатура)
	               |				И Склад = &Склад) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура)
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |	И РасходныйОрдерСкладТовары.Ссылка.Получатель = &ТТ
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) <= -0.5
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И РасходныйОрдерСкладТовары.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (&Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура = &Номенклатура)
	               |	И РасходныйОрдерСкладТовары.Ссылка.Получатель = &ТТ
	               |	И РасходныйОрдерСкладТовары.Ссылка.Склад = &Склад
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	Запрос.УстановитьПараметр("ТТ", ТТСсылка);
	Запрос.УстановитьПараметр("Склад", СкладСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции
 
&НаСервере
Функция Расшифровать_ПоГруппеНоменклатуры(Расшифровка);
	
	Данные = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	//СтатьяДР_Код = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[1].Значение);
	//СтатьяДР_Наименование = СокрЛП(ДанныеРасшифровки.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение);
	
	ПараметрПериод = Данные.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("Период"));
	
	НачалоПериода = ПараметрПериод.Значение.ДатаНачала;
	КонецПериода  = ПараметрПериод.Значение.ДатаОкончания;

	//КомплектовщикСсылка = Данные.Элементы[Данные.Элементы[Расшифровка].ПолучитьРодителей()[0]].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;
	НоменклатураСсылка = Данные.Элементы[Расшифровка].ПолучитьРодителей()[0].ПолучитьПоля()[0].Значение;

	
	//+++АК BELN 2018.04.03 
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	РасходныйОрдерСкладТовары.Сборщик,
		|	ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК Получатель,
		|	РасходныйОрдерСкладТовары.Склад,
		|	РасходныйОрдерСкладТовары.Дата,
		|	РасходныйОрдерСкладТовары.ДатаРаспределения,
		|	РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы КАК ТипСтруктурнойЕдиницы,
		|	РасходныйОрдерСкладТовары.ПриемкаВМагазинеБезПересчета
		|ПОМЕСТИТЬ ТабРасходники
		|ИЗ
		|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСкладТовары
		|ГДЕ
		|	РасходныйОрдерСкладТовары.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И (РасходныйОрдерСкладТовары.ПровереноОператором
		|			ИЛИ РасходныйОрдерСкладТовары.СборкаТерминаломЗакончена)
		|	И РасходныйОрдерСкладТовары.ВидОперации = &ВидОперации
		|	И РасходныйОрдерСкладТовары.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРасходныхОрдеров.ВСборке)
		|	И РасходныйОрдерСкладТовары.Склад.Владелец.ТипСтруктурнойЕдиницы = &ТипСклада
		|	И НАЧАЛОПЕРИОДА(ВЫБОР
		|				КОГДА РасходныйОрдерСкладТовары.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|					ТОГДА РасходныйОрдерСкладТовары.ДатаРаспределения
		|				ИНАЧЕ РасходныйОрдерСкладТовары.Дата
		|			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РасходныйОрдерСкладТовары.Номенклатура КАК Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
		|	СУММА(РасходныйОрдерСкладТовары.Количество) КАК Количество,
		|	СУММА(РасходныйОрдерСкладТовары.КоличествоУРЗ) КАК КоличествоУРЗ,
		|	СУММА(РасходныйОрдерСкладТовары.Отклонение) КАК Отклонение,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы) КАК ТорговаяТочка,
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ) КАК Дата
		|ИЗ
		|	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТабРасходники КАК ТабРасходники
		|		ПО РасходныйОрдерСкладТовары.Ссылка = ТабРасходники.Ссылка
		|ГДЕ
		|	(РасходныйОрдерСкладТовары.Номенклатура.Родитель = &Номенклатура
		|			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель = &Номенклатура
		|			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель.Родитель = &Номенклатура
		|			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель.Родитель.Родитель = &Номенклатура
		|			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель.Родитель.Родитель.Родитель = &Номенклатура)
		|
		|СГРУППИРОВАТЬ ПО
		|	РасходныйОрдерСкладТовары.Номенклатура,
		|	РасходныйОрдерСкладТовары.Ссылка,
		|	ВЫРАЗИТЬ(ТабРасходники.Получатель КАК Справочник.СтруктурныеЕдиницы),
		|	НАЧАЛОПЕРИОДА(ВЫБОР
		|			КОГДА ТабРасходники.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ТабРасходники.ДатаРаспределения
		|			ИНАЧЕ ТабРасходники.Дата
		|		КОНЕЦ, ДЕНЬ)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	ТорговаяТочка,
		|	Номенклатура,
		|	Документ";

	
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	
	
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(КонецПериода)+3*24*60*60);
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачалоПериода)-3*24*60*60);
	
	Запрос.УстановитьПараметр("ТипСклада", Перечисления.ТипыСтруктурныхЕдиниц.Склад);
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	РезультатЗапроса = Запрос.Выполнить();
	
	ТЗВыручка = РезультатЗапроса.Выгрузить();
	
	ТаблицаДанныхПоПоступлению=ВнешниеДанные.ПолучитьДвиженияТоваровПолная(НачалоПериода, КонецПериода,, НоменклатураСсылка);	
	
	ТаблицаДанныхПоПоступлениюИтог=ТаблицаДанныхПоПоступлению.СкопироватьКолонки();
	ТаблицаДанныхПоПоступлениюИтог.Колонки.Добавить("Расходник",Новый ОписаниеТипов("ДокументСсылка.РасходныйОрдерСклад"));
	Кол=ТЗВыручка.Количество();
	Сч=1;
	Для каждого Стр Из ТЗВыручка Цикл
		МасСтр=ТаблицаДанныхПоПоступлению.НайтиСтроки(Новый Структура("Номенклатура,ТТ,День",Стр.Номенклатура,Стр.ТорговаяТочка,Стр.Дата));	
		
		Если МасСтр.Количество() Тогда
			Если Сч=Кол Тогда
				ФлСлед=Ложь;
			Иначе	
				ФлСлед= (Стр.ТорговаяТочка=ТЗВыручка[Сч].ТорговаяТочка И Стр.Дата=ТЗВыручка[Сч].Дата  И Стр.Номенклатура=ТЗВыручка[Сч].Номенклатура);
			КонецЕсли; 
			НовСтр=ТаблицаДанныхПоПоступлениюИтог.Добавить();
		    ЗаполнитьЗначенияСвойств(НовСтр,МасСтр[0]);
			Поступ=?(МасСтр[0].Поступило>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Поступило);
			МасСтр[0].Поступило=МасСтр[0].Поступило-Поступ;
			НовСтр.Поступило=Поступ;
			
			Бой=?(МасСтр[0].Бой>Стр.Количество И ФлСлед,Стр.Количество,МасСтр[0].Бой);
			МасСтр[0].Бой=МасСтр[0].Бой-Бой;
			НовСтр.Бой=Бой;
			НовСтр.Расходник=Стр.Документ;
		КонецЕсли; 
	    Сч=Сч+1;
	КонецЦикла; 
	//---АК BELN 2018.04.03 
	
	Запрос = Новый Запрос;
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТаблицаПоПоступлению.Номенклатура,
	               |	ТаблицаПоПоступлению.ТТ,
	               |	ТаблицаПоПоступлению.Поступило,
	               |	ТаблицаПоПоступлению.Бой,ТаблицаПоПоступлению.Расходник,
	               |	ТаблицаПоПоступлению.День
	               |ПОМЕСТИТЬ ТаблицаДанныхПоПоступлению
	               |ИЗ
	               |	&ТаблицаПоПоступлению КАК ТаблицаПоПоступлению
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ЛистУчета.Дата, ДЕНЬ) КАК Периода,
	               |	ЛистУчета.ТорговаяТочка
	               |ПОМЕСТИТЬ ПоздноПришло
	               |ИЗ
	               |	Документ.ЛистУчета КАК ЛистУчета
	               |ГДЕ
	               |	ЛистУчета.Проведен
	               |	И ЛистУчета.Дата МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И ЛистУчета.ВремяДоставки МЕЖДУ &ВремяДоставкиНач И &ВремяДоставкиКон
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	НАЧАЛОПЕРИОДА(ТоварыНаСкладахОстаткиИОбороты.Период, ДЕНЬ) КАК Период,
	               |	ТоварыНаСкладахОстаткиИОбороты.Склад,
	               |	ТоварыНаСкладахОстаткиИОбороты.Номенклатура,
	               |	ТоварыНаСкладахОстаткиИОбороты.Характеристика,
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток КАК КоличествоОстаток
	               |ПОМЕСТИТЬ Остатки
	               |ИЗ
	               |	РегистрНакопления.ТоварыНаСкладах.ОстаткиИОбороты(&НачалоПериода, &КонецПериода, День, , ) КАК ТоварыНаСкладахОстаткиИОбороты
	               |ГДЕ
	               |	ТоварыНаСкладахОстаткиИОбороты.КоличествоНачальныйОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	МАКСИМУМ(ВЫРАЗИТЬ(ВЫБОР
	               |				КОГДА ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение) = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ЕСТЬNULL(ЗначенияСвойствОбъектов.Количество, ЗначенияПоХарактеристике.Значение)
	               |			КОНЕЦ КАК ЧИСЛО(15, 3))) КАК КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |ПОМЕСТИТЬ ТабТовары
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КоличествоВКоробкеПоДням КАК ЗначенияСвойствОбъектов
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияСвойствОбъектов.Характеристика
				   |			И РасходныйОрдерСкладТовары.Ссылка.Склад.Владелец = ЗначенияСвойствОбъектов.СтруктурнаяЕдиница
	               |			И (ЗначенияСвойствОбъектов.День = НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, День))
				   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияПоХарактеристике
	               |		ПО РасходныйОрдерСкладТовары.Характеристика = ЗначенияПоХарактеристике.Объект
	               |			И (ЗначенияПоХарактеристике.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке))
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	РасходныйОрдерСкладТовары.Номенклатура,
	               |	РасходныйОрдерСкладТовары.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	РасходныйОрдерСкладТовары.Номенклатура КАК Товар,
	               |	РасходныйОрдерСкладТовары.Количество,
	               |	РасходныйОрдерСкладТовары.КоличествоУРЗ,
	               |	РасходныйОрдерСкладТовары.ЗаявкаНаСклад,
	               |	РасходныйОрдерСкладТовары.Отклонение,
	               |	РасходныйОрдерСкладТовары.Ссылка.Сборщик КАК Комплектовщик,
	               |	РасходныйОрдерСкладТовары.Ссылка.Склад,
	               |	РасходныйОрдерСкладТовары.Ссылка.Получатель КАК ТТ,
	               |	РасходныйОрдерСкладТовары.Ссылка КАК Документ,
	               |	НАЧАЛОПЕРИОДА(РасходныйОрдерСкладТовары.Ссылка.Дата, ДЕНЬ) КАК Дата,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК КоличествоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Распределен,
	               |	ТабТовары.КоличествоВУпаковке,
	               |	РасходныйОрдерСкладТовары.Характеристика,
	               |	ТаблицаДанныхПоПоступлению.Поступило,
	               |	ТаблицаДанныхПоПоступлению.Бой,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ПоступилоУпаковок,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК БойУпаковок,
	               |	Остатки.КоличествоОстаток КАК Остаток,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК ОстСклад,
	               |	РасходныйОрдерСкладТовары.Номенклатура.id_tov КАК N_tov,
	               |	МЕСЯЦ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Месяц,
	               |	ГОД(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Год,
	               |	НЕДЕЛЯ(РасходныйОрдерСкладТовары.Ссылка.Дата) КАК Неделя,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель КАК ГруппаТов,
	               |	РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель КАК ВерхГрупТов,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорМн,
	               |	ВЫБОР
	               |		КОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА (РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке - (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДробныеКорПл,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) < 0
	               |			ТОГДА -(ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК БольшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))) > 0
	               |			ТОГДА ВЫРАЗИТЬ((РасходныйОрдерСкладТовары.КоличествоУРЗ - ЕСТЬNULL(ТаблицаДанныхПоПоступлению.Поступило, 0)) / ТабТовары.КоличествоВУпаковке КАК ЧИСЛО(15, 0))
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК МеньшеОтгрузили,
	               |	ВЫБОР
	               |		КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |			ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |		ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Бой / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |	КОНЕЦ КАК Отказ,
	               |	ВЫБОР
	               |		КОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ > 0
	               |				И ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(Остатки.КоличествоОстаток / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ < ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.КоличествоУРЗ / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ - ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(РасходныйОрдерСкладТовары.Количество / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК НеХватило,
	               |	0 КАК МеньшеОтгрузилиСист,
	               |	ВЫБОР
	               |		КОГДА НЕ ПоздноПришло.ТорговаяТочка ЕСТЬ NULL 
	               |			ТОГДА ВЫБОР
	               |					КОГДА (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))) - ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) < 0
	               |						ТОГДА 1 + (ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0)))
	               |					ИНАЧЕ ВЫРАЗИТЬ(ТаблицаДанныхПоПоступлению.Поступило / (ВЫРАЗИТЬ(ЕСТЬNULL(ТабТовары.КоличествоВУпаковке, 1) КАК ЧИСЛО(15, 3))) КАК ЧИСЛО(15, 0))
	               |				КОНЕЦ
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПоздноПришло
	               |ИЗ
	               |	Документ.РасходныйОрдерСклад.Товары КАК РасходныйОрдерСкладТовары
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТабТовары КАК ТабТовары
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТабТовары.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка = ТабТовары.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаДанныхПоПоступлению КАК ТаблицаДанныхПоПоступлению
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = ТаблицаДанныхПоПоступлению.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Ссылка.Получатель = ТаблицаДанныхПоПоступлению.ТТ И РасходныйОрдерСкладТовары.Ссылка = ТаблицаДанныхПоПоступлению.Расходник
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ТаблицаДанныхПоПоступлению.День)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Остатки КАК Остатки
	               |		ПО РасходныйОрдерСкладТовары.Номенклатура = Остатки.Номенклатура
	               |			И РасходныйОрдерСкладТовары.Характеристика = Остатки.Характеристика
	               |			И РасходныйОрдерСкладТовары.Ссылка.Склад = Остатки.Склад
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = Остатки.Период)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ПоздноПришло КАК ПоздноПришло
	               |		ПО РасходныйОрдерСкладТовары.Ссылка.Получатель = ПоздноПришло.ТорговаяТочка
	               |			И (НАЧАЛОПЕРИОДА(ВЫБОР
	               |					КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |					ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |				КОНЕЦ, ДЕНЬ) = ПоздноПришло.Периода)
	               |ГДЕ
	               |	НАЧАЛОПЕРИОДА(ВЫБОР
	               |				КОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения <> ДАТАВРЕМЯ(1, 1, 1)
	               |					ТОГДА РасходныйОрдерСкладТовары.Ссылка.ДатаРаспределения
	               |				ИНАЧЕ РасходныйОрдерСкладТовары.Ссылка.Дата
	               |			КОНЕЦ, ДЕНЬ) МЕЖДУ &НачалоПериода И &КонецПериода
	               |	И (РасходныйОрдерСкладТовары.Ссылка.ПровереноОператором ИЛИ РасходныйОрдерСкладТовары.Ссылка.СборкаТерминаломЗакончена)
	               |	И РасходныйОрдерСкладТовары.Ссылка.ВидОперации = &ВидОперации
	               |	И (РасходныйОрдерСкладТовары.Номенклатура.Родитель = &Номенклатура
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель = &Номенклатура
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель.Родитель = &Номенклатура
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель.Родитель.Родитель = &Номенклатура
	               |			ИЛИ РасходныйОрдерСкладТовары.Номенклатура.Родитель.Родитель.Родитель.Родитель.Родитель = &Номенклатура)
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата,
	               |	ТТ";
				   
				   
	Запрос.УстановитьПараметр("ВидОперации", Перечисления.ВидыОперацийРасходСкладскойУчет.ОтгрузкаВТорговуюТочку);			   
	Запрос.УстановитьПараметр("НачалоПериода", НачалоДня(НачалоПериода));			   
	Запрос.УстановитьПараметр("КонецПериода", КонецДня(КонецПериода));			   
	//Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.КоличествоВУпаковке);	
	Запрос.УстановитьПараметр("ВремяДоставкиНач", '00010101020000');			   
	Запрос.УстановитьПараметр("ВремяДоставкиКон", '00010101070000');	
	Запрос.УстановитьПараметр("Номенклатура", НоменклатураСсылка);
	//Запрос.УстановитьПараметр("Сборщик", КомплектовщикСсылка);
	Запрос.УстановитьПараметр("ТаблицаПоПоступлению", ТаблицаДанныхПоПоступлениюИтог);
	
	Выгрузка = Запрос.Выполнить().Выгрузить();       
			
	ТабДокумент = Новый ТабличныйДокумент;
	Макет = Отчеты.ПересортТоваров.ПолучитьМакет("Расшифровка");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
//	ОбластьОрганизация = Макет.ПолучитьОбласть("СтрокаОрганизация");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьИтоги = Макет.ПолучитьОбласть("Итоги");
	//
	//ОбластьШапка.Параметры.Код = СтатьяДР_Код;
	//ОбластьШапка.Параметры.Статья = СтатьяДР_Наименование;
	
	ТабДокумент.Вывести(ОбластьШапка);

	Для Каждого Строка Из Выгрузка Цикл
		ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры, Строка);
		ТабДокумент.Вывести(ОбластьСтрока);
	КонецЦикла;
	
	
	
	Возврат ТабДокумент;	
КонецФункции



&НаСервере
Процедура ПеречитатьДанныеПеремещенияВкусвилл()
	
	ТабПеремещения.Очистить();
	НоменклатураИтог.Очистить();
	
	//ADOСоединение = Новый COMОбъект("ADODB.Connection");
	//ADOСоединение.ConnectionTimeOut = 0;
	//ADOСоединение.CommandTimeOut    = 0;
	//
	//СтрСоедиение = ОбменСAccess.ПолучитьСтрокуСоединения("sms_izbenka");
	//
	//ADOСоединение.ConnectionString  = СтрСоедиение;
	//ADOСоединение.Open();
	//
	//СтрокаОтборПолучатель = "9999999";
	//Для Каждого СтрокаТаб Из ТТПолучатели Цикл
	//	СтрокаОтборПолучатель = СтрокаОтборПолучатель + ", " + Формат(СтрокаТаб.Значение.id_tt, "ЧГ=0");
	//КонецЦикла;
	//
	//СтрокаОтборОтправители = "9999999";
	//Для Каждого СтрокаТаб Из ТТОтправители Цикл
	//	СтрокаОтборОтправители = СтрокаОтборОтправители + ", " + Формат(СтрокаТаб.Значение.id_tt, "ЧГ=0");
	//КонецЦикла;
	//
	//СтрокаОтборТовары = "9999999";
	//Для Каждого СтрокаТаб Из Номенклатура Цикл
	//	СтрокаОтборТовары = СтрокаОтборТовары + ", " + Формат(СтрокаТаб.Значение.id_tov, "ЧГ=0");
	//КонецЦикла;

	//СтрЗапрос = "IF OBJECT_ID ('tempdb..#VT_Docs') IS NOT NULL
	//				|DROP TABLE #VT_Docs
	//				|
	//				|SELECT DocTab._Document304_IDRRef as DocRef INTO #VT_Docs 
	//				|
	//				|FROM VV.dbo._Document304_VT4816 as DocTab WITH(NOLOCK)
	//				|LEFT OUTER JOIN VV.dbo._Document304 as Doc WITH(NOLOCK)
	//				|ON DocTab._Document304_IDRRef = Doc._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T3 WITH(NOLOCK)
	//				|ON Doc._Fld4811RRef = T3._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T4 WITH(NOLOCK)
	//				|ON Doc._Fld4813RRef = T4._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference133 T5 WITH(NOLOCK)
	//				|ON DocTab._Fld4818RRef = T5._IDRRef
	//				|WHERE DATEADD(YEAR, -2000, Doc._Date_Time) >= '" + Формат(ДатаНачалаПеремещения, "ДФ=yyyy-MM-dd") + "T00:00:00' AND DATEADD(YEAR, -2000, Doc._Date_Time) <= '" + Формат(ДатаКонцаПеремещения, "ДФ=yyyy-MM-dd") + "T23:59:59'
	//				|and Doc._Posted = 1
	//				|and ((T3._Fld1509RRef = 0x8BC608214203D1A34B69775DA2E205CD or T3._Fld1509RRef = 0x8BF691CDCBF7D5E246900F9D06A0F181) and (T4._Fld1509RRef = 0x8BC608214203D1A34B69775DA2E205CD or T4._Fld1509RRef = 0x8BF691CDCBF7D5E246900F9D06A0F181) or Doc._Fld7142 LIKE '%ТТ%')
	//				|and (T3._Fld1530 IN (" + СтрокаОтборОтправители + ") or " + ?(ТТОтправители.Количество() = 0, "0", "1") + "=0) --otpravitel--
	//				|and (T4._Fld1530 IN (" + СтрокаОтборПолучатель + ") or " + ?(ТТПолучатели.Количество() = 0, "0", "1") + "=0) --poluchatel--
	//				|and (T5._Fld1183 IN (" + СтрокаОтборТовары + ") or " + ?(Номенклатура.Количество() = 0, "0", "1") + "=0) --tovar--
	//				|
	//				|
	//				|UNION ALL 
	//				|SELECT
	//				|
	//				|DocTab._Document305_IDRRef
	//				|FROM VV.dbo._Document305_VT4832 as DocTab WITH(NOLOCK)
	//				|LEFT OUTER JOIN VV.dbo._Document305 as Doc WITH(NOLOCK)
	//				|ON DocTab._Document305_IDRRef = Doc._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T8 WITH(NOLOCK)
	//				|ON Doc._Fld4829RRef = T8._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference133 T9 WITH(NOLOCK)
	//				|ON DocTab._Fld4834RRef = T9._IDRRef
	//				|WHERE DATEADD(YEAR, -2000, Doc._Date_Time) >= '" + Формат(ДатаНачалаПеремещения, "ДФ=yyyy-MM-dd") + "T00:00:00' AND DATEADD(YEAR, -2000, Doc._Date_Time) <= '" + Формат(ДатаКонцаПеремещения, "ДФ=yyyy-MM-dd") + "T23:59:59'
	//				|and Doc._Posted = 1
	//				|and Doc._Fld7143 LIKE '%ТТ%'
	//				|and (T8._Fld1530 IN (" + СтрокаОтборПолучатель + ") or " + ?(ТТПолучатели.Количество() = 0, "0", "1") + "=0) --poluchatel--
	//				|and (" + ?(ТТОтправители.Количество() = 0, "0", "1") + "=0) --otpravitel--
	//				|and (T9._Fld1183 IN (" + СтрокаОтборТовары + ") or " + ?(Номенклатура.Количество() = 0, "0", "1") + "0=0) --tovar--
	//				|
	//				|SELECT
	//				|'Расход' as Vid,
	//				|T1._Number as Nomer,
	//				|DATEADD(YEAR, -2000, T1._Date_Time) as DateDoc,
	//				|CAST(T1._Fld7142 AS VARCHAR(400)) as Komment,
	//				|T2._Description as TTOtpravitel,
	//				|T3._Description as SkladOtpravitel,
	//				|T4._Description as TTPoluchatel,
	//				|T5._Description as SkladPoluchatel
	//				|FROM VV.dbo._Document304 T1 WITH(NOLOCK)
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T2 WITH(NOLOCK)
	//				|ON T1._Fld4811RRef = T2._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference166 T3 WITH(NOLOCK)
	//				|ON T1._Fld4812RRef = T3._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T4 WITH(NOLOCK)
	//				|ON T1._Fld4813RRef = T4._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference166 T5 WITH(NOLOCK)
	//				|ON T1._Fld4814RRef = T5._IDRRef
	//				|WHERE (T1._IDRRef IN (SELECT Doc.DocRef FROM #VT_Docs as Doc))
	//				|UNION ALL 
	//				|SELECT
	//				|'Приход',
	//				|T6._Number,
	//				|T6._Date_Time,
	//				|CAST(T6._Fld7143 AS VARCHAR(400)),
	//				|'',
	//				|'',
	//				|T7._Description,
	//				|T8._Description
	//				|FROM VV.dbo._Document305 T6 WITH(NOLOCK)
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T7 WITH(NOLOCK)
	//				|ON T6._Fld4829RRef = T7._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference166 T8 WITH(NOLOCK)
	//				|ON T6._Fld4830RRef = T8._IDRRef
	//				|WHERE T6._IDRRef IN (SELECT Doc.DocRef FROM #VT_Docs as Doc)
	//				|ORDER BY 3, 2
	//				|
	//				|SELECT
	//				|T1.TovarName,
	//				|T1.TTName,
	//				|SUM(T1.Kolvo) as Kolvo,
	//				|T1.Vid
	//				|FROM (SELECT
	//				|T3._Description AS TovarName,
	//				|T5._Description AS TTName,
	//				|T2._Fld4822 AS Kolvo,
	//				|'Расход' AS Vid
	//				|FROM VV.dbo._Document304_VT4816 T2 WITH(NOLOCK)
	//				|LEFT OUTER JOIN VV.dbo._Reference133 T3 WITH(NOLOCK)
	//				|ON T2._Fld4818RRef = T3._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Document304 T4 WITH(NOLOCK)
	//				|ON T2._Document304_IDRRef = T4._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T5 WITH(NOLOCK)
	//				|ON T4._Fld4811RRef = T5._IDRRef
	//				|WHERE (T2._Document304_IDRRef IN (SELECT Doc.DocRef FROM #VT_Docs as Doc))
	//				|and (T3._Fld1183 IN (" + СтрокаОтборТовары + ") or " + ?(Номенклатура.Количество() = 0, "0", "1") + "0=0) --tovar--
	//				|UNION ALL SELECT
	//				|T7._Description AS Description_,
	//				|T9._Description AS Description_,
	//				|T6._Fld4838 AS Fld4838_,
	//				|'Приход'
	//				|FROM VV.dbo._Document305_VT4832 T6 WITH(NOLOCK)
	//				|LEFT OUTER JOIN VV.dbo._Reference133 T7 WITH(NOLOCK)
	//				|ON T6._Fld4834RRef = T7._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Document305 T8 WITH(NOLOCK)
	//				|ON T6._Document305_IDRRef = T8._IDRRef
	//				|LEFT OUTER JOIN VV.dbo._Reference176 T9 WITH(NOLOCK)
	//				|ON T8._Fld4829RRef = T9._IDRRef
	//				|WHERE (T6._Document305_IDRRef IN (SELECT Doc.DocRef FROM #VT_Docs as Doc))
	//				|and (T7._Fld1183 IN (" + СтрокаОтборТовары + ") or " + ?(Номенклатура.Количество() = 0, "0", "1") + "0=0) --tovar--
	//				|) as T1
	//				|GROUP BY T1.TovarName,
	//				|T1.TTName,
	//				|T1.Vid
	//				|
	//				|Order by 2, 1
	//				|
	//				|IF OBJECT_ID ('tempdb..#VT_Docs') IS NOT NULL
	//				|DROP TABLE #VT_Docs";
	//				
	//rs = ADOСоединение.Execute(СтрЗапрос);
	//
	//Пока rs <> Неопределено И rs.Fields.Count <= 0 Цикл
	//	rs=rs.NextRecordSet();
	//КонецЦикла;
	//
	//Попытка
	//	rs.MoveFirst();
	//	
	//	Пока НЕ rs.EOF() Цикл
	//		СтрокаДоб = ТабПеремещения.Добавить();
	//		СтрокаДоб.Вид 		= Rs.Fields("Vid").Value;
	//		СтрокаДоб.Дата 		= Rs.Fields("DateDoc").Value;
	//		СтрокаДоб.Номер 		= Rs.Fields("Nomer").Value;
	//		СтрокаДоб.Отправитель 		= Rs.Fields("TTOtpravitel").Value;
	//		СтрокаДоб.СкладОтправителя 		= Rs.Fields("SkladOtpravitel").Value;   
	//		СтрокаДоб.Получатель 		= Rs.Fields("TTPoluchatel").Value;   
	//		СтрокаДоб.СкладПолучателя 		= Rs.Fields("SkladPoluchatel").Value;   
	//		СтрокаДоб.Комментарий 		= СокрЛП(Rs.Fields("Komment").Value); 
	//		rs.MoveNext();
	//	КонецЦикла;
	//Исключение
	//КонецПопытки;
	//
	//rs = rs.NextRecordset();
	//
	//Попытка
	//	rs.MoveFirst();
	//	
	//	Пока НЕ rs.EOF() Цикл
	//		СтрокаДоб = НоменклатураИтог.Добавить();
	//		СтрокаДоб.Вид 		= Rs.Fields("Vid").Value;
	//		СтрокаДоб.СтруктурнаяЕдиница 		= Rs.Fields("TTName").Value;
	//		СтрокаДоб.Номенклатура 		= Rs.Fields("TovarName").Value;
	//		СтрокаДоб.Количество 		= Rs.Fields("Kolvo").Value;
	//		rs.MoveNext();
	//	КонецЦикла;
	//Исключение
	//КонецПопытки;
	//
	//ADOСоединение.Close();
	
КонецПроцедуры

&НаКлиенте
Процедура ПеречитатьДанные(Команда)
	
	ПеречитатьДанныеПеремещенияВкусвилл();
	
КонецПроцедуры

