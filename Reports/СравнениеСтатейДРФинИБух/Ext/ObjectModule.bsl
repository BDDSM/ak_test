Перем СоединениеСБазой;

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	Перем ВнешнийНаборДанных;
	
	УстановитьПривилегированныйРежим(Истина);
	СтандартнаяОбработка = Ложь;
	
	ОбъектВывода = ДокументРезультат;
			
	НастройкиВывода = КомпоновщикНастроек.ПолучитьНастройки();
		
	ОбъектВывода.Очистить();
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, НастройкиВывода, );
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	
	//НастройкиКомпоновкиДанных = КомпоновщикНастроек.ПолучитьНастройки();

	
	РассчитатьНаборДанных(ВнешнийНаборДанных,НастройкиВывода);
	
	Если ВнешнийНаборДанных=Неопределено Тогда
		возврат;
	КонецЕсли;	
	
	СтруктураДанных = Новый Структура;
	СтруктураДанных.Вставить("ТЗ", 				ВнешнийНаборДанных);
	
	
	МакетКомпоновки = КомпоновщикМакета.Выполнить(
		СхемаКомпоновкиДанных, 
		НастройкиВывода,
		ДанныеРасшифровки
	);
	
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновки.Инициализировать(
		МакетКомпоновки,
		СтруктураДанных,
		ДанныеРасшифровки
	);
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
	ПроцессорВывода.НачатьВывод();
	ПроцессорВывода.Вывести(ПроцессорКомпоновки, Истина);
	ПроцессорВывода.ЗакончитьВывод();	
	
	//_глВывестиРезультатКомпоновкиСАвтофиксациейСтрок(ОбъектВывода, ПроцессорКомпоновки,,,Истина);  	
	
		
КонецПроцедуры

Функция ВыполнитьПодключениеКБазе()
	
	Если НЕ СоединениеСБазой = Неопределено Тогда
		возврат Истина;
	КонецЕсли;
	//ИмяИнформационнойБазыНаСервереДляПодключения 	= "BP_CORP_Deb";
	
	#Если ТолстыйКлиентОбычноеПриложение Тогда
	Состояние("Подключение к информационной базе");
	#КонецЕсли
	
	Попытка
		
		//ИмяСервераИнформационнойБазыДляПодключения = "10.0.0.15";
		//ИмяИнформационнойБазыНаСервереДляПодключения = "BP_CORP";
		//ПользовательИнформационнойБазыДляПодключения = "Обмен";
		//ПарольИнформационнойБазыДляПодключения = "123321";
		
		
		Коннектор = Новый COMObject(ПолныеПрава.ПолучитьВерсиюКомОбъекта_Бух() + ".COMConnector");
		// создается объект COM-соединение
		
		Строка = ПолныеПрава.ПолучитьСтрокуПодключения_Бух();
		СоединениеСБазой = Коннектор.Connect(Строка);
	Исключение
		СоединениеСБазой = Неопределено;
		Сообщить("Подключится к базе невозможно! " + Символы.ПС+Строка(ОписаниеОшибки()));
		Возврат Ложь;
	КонецПопытки;
	
	Возврат Истина;
	
КонецФункции


Процедура РассчитатьНаборДанных(ВнешнийНаборДанных,НастройкиВывода)
	
	ВнешнийНаборДанных = Новый ТаблицаЗначений;
	   	
	ВнешнийНаборДанных.Колонки.Добавить("РегистраторФин", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	ВнешнийНаборДанных.Колонки.Добавить("ГуидРегистратораФин", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	
	//МассивТипов = Новый Массив;
	//МассивТипов.Добавить(Документы.ТипВсеСсылки());
	//МассивТипов.Добавить(Тип("Строка"));
	ВнешнийНаборДанных.Колонки.Добавить("РегистраторФинСсылка", Документы.ТипВсеСсылки());

	ВнешнийНаборДанных.Колонки.Добавить("СтатьяБухФ", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
    ВнешнийНаборДанных.Колонки.Добавить("КодСтатьяБухФ", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	ВнешнийНаборДанных.Колонки.Добавить("КонтрагентФин", Новый ОписаниеТипов("СправочникСсылка.Контрагенты"));
	ВнешнийНаборДанных.Колонки.Добавить("ГуидКонтрагентаФин", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100))); 
	ВнешнийНаборДанных.Колонки.Добавить("СуммаОборотФин", Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
    ВнешнийНаборДанных.Колонки.Добавить("СтатьяДР", Новый ОписаниеТипов("СправочникСсылка.СтатьиДоходовРасходов"));
	ВнешнийНаборДанных.Колонки.Добавить("ГруппаФин", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
  	
	ВнешнийНаборДанных.Колонки.Добавить("РегистраторБух", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	ВнешнийНаборДанных.Колонки.Добавить("КомментарийБух", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	ВнешнийНаборДанных.Колонки.Добавить("ГуидРегистратораБух", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
    ВнешнийНаборДанных.Колонки.Добавить("СтатьяБух", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	ВнешнийНаборДанных.Колонки.Добавить("Группа", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
    ВнешнийНаборДанных.Колонки.Добавить("КодСтатьяБух", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	ВнешнийНаборДанных.Колонки.Добавить("КонтрагентБух", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100)));
	ВнешнийНаборДанных.Колонки.Добавить("ГуидКонтрагентаБух", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(100))); 
	ВнешнийНаборДанных.Колонки.Добавить("СуммаОборотБух", Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
    ВнешнийНаборДанных.Колонки.Добавить("Отклонение", Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
	ВнешнийНаборДанных.Колонки.Добавить("Загружать", Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(3)));


	
	//ВнешнийНаборДанных.Колонки.Добавить("Организация",Новый ОписаниеТипов("СправочникСсылка.Организации"));
	//ВнешнийНаборДанных.Колонки.Добавить("ЗадолженностьФинДт",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
	//ВнешнийНаборДанных.Колонки.Добавить("ЗадолженностьФинКт",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
	//ВнешнийНаборДанных.Колонки.Добавить("ЗадолженностьБухДт",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
	//ВнешнийНаборДанных.Колонки.Добавить("ЗадолженностьБухКт",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
	
	ВнешнийНаборДанных.Колонки.Добавить("СуммаФин",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
	ВнешнийНаборДанных.Колонки.Добавить("СуммаБух",Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
	
	//ПараметрДатаНачалаАнализа  = НастройкиВывода.ПараметрыДанных.Элементы.Найти("НачалоПериода");
	//Если ПараметрДатаНачалаАнализа = Неопределено Тогда
	//	ДатаНачалаАнализа = ДобавитьМесяц(ТекущаяДата(),-1);
	//Иначе
	//	ДатаНачалаАнализа = Дата(ПараметрДатаНачалаАнализа.Значение);
	//КонецЕсли;	
	//
	Период  = НастройкиВывода.ПараметрыДанных.Элементы.Найти("ПериодОтчета");
	//ПолеПериод = КонецДня(Период);
	//Если ПараметрДатаНачалаАнализа = Неопределено Тогда
	//	ДатаОкончанияАнализа = ДобавитьМесяц(ТекущаяДата(),1);
	//Иначе
	//	ДатаОкончанияАнализа = Дата(ПараметрДатаОкончанияАнализа.Значение);
	//КонецЕсли;	 
	ДатаНач = Период.Значение.ДатаНачала;
	ДатаКон = Период.Значение.ДатаОкончания;
	
	Если НЕ ВыполнитьПодключениеКБазе() Тогда
		Возврат;
	КонецЕсли;

	
	#Если ТолстыйКлиентОбычноеПриложение Тогда
	Состояние("Сопоставление контрагентов и организаций между базами");
	#КонецЕсли 
	ТаблицаДанныхБУ = ВернутьТаблицуБух(ДатаНач, ДатаКон); 
	ТаблицаДанныхФин = ВернутьТаблицуФин(ДатаНач, ДатаКон);
	#Если ТолстыйКлиентОбычноеПриложение Тогда
	Состояние("");
	#КонецЕсли  	
	
		
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ВЫРАЗИТЬ(ТЗ_Бух.РегистраторБух КАК СТРОКА(100)) КАК РегистраторБух,
	               |	ТЗ_Бух.ГуидРегистратораБух,
	               |	ТЗ_Бух.ГруппаБух,
	               |	ТЗ_Бух.КомментарийБух,
	               |	ТЗ_Бух.СтатьяБух,
	               |	ТЗ_Бух.КодСтатьяБух,
	               |	ТЗ_Бух.КонтрагентБух,
	               |	ТЗ_Бух.ГуидКонтрагентаБух,
	               |	ТЗ_Бух.СуммаОборотБух,
	               |	ТЗ_Бух.НомерБух,
	               |	ТЗ_Бух.ДатаБух
	               |ПОМЕСТИТЬ ТЗ_Бух
	               |ИЗ
	               |	&ТЗ_Бух КАК ТЗ_Бух
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ВЫРАЗИТЬ(ТЗ_Фин.РегистраторФин КАК СТРОКА(100)) КАК РегистраторФин,
				   |	ТЗ_Фин.РегистраторФинСсылка КАК РегистраторФинСсылка,
	               |	ВЫРАЗИТЬ(ТЗ_Фин.ГуидРегистратораФин КАК СТРОКА(100)) КАК ГуидРегистратораФин,
	               |	ВЫРАЗИТЬ(ТЗ_Фин.ГруппаФин КАК СТРОКА(100)) КАК ГруппаФин,
	               |	ВЫРАЗИТЬ(ТЗ_Фин.СтатьяБухФ КАК СТРОКА(100)) КАК СтатьяБухФ,
	               |	ВЫРАЗИТЬ(ТЗ_Фин.КодСтатьяБухФ КАК СТРОКА(100)) КАК КодСтатьяБухФ,
	               |	ТЗ_Фин.СтатьяФин,
	               |	ТЗ_Фин.КонтрагентФин,
	               |	ВЫРАЗИТЬ(ТЗ_Фин.ГуидКонтрагентаФин КАК СТРОКА(100)) КАК ГуидКонтрагентаФин,
	               |	ТЗ_Фин.СуммаОборотФин,
	               |	ТЗ_Фин.НомерФин,
	               |	ТЗ_Фин.ДатаФин,
	               |	ТЗ_Фин.Загружать
	               |ПОМЕСТИТЬ ТЗ_Фин
	               |ИЗ
	               |	&ТЗ_Фин КАК ТЗ_Фин
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_Фин.РегистраторФин,
				   |	ТЗ_Фин.РегистраторФинСсылка,
	               |	ТЗ_Фин.КонтрагентФин,
	               |	ТЗ_Фин.СтатьяФин,
	               |	ТЗ_Фин.СуммаОборотФин,
	               |	ТЗ_Фин.ГуидРегистратораФин,
	               |	ТЗ_Фин.ГуидКонтрагентаФин
	               |ПОМЕСТИТЬ ТЗ_ОбщаяСумма
	               |ИЗ
	               |	ТЗ_Фин КАК ТЗ_Фин
	               |ГДЕ
	               |	ТЗ_Фин.РегистраторФин ПОДОБНО ""%Начисление арендной платы от арендодателей%""
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ТЗ_Фин.СтатьяФин,
	               |	ТЗ_Фин.КонтрагентФин,
	               |	ТЗ_Фин.РегистраторФин,
				   |	ТЗ_Фин.РегистраторФинСсылка,
	               |	ТЗ_Фин.СуммаОборотФин,
	               |	ТЗ_Фин.ГуидРегистратораФин,
	               |	ТЗ_Фин.ГуидКонтрагентаФин
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ВЫРАЗИТЬ(ТЗ_Фин.РегистраторФин КАК СТРОКА(100)) КАК РегистраторФин,
				   |	ТЗ_Фин.РегистраторФинСсылка КАК РегистраторФинСсылка,
	               |	ЕСТЬNULL(ТЗ_Фин.КонтрагентФин.Наименование, ЕСТЬNULL(ТЗ_Бух.КонтрагентБух, """")) КАК Контрагент,
	               |	ЕСТЬNULL(ТЗ_Фин.СуммаОборотФин, 0) КАК СуммаОборотФин,
	               |	ТЗ_Бух.РегистраторБух,
	               |	ЕСТЬNULL(ТЗ_Фин.СтатьяБухФ, ТЗ_Бух.СтатьяБух) КАК СтатьяБух,
				   |	ЕСТЬNULL(ТЗ_Фин.КодСтатьяБухФ, ТЗ_Бух.КодСтатьяБух) КАК КодСтатьяБух,
	               |	ТЗ_Фин.СтатьяФин КАК СтатьяДР,
	               |	ЕСТЬNULL(ТЗ_Бух.СуммаОборотБух, 0) КАК СуммаОборотБух,
	               |	ЕСТЬNULL(ТЗ_Фин.ГруппаФин, ТЗ_Бух.ГруппаБух) КАК Группа,
	               |	ТЗ_Фин.ГуидРегистратораФин,
	               |	ТЗ_Фин.ГуидКонтрагентаФин,
	               |	ТЗ_Фин.Загружать
	               |ПОМЕСТИТЬ ТЗ_Итог
	               |ИЗ
	               |	ТЗ_Фин КАК ТЗ_Фин
	               |		ПОЛНОЕ СОЕДИНЕНИЕ ТЗ_Бух КАК ТЗ_Бух
	               |		ПО (ВЫБОР
	               |				КОГДА (ВЫРАЗИТЬ(ТЗ_Фин.ГруппаФин КАК СТРОКА(7))) = ""Выручка""
	               |					ТОГДА (ВЫРАЗИТЬ(ТЗ_Фин.ГруппаФин КАК СТРОКА(7))) = (ВЫРАЗИТЬ(ТЗ_Бух.ГруппаБух КАК СТРОКА(7)))
	               |				КОГДА (ВЫРАЗИТЬ(ТЗ_Фин.СтатьяФин.Наименование КАК СТРОКА(50))) = ""Себестоимость проданного товара""
	               |					ТОГДА (ВЫРАЗИТЬ(ТЗ_Фин.СтатьяФин.Наименование КАК СТРОКА(50))) = (ВЫРАЗИТЬ(ТЗ_Бух.СтатьяБух КАК СТРОКА(50)))
	               |				ИНАЧЕ (ВЫРАЗИТЬ(ТЗ_Фин.ГуидКонтрагентаФин КАК СТРОКА(100))) = (ВЫРАЗИТЬ(ТЗ_Бух.ГуидКонтрагентаБух КАК СТРОКА(100)))
	               |			КОНЕЦ)
	               |			И (ВЫБОР
	               |				КОГДА ТЗ_Фин.РегистраторФин ПОДОБНО ""%Поступление товаров услуг%""
	               |					ТОГДА (ВЫРАЗИТЬ(ТЗ_Фин.НомерФин КАК СТРОКА(20))) = (ВЫРАЗИТЬ(ТЗ_Бух.НомерБух КАК СТРОКА(20)))
	               |							И ТЗ_Фин.ДатаФин = ТЗ_Бух.ДатаБух
	               |				//КОГДА (ВЫРАЗИТЬ(ТЗ_Фин.ГруппаФин КАК СТРОКА(7))) = ""Выручка""
	               |				//	ТОГДА (ВЫРАЗИТЬ(ТЗ_Фин.ГруппаФин КАК СТРОКА(7))) = (ВЫРАЗИТЬ(ТЗ_Бух.ГруппаБух КАК СТРОКА(7)))
	               |				//КОГДА (ВЫРАЗИТЬ(ТЗ_Фин.СтатьяФин.Наименование КАК СТРОКА(50))) = ""Себестоимость проданного товара""
	               |				//	ТОГДА (ВЫРАЗИТЬ(ТЗ_Фин.СтатьяФин.Наименование КАК СТРОКА(50))) = (ВЫРАЗИТЬ(ТЗ_Бух.СтатьяБух КАК СТРОКА(50)))
	               |				КОГДА ТЗ_Фин.РегистраторФин ПОДОБНО ""%Начисление арендной платы от арендодателей%""
	               |					ТОГДА ТЗ_Фин.СуммаОборотФин = ТЗ_Бух.СуммаОборотБух И НачалоПериода(ТЗ_Фин.ДатаФин, День) = НачалоПериода(ТЗ_Бух.ДатаБух, День)
	               |				ИНАЧЕ (ВЫРАЗИТЬ(ТЗ_Фин.ГуидРегистратораФин КАК СТРОКА(100))) = (ВЫРАЗИТЬ(ТЗ_Бух.ГуидРегистратораБух КАК СТРОКА(100)))
	               |			КОНЕЦ)
	               |			И (ВЫБОР
	               |				//КОГДА (ВЫРАЗИТЬ(ТЗ_Фин.ГруппаФин КАК СТРОКА(7))) = ""Выручка""
	               |				//	ТОГДА (ВЫРАЗИТЬ(ТЗ_Фин.ГруппаФин КАК СТРОКА(7))) = (ВЫРАЗИТЬ(ТЗ_Бух.ГруппаБух КАК СТРОКА(7)))
	               |				КОГДА (ВЫРАЗИТЬ(ТЗ_Фин.СтатьяФин.Наименование КАК СТРОКА(50))) = ""Себестоимость проданного товара111""
	               |					ТОГДА (ВЫРАЗИТЬ(ТЗ_Фин.СтатьяФин.Наименование КАК СТРОКА(50))) = (ВЫРАЗИТЬ(ТЗ_Бух.СтатьяБух КАК СТРОКА(50)))
	               |				ИНАЧЕ (ВЫРАЗИТЬ(ТЗ_Фин.КодСтатьяБухФ КАК СТРОКА(15))) = (ВЫРАЗИТЬ(ТЗ_Бух.КодСтатьяБух КАК СТРОКА(15)))
	               |			КОНЕЦ)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_Итог.РегистраторФин,
				   |	ТЗ_Итог.РегистраторФинСсылка,
	               |	ТЗ_Итог.Контрагент,
	               |	ТЗ_Итог.СуммаОборотФин,
	               |	ТЗ_Итог.РегистраторБух,
				   |	ТЗ_Итог.КодСтатьяБух,
	               |	ТЗ_Итог.СтатьяБух,
	               |	ТЗ_Итог.СтатьяДР,
	               |	ТЗ_Итог.СуммаОборотБух,
	               |	ТЗ_Итог.Группа,
	               |	ВЫБОР
	               |		КОГДА ЕСТЬNULL(ТЗ_ОбщаяСумма.СуммаОборотФин, 0) = 0
	               |				ИЛИ ЕСТЬNULL(ТЗ_Итог.СуммаОборотБух, 0) = 0
	               |			ТОГДА 1
	               |		ИНАЧЕ ТЗ_Итог.СуммаОборотБух / ТЗ_ОбщаяСумма.СуммаОборотФин
	               |	КОНЕЦ КАК Коэффициент,
	               |	ТЗ_Итог.Загружать
	               |ПОМЕСТИТЬ ТЗ_ИтогоКоэффициент
	               |ИЗ
	               |	ТЗ_Итог КАК ТЗ_Итог
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТЗ_ОбщаяСумма КАК ТЗ_ОбщаяСумма
	               |		ПО ТЗ_Итог.ГуидРегистратораФин = ТЗ_ОбщаяСумма.ГуидРегистратораФин
	               |			И ТЗ_Итог.ГуидКонтрагентаФин = ТЗ_ОбщаяСумма.ГуидКонтрагентаФин
	               |			И ТЗ_Итог.СтатьяДР = ТЗ_ОбщаяСумма.СтатьяФин
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_ИтогоКоэффициент.РегистраторФин КАК РегистраторФин,
				   |	ТЗ_ИтогоКоэффициент.РегистраторФинСсылка КАК РегистраторФинСсылка,
	               |	ТЗ_ИтогоКоэффициент.Контрагент,
	               |	ВЫРАЗИТЬ(ТЗ_ИтогоКоэффициент.СуммаОборотФин * ТЗ_ИтогоКоэффициент.Коэффициент КАК ЧИСЛО(15, 2)) КАК СуммаОборотФин,
	               |	ТЗ_ИтогоКоэффициент.РегистраторБух,
	               |	Выбор 
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(24)) = ""Упаковка, тара, этикетки""
				   |         	Тогда ""Себестоимость проданного товара""  
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(20)) = ""Транспортные расходы""
				   |         	Тогда ""Себестоимость проданного товара""
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(18)) = ""Бонусы покупателям""
				   |         	Тогда """"
				   |	   	Иначе
				   |			ТЗ_ИтогоКоэффициент.СтатьяБух
				   |		Конец КАК СтатьяБух, 
				   |	Выбор 
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(24)) = ""Упаковка, тара, этикетки""
				   |         	Тогда ""000000069""
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(20)) = ""Транспортные расходы""
				   |         	Тогда ""000000069""
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(18)) = ""Бонусы покупателям""
				   |         	Тогда """"   
				   |	   	Иначе
				   |			ТЗ_ИтогоКоэффициент.КодСтатьяБух	
				   |		Конец КАК КодСтатьяБух,
				   |	
	               |	Выбор 
			   	   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(7)) = ""Выручка"" И НЕ Выразить(ТЗ_ИтогоКоэффициент.РегистраторБух КАК Строка(14)) = ""Бонус по карте""
			   	   |			Тогда &Выручка
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.РегистраторБух КАК Строка(20)) = ""Транспортные расходы"" 
			   	   |			Тогда ""Транспортные расходы"" 
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.РегистраторБух КАК Строка(14)) = ""Бонус по карте""  
			   	   |			Тогда &БонусыПокупателям 
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(31)) = ""Себестоимость проданного товара"" И (ТЗ_ИтогоКоэффициент.РегистраторБух = """" ИЛИ ТЗ_ИтогоКоэффициент.РегистраторБух = ""Интеркомпани НДС"" ИЛИ ТЗ_ИтогоКоэффициент.РегистраторБух = ""Интеркомпани"")   
			   	   |			Тогда &СебестоимостьПроданногоТовара  
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(24)) = ""Упаковка, тара, этикетки""  
			   	   |			Тогда ""Упаковка, тара, этикетки"" 
				   |		Когда Выразить(ТЗ_ИтогоКоэффициент.СтатьяБух КАК Строка(18)) = ""Бонусы покупателям""
				   |         	Тогда &БонусыПокупателям 
			   	   |		Иначе ТЗ_ИтогоКоэффициент.СтатьяДР Конец КАК СтатьяДР,
	               |	ТЗ_ИтогоКоэффициент.СуммаОборотБух,
	               |	ТЗ_ИтогоКоэффициент.Группа,
	               |	(ВЫРАЗИТЬ(ТЗ_ИтогоКоэффициент.СуммаОборотФин * ТЗ_ИтогоКоэффициент.Коэффициент КАК ЧИСЛО(15, 2))) - ТЗ_ИтогоКоэффициент.СуммаОборотБух КАК Отклонение,
	               |	ТЗ_ИтогоКоэффициент.Загружать КАК Загружать
	               |ИЗ
	               |	ТЗ_ИтогоКоэффициент КАК ТЗ_ИтогоКоэффициент
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	РегистраторФин,
	               |	СтатьяДР";
	
	Запрос.УстановитьПараметр("ТЗ_Бух", ТаблицаДанныхБУ);
	Запрос.УстановитьПараметр("ТЗ_Фин", ТаблицаДанныхФин);
	Запрос.УстановитьПараметр("Выручка", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("1"));
	Запрос.УстановитьПараметр("СебестоимостьПроданногоТовара", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("20110"));
	Запрос.УстановитьПараметр("БонусыПокупателям", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("20901"));
	
	ВнешнийНаборДанных = Запрос.Выполнить().Выгрузить();		
	
	
КонецПроцедуры

Функция ВернутьТаблицуБух(ДатаНач, ДатаКон)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
		|	ФинансовыйОбороты.СуммаОборот
		|ИЗ
		|	РегистрБухгалтерии.Финансовый.Обороты(&ДатаНач, &ДатаКон, Авто, Счет = &Счет6004, , Субконто2 = &Субконто2, КорСчет = &Счет50, ) КАК ФинансовыйОбороты";
	
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
	Запрос.УстановитьПараметр("Счет6004", ПланыСчетов.Финансовый.ПрочаяЗадолженность);
	Запрос.УстановитьПараметр("Счет50", ПланыСчетов.Финансовый.Касса);
    Запрос.УстановитьПараметр("Субконто2", Справочники.Контрагенты.НайтиПоНаименованию("Бонус по карте"));
	 
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	СуммаЗадолженности = 0;
	СуммаЗадолженностиНДС = 0;	
	Если Выборка.Следующий() Тогда
		СуммаЗадолженности = Выборка.СуммаОборот;
		СуммаЗадолженностиНДС = - Выборка.СуммаОборот * 0.11;
	КонецЕсли;   	
	
	Запрос = СоединениеСБазой.NewObject("Запрос");
	Запрос.Текст = "ВЫБРАТЬ
               |	Организации.ИНН
               |ПОМЕСТИТЬ ТЗ_ИНН
               |ИЗ
               |	Справочник.Организации КАК Организации
               |
               |СГРУППИРОВАТЬ ПО
               |	Организации.ИНН
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	СУММА(ВЫБОР
               |			КОГДА НЕ РеализацияТоваровУслугТовары.Номенклатура.Услуга
               |				ТОГДА РеализацияТоваровУслугТовары.СуммаНДС
               |			ИНАЧЕ 0
               |		КОНЕЦ) КАК СуммаНДСТовары,
               |	ВЫБОР
               |		КОГДА РеализацияТоваровУслугТовары.Номенклатура.Услуга
               |			ТОГДА РеализацияТоваровУслугТовары.СуммаНДС
               |		ИНАЧЕ 0
               |	КОНЕЦ КАК СуммаНДСУслуги
               |ПОМЕСТИТЬ ТЗ_НДС
               |ИЗ
               |	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
               |ГДЕ
               |	РеализацияТоваровУслугТовары.Ссылка.Дата МЕЖДУ &ДатаНач И &ДатаКон
               |	И РеализацияТоваровУслугТовары.Ссылка.Контрагент.ИНН В
               |			(ВЫБРАТЬ
               |				ТЗ_ИНН.ИНН
               |			ИЗ
               |				ТЗ_ИНН КАК ТЗ_ИНН)
               |
               |СГРУППИРОВАТЬ ПО
               |	ВЫБОР
               |		КОГДА РеализацияТоваровУслугТовары.Номенклатура.Услуга
               |			ТОГДА РеализацияТоваровУслугТовары.СуммаНДС
               |		ИНАЧЕ 0
               |	КОНЕЦ
               |
               |ОБЪЕДИНИТЬ ВСЕ
               |
               |ВЫБРАТЬ
               |	СУММА(ВЫБОР
               |			КОГДА НЕ РеализацияТоваровУслугУслуги.Номенклатура.Услуга
               |				ТОГДА РеализацияТоваровУслугУслуги.СуммаНДС
               |			ИНАЧЕ 0
               |		КОНЕЦ),
               |	ВЫБОР
               |		КОГДА РеализацияТоваровУслугУслуги.Номенклатура.Услуга
               |			ТОГДА РеализацияТоваровУслугУслуги.СуммаНДС
               |		ИНАЧЕ 0
               |	КОНЕЦ
               |ИЗ
               |	Документ.РеализацияТоваровУслуг.Услуги КАК РеализацияТоваровУслугУслуги
               |ГДЕ
               |	РеализацияТоваровУслугУслуги.Ссылка.Дата МЕЖДУ &ДатаНач И &ДатаКон
               |	И РеализацияТоваровУслугУслуги.Ссылка.Контрагент.ИНН В
               |			(ВЫБРАТЬ
               |				ТЗ_ИНН.ИНН
               |			ИЗ
               |				ТЗ_ИНН КАК ТЗ_ИНН)
               |
               |СГРУППИРОВАТЬ ПО
               |	ВЫБОР
               |		КОГДА РеализацияТоваровУслугУслуги.Номенклатура.Услуга
               |			ТОГДА РеализацияТоваровУслугУслуги.СуммаНДС
               |		ИНАЧЕ 0
               |	КОНЕЦ
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	СУММА(ТЗ_НДС.СуммаНДСТовары) КАК СуммаНДСТовары,
               |	СУММА(ТЗ_НДС.СуммаНДСУслуги) КАК СуммаНДСУслуги
               |ПОМЕСТИТЬ ТЗ_НДССвернутая
               |ИЗ
               |	ТЗ_НДС КАК ТЗ_НДС
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ВЫБОР
               |		КОГДА НЕ ХозрасчетныйОбороты.КорСубконто3.Услуга
               |			ТОГДА ХозрасчетныйОбороты.СуммаОборот
               |		ИНАЧЕ 0
               |	КОНЕЦ КАК СуммаОборотТовары,
               |	ВЫБОР
               |		КОГДА ХозрасчетныйОбороты.КорСубконто3.Услуга
               |			ТОГДА ХозрасчетныйОбороты.СуммаОборот
               |		ИНАЧЕ 0
               |	КОНЕЦ КАК СуммаОборотУслуги
               |ПОМЕСТИТЬ ТЗ_Интеркомпани
               |ИЗ
               |	РегистрБухгалтерии.Хозрасчетный.Обороты(
               |			&ДатаНач,
               |			&ДатаКон,
               |			Авто,
               |			Счет В ИЕРАРХИИ (&Счет62),
               |			,
               |			Субконто1.ИНН В
               |				(ВЫБРАТЬ
               |					ТЗ_ИНН.ИНН
               |				ИЗ
               |					ТЗ_ИНН КАК ТЗ_ИНН),
               |			КорСчет В ИЕРАРХИИ (&Счет90),
               |			) КАК ХозрасчетныйОбороты
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	СУММА(ТЗ_Интеркомпани.СуммаОборотТовары) КАК СуммаОборотТовары,
               |	СУММА(ТЗ_Интеркомпани.СуммаОборотУслуги) КАК СуммаОборотУслуги
               |ПОМЕСТИТЬ ТЗ_ИнтеркомпаниСвернутая
               |ИЗ
               |	ТЗ_Интеркомпани КАК ТЗ_Интеркомпани
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	ТЗ_ИнтеркомпаниСвернутая.СуммаОборотТовары,
               |	ТЗ_ИнтеркомпаниСвернутая.СуммаОборотУслуги,
               |	NULL КАК СуммаНДСТовары,
               |	NULL КАК СуммаНДСУслуги
               |ПОМЕСТИТЬ ТЗ_Итог
               |ИЗ
               |	ТЗ_ИнтеркомпаниСвернутая КАК ТЗ_ИнтеркомпаниСвернутая
               |
               |ОБЪЕДИНИТЬ ВСЕ
               |
               |ВЫБРАТЬ
               |	NULL,
               |	NULL,
               |	ТЗ_НДССвернутая.СуммаНДСТовары,
               |	ТЗ_НДССвернутая.СуммаНДСУслуги
               |ИЗ
               |	ТЗ_НДССвернутая КАК ТЗ_НДССвернутая
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	СУММА(ТЗ_Итог.СуммаОборотТовары) КАК СуммаОборотТовары,
               |	СУММА(ТЗ_Итог.СуммаОборотУслуги) КАК СуммаОборотУслуги,
               |	СУММА(ТЗ_Итог.СуммаНДСТовары) КАК СуммаНДСТовары,
               |	СУММА(ТЗ_Итог.СуммаНДСУслуги) КАК СуммаНДСУслуги
               |ИЗ
               |	ТЗ_Итог КАК ТЗ_Итог";
				   
	Запрос.УстановитьПараметр("Счет62", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("62"));
	Запрос.УстановитьПараметр("Счет90", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("90"));
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
	
	Результат = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = Результат.Выбрать();
	СуммаИнтеркомпаниТовары = 0;
	СуммаИнтеркомпаниНДСТовары = 0;
	СуммаИнтеркомпаниУслуги = 0;
	СуммаИнтеркомпаниНДСУслуги = 0;
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		СуммаИнтеркомпаниТовары = ВыборкаДетальныеЗаписи.СуммаОборотТовары;
		СуммаИнтеркомпаниНДСТовары = ВыборкаДетальныеЗаписи.СуммаНДСТовары;
		СуммаИнтеркомпаниУслуги = ВыборкаДетальныеЗаписи.СуммаОборотУслуги;
		СуммаИнтеркомпаниНДСУслуги = ВыборкаДетальныеЗаписи.СуммаНДСУслуги;	
	КонецЦикла;   	
	
	ТаблицаВозврата = Новый ТаблицаЗначений;   	
	ТаблицаВозврата.Колонки.Добавить("РегистраторБух", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("КомментарийБух", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("ГуидРегистратораБух", Новый ОписаниеТипов("Строка"));
    ТаблицаВозврата.Колонки.Добавить("СтатьяБух", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("ГруппаБух", Новый ОписаниеТипов("Строка"));
    ТаблицаВозврата.Колонки.Добавить("КодСтатьяБух", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("КонтрагентБух", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("ГуидКонтрагентаБух", Новый ОписаниеТипов("Строка")); 
	ТаблицаВозврата.Колонки.Добавить("СуммаОборотБух", Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
    ТаблицаВозврата.Колонки.Добавить("НомерБух", Новый ОписаниеТипов("Строка"));
    ТаблицаВозврата.Колонки.Добавить("ДатаБух", Новый ОписаниеТипов("Дата",,, Новый КвалификаторыДаты(ЧастиДаты.ДатаВремя)));
	
	Запрос = СоединениеСБазой.NewObject("Запрос");
	Запрос.Текст ="ВЫБРАТЬ
              |	Организации.ИНН
              |ПОМЕСТИТЬ ТЗ_ИНН
              |ИЗ
              |	Справочник.Организации КАК Организации
              |;
              |
              |////////////////////////////////////////////////////////////////////////////////
              |ВЫБРАТЬ
              |	ХозрасчетныйОбороты.СуммаОборот КАК СуммаНДС
              |ПОМЕСТИТЬ ТЗ_СуммаНДС
              |ИЗ
              |	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаНач, &ДатаКон, , Счет В ИЕРАРХИИ (&Счет9003), , , , ) КАК ХозрасчетныйОбороты
              |;
              |
              |////////////////////////////////////////////////////////////////////////////////
              |ВЫБРАТЬ
              |	ХозрасчетныйОбороты.Регистратор КАК РегистраторБух,
              |	ХозрасчетныйОбороты.Регистратор.Номер КАК НомерБух,
              |	ХозрасчетныйОбороты.Регистратор.Дата КАК ДатаБух,
              |	ВЫРАЗИТЬ(ХозрасчетныйОбороты.Регистратор.Комментарий КАК СТРОКА(150)) КАК КомментарийБух,
              |	""СТАТЬИ ИЗ БУХ"" КАК Группа,
              |	ВЫБОР
              |		КОГДА ХозрасчетныйОбороты.Субконто1.Наименование = ""Упаковка, тара, этикетки1""
              |			ТОГДА ""Себестоимость проданного товара""
              |		ИНАЧЕ ХозрасчетныйОбороты.Субконто1
              |	КОНЕЦ КАК СтатьяБух,
              |	ВЫБОР
              |		КОГДА ХозрасчетныйОбороты.Субконто1.Наименование = ""Упаковка, тара, этикетки1""
              |			ТОГДА ""000000069""
              |		ИНАЧЕ ХозрасчетныйОбороты.Субконто1.Код
              |	КОНЕЦ КАК КодСтатьяБух,
              |	СУММА(-ХозрасчетныйОбороты.СуммаОборот) КАК СуммаОборотБух,
              |	ВЫРАЗИТЬ(ХозрасчетныйОбороты.КорСубконто1 КАК Справочник.Контрагенты) КАК КонтрагентБух
              |ИЗ
              |	РегистрБухгалтерии.Хозрасчетный.Обороты(
              |			&ДатаНач,
              |			&ДатаКон,
              |			Регистратор,
              |			Счет В ИЕРАРХИИ (&Счет44)
              |				ИЛИ Счет В ИЕРАРХИИ (&Счет26)
              |				ИЛИ Счет В ИЕРАРХИИ (&Счет91),
              |			,
              |			,
              |			НЕ КорСчет В ИЕРАРХИИ (&Счет90)
              |				И НЕ КорСчет В ИЕРАРХИИ (&Счет44)
              |				И НЕ КорСчет В ИЕРАРХИИ (&Счет20)
              |				И НЕ КорСчет В ИЕРАРХИИ (&Счет26),
              |			) КАК ХозрасчетныйОбороты
              |ГДЕ
              |	ВЫБОР
              |			КОГДА ХозрасчетныйОбороты.КорСчет В ИЕРАРХИИ (&Счет60)
              |				ТОГДА НЕ ХозрасчетныйОбороты.КорСубконто1.ИНН В
              |							(ВЫБРАТЬ
              |								ТЗ_ИНН.ИНН
              |							ИЗ
              |								ТЗ_ИНН КАК ТЗ_ИНН)
              |			ИНАЧЕ ИСТИНА
              |		КОНЕЦ
              |	И ВЫБОР
              |			КОГДА ХозрасчетныйОбороты.Счет В ИЕРАРХИИ (&Счет44)
              |				ТОГДА НЕ ХозрасчетныйОбороты.Субконто1.ВидРасходовНУ = &ТранспортныеЗатраты
              |			ИНАЧЕ ИСТИНА
              |		КОНЕЦ
              |
              |СГРУППИРОВАТЬ ПО
              |	ХозрасчетныйОбороты.Регистратор,
              |	ХозрасчетныйОбороты.Регистратор.Номер,
              |	ХозрасчетныйОбороты.Регистратор.Дата,
              |	ВЫРАЗИТЬ(ХозрасчетныйОбороты.Регистратор.Комментарий КАК СТРОКА(150)),
              |	ВЫРАЗИТЬ(ХозрасчетныйОбороты.КорСубконто1 КАК Справочник.Контрагенты),
              |	ВЫБОР
              |		КОГДА ХозрасчетныйОбороты.Субконто1.Наименование = ""Упаковка, тара, этикетки1""
              |			ТОГДА ""Себестоимость проданного товара""
              |		ИНАЧЕ ХозрасчетныйОбороты.Субконто1
              |	КОНЕЦ,
              |	ВЫБОР
              |		КОГДА ХозрасчетныйОбороты.Субконто1.Наименование = ""Упаковка, тара, этикетки1""
              |			ТОГДА ""000000069""
              |		ИНАЧЕ ХозрасчетныйОбороты.Субконто1.Код
              |	КОНЕЦ
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Выручка"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	СУММА(-ХозрасчетныйОбороты.СуммаОборот),
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |ИЗ
              |	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаНач, &ДатаКон, Авто, Счет В ИЕРАРХИИ (&Счет9001), , , , ) КАК ХозрасчетныйОбороты
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Транспортные расходы"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Транспортные расходы"",
              |	""Себестоимость проданного товара"",
              |	""000000069"",
              |	СУММА(-ХозрасчетныйОбороты.СуммаОборот),
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |ИЗ
              |	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаНач, &ДатаКон, Авто, Счет В ИЕРАРХИИ (&Счет9007), , КорСубконто1.ВидРасходовНУ = &ТранспортныеЗатраты, КорСчет В ИЕРАРХИИ (&Счет44), ) КАК ХозрасчетныйОбороты
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Выручка НДС"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	-ТЗ_СуммаНДС.СуммаНДС,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |ИЗ
              |	ТЗ_СуммаНДС КАК ТЗ_СуммаНДС
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	"""",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Переменные затраты"",
              |	""Себестоимость проданного товара"",
              |	""000000069"",
              |	СУММА(-ХозрасчетныйОбороты.СуммаОборот),
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |ИЗ
              |	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаНач, &ДатаКон, Авто, Счет В ИЕРАРХИИ (&Счет9002), , , , ) КАК ХозрасчетныйОбороты
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Бонус по карте"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	&СуммаЗадолженности,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Бонус по карте НДС"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	&СуммаЗадолженностиНДС,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Бонус по карте"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	"""",
              |	""Бонусы покупателям"",
              |	"""",
              |	-&СуммаЗадолженности,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Бонус по карте НДС"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	"""",
              |	""Бонусы покупателям"",
              |	"""",
              |	-&СуммаЗадолженностиНДС,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Интеркомпани товары"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	&СуммаИнтеркомпаниТовары,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Интеркомпани НДС товары"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	&СуммаИнтеркомпаниНДСТовары,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              | 
			  |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Интеркомпани услуги"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	&СуммаИнтеркомпаниУслуги,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Интеркомпани НДС услуги"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Выручка"",
              |	""Выручка"",
              |	""1"",
              |	&СуммаИнтеркомпаниНДСУслуги,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Интеркомпани товары"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Переменные затраты"",
              |	""Себестоимость проданного товара"",
              |	""000000069"",
              |	-&СуммаИнтеркомпаниТовары,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""Интеркомпани НДС товары"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	""Переменные затраты"",
              |	""Себестоимость проданного товара"",
              |	""000000069"",
              |	-&СуммаИнтеркомпаниНДСТовары,
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""НДФЛ"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	"""",
              |	""Оплата труда"",
              |	""000000016"",
              |	СУММА(ХозрасчетныйОбороты.СуммаОборот),
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |ИЗ
              |	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаНач, &ДатаКон, Авто, Счет В ИЕРАРХИИ (&Счет70), , , КорСчет = &Счет6801, ) КАК ХозрасчетныйОбороты
              |
              |ОБЪЕДИНИТЬ ВСЕ
              |
              |ВЫБРАТЬ
              |	""НДФЛ"",
              |	"""",
              |	ДАТАВРЕМЯ(1, 1, 1),
              |	"""",
              |	"""",
              |	""Страховые взносы"",
              |	""000000023"",
              |	СУММА(-ХозрасчетныйОбороты.СуммаОборот),
              |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
              |ИЗ
              |	РегистрБухгалтерии.Хозрасчетный.Обороты(&ДатаНач, &ДатаКон, Авто, Счет В ИЕРАРХИИ (&Счет70), , , КорСчет = &Счет6801, ) КАК ХозрасчетныйОбороты
              |
              |УПОРЯДОЧИТЬ ПО
              |	РегистраторБух
              |АВТОУПОРЯДОЧИВАНИЕ";
				  
	Запрос.УстановитьПараметр("Счет44", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("44"));
	Запрос.УстановитьПараметр("Счет20", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("20"));
	Запрос.УстановитьПараметр("Счет26", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("26"));
	Запрос.УстановитьПараметр("Счет90", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("90"));
	Запрос.УстановитьПараметр("Счет91", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("91"));
	Запрос.УстановитьПараметр("Счет60", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("60"));
	Запрос.УстановитьПараметр("Счет70", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("70"));
	Запрос.УстановитьПараметр("Счет6801", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("68.01"));
	Запрос.УстановитьПараметр("Счет9001", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("90.01"));
	Запрос.УстановитьПараметр("Счет9002", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("90.02"));
	Запрос.УстановитьПараметр("Счет9003", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("90.03"));
	Запрос.УстановитьПараметр("Счет9007", СоединениеСБазой.ПланыСчетов.Хозрасчетный.НайтиПоКоду("90.07"));
	//Запрос.УстановитьПараметр("ТранспортныеЗатраты", СоединениеСБазой.Справочники.СтатьиЗатрат.НайтиПоНаименованию("Транспортные расходы"));
    Запрос.УстановитьПараметр("ТранспортныеЗатраты", СоединениеСБазой.Перечисления.ВидыРасходовНУ.ТранспортныеРасходы);


	Запрос.УстановитьПараметр("СуммаЗадолженности", СуммаЗадолженности);
	Запрос.УстановитьПараметр("СуммаЗадолженностиНДС", СуммаЗадолженностиНДС);
	Запрос.УстановитьПараметр("СуммаИнтеркомпаниТовары", -СуммаИнтеркомпаниТовары);
	Запрос.УстановитьПараметр("СуммаИнтеркомпаниНДСТовары", СуммаИнтеркомпаниНДСТовары);
	Запрос.УстановитьПараметр("СуммаИнтеркомпаниУслуги", -СуммаИнтеркомпаниУслуги);
	Запрос.УстановитьПараметр("СуммаИнтеркомпаниНДСУслуги", СуммаИнтеркомпаниНДСУслуги);
	
	Запрос.УстановитьПараметр("ДатаНач", ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", ДатаКон);
	
	Результат = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = Результат.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		НоваяСтрока = ТаблицаВозврата.Добавить();
		
		НоваяСтрока.РегистраторБух = СоединениеСБазой.String(ВыборкаДетальныеЗаписи.РегистраторБух); 
		НоваяСтрока.КомментарийБух = СоединениеСБазой.String(ВыборкаДетальныеЗаписи.КомментарийБух);
		Попытка
			НоваяСтрока.ГуидРегистратораБух = СоединениеСБазой.String(ВыборкаДетальныеЗаписи.РегистраторБух.УникальныйИдентификатор());; 
		Исключение
		КонецПопытки;
		НоваяСтрока.СтатьяБух = СоединениеСБазой.String(ВыборкаДетальныеЗаписи.СтатьяБух); 
		НоваяСтрока.КодСтатьяБух = СоединениеСБазой.String(ВыборкаДетальныеЗаписи.КодСтатьяБух); 
		НоваяСтрока.КонтрагентБух = СоединениеСБазой.String(ВыборкаДетальныеЗаписи.КонтрагентБух);
		Попытка
			НоваяСтрока.ГуидКонтрагентаБух = СоединениеСБазой.String(ВыборкаДетальныеЗаписи.КонтрагентБух.УникальныйИдентификатор());; 
		Исключение
		КонецПопытки; 
		
		НоваяСтрока.СуммаОборотБух = ВыборкаДетальныеЗаписи.СуммаОборотБух;
		НоваяСтрока.ГруппаБух = ВыборкаДетальныеЗаписи.Группа;
		НоваяСтрока.НомерБух = ВыборкаДетальныеЗаписи.НомерБух;
		НоваяСтрока.ДатаБух = ВыборкаДетальныеЗаписи.ДатаБух;
	
		//НоваяСтрока.ГУИД = СоединениеСБазой.String(КонтрагентБУ.УникальныйИдентификатор());	
	КонецЦикла;   	
		 	
	
	Возврат ТаблицаВозврата;
		
КонецФункции	

Функция ВернутьТаблицуФин(ДатаНач, ДатаКон)
	
	ТаблицаВозврата = Новый ТаблицаЗначений;   	
	
	ТаблицаВозврата.Колонки.Добавить("РегистраторФин", Новый ОписаниеТипов("Строка"));
	//МассивТипов = Новый Массив;
	//МассивТипов.Добавить(Документы.ТипВсеСсылки());
	//МассивТипов.Добавить(Тип("Строка"));
	ТаблицаВозврата.Колонки.Добавить("РегистраторФинСсылка", Документы.ТипВсеСсылки());
	ТаблицаВозврата.Колонки.Добавить("ГуидРегистратораФин", Новый ОписаниеТипов("Строка"));
    ТаблицаВозврата.Колонки.Добавить("СтатьяБухФ", Новый ОписаниеТипов("Строка"));
    ТаблицаВозврата.Колонки.Добавить("КодСтатьяБухФ", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("КонтрагентФин", Новый ОписаниеТипов("СправочникСсылка.Контрагенты"));
	ТаблицаВозврата.Колонки.Добавить("ГуидКонтрагентаФин", Новый ОписаниеТипов("Строка")); 
	ТаблицаВозврата.Колонки.Добавить("СуммаОборотФин", Новый ОписаниеТипов("Число",Новый КвалификаторыЧисла(15,2)));
    ТаблицаВозврата.Колонки.Добавить("СтатьяФин", Новый ОписаниеТипов("СправочникСсылка.СтатьиДоходовРасходов"));
	ТаблицаВозврата.Колонки.Добавить("ГруппаФин", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("НомерФин", Новый ОписаниеТипов("Строка"));
	ТаблицаВозврата.Колонки.Добавить("ДатаФин", Новый ОписаниеТипов("Дата",,, Новый КвалификаторыДаты(ЧастиДаты.ДатаВремя)));
	ТаблицаВозврата.Колонки.Добавить("Загружать", Новый ОписаниеТипов("Строка"));
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ПоступлениеТоваровУслугУслуги.Ссылка
	               |ПОМЕСТИТЬ ТЗ_ДокПоступленияУслуг
	               |ИЗ
	               |	Документ.ПоступлениеТоваровУслуг.Услуги КАК ПоступлениеТоваровУслугУслуги
	               |ГДЕ
	               |	ПоступлениеТоваровУслугУслуги.Ссылка.Проведен
	               |	И ПоступлениеТоваровУслугУслуги.СчетЗатрат В ИЕРАРХИИ(&Счет44)
	               |	И ПоступлениеТоваровУслугУслуги.Ссылка.Дата МЕЖДУ &ДатаНач И &ДатаКон
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПоступлениеТоваровУслугУслуги.Ссылка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	СоответствиеСтатейДРСтатьямБУ.Статья,
	               |	СоответствиеСтатейДРСтатьямБУ.Счет,
	               |	МАКСИМУМ(СоответствиеСтатейДРСтатьямБУ.СтатьяБУ) КАК СтатьяБУ
	               |ПОМЕСТИТЬ ТЗ_ОсновныеСтатьиБУ
	               |ИЗ
	               |	РегистрСведений.СоответствиеСтатейДРСтатьямБУ КАК СоответствиеСтатейДРСтатьямБУ
	               |ГДЕ
	               |	СоответствиеСтатейДРСтатьямБУ.Основное И СоответствиеСтатейДРСтатьямБУ.КорСчет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПустаяСсылка)
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	СоответствиеСтатейДРСтатьямБУ.Статья,
	               |	СоответствиеСтатейДРСтатьямБУ.Счет
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	СоответствиеСтатейДРСтатьямБУ.Статья,
	               |	СоответствиеСтатейДРСтатьямБУ.Счет,
	               |	СоответствиеСтатейДРСтатьямБУ.СтатьяБУ
	               |ПОМЕСТИТЬ ТЗ_НеОсновныеСтатьиБУ
	               |ИЗ
	               |	РегистрСведений.СоответствиеСтатейДРСтатьямБУ КАК СоответствиеСтатейДРСтатьямБУ
	               |ГДЕ
	               |	НЕ СоответствиеСтатейДРСтатьямБУ.Основное И СоответствиеСтатейДРСтатьямБУ.КорСчет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПустаяСсылка)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ КАК СтатьяФин,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ КАК КодСтатьяФин,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ КАК Контрагент,
	               |	СУММА(-ФинансовыйОбороты.СуммаОборот) КАК СуммаОборот,
	               |	""Переменные затраты"" КАК Группа,
	               |	ФинансовыйОбороты.Счет
	               |ПОМЕСТИТЬ ТЗ_Общая
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Обороты(
	               |			&ДатаНач,
	               |			&ДатаКон,
	               |			Регистратор,
	               |			Счет В ИЕРАРХИИ (&Счет44)
	               |				И НЕ Счет = &Счет442,
	               |			,
	               |			НЕ Субконто2 В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				И НЕ Субконто2 В ИЕРАРХИИ (&УЕК)
	               |				И НЕ Субконто2 = &КорСубконто2,
	               |			НЕ КорСчет В ИЕРАРХИИ (&Счет90)
	               |				И НЕ КорСчет В ИЕРАРХИИ (&Счет44),
	               |			) КАК ФинансовыйОбороты
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ,
	               |	ФинансовыйОбороты.Счет
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ,
	               |	СУММА(-ФинансовыйОбороты.СуммаОборот),
	               |	""Постоянные затраты"",
	               |	ФинансовыйОбороты.Счет
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Обороты(
	               |			&ДатаНач,
	               |			&ДатаКон,
	               |			Регистратор,
	               |			Счет В ИЕРАРХИИ (&Счет44)
	               |				И НЕ Счет = &Счет442,
	               |			,
	               |			Субконто2 В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				ИЛИ Субконто2 В ИЕРАРХИИ (&УЕК),
	               |			НЕ КорСчет В ИЕРАРХИИ (&Счет90)
	               |				И НЕ КорСчет В ИЕРАРХИИ (&Счет44),
	               |			) КАК ФинансовыйОбороты
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ,
	               |	ФинансовыйОбороты.Счет
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ,
	               |	СУММА(-ФинансовыйОбороты.СуммаОборот),
	               |	""Общие затраты"",
	               |	ФинансовыйОбороты.Счет
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Обороты(
	               |			&ДатаНач,
	               |			&ДатаКон,
	               |			Регистратор,
	               |			Счет = &Счет442,
	               |			,
	               |			НЕ Субконто2 = &КорСубконто2
	               |				И НЕ ВЫРАЗИТЬ(Субконто2 КАК Справочник.СтатьиДоходовРасходов).Код = ""35018"",
	               |			НЕ КорСчет В ИЕРАРХИИ (&Счет90)
	               |				И НЕ КорСчет В ИЕРАРХИИ (&Счет44),
	               |			) КАК ФинансовыйОбороты
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ,
	               |	ФинансовыйОбороты.Счет
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ,
	               |	СУММА(-ФинансовыйОбороты.СуммаОборот),
	               |	""Основные средства"",
	               |	ФинансовыйОбороты.Счет
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Обороты(
	               |			&ДатаНач,
	               |			&ДатаКон,
	               |			Регистратор,
	               |			Счет В ИЕРАРХИИ (&Счет44),
	               |			,
	               |			Субконто2 = &КорСубконто2,
	               |			НЕ КорСчет В ИЕРАРХИИ (&Счет90)
	               |				И НЕ КорСчет В ИЕРАРХИИ (&Счет44),
	               |			) КАК ФинансовыйОбороты
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ФинансовыйОбороты.Регистратор,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.Счет = &Счет444
	               |			ТОГДА ФинансовыйОбороты.Субконто1.Код
	               |		ИНАЧЕ ФинансовыйОбороты.Субконто2.Код
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ФинансовыйОбороты.КорСубконто1 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто1 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто2 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто2 КАК Справочник.Контрагенты)
	               |		КОГДА ФинансовыйОбороты.КорСубконто3 ССЫЛКА Справочник.Контрагенты
	               |			ТОГДА ВЫРАЗИТЬ(ФинансовыйОбороты.КорСубконто3 КАК Справочник.Контрагенты)
	               |	КОНЕЦ,
	               |	ФинансовыйОбороты.Счет
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	""Выручка фин"",
	               |	&Выручка,
	               |	""1"",
	               |	ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка),
	               |	-ФинансовыйОбороты.СуммаОборот,
	               |	""Выручка"",
	               |	ФинансовыйОбороты.Счет
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Обороты(&ДатаНач, &ДатаКон, , Счет В ИЕРАРХИИ (&Счет90), , Субконто2 В ИЕРАРХИИ (&Выручка), , ) КАК ФинансовыйОбороты
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_Общая.Регистратор
	               |ПОМЕСТИТЬ ТЗ_РегистраторыАванс
	               |ИЗ
	               |	ТЗ_Общая КАК ТЗ_Общая
	               |ГДЕ
	               |	ТЗ_Общая.Регистратор ССЫЛКА Документ.АвансовыйОтчет
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ТЗ_Общая.Регистратор
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ВложенныйЗапрос.Статья,
	               |	ВложенныйЗапрос.Регистратор,
	               |	-ВложенныйЗапрос.СуммаСНДС КАК СуммаСНДС,
	               |	-ВложенныйЗапрос.СуммаБезНДС КАК СуммаБезНДС,
	               |	-ВложенныйЗапрос.СуммаНДС КАК СуммаНДС,
	               |	ВЫБОР
	               |		КОГДА ВложенныйЗапрос.СтатьяБУ = ЗНАЧЕНИЕ(Справочник.СтатьиЗатратБУ.ПустаяСсылка)
	               |				ИЛИ ВложенныйЗапрос.СтатьяБУ ЕСТЬ NULL 
	               |			ТОГДА НЕОПРЕДЕЛЕНО
	               |		ИНАЧЕ ЕСТЬNULL(ВложенныйЗапрос.СтатьяБУ, НЕОПРЕДЕЛЕНО)
	               |	КОНЕЦ КАК СтатьяБУ,
	               |	ВложенныйЗапрос.Контрагент,
	               |	ВложенныйЗапрос.Статья.Код,
	               |	ВЫБОР
	               |		КОГДА НЕ ВложенныйЗапрос.Статья В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				И НЕ ВложенныйЗапрос.Статья В ИЕРАРХИИ (&УЕК)
	               |				И НЕ ВложенныйЗапрос.Статья = &КорСубконто2
	               |			ТОГДА ""Переменные затраты""
	               |		КОГДА ВложенныйЗапрос.Статья В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				ИЛИ ВложенныйЗапрос.Статья В ИЕРАРХИИ (&УЕК)
	               |			ТОГДА ""Постоянные затраты""
	               |		КОГДА ВложенныйЗапрос.Статья = &КорСубконто2
	               |			ТОГДА ""Основные средства""
	               |		ИНАЧЕ ""Общие затраты""
	               |	КОНЕЦ КАК Группа,
	               |	ВЫБОР
	               |		КОГДА ВложенныйЗапрос.СчетЗатрат = &Счет08
	               |			ТОГДА &Счет443
	               |		ИНАЧЕ ВложенныйЗапрос.СчетЗатрат
	               |	КОНЕЦ КАК Счет
	               |ПОМЕСТИТЬ ТЗ_Поступления
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов) КАК Статья,
	               |		ПоступлениеТоваровУслугТовары.Ссылка КАК Регистратор,
	               |		ПоступлениеТоваровУслугТовары.Сумма КАК СуммаСНДС,
	               |		ПоступлениеТоваровУслугТовары.Сумма - ПоступлениеТоваровУслугТовары.СуммаНДС КАК СуммаБезНДС,
	               |		ПоступлениеТоваровУслугТовары.СуммаНДС КАК СуммаНДС,
	               |		НЕОПРЕДЕЛЕНО КАК СтатьяБУ,
	               |		ПоступлениеТоваровУслугТовары.Ссылка.Контрагент КАК Контрагент,
	               |		NULL КАК СчетЗатрат
	               |	ИЗ
	               |		Документ.ПоступлениеТоваровУслуг.Товары КАК ПоступлениеТоваровУслугТовары
	               |	ГДЕ
	               |		ПоступлениеТоваровУслугТовары.Ссылка В
	               |				(ВЫБРАТЬ
	               |					ТЗ_ДокПоступленияУслуг.Ссылка
	               |				ИЗ
	               |					ТЗ_ДокПоступленияУслуг КАК ТЗ_ДокПоступленияУслуг)
	               |		И ПоступлениеТоваровУслугТовары.СчетУчета В ИЕРАРХИИ(&Счет44)
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		ВЫБОР
	               |			КОГДА ПоступлениеТоваровУслугУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |					ИЛИ ПоступлениеТоваровУслугУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет01)
	               |				ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |			ИНАЧЕ ВЫРАЗИТЬ(ПоступлениеТоваровУслугУслуги.Субконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |		КОНЕЦ,
	               |		ПоступлениеТоваровУслугУслуги.Ссылка,
	               |		ПоступлениеТоваровУслугУслуги.Сумма,
	               |		ВЫБОР
	               |			КОГДА ПоступлениеТоваровУслугУслуги.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС0)
	               |					ИЛИ ПоступлениеТоваровУслугУслуги.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.ПустаяСсылка)
	               |					ИЛИ ПоступлениеТоваровУслугУслуги.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
	               |				ТОГДА ПоступлениеТоваровУслугУслуги.Сумма - ПоступлениеТоваровУслугУслуги.СуммаНДС
	               |			ИНАЧЕ ПоступлениеТоваровУслугУслуги.Сумма - ПоступлениеТоваровУслугУслуги.СуммаНДС
	               |		КОНЕЦ,
	               |		ВЫБОР
	               |			КОГДА ПоступлениеТоваровУслугУслуги.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.НДС0)
	               |					ИЛИ ПоступлениеТоваровУслугУслуги.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.ПустаяСсылка)
	               |					ИЛИ ПоступлениеТоваровУслугУслуги.СтавкаНДС = ЗНАЧЕНИЕ(Перечисление.СтавкиНДС.БезНДС)
	               |				ТОГДА ПоступлениеТоваровУслугУслуги.СуммаНДС
	               |			ИНАЧЕ ПоступлениеТоваровУслугУслуги.СуммаНДС
	               |		КОНЕЦ,
	               |		ВЫБОР
	               |			КОГДА ПоступлениеТоваровУслугУслуги.СубконтоБУ1 ССЫЛКА Справочник.СтатьиЗатратБУ
	               |				ТОГДА ВЫБОР
	               |						КОГДА ПоступлениеТоваровУслугУслуги.СубконтоБУ1 = ЗНАЧЕНИЕ(Справочник.СтатьиЗатратБУ.ПустаяСсылка)
	               |							ТОГДА НЕОПРЕДЕЛЕНО
	               |						ИНАЧЕ ПоступлениеТоваровУслугУслуги.СубконтоБУ1
	               |					КОНЕЦ
	               |			ИНАЧЕ НЕОПРЕДЕЛЕНО
	               |		КОНЕЦ,
	               |		ПоступлениеТоваровУслугУслуги.Ссылка.Контрагент,
	               |		ПоступлениеТоваровУслугУслуги.СчетЗатрат
	               |	ИЗ
	               |		Документ.ПоступлениеТоваровУслуг.Услуги КАК ПоступлениеТоваровУслугУслуги
	               |	ГДЕ
	               |		ПоступлениеТоваровУслугУслуги.Ссылка В
	               |				(ВЫБРАТЬ
	               |					ТЗ_ДокПоступленияУслуг.Ссылка
	               |				ИЗ
	               |					ТЗ_ДокПоступленияУслуг КАК ТЗ_ДокПоступленияУслуг)
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов),
	               |		ПоступлениеТоваровУслугОборудование.Ссылка,
	               |		ПоступлениеТоваровУслугОборудование.Сумма,
	               |		ПоступлениеТоваровУслугОборудование.Сумма - ПоступлениеТоваровУслугОборудование.СуммаНДС,
	               |		ПоступлениеТоваровУслугОборудование.СуммаНДС,
	               |		НЕОПРЕДЕЛЕНО,
	               |		ПоступлениеТоваровУслугОборудование.Ссылка.Контрагент,
	               |		&Счет443
	               |	ИЗ
	               |		Документ.ПоступлениеТоваровУслуг.Оборудование КАК ПоступлениеТоваровУслугОборудование
	               |	ГДЕ
	               |		ПоступлениеТоваровУслугОборудование.Ссылка В
	               |				(ВЫБРАТЬ
	               |					ТЗ_ДокПоступленияУслуг.Ссылка
	               |				ИЗ
	               |					ТЗ_ДокПоступленияУслуг КАК ТЗ_ДокПоступленияУслуг)) КАК ВложенныйЗапрос
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	АвансовыйОтчетТовары.Сумма,
	               |	АвансовыйОтчетТовары.СуммаНДС,
	               |	-(АвансовыйОтчетТовары.Сумма - АвансовыйОтчетТовары.СуммаНДС) КАК СуммаБезНДС,
	               |	ВЫБОР
	               |		КОГДА АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ (&Счет08)
	               |			ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |		ИНАЧЕ АвансовыйОтчетТовары.Субконто2
	               |	КОНЕЦ КАК Статья,
	               |	АвансовыйОтчетТовары.Ссылка КАК Регистратор,
	               |	АвансовыйОтчетТовары.СубконтоБУ1 КАК СтатьяБУ,
	               |	НЕОПРЕДЕЛЕНО КАК Контрагент,
	               |	ВЫБОР
	               |		КОГДА НЕ ВЫБОР
	               |						КОГДА АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ (&Счет08)
	               |							ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |						ИНАЧЕ АвансовыйОтчетТовары.Субконто2
	               |					КОНЕЦ В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				И НЕ ВЫБОР
	               |						КОГДА АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ (&Счет08)
	               |							ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |						ИНАЧЕ АвансовыйОтчетТовары.Субконто2
	               |					КОНЕЦ В ИЕРАРХИИ (&УЕК)
	               |				И НЕ ВЫБОР
	               |						КОГДА АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ (&Счет08)
	               |							ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |						ИНАЧЕ АвансовыйОтчетТовары.Субконто2
	               |					КОНЕЦ = &КорСубконто2
	               |			ТОГДА ""Переменные затраты""
	               |		КОГДА ВЫБОР
	               |					КОГДА АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ (&Счет08)
	               |						ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |					ИНАЧЕ АвансовыйОтчетТовары.Субконто2
	               |				КОНЕЦ В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				ИЛИ ВЫБОР
	               |					КОГДА АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ (&Счет08)
	               |						ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |					ИНАЧЕ АвансовыйОтчетТовары.Субконто2
	               |				КОНЕЦ В ИЕРАРХИИ (&УЕК)
	               |			ТОГДА ""Постоянные затраты""
	               |		КОГДА ВЫБОР
	               |				КОГДА АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ (&Счет08)
	               |					ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |				ИНАЧЕ АвансовыйОтчетТовары.Субконто2
	               |			КОНЕЦ = &КорСубконто2
	               |			ТОГДА ""Основные средства""
	               |		ИНАЧЕ ""Общие затраты""
	               |	КОНЕЦ КАК Группа
	               |ПОМЕСТИТЬ ТЗ_Авансы
	               |ИЗ
	               |	Документ.АвансовыйОтчет.Товары КАК АвансовыйОтчетТовары
	               |ГДЕ
	               |	АвансовыйОтчетТовары.Ссылка В
	               |			(ВЫБРАТЬ
	               |				ТЗ_РегистраторыАванс.Регистратор
	               |			ИЗ
	               |				ТЗ_РегистраторыАванс КАК ТЗ_РегистраторыАванс)
	               |	И АвансовыйОтчетТовары.СчетУчета В ИЕРАРХИИ(&Счет44)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	АвансовыйОтчетУслуги.Сумма,
	               |	АвансовыйОтчетУслуги.СуммаНДС,
	               |	-(АвансовыйОтчетУслуги.Сумма - АвансовыйОтчетУслуги.СуммаНДС),
	               |	ВЫБОР
	               |		КОГДА АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |			ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |		ИНАЧЕ АвансовыйОтчетУслуги.Субконто2
	               |	КОНЕЦ,
	               |	АвансовыйОтчетУслуги.Ссылка,
	               |	АвансовыйОтчетУслуги.СубконтоБУ1,
	               |	НЕОПРЕДЕЛЕНО,
	               |	ВЫБОР
	               |		КОГДА НЕ ВЫБОР
	               |						КОГДА АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |							ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |						ИНАЧЕ АвансовыйОтчетУслуги.Субконто2
	               |					КОНЕЦ В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				И НЕ ВЫБОР
	               |						КОГДА АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |							ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |						ИНАЧЕ АвансовыйОтчетУслуги.Субконто2
	               |					КОНЕЦ В ИЕРАРХИИ (&УЕК)
	               |				И НЕ ВЫБОР
	               |						КОГДА АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |							ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |						ИНАЧЕ АвансовыйОтчетУслуги.Субконто2
	               |					КОНЕЦ = &КорСубконто2
	               |			ТОГДА ""Переменные затраты""
	               |		КОГДА ВЫБОР
	               |					КОГДА АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |						ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |					ИНАЧЕ АвансовыйОтчетУслуги.Субконто2
	               |				КОНЕЦ В ИЕРАРХИИ (&ЗатратыПостоянные)
	               |				ИЛИ ВЫБОР
	               |					КОГДА АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |						ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |					ИНАЧЕ АвансовыйОтчетУслуги.Субконто2
	               |				КОНЕЦ В ИЕРАРХИИ (&УЕК)
	               |			ТОГДА ""Постоянные затраты""
	               |		КОГДА ВЫБОР
	               |				КОГДА АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |					ТОГДА ВЫРАЗИТЬ(&КорСубконто2 КАК Справочник.СтатьиДоходовРасходов)
	               |				ИНАЧЕ АвансовыйОтчетУслуги.Субконто2
	               |			КОНЕЦ = &КорСубконто2
	               |			ТОГДА ""Основные средства""
	               |		ИНАЧЕ ""Общие затраты""
	               |	КОНЕЦ
	               |ИЗ
	               |	Документ.АвансовыйОтчет.Услуги КАК АвансовыйОтчетУслуги
	               |ГДЕ
	               |	АвансовыйОтчетУслуги.Ссылка В
	               |			(ВЫБРАТЬ
	               |				ТЗ_РегистраторыАванс.Регистратор
	               |			ИЗ
	               |				ТЗ_РегистраторыАванс КАК ТЗ_РегистраторыАванс)
	               |	И (АвансовыйОтчетУслуги.СчетЗатрат В ИЕРАРХИИ (&Счет08)
	               |			ИЛИ АвансовыйОтчетУслуги.Субконто2 ССЫЛКА Справочник.СтатьиДоходовРасходов)
	               |	И ЛОЖЬ
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_Общая.Регистратор,
	               |	ТЗ_Общая.СтатьяФин,
	               |	ТЗ_Общая.КодСтатьяФин,
	               |	ТЗ_Общая.Контрагент,
	               |	ТЗ_Общая.СуммаОборот,
	               |	НЕОПРЕДЕЛЕНО КАК СтатьяБУ,
	               |	ТЗ_Общая.Группа,
	               |	ТЗ_Общая.Счет
	               |ПОМЕСТИТЬ ТЗ_ИтоговаяБезСтатьиБУ
	               |ИЗ
	               |	ТЗ_Общая КАК ТЗ_Общая
	               |ГДЕ
	               |	НЕ ТЗ_Общая.Регистратор В
	               |				(ВЫБРАТЬ
	               |					ТЗ_ДокПоступленияУслуг.Ссылка
	               |				ИЗ
	               |					ТЗ_ДокПоступленияУслуг КАК ТЗ_ДокПоступленияУслуг)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ТЗ_Поступления.Регистратор,
	               |	ТЗ_Поступления.Статья,
	               |	ТЗ_Поступления.СтатьяКод,
	               |	ТЗ_Поступления.Контрагент,
	               |	ТЗ_Поступления.СуммаБезНДС,
	               |	ТЗ_Поступления.СтатьяБУ,
	               |	ТЗ_Поступления.Группа,
	               |	ТЗ_Поступления.Счет
	               |ИЗ
	               |	ТЗ_Поступления КАК ТЗ_Поступления
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_ИтоговаяБезСтатьиБУ.Регистратор КАК РегистраторФин,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.КодСтатьяФин,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.Контрагент КАК КонтрагентФин,
	               |	СУММА(ТЗ_ИтоговаяБезСтатьиБУ.СуммаОборот) КАК СуммаОборотФин,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин = &Выручка
	               |			ТОГДА ""Выручка""
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ = НЕОПРЕДЕЛЕНО
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ ЕСТЬ NULL 
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ = ЗНАЧЕНИЕ(Справочник.СтатьиЗатратБУ.ПустаяСсылка)
	               |			ТОГДА ЕСТЬNULL(ТЗ_ОсновныеСтатьиБУ.СтатьяБУ, ТЗ_НеОсновныеСтатьиБУ.СтатьяБУ)
	               |		ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ
	               |	КОНЕЦ КАК СтатьяБУ,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.Группа,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин = &Выручка
	               |			ТОГДА ""1""
	               |		ИНАЧЕ (ВЫБОР
	               |				КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ = НЕОПРЕДЕЛЕНО
	               |					ТОГДА ЕСТЬNULL(ТЗ_ОсновныеСтатьиБУ.СтатьяБУ, ТЗ_НеОсновныеСтатьиБУ.СтатьяБУ)
	               |				ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ
	               |			КОНЕЦ).Код
	               |	КОНЕЦ КАК КодСтатьяБУ,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = """"
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = НЕОПРЕДЕЛЕНО
	               |			ТОГДА """"
	               |		ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор.Номер
	               |	КОНЕЦ КАК НомерФин,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = """"
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = НЕОПРЕДЕЛЕНО
	               |			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
	               |		ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор.Дата
	               |	КОНЕЦ КАК ДатаФин,
	               |	"""" КАК Загружать
	               |ПОМЕСТИТЬ ТЗ_ИтогГруппировка
	               |ИЗ
	               |	ТЗ_ИтоговаяБезСтатьиБУ КАК ТЗ_ИтоговаяБезСтатьиБУ
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТЗ_ОсновныеСтатьиБУ КАК ТЗ_ОсновныеСтатьиБУ
	               |		ПО ТЗ_ИтоговаяБезСтатьиБУ.Счет = ТЗ_ОсновныеСтатьиБУ.Счет
	               |			И ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин = ТЗ_ОсновныеСтатьиБУ.Статья
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТЗ_НеОсновныеСтатьиБУ КАК ТЗ_НеОсновныеСтатьиБУ
	               |		ПО ТЗ_ИтоговаяБезСтатьиБУ.Счет = ТЗ_НеОсновныеСтатьиБУ.Счет
	               |			И ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин = ТЗ_НеОсновныеСтатьиБУ.Статья
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ТЗ_ИтоговаяБезСтатьиБУ.Группа,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.Регистратор,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.КодСтатьяФин,
	               |	ТЗ_ИтоговаяБезСтатьиБУ.Контрагент,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин = &Выручка
	               |			ТОГДА ""Выручка""
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ = НЕОПРЕДЕЛЕНО
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ ЕСТЬ NULL 
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ = ЗНАЧЕНИЕ(Справочник.СтатьиЗатратБУ.ПустаяСсылка)
	               |			ТОГДА ЕСТЬNULL(ТЗ_ОсновныеСтатьиБУ.СтатьяБУ, ТЗ_НеОсновныеСтатьиБУ.СтатьяБУ)
	               |		ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = """"
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = НЕОПРЕДЕЛЕНО
	               |			ТОГДА """"
	               |		ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор.Номер
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = """"
	               |				ИЛИ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор = НЕОПРЕДЕЛЕНО
	               |			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
	               |		ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.Регистратор.Дата
	               |	КОНЕЦ,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяФин = &Выручка
	               |			ТОГДА ""1""
	               |		ИНАЧЕ (ВЫБОР
	               |				КОГДА ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ = НЕОПРЕДЕЛЕНО
	               |					ТОГДА ЕСТЬNULL(ТЗ_ОсновныеСтатьиБУ.СтатьяБУ, ТЗ_НеОсновныеСтатьиБУ.СтатьяБУ)
	               |				ИНАЧЕ ТЗ_ИтоговаяБезСтатьиБУ.СтатьяБУ
	               |			КОНЕЦ).Код
	               |	КОНЕЦ
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ТЗ_ИтогГруппировка.РегистраторФин,
	               |	ТЗ_ИтогГруппировка.СтатьяФин,
	               |	ТЗ_ИтогГруппировка.КодСтатьяФин,
	               |	ТЗ_ИтогГруппировка.КонтрагентФин,
	               |	ТЗ_ИтогГруппировка.СуммаОборотФин,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтогГруппировка.СтатьяБУ ССЫЛКА Справочник.СтатьиЗатратБУ
	               |			ТОГДА ВЫБОР
	               |					КОГДА НЕ ТЗ_ИтогГруппировка.СтатьяБУ.ГоловнаяСтатьяЗатратБУ = ЗНАЧЕНИЕ(Справочник.СтатьиЗатратБУ.ПустаяСсылка)
	               |						ТОГДА ТЗ_ИтогГруппировка.СтатьяБУ.ГоловнаяСтатьяЗатратБУ
	               |					ИНАЧЕ ТЗ_ИтогГруппировка.СтатьяБУ
	               |				КОНЕЦ
	               |		ИНАЧЕ ТЗ_ИтогГруппировка.СтатьяБУ
	               |	КОНЕЦ КАК СтатьяБУ,
	               |	ТЗ_ИтогГруппировка.Группа,
	               |	ВЫБОР
	               |		КОГДА ТЗ_ИтогГруппировка.СтатьяБУ ССЫЛКА Справочник.СтатьиЗатратБУ
	               |			ТОГДА ВЫБОР
	               |					КОГДА НЕ ТЗ_ИтогГруппировка.СтатьяБУ.ГоловнаяСтатьяЗатратБУ = ЗНАЧЕНИЕ(Справочник.СтатьиЗатратБУ.ПустаяСсылка)
	               |						ТОГДА ТЗ_ИтогГруппировка.СтатьяБУ.ГоловнаяСтатьяЗатратБУ.Код
	               |					ИНАЧЕ ТЗ_ИтогГруппировка.СтатьяБУ.Код
	               |				КОНЕЦ
	               |		ИНАЧЕ ТЗ_ИтогГруппировка.КодСтатьяБУ
	               |	КОНЕЦ КАК КодСтатьяБУ,
	               |	ТЗ_ИтогГруппировка.НомерФин,
	               |	ТЗ_ИтогГруппировка.ДатаФин,
	               |	ТЗ_ИтогГруппировка.Загружать
	               |ИЗ
	               |	ТЗ_ИтогГруппировка КАК ТЗ_ИтогГруппировка";
		
	Запрос.УстановитьПараметр("Счет44", ПланыСчетов.Финансовый.НайтиПоКоду("44"));
	Запрос.УстановитьПараметр("Счет442", ПланыСчетов.Финансовый.НайтиПоКоду("44.2"));
	Запрос.УстановитьПараметр("Счет443", ПланыСчетов.Финансовый.НайтиПоКоду("44.3")); 
	Запрос.УстановитьПараметр("Счет444", ПланыСчетов.Финансовый.НайтиПоКоду("44.4"));
    Запрос.УстановитьПараметр("Счет08", ПланыСчетов.Финансовый.НайтиПоКоду("08"));
	Запрос.УстановитьПараметр("Счет90", ПланыСчетов.Финансовый.НайтиПоКоду("90"));
	//Запрос.УстановитьПараметр("СтатьяАмортизация", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("61010"));
	Запрос.УстановитьПараметр("Счет01", ПланыСчетов.Финансовый.НайтиПоКоду("01"));
	Запрос.УстановитьПараметр("КорСубконто2", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("61010"));
	
	Запрос.УстановитьПараметр("ЗатратыПостоянные", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("3"));
	Запрос.УстановитьПараметр("УЕК", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("4"));
	Запрос.УстановитьПараметр("Выручка", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("1"));
	Запрос.УстановитьПараметр("Себестоимость", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("20110"));
	//Запрос.УстановитьПараметр("ЗатратыПостоянные", Справочники.СтатьиДоходовРасходов.НайтиПоКоду("61010"));
	
	Запрос.УстановитьПараметр("ДатаНач", ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", ДатаКон);
	
	Результат = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = Результат.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		НоваяСтрока = ТаблицаВозврата.Добавить();
		
		НоваяСтрока.РегистраторФин = ВыборкаДетальныеЗаписи.РегистраторФин;
		Попытка   
			НоваяСтрока.ГуидРегистратораФин = ВыборкаДетальныеЗаписи.РегистраторФин.УникальныйИдентификатор();
		Исключение
			Если ВыборкаДетальныеЗаписи.Группа = "Выручка" Тогда
				НоваяСтрока.ГуидРегистратораФин = "999";	
			КонецЕсли;
		КонецПопытки;	
		НоваяСтрока.СтатьяБухФ = ВыборкаДетальныеЗаписи.СтатьяБУ; 
		НоваяСтрока.КодСтатьяБухФ = ВыборкаДетальныеЗаписи.КодСтатьяБУ; 
		НоваяСтрока.КонтрагентФин = ВыборкаДетальныеЗаписи.КонтрагентФин;
		Попытка
			НоваяСтрока.ГуидКонтрагентаФин = ВыборкаДетальныеЗаписи.КонтрагентФин.УникальныйИдентификатор(); 
		Исключение
		КонецПопытки; 
		НоваяСтрока.СтатьяФин = ВыборкаДетальныеЗаписи.СтатьяФин;
		НоваяСтрока.СуммаОборотФин = ВыборкаДетальныеЗаписи.СуммаОборотФин;
		НоваяСтрока.ГруппаФин = ВыборкаДетальныеЗаписи.Группа;
		НоваяСтрока.НомерФин = ВыборкаДетальныеЗаписи.НомерФин;
		НоваяСтрока.ДатаФин = ВыборкаДетальныеЗаписи.ДатаФин;
		  	

		Если ТипЗнч(ВыборкаДетальныеЗаписи.РегистраторФин) = Тип("ДокументСсылка.ПоступлениеТоваровУслуг") Тогда
			НоваяСтрока.Загружать = Строка(НЕ ВыборкаДетальныеЗаписи.РегистраторФин.НеВыгружатьВБУ);	
		ИначеЕсли ТипЗнч(ВыборкаДетальныеЗаписи.РегистраторФин) = Тип("ДокументСсылка.АвансовыйОтчет") Тогда	
			НоваяСтрока.Загружать = Строка(ВыборкаДетальныеЗаписи.РегистраторФин.ВыгружатьВ_БП);
		Иначе
			НоваяСтрока.Загружать = "";	
		КонецЕсли;	
		//НоваяСтрока.Загружать = ВыборкаДетальныеЗаписи.Загружать;
		НоваяСтрока.РегистраторФинСсылка = ВыборкаДетальныеЗаписи.РегистраторФин;
		
		//НоваяСтрока.ГУИД = СоединениеСБазой.String(КонтрагентБУ.УникальныйИдентификатор());	
	КонецЦикла; 			 	
	
	Возврат ТаблицаВозврата;
		
КонецФункции	

