
Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	СтандартнаяОбработка=Ложь;		
 	
	СтрокаПодключения = ПолныеПрава.ПолучитьСтрокуПодключения_Бух();	
	v82COMОбъект = Новый COMОбъект(ПолныеПрава.ПолучитьВерсиюКомОбъекта_Бух() + ".COMConnector");
	
	Попытка
		v82 = v82COMОбъект.Connect(СтрокаПодключения);
		ПодключениеУстановлено=Истина;
	Исключение
		ПодключениеУстановлено=Ложь;
		Сообщить("Не удалось подключиться к базе бухгалтерии!");
		Возврат;
	КонецПопытки;
	
	Запрос=v82.NewObject("Запрос");
	
	ЗапросДанныеФинансов = Новый Запрос;
	
	ДанныеБух.Очистить();
	ТаблицаФинансы.Очистить();
		
	КомпоновщикНастроек.ЗагрузитьНастройки(КомпоновщикНастроек.ПолучитьНастройки());		
	
	Для каждого Параметр из КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы Цикл
		Если СокрЛП(Параметр.Параметр)="ПериодОтчета" Тогда
			Запрос.УстановитьПараметр("НачалоПериода",Параметр.Значение.ДатаНачала);
			Запрос.УстановитьПараметр("КонецПериода",КонецДня(Параметр.Значение.ДатаОкончания));
			
			ЗапросДанныеФинансов.УстановитьПараметр("НачалоПериода",Параметр.Значение.ДатаНачала);
			ЗапросДанныеФинансов.УстановитьПараметр("КонецПериода",КонецДня(Параметр.Значение.ДатаОкончания));			
			
		Иначе
			
			ЗначСоответствия = Параметр.Использование;
			
			СокрЛППараметр = СокрЛП(Параметр.Параметр);
			
			Если СокрЛППараметр = "ВЭ_ТН" Тогда
				ВЭ_ТН = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "ВЭ_ТН_ИсключитьПТУ" Тогда
				ВЭ_ТН_ИсключитьПТУ = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "ВЭ_ПУ" Тогда
				ВЭ_ПУ = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "ПТУ" Тогда
				ПТУ = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "ПТУ_ИсключитьПТУ" Тогда
				ПТУ_ИсключитьПТУ = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "ДР" Тогда
				ДР = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "Авансовые" Тогда
				Авансовые = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "Прочее" Тогда
				Прочее = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "СписаниеОС" Тогда
				СписаниеОС = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "КоррПТУ" Тогда
				КоррПТУ = ЗначСоответствия;
			ИначеЕсли СокрЛППараметр = "РеализацияОС" Тогда
				РеализацияОС = ЗначСоответствия;
			КонецЕсли;			
			
		КонецЕсли;
	КонецЦикла;
		
	СводнаяТаблица = Новый ТаблицаЗначений;
	СводнаяТаблица.Колонки.Добавить("Раздел");
	СводнаяТаблица.Колонки.Добавить("ДокументБух");
	СводнаяТаблица.Колонки.Добавить("ДокументФин");
	СводнаяТаблица.Колонки.Добавить("СуммаБух");
	СводнаяТаблица.Колонки.Добавить("СуммаФин");	
	СводнаяТаблица.Колонки.Добавить("НоменклатураБух");
	СводнаяТаблица.Колонки.Добавить("НоменклатураФин");
	//
	СводнаяТаблица.Колонки.Добавить("СчетДТФин");
	СводнаяТаблица.Колонки.Добавить("СчетКТФин");
	СводнаяТаблица.Колонки.Добавить("СчетДТБух");
	СводнаяТаблица.Колонки.Добавить("СчетКТБух");
	
	Если ВЭ_ТН ИЛИ ВЭ_ТН_ИсключитьПТУ Тогда
	
		ТекстЗапроса="ВЫБРАТЬ РАЗРЕШЕННЫЕ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор) КАК Документ,
				|	ХозрасчетныйОбороты.Регистратор КАК ДокументСсылка,
				|	ХозрасчетныйОбороты.Регистратор.Дата КАК ДатаПоиска,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоДт1) КАК Номенклатура,
				|	ХозрасчетныйОбороты.СубконтоДт1.ИД КАК id_tov,
				|	ХозрасчетныйОбороты.Регистратор.Комментарий КАК Комментарий,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Организация) КАК Организация,
				|	ХозрасчетныйОбороты.Организация.ИНН,
				|	-ХозрасчетныйОбороты.СуммаОборот КАК Сумма,
				|	ХозрасчетныйОбороты.СчетДт.Код КАК СчетДт,
				|	ХозрасчетныйОбороты.СчетКт.Код КАК СчетКт
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&СписокСчетов), , , , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная

				|ОБЪЕДИНИТЬ ВСЕ

				|ВЫБРАТЬ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор),
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоКт1),
				|	ХозрасчетныйОбороты.СубконтоКт1.ИД,
				|	ХозрасчетныйОбороты.Регистратор.Комментарий,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Организация),
				|	ХозрасчетныйОбороты.Организация.ИНН,
				|	ХозрасчетныйОбороты.СуммаОборот,
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.СчетКт.Код
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&СписокСчетов), , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная";
	
		Запрос.Текст=ТекстЗапроса;	
				
		МассивСчетов=v82.NewObject("Массив");		
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ИнвентарьИХозяйственныеПринадлежности);
		
		Если ВЭ_ТН Тогда 
			МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПрочиеМатериалы);
		КонецЕсли;

		Запрос.УстановитьПараметр("СписокСчетов", МассивСчетов);
					
		Выборка=Запрос.Выполнить().Выбрать();
		
		Пока Выборка.Следующий() Цикл
			НС=ДанныеБух.Добавить();
			ЗаполнитьЗначенияСвойств(НС, Выборка);			
			НС.ДатаПоиска =НачалоДня(НС.ДатаПоиска);
			НС.Раздел = "ВЭ_ТН";
			НС.ГУИД = v82.XMLСтрока(Выборка.ДокументСсылка);
		КонецЦикла;		
		
		МассивСчетов = Новый Массив;
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.Инвентарь);
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредствДо100000);	
		
		Если ВЭ_ТН Тогда
			МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПрочиеМатериалы);	
			МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредств);	
		КонецЕсли;		
	
		ЗапросДанныеФинансов.УстановитьПараметр("Счета", МассивСчетов);	
		
		Если ВЭ_ТН Тогда
			
			ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                             |	ФинансовыйОбороты.Регистратор КАК Док,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ КАК Номенклатура,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ КАК id_tov,
		                             |	""ВЭ_ТН"" КАК Раздел,
		                             |	ФинансовыйОбороты.СчетДт КАК СчетДт,
		                             |	ФинансовыйОбороты.СчетКт КАК СчетКт,
		                             |	ФинансовыйОбороты.Регистратор.Дата,
		                             |	ФинансовыйОбороты.Регистратор.Номер,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.Регистратор.Дата < ДАТАВРЕМЯ(2017, 4, 1)
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
		                             |	КОНЕЦ КАК Ос
		                             |ПОМЕСТИТЬ Сводная
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	(ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
		                             |			ИЛИ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная)
		                             |	И ВЫБОР
		                             |			КОГДА ФинансовыйОбороты.СчетДт.Код = ""08.4"" ИЛИ ФинансовыйОбороты.СчетДт.Код = ""08.10""
		                             |				ТОГДА ФинансовыйОбороты.СчетКт.Код = ""01.10""
		                             |						ИЛИ ФинансовыйОбороты.СчетКт.Код = ""10.09""
		                             |			ИНАЧЕ ИСТИНА
		                             |		КОНЕЦ
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.Регистратор.Дата,
		                             |	ФинансовыйОбороты.Регистратор.Номер,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.Регистратор.Дата < ДАТАВРЕМЯ(2017, 4, 1)
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
		                             |	КОНЕЦ
		                             |
		                             |ОБЪЕДИНИТЬ ВСЕ
		                             |
		                             |ВЫБРАТЬ
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	""ВЭ_ТН"",
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.Регистратор.Дата,
		                             |	ФинансовыйОбороты.Регистратор.Номер,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.Регистратор.Дата < ДАТАВРЕМЯ(2017, 4, 1)
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
		                             |	КОНЕЦ
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&Счета), , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	(ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
		                             |			ИЛИ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная)
		                             |	И ВЫБОР
		                             |			КОГДА ФинансовыйОбороты.СчетДт.Код = ""01.1""
		                             |				ТОГДА ФинансовыйОбороты.СчетКт.Код = ""10.9""
		                             |						ИЛИ ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ИНАЧЕ ИСТИНА
		                             |		КОНЕЦ
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.Регистратор.Дата,
		                             |	ФинансовыйОбороты.Регистратор.Номер,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.Регистратор.Дата < ДАТАВРЕМЯ(2017, 4, 1)
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
		                             |	КОНЕЦ
		                             |;
		                             |
		                             |////////////////////////////////////////////////////////////////////////////////
		                             |ВЫБРАТЬ
		                             |	Сводная.Док КАК Док,
		                             |	Сводная.Сумма,
		                             |	Сводная.Номенклатура,
		                             |	Сводная.id_tov КАК id_tov,
		                             |	Сводная.Раздел,
		                             |	Сводная.СчетДт,
		                             |	Сводная.СчетКт,
		                             |	Сводная.РегистраторДата КАК РегистраторДата,
		                             |	Сводная.РегистраторНомер КАК РегистраторНомер,
		                             |	Сводная.Ос
		                             |ИЗ
		                             |	Сводная КАК Сводная
		                             |
		                             |УПОРЯДОЧИТЬ ПО
		                             |	РегистраторДата,
		                             |	РегистраторНомер,
		                             |	Док,
		                             |	id_tov
		                             |АВТОУПОРЯДОЧИВАНИЕ";
			
		Иначе
			
			ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
			                             |	ФинансовыйОбороты.Регистратор КАК Док,
			                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
			                             |	КОНЕЦ КАК Номенклатура,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
			                             |	КОНЕЦ КАК id_tov,
			                             |	""ВЭ_ТН"" КАК Раздел,
			                             |	ФинансовыйОбороты.СчетДт КАК СчетДт,
			                             |	ФинансовыйОбороты.СчетКт КАК СчетКт,
			                             |	ФинансовыйОбороты.Регистратор.Дата,
			                             |	ФинансовыйОбороты.Регистратор.Номер,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.Регистратор.Дата < ДАТАВРЕМЯ(2017, 4, 1)
			                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
			                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
			                             |	КОНЕЦ КАК Ос
			                             |ПОМЕСТИТЬ Сводная
			                             |ИЗ
			                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
			                             |ГДЕ
			                             |	(ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
			                             |			ИЛИ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная)
			                             |	И ВЫБОР
			                             |			КОГДА ФинансовыйОбороты.СчетДт.Код = ""08.4""
			                             |					ИЛИ ФинансовыйОбороты.СчетДт.Код = ""08.10""
			                             |				ТОГДА ФинансовыйОбороты.СчетКт.Код = ""01.10""
			                             |						ИЛИ ФинансовыйОбороты.СчетКт.Код = ""10.09""
			                             |			ИНАЧЕ ИСТИНА
			                             |		КОНЕЦ
			                             |
			                             |СГРУППИРОВАТЬ ПО
			                             |	ФинансовыйОбороты.Регистратор,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
			                             |	КОНЕЦ,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
			                             |	КОНЕЦ,
			                             |	ФинансовыйОбороты.СчетДт,
			                             |	ФинансовыйОбороты.СчетКт,
			                             |	ФинансовыйОбороты.Регистратор.Дата,
			                             |	ФинансовыйОбороты.Регистратор.Номер,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.Регистратор.Дата < ДАТАВРЕМЯ(2017, 4, 1)
			                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
			                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
			                             |	КОНЕЦ
			                             |
			                             |ОБЪЕДИНИТЬ ВСЕ
			                             |
			                             |ВЫБРАТЬ
			                             |	ФинансовыйОбороты.Регистратор,
			                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
			                             |	КОНЕЦ,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
			                             |	КОНЕЦ,
			                             |	""ВЭ_ТН"",
			                             |	ФинансовыйОбороты.СчетДт,
			                             |	ФинансовыйОбороты.СчетКт,
			                             |	ФинансовыйОбороты.Регистратор.Дата,
			                             |	ФинансовыйОбороты.Регистратор.Номер,
			                             |	ФинансовыйОбороты.СубконтоКт1
			                             |ИЗ
			                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&Счета), , ) КАК ФинансовыйОбороты
			                             |ГДЕ
			                             |	(ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
			                             |			ИЛИ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная)
			                             |	И ВЫБОР
			                             |			КОГДА ФинансовыйОбороты.СчетДт.Код = ""01.1""
			                             |				ТОГДА ФинансовыйОбороты.СчетКт.Код = ""10.9""
			                             |						ИЛИ ФинансовыйОбороты.СчетКт.Код = ""10.6""
			                             |			ИНАЧЕ ИСТИНА
			                             |		КОНЕЦ
			                             |
			                             |СГРУППИРОВАТЬ ПО
			                             |	ФинансовыйОбороты.Регистратор,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
			                             |	КОНЕЦ,
			                             |	ВЫБОР
			                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
			                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
			                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
			                             |	КОНЕЦ,
			                             |	ФинансовыйОбороты.СчетКт,
			                             |	ФинансовыйОбороты.СчетДт,
			                             |	ФинансовыйОбороты.Регистратор.Дата,
			                             |	ФинансовыйОбороты.Регистратор.Номер,
			                             |	ФинансовыйОбороты.СубконтоКт1
			                             |;
			                             |
			                             |////////////////////////////////////////////////////////////////////////////////
			                             |ВЫБРАТЬ
			                             |	Сводная.Док КАК Док,
			                             |	Сводная.Сумма,
			                             |	Сводная.Номенклатура,
			                             |	Сводная.id_tov КАК id_tov,
			                             |	Сводная.Раздел,
			                             |	Сводная.СчетДт,
			                             |	Сводная.СчетКт,
			                             |	Сводная.РегистраторДата КАК РегистраторДата,
			                             |	Сводная.РегистраторНомер КАК РегистраторНомер,
			                             |	Сводная.Ос
			                             |ПОМЕСТИТЬ Итоговая
			                             |ИЗ
			                             |	Сводная КАК Сводная
			                             |;
			                             |
			                             |////////////////////////////////////////////////////////////////////////////////
			                             |ВЫБРАТЬ
			                             |	Итоговая.Док,
			                             |	СУММА(Итоговая.Сумма) КАК Сумма,
			                             |	Итоговая.Номенклатура,
			                             |	Итоговая.id_tov,
			                             |	Итоговая.Раздел,
			                             |	Итоговая.СчетДт,
			                             |	Итоговая.СчетКт,
			                             |	Итоговая.РегистраторДата,
			                             |	Итоговая.РегистраторНомер
			                             |ИЗ
			                             |	Итоговая КАК Итоговая
			                             |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеТоваровУслуг.Оборудование КАК ПоступлениеТоваровУслугОборудование
			                             |		ПО Итоговая.Ос = ПоступлениеТоваровУслугОборудование.ОсновноеСредство
			                             |			И (ПоступлениеТоваровУслугОборудование.Ссылка.Проведен)
			                             |ГДЕ
			                             |	НЕ ЕСТЬNULL(ПоступлениеТоваровУслугОборудование.Ссылка.НеВыгружатьВБУ, ЛОЖЬ)
			                             |
			                             |СГРУППИРОВАТЬ ПО
			                             |	Итоговая.Док,
			                             |	Итоговая.Номенклатура,
			                             |	Итоговая.id_tov,
			                             |	Итоговая.Раздел,
			                             |	Итоговая.СчетДт,
			                             |	Итоговая.СчетКт,
			                             |	Итоговая.РегистраторДата,
			                             |	Итоговая.РегистраторНомер"; 
			
		КонецЕсли;
								 
		ТаблицаФинансы.Загрузить(ЗапросДанныеФинансов.Выполнить().Выгрузить());
		
		Для Каждого Стр Из ТаблицаФинансы Цикл
			Стр.ГУИД = Стр.Док.УникальныйИдентификатор();
		КонецЦикла;
					 
		// сопоставляем
		Для Каждого Стр Из ТаблицаФинансы Цикл
			
			Если ТипЗнч(Стр.Док) = Тип("ДокументСсылка.ТребованиеНакладная") Тогда
				
				НСтрокиТОвары = Неопределено;
				
				СтруктураПоиска = Новый Структура;
				СтруктураПоиска.Вставить("Раздел", "ВЭ_ТН");
				СтруктураПоиска.Вставить("ГУИД", Стр.ГУИД);					
				
				НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				Если НайдСтроки.Количество() <> 0 Тогда
					
					// теперь ищем в разрезе товаров				
					СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
					СтруктураПоиска.Вставить("Обработан", Ложь);
					
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
					
					Если НСтрокиТовары.Количество() = 0 Тогда
						СтруктураПоиска.Удалить("id_tov");
						СтруктураПоиска.Вставить("Номенклатура", СокрЛП(Стр.Номенклатура.Наименование));
						
						НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
						
					КонецЕсли;						
									
				КонецЕсли;
				
				Если НайдСтроки.Количество() = 0 Тогда
					НовСтр = СводнаяТаблица.Добавить();
					НовСтр.Раздел = "Требование накладная";
					НОвСтр.ДокументФин = Стр.Док;
					НовСтр.ДокументБух = "ДОКУМЕНТ НЕ НАЙДЕН";
					НовСтр.СуммаФин = Стр.Сумма;
					НовСтр.СуммаБух = 0;
					НовСтр.НоменклатураФин = Стр.Номенклатура;
					НовСтр.НоменклатураБух = "<---->";
					//
					НовСтр.СчетДТФин = Стр.СчетДТ;
					НовСтр.СчетКТФин = Стр.СчетКТ;
					НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
					НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
					Продолжить;
					
				Иначе
					
					Если НСтрокиТОвары = Неопределено ИЛИ НСтрокиТовары.Количество() = 0 Тогда
						НовСтр = СводнаяТаблица.Добавить();
						НовСтр.Раздел = "Требование накладная";
						НОвСтр.ДокументФин = Стр.Док;
						НовСтр.ДокументБух = НайдСтроки[0].Документ;
						НовСтр.СуммаФин = Стр.Сумма;
						НовСтр.СуммаБух = 0;
						НовСтр.НоменклатураФин = Стр.Номенклатура;
						НовСтр.НоменклатураБух = "<---->";
						//
						НовСтр.СчетДТФин = Стр.СчетДТ;
						НовСтр.СчетКТФин = Стр.СчетКТ;
						НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
						НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
						Продолжить;
					КонецЕсли;
					
					Для Каждого НСтр Из НСтрокиТовары Цикл
						
						НовСтр = СводнаяТаблица.Добавить();
						НовСтр.Раздел = "Требование накладная";
						НОвСтр.ДокументФин = Стр.Док;
						НовСтр.ДокументБух = НСтр.Документ;
						НовСтр.СуммаФин = Стр.Сумма;
						НовСтр.СуммаБух = НСтр.Сумма;
						НовСтр.НоменклатураФин = Стр.Номенклатура;
						НовСтр.НоменклатураБух = НСтр.Номенклатура;
						//
						НовСтр.СчетДТФин = Стр.СчетДТ;
						НовСтр.СчетКТФин = Стр.СчетКТ;
						НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетДт);
						НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетКт);

						НСтр.Обработан = Истина;
						
					КонецЦикла;
					
				КонецЕсли;
										
			Иначе				
				
				ДатаПоиска = НачалоДня(Стр.Док.Дата);
				ОрганизацияПоискаИНН = Стр.Док.Организация.ИНН;
				
				Если Стр.Док.Дата < Дата(2017, 4, 1) Тогда
					
					НоменклатураИД = Стр.id_tov;
					Номенклатура = Стр.Номенклатура.Наименование;
					КомментарийПоиска = "Загружен из Финансов: " + Стр.ОС + " с инв. номером " + Стр.ОС.ИнвентарныйНомер;
					
					СтруктураПоиска = Новый Структура;
					СтруктураПоиска.Вставить("ДатаПоиска", ДатаПоиска);
					СтруктураПоиска.Вставить("ОрганизацияИНН", ОрганизацияПоискаИНН);
					СтруктураПоиска.Вставить("id_tov", НоменклатураИД);
					//СтруктураПоиска.Вставить("Номенклатура", Номенклатура);
					СтруктураПоиска.Вставить("Комментарий", КомментарийПоиска);
					СтруктураПоиска.Вставить("Раздел", "ВЭ_ТН");
					СтруктураПоиска.Вставить("Обработан", Ложь);
					
					НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
					
					Если НайдСтроки.Количество() = 0 Тогда
						СтруктураПоиска.Удалить("id_tov");
						СтруктураПоиска.Вставить("Номенклатура", Номенклатура);						
						НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
					КонецЕсли;
					
					Если НайдСтроки.Количество() <> 0 Тогда						
						
						Для Каждого НСтр Из НайдСтроки Цикл
							НовСтр = СводнаяТаблица.Добавить();
							НовСтр.Раздел = "Требование накладная";
							НОвСтр.ДокументФин = Стр.Док;
							НовСтр.ДокументБух = НСтр.Документ;
							НовСтр.СуммаФин = Стр.Сумма;
							НовСтр.СуммаБух = НСтр.Сумма;
							НовСтр.НоменклатураФин = Стр.Номенклатура;
							НовСтр.НоменклатураБух = НСтр.Номенклатура;
							//
							НовСтр.СчетДТФин = Стр.СчетДТ;
							НовСтр.СчетКТФин = Стр.СчетКТ;
							НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетДт);
							НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетКт);
							НСтр.Обработан = Истина;							
							
						КонецЦикла;
						
					Иначе
						
						НовСтр = СводнаяТаблица.Добавить();
						НовСтр.Раздел = "Требование накладная";
						НОвСтр.ДокументФин = Стр.Док;
						НовСтр.ДокументБух = "ДОКУМЕНТ НЕ НАЙДЕН";
						НовСтр.СуммаФин = Стр.Сумма;
						НовСтр.СуммаБух = 0;
						НовСтр.НоменклатураФин = Стр.Номенклатура;
						НовСтр.НоменклатураБух = "<---->";
						//
						НовСтр.СчетДТФин = Стр.СчетДТ;
						НовСтр.СчетКТФин = Стр.СчетКТ;
						НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
						НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
						
					КонецЕсли;		
					
				Иначе
					
					НоменклатураИД = Стр.id_tov;
					Номенклатура = Стр.Номенклатура.Наименование;
					
					СтруктураПоиска = Новый Структура;
					СтруктураПоиска.Вставить("ДатаПоиска", ДатаПоиска);
					СтруктураПоиска.Вставить("ОрганизацияИНН", ОрганизацияПоискаИНН);
					СтруктураПоиска.Вставить("Комментарий", "Загружен из Финансов: Ввод в эксплуатацию №" + Стр.Док.Номер);
					СтруктураПоиска.Вставить("Раздел", "ВЭ_ТН");					
					СтруктураПоиска.Вставить("id_tov", НоменклатураИД);
					СтруктураПоиска.Вставить("Обработан", Ложь);
					
					НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
					
					Если НайдСтроки.Количество() = 0 Тогда
						СтруктураПоиска.Удалить("id_tov");
						СтруктураПоиска.Вставить("Номенклатура", Номенклатура);						
						НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
					КонецЕсли;
					
					ПолученоИзОбработанных = Ложь;
					
					Если НайдСтроки.Количество() = 0 Тогда
						СтруктураПоиска.Удалить("Обработан");
						СтруктураПоиска.Вставить("id_tov", НоменклатураИД);
					    СтруктураПоиска.Удалить("Номенклатура");
						
						НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
						
						Если НайдСтроки.Количество() = 0 Тогда
							СтруктураПоиска.Удалить("id_tov");
							СтруктураПоиска.Вставить("Номенклатура", Номенклатура);						
							НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
						КонецЕсли;
						
						ПолученоИзОбработанных = Истина;
					КонецЕсли;
						
					Если НайдСтроки.Количество() <> 0 Тогда
												
						Для Каждого НСтр Из НайдСтроки Цикл
							НовСтр = СводнаяТаблица.Добавить();
							НовСтр.Раздел = "Требование накладная";
							НОвСтр.ДокументФин = Стр.Док;
							НовСтр.ДокументБух = НСтр.Документ;
							НовСтр.СуммаФин = Стр.Сумма;
							НовСтр.СуммаБух = ?(ПолученоИзОбработанных, 0, Нстр.Сумма);
							НовСтр.НоменклатураФин = Стр.Номенклатура;
							НовСтр.НоменклатураБух = НСтр.Номенклатура;
							//
							НовСтр.СчетДТФин = Стр.СчетДТ;
							НовСтр.СчетКТФин = Стр.СчетКТ;
							НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетДт);
							НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетКт);
							
							НСтр.Обработан = Истина;							
						КонецЦикла;
						
					Иначе
						
						НовСтр = СводнаяТаблица.Добавить();
						НовСтр.Раздел = "Требование накладная";
						НОвСтр.ДокументФин = Стр.Док;
						НовСтр.ДокументБух = "ДОКУМЕНТ НЕ НАЙДЕН";
						НовСтр.СуммаФин = Стр.Сумма;
						НовСтр.СуммаБух = 0;
						НовСтр.НоменклатураФин = Стр.Номенклатура;
						НовСтр.НоменклатураБух = "<---->";
						//
						НовСтр.СчетДТФин = Стр.СчетДТ;
						НовСтр.СчетКТФин = Стр.СчетКТ;
						НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
						НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
						
					КонецЕсли;
					
				КонецЕсли;
				
			КонецЕсли;
			
			Стр.Обработан = Истина;
			
		КонецЦикла;		
				
		Для Каждого Стр Из ДанныеБух Цикл
			
			Если Стр.Обработан Тогда
				Продолжить;
			КонецЕсли;
			
			НСтрокиТОвары = Неопределено;
			
			СтруктураПоиска = Новый Структура;
			СтруктураПоиска.Вставить("Раздел", "ВЭ_ТН");					
			СтруктураПоиска.Вставить("ГУИД", Стр.ГУИД);					
			
			НайдСтроки = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
			
			Если НайдСтроки.Количество() <> 0 Тогда
				
				// теперь ищем в разрезе товаров				
				СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
				СтруктураПоиска.Вставить("Обработан", Ложь);
				
				НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("id_tov");
					СтруктураПоиска.Вставить("НоменклатураСтрокой", СокрЛП(Стр.Номенклатура));
					
					НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
					
				КонецЕсли;				
				
			КонецЕсли;
			
			Если НайдСтроки.Количество() = 0 Тогда
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Требование накладная";
				НОвСтр.ДокументФин = "ДОКУМЕНТ НЕ НАЙДЕН";
				НовСтр.ДокументБух = Стр.Документ;
				НовСтр.СуммаФин = 0;
				НовСтр.СуммаБух = Стр.Сумма;
				НовСтр.НоменклатураФин = "<---->";
				НовСтр.НоменклатураБух = Стр.Номенклатура;
				//
				НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДТ);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКТ);

				Продолжить;
				
			Иначе			
				
				Если НСтрокиТОвары = Неопределено ИЛИ НСтрокиТовары.Количество() = 0 Тогда
					НовСтр = СводнаяТаблица.Добавить();
					НовСтр.Раздел = "Требование накладная";
					НОвСтр.ДокументФин = НайдСтроки[0].Док;
					НовСтр.ДокументБух = Стр.Документ;
					НовСтр.СуммаФин = 0;
					НовСтр.СуммаБух = Стр.Сумма;
					НовСтр.НоменклатураФин = "<---->";
					НовСтр.НоменклатураБух = Стр.Номенклатура;
					//
					НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
					НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
					НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДТ);
					НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКТ);

					Продолжить;
				КонецЕсли;
				
				Для Каждого НСтр Из НСтрокиТовары Цикл
					
					НовСтр = СводнаяТаблица.Добавить();
					НовСтр.Раздел = "Требование накладная";
					НОвСтр.ДокументФин = НСтр.Док;
					НовСтр.ДокументБух = Стр.Документ;
					НовСтр.СуммаФин = НСтр.Сумма;
					НовСтр.СуммаБух = Стр.Сумма;
					НовСтр.НоменклатураФин = НСтр.Номенклатура;
					НовСтр.НоменклатураБух = Стр.Номенклатура;	
					//
					НовСтр.СчетДТФин = НСтр.СчетДт;
					НовСтр.СчетКТФин = НСтр.СчетКт;
					НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДТ);
					НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКДТ);

					
				КонецЦикла;
				
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	Если ВЭ_ПУ Тогда
		
		ДанныеБух.Очистить();
		ТаблицаФинансы.Очистить();
		
		ТекстЗапроса="ВЫБРАТЬ
					|	ХозрасчетныйОбороты.Счет.Код КАК СчетДт,
					|	ХозрасчетныйОбороты.КорСчет.Код КАК СчетКт,
					|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор) КАК Документ,
					|	ХозрасчетныйОбороты.Регистратор КАК ДокументСсылка,
					|	НАЧАЛОПЕРИОДА(ХозрасчетныйОбороты.Регистратор.Дата, ДЕНЬ) КАК ДатаПоиска,
					|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Субконто1) КАК Номенклатура,
					|	ПринятиеКУчетуОСОсновныеСредства.ИнвентарныйНомер КАК ИнвентарныйНомер,
					|	ХозрасчетныйОбороты.Субконто1 КАК НоменклатураСсылка,
					|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Организация) КАК Организация,
					|	ХозрасчетныйОбороты.Организация.ИНН,
					|	ХозрасчетныйОбороты.СуммаОборот КАК Сумма,
					|	ХозрасчетныйОбороты.Субконто1.ЗаводскойНомер КАК ЗаводскойНомер
					|ИЗ					
					|	РегистрБухгалтерии.Хозрасчетный.Обороты(&НачалоПериода, &КонецПериода, Регистратор, , , , КорСчет = &Счет0804, ) КАК ХозрасчетныйОбороты
					|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПринятиеКУчетуОС.ОсновныеСредства КАК ПринятиеКУчетуОСОсновныеСредства
					|		ПО ХозрасчетныйОбороты.Регистратор = ПринятиеКУчетуОСОсновныеСредства.Ссылка
					|			И ХозрасчетныйОбороты.Субконто1 = ПринятиеКУчетуОСОсновныеСредства.ОсновноеСредство
					|ГДЕ
					|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПринятиеКУчетуОС";
	
		Запрос.Текст=ТекстЗапроса;	
		Запрос.УстановитьПараметр("Счет0101", v82.ПланыСчетов.Хозрасчетный.ОСвОрганизации);
		Запрос.УстановитьПараметр("Счет0804", v82.ПланыСчетов.Хозрасчетный.ПриобретениеОбъектовОсновныхСредств);
					
		Выборка=Запрос.Выполнить().Выбрать();
		
		Пока Выборка.Следующий() Цикл
			НС=ДанныеБух.Добавить();
			ЗаполнитьЗначенияСвойств(НС, Выборка);
			НС.Номенклатура = СокрЛП(НС.Номенклатура);
			НС.Гуид = v82.XMLСтрока(Выборка.НоменклатураСсылка);
			НС.Раздел = "ВЭ_ПУ";			
		КонецЦикла;		
		
		МассивСчетов = Новый Массив;
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредств);	
	
		ЗапросДанныеФинансов.УстановитьПараметр("Счета", МассивСчетов);	
	  
		ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ
		                             |	ФинансовыйОбороты.СчетДт КАК СчетДт,
		                             |	ФинансовыйОбороты.СчетКт КАК СчетКт,
		                             |	ФинансовыйОбороты.Регистратор КАК Док,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
		                             |	ФинансовыйОбороты.СубконтоДт1 КАК ОС,
		                             |	""ВЭ_ПУ"" КАК Раздел
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
		                             |	И ВЫБОР
		                             |			КОГДА ФинансовыйОбороты.СчетДт.Код = ""08.4""
		                             |				ТОГДА ФинансовыйОбороты.СчетКт.Код <> ""01.10""
		                             |			ИНАЧЕ ИСТИНА
		                             |		КОНЕЦ
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ФинансовыйОбороты.СубконтоДт1,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |ОБЪЕДИНИТЬ ВСЕ
		                             |
		                             |ВЫБРАТЬ
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
		                             |	ФинансовыйОбороты.СубконтоКт1,
		                             |	""ВЭ_ПУ""
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&Счета), , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
		                             |	И ВЫБОР
		                             |			КОГДА ФинансовыйОбороты.СчетКт.Код = ""08.4""
		                             |				ТОГДА ФинансовыйОбороты.СчетДт.Код <> ""01.10"" И  ФинансовыйОбороты.СчетДт.Код <> ""44.3""
		                             |			ИНАЧЕ ИСТИНА
		                             |		КОНЕЦ
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ФинансовыйОбороты.СубконтоКт1,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт"; 	
								 
		ТаблицаФинансы.Загрузить(ЗапросДанныеФинансов.Выполнить().Выгрузить());	
		
		// муторно сопоставляем
		Для Каждого Стр Из ТаблицаФинансы Цикл
		
			ДатаПоиска = НачалоДня(Стр.Док.Дата);
			ОрганизацияПоискаИНН = Стр.Док.Организация.ИНН;
			
			ГуидПоиска1 = Стр.ОС.АК_ID_Buh;
			ГуидПоиска2 = Стр.ОС.УникальныйИдентификатор();
			
			ЗаводскойНомер = Стр.ОС.ЗаводскойНомер;
			НаименованиеОС = СокрЛП(Стр.ОС.Наименование);
			ИНвНомер = СокрЛП(Стр.ОС.ИнвентарныйНомер);
							
			СтруктураПоиска = Новый Структура;
			СтруктураПоиска.Вставить("Раздел", "ВЭ_ПУ");
			СтруктураПоиска.Вставить("ДатаПоиска", ДатаПоиска);
			СтруктураПоиска.Вставить("ОрганизацияИНН", ОрганизацияПоискаИНН);
			СтруктураПоиска.Вставить("ИнвентарныйНомер", ИНвНомер);
			
			//1
			СтруктураПоиска.Вставить("ГУИД", ГуидПоиска1);
			
			НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
			
			//2
			Если НайдСтроки.Количество() = 0 Тогда
				СтруктураПоиска.Вставить("ГУИД", ГуидПоиска2);
				
				НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
			КонецЕсли;
			
			//3
			Если НайдСтроки.Количество() = 0 Тогда
				СтруктураПоиска.Удалить("ГУИД");
				СтруктураПоиска.Вставить("ЗаводскойНомер", ЗаводскойНомер);
				СтруктураПоиска.Вставить("Номенклатура", НаименованиеОС);
				
				НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
			КонецЕсли;
			
			//4 последний самый стремный вариант, т.к. инвентарные номера обрезаны
			Если НайдСтроки.Количество() = 0 Тогда
				
				СтруктураПоиска = Новый Структура;				
				СтруктураПоиска.Вставить("Раздел", "ВЭ_ПУ");
				СтруктураПоиска.Вставить("ДатаПоиска", ДатаПоиска);
				СтруктураПоиска.Вставить("ОрганизацияИНН", ОрганизацияПоискаИНН);
				СтруктураПоиска.Вставить("ИнвентарныйНомер", Лев(ИНвНомер, СтрДлина(ИНвНомер) - 1));
			
				//1.1
				СтруктураПоиска.Вставить("ГУИД", ГуидПоиска1);
			
				НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
			
				//2.1
				Если НайдСтроки.Количество() = 0 Тогда
					СтруктураПоиска.Вставить("ГУИД", ГуидПоиска2);
				
					НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;
			
				//3.1
				Если НайдСтроки.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("ГУИД");
					СтруктураПоиска.Вставить("ЗаводскойНомер", ЗаводскойНомер);
					СтруктураПоиска.Вставить("Номенклатура", НаименованиеОС);
				
					НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;
				
				//+++
				//3+ просто по наименованию, че делать
				Если НайдСтроки.Количество() = 0 Тогда
					СтруктураПоиска = Новый Структура;				
					СтруктураПоиска.Вставить("Раздел", "ВЭ_ПУ");
					СтруктураПоиска.Вставить("ДатаПоиска", ДатаПоиска);
					СтруктураПоиска.Вставить("ОрганизацияИНН", ОрганизацияПоискаИНН);
					СтруктураПоиска.Вставить("ИнвентарныйНомер", ИНвНомер);
					СтруктураПоиска.Вставить("Номенклатура", НаименованиеОС);
				
					НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;
			
				Если НайдСтроки.Количество() = 0 Тогда
				
					СтруктураПоиска = Новый Структура;				
					СтруктураПоиска.Вставить("Раздел", "ВЭ_ПУ");
					СтруктураПоиска.Вставить("ДатаПоиска", ДатаПоиска);
					СтруктураПоиска.Вставить("ОрганизацияИНН", ОрганизацияПоискаИНН);
					СтруктураПоиска.Вставить("ИнвентарныйНомер", Лев(ИНвНомер, СтрДлина(ИНвНомер) - 1));
			        СтруктураПоиска.Вставить("Номенклатура", НаименованиеОС);
				
					НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;
				//+++
				
			КонецЕсли;
							
			Если НайдСтроки.Количество() <> 0 Тогда						
					
				Для Каждого НСтр Из НайдСтроки Цикл
					НовСтр = СводнаяТаблица.Добавить();
					НовСтр.Раздел = "Ввод в эксплуатацию -> Принятие к учету";
					НОвСтр.ДокументФин = Стр.Док;
					НовСтр.ДокументБух = НСтр.Документ;
					НовСтр.СуммаФин = Стр.Сумма;
					НовСтр.СуммаБух = НСтр.Сумма;
					НовСтр.НоменклатураФин = Стр.ОС;
					НовСтр.НоменклатураБух = НСтр.Номенклатура;
					//
					НовСтр.СчетДТФин = Стр.СчетДТ;
					НовСтр.СчетКТФин = Стр.СчетКТ;
					НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетДт);
					НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетКт);				
					
					НСтр.Обработан = Истина;							
					
				КонецЦикла;
				
			Иначе
				
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Ввод в эксплуатацию -> Принятие к учету";
				НОвСтр.ДокументФин = Стр.Док;
				НовСтр.ДокументБух = "ДОКУМЕНТ НЕ НАЙДЕН";
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = 0;
				НовСтр.НоменклатураФин = Стр.ОС;
				НовСтр.НоменклатураБух = "<---->";
				//
				НовСтр.СчетДТФин = Стр.СчетДТ;
				НовСтр.СчетКТФин = Стр.СчетКТ;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
					
			КонецЕсли;	
		
		КонецЦикла;
		
		Для Каждого Стр Из ДанныеБух Цикл
			
			Если НЕ Стр.Обработан Тогда
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Ввод в эксплуатацию -> Принятие к учету";
				НОвСтр.ДокументФин = "ДОКУМЕНТ НЕ НАЙДЕН";
				НовСтр.ДокументБух = Стр.Документ;
				НовСтр.СуммаФин = 0;
				НовСтр.СуммаБух = Стр.Сумма;
				НовСтр.НоменклатураФин = "<---->";
				НовСтр.НоменклатураБух = Стр.Номенклатура;
				//
				НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);
			КонецЕсли;
			
		КонецЦикла;

	КонецЕсли;	
		
	Если ПТУ ИЛИ ПТУ_ИсключитьПТУ Тогда		
			
		ДанныеБух.Очистить();
		ТаблицаФинансы.Очистить();
	
		ТекстЗапроса="ВЫБРАТЬ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор) КАК Документ,
				|	ХозрасчетныйОбороты.Регистратор КАК ДокументСсылка,
				|	ХозрасчетныйОбороты.Регистратор.Дата КАК ДатаПоиска,
				|	ХозрасчетныйОбороты.Регистратор.Номер КАК НомерПоиска,
				|	СУММА(ХозрасчетныйОбороты.СуммаОборот) КАК Сумма,
				|	ХозрасчетныйОбороты.СубконтоДт1 КАК НоменклатураСсылка,
				|	ХозрасчетныйОбороты.СубконтоДт1.ИД КАК id_tov,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоДт1) КАК Номенклатура,
				|	ХозрасчетныйОбороты.СчетДт.Код КАК СчетДт,
				|	ХозрасчетныйОбороты.СчетКт.Код КАК СчетКт
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&СписокСчетов), , , , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг

				|СГРУППИРОВАТЬ ПО
				|	ХозрасчетныйОбороты.СубконтоДт1,
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.СчетКт.Код,
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ХозрасчетныйОбороты.Регистратор.Номер,
				|	ХозрасчетныйОбороты.СубконтоДт1.ИД,
				|	ХозрасчетныйОбороты.СчетДт,
				|	ХозрасчетныйОбороты.СчетКт

				|ОБЪЕДИНИТЬ ВСЕ

				|ВЫБРАТЬ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор),
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ХозрасчетныйОбороты.Регистратор.Номер,
				|	СУММА(ХозрасчетныйОбороты.СуммаОборот),
				|	ХозрасчетныйОбороты.СубконтоКт1,
				|	ХозрасчетныйОбороты.СубконтоКт1.ИД,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоКт1),
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.СчетКт.Код
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&СписокСчетов), , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг

				|СГРУППИРОВАТЬ ПО
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.СубконтоКт1,
				|	ХозрасчетныйОбороты.СчетКт.Код,
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ХозрасчетныйОбороты.СубконтоКт1.ИД,
				|	ХозрасчетныйОбороты.Регистратор.Номер,
				|	ХозрасчетныйОбороты.СчетДт,
				|	ХозрасчетныйОбороты.СчетКт

				|УПОРЯДОЧИТЬ ПО
				|	СчетДт
				|АВТОУПОРЯДОЧИВАНИЕ";
	
		Запрос.Текст=ТекстЗапроса;
		
		МассивСчетов=v82.NewObject("Массив");
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ИнвентарьИХозяйственныеПринадлежности);
		
		Если ПТУ Тогда
			МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПриобретениеОбъектовОсновныхСредств);		
			МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПрочиеМатериалы);		
		КонецЕсли;
		
		//
		Запрос.УстановитьПараметр("СписокСчетов", МассивСчетов);
						
		Выборка=Запрос.Выполнить().Выбрать();
			
		Пока Выборка.Следующий() Цикл
			НС=ДанныеБух.Добавить();
			ЗаполнитьЗначенияСвойств(НС, Выборка);
			НС.НомерПоиска = СокрЛП(НС.НомерПоиска);					
			НС.ГУИД = v82.XMLСтрока(Выборка.ДокументСсылка); 
			НС.Раздел = "ПТУ";
		КонецЦикла;			
		
		МассивСчетов = Новый Массив;	
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредствДо100000);
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.Инвентарь);
		
		Если ПТУ Тогда
			МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредств);		
			МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПрочиеМатериалы);	
		КонецЕсли;
		
		ЗапросДанныеФинансов.УстановитьПараметр("Счета", МассивСчетов);
		
		Если ПТУ Тогда
			
			ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.Регистратор КАК Док,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ КАК Номенклатура,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ КАК id_tov
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |ОБЪЕДИНИТЬ ВСЕ
		                             |
		                             |ВЫБРАТЬ
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&Счета), , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |УПОРЯДОЧИТЬ ПО
		                             |	ФинансовыйОбороты.СчетДт
		                             |АВТОУПОРЯДОЧИВАНИЕ";
			
		Иначе
			
			ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.Регистратор КАК Док,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ КАК Номенклатура,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ КАК id_tov
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		                             |	И НЕ ФинансовыйОбороты.Регистратор.НеВыгружатьВБУ
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |ОБЪЕДИНИТЬ ВСЕ
		                             |
		                             |ВЫБРАТЬ
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&Счета), , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		                             |	И НЕ ФинансовыйОбороты.Регистратор.НеВыгружатьВБУ
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |УПОРЯДОЧИТЬ ПО
		                             |	ФинансовыйОбороты.СчетДт
		                             |АВТОУПОРЯДОЧИВАНИЕ";

		КонецЕсли;
								 
	ТаблицаФинансы.Загрузить(ЗапросДанныеФинансов.Выполнить().Выгрузить());
	
	Для Каждого Стр Из ТаблицаФинансы Цикл
		Стр.ГУИД = Стр.Док.УникальныйИдентификатор();		
		Стр.ДатаПоиска = Стр.Док.Дата;
		Стр.НомерПоиска = СокрЛП(Стр.Док.Номер);
		Стр.НоменклатураСтрокой = СокрЛП(Стр.Номенклатура.Наименование);
		Стр.Раздел = "ПТУ";
	КонецЦикла;
		
	// сопоставляем
	Для Каждого Стр Из ТаблицаФинансы Цикл
		
		НСтрокиТОвары = Неопределено;
		
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Раздел", "ПТУ");
		СтруктураПоиска.Вставить("ГУИД", Стр.ГУИД);		
				
		НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
		Если НайдСтроки.Количество() <> 0 Тогда
			
			// теперь ищем в разрезе товаров				
			СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
			СтруктураПоиска.Вставить("Обработан", Ложь);
			
			НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
			
			Если НСтрокиТовары.Количество() = 0 Тогда
				СтруктураПоиска.Удалить("id_tov");
				СтруктураПоиска.Вставить("Номенклатура", СокрЛП(Стр.Номенклатура.Наименование));
				
				НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
			КонецЕсли;		
				
		Иначе		
			
			СтруктураПоиска = Новый Структура;
			СтруктураПоиска.Вставить("Раздел", "ПТУ");
			СтруктураПоиска.Вставить("ДатаПоиска", Стр.Док.Дата);
			СтруктураПоиска.Вставить("НомерПоиска", СокрЛП(Стр.Док.Номер));
			
			НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
			Если НайдСтроки.Количество() <> 0 Тогда
				
				// теперь ищем в разрезе товаров				
				СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
				СтруктураПоиска.Вставить("Обработан", Ложь);
			
				НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
			
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("id_tov");
					СтруктураПоиска.Вставить("Номенклатура", СокрЛП(Стр.Номенклатура.Наименование));
				
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;	
				
			КонецЕсли;
							
		КонецЕсли;
		
		Если НайдСтроки.Количество() = 0 Тогда
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Поступление товаров и услуг";
			НОвСтр.ДокументФин = Стр.Док;
			НовСтр.ДокументБух = "ДОКУМЕНТ НЕ НАЙДЕН";
			НовСтр.СуммаФин = Стр.Сумма;
			НовСтр.СуммаБух = 0;
			НовСтр.НоменклатураФин = Стр.Номенклатура;
			НовСтр.НоменклатураБух = "<---->";
			//
			НовСтр.СчетДТФин = Стр.СчетДТ;
			НовСтр.СчетКТФин = Стр.СчетКТ;
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
			Продолжить;
		Иначе
		
			Если НСтрокиТОвары = Неопределено ИЛИ НСтрокиТовары.Количество() = 0 Тогда
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Поступление товаров и услуг";
				НОвСтр.ДокументФин = Стр.Док;
				НовСтр.ДокументБух = НайдСтроки[0].Документ;
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = 0;
				НовСтр.НоменклатураФин = Стр.Номенклатура;
				НовСтр.НоменклатураБух = "<---->";
				//
				НовСтр.СчетДТФин = Стр.СчетДТ;
				НовСтр.СчетКТФин = Стр.СчетКТ;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
				Продолжить;
			КонецЕсли;
		
			//Для Каждого НСтр Из НСтрокиТовары Цикл
			НСтр = НСтрокиТовары[0];
			
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Поступление товаров и услуг";
				НОвСтр.ДокументФин = Стр.Док;
				НовСтр.ДокументБух = НСтр.Документ;
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = НСтр.Сумма;
				НовСтр.НоменклатураФин = Стр.Номенклатура;
				НовСтр.НоменклатураБух = НСтр.Номенклатура;
				//
				НовСтр.СчетДТФин = Стр.СчетДТ;
				НовСтр.СчетКТФин = Стр.СчетКТ;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетКт);
					
				НСтр.Обработан = Истина;
			
			//КонецЦикла;
			
		КонецЕсли;
		
		Стр.Обработан = Истина;
		
	КонецЦикла;	
	
	// сопоставляем
	Для Каждого Стр Из ДанныеБух Цикл
		
		Если Стр.Обработан Тогда
			Продолжить;
		КонецЕсли;
		
		НСтрокиТОвары = Неопределено;
		
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Раздел", "ПТУ");					
		СтруктураПоиска.Вставить("ГУИД", Стр.ГУИД);					
				
		НайдСтроки = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
		Если НайдСтроки.Количество() <> 0 Тогда
			
			// теперь ищем в разрезе товаров				
			СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
			СтруктураПоиска.Вставить("Обработан", Ложь);
			
			НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
			
			Если НСтрокиТовары.Количество() = 0 Тогда
				СтруктураПоиска.Удалить("id_tov");
				СтруктураПоиска.Вставить("НоменклатураСтрокой", СокрЛП(Стр.Номенклатура));
				
				НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
			КонецЕсли;		
				
		Иначе		
			
			СтруктураПоиска = Новый Структура;
			СтруктураПоиска.Вставить("Раздел", "ПТУ");
			СтруктураПоиска.Вставить("ДатаПоиска", Стр.ДатаПоиска);
			СтруктураПоиска.Вставить("НомерПоиска", СокрЛП(Стр.НомерПоиска));
			
			НайдСтроки = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
			Если НайдСтроки.Количество() <> 0 Тогда
				
				// теперь ищем в разрезе товаров				
				СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
				СтруктураПоиска.Вставить("Обработан", Ложь);
			
				НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
			
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("id_tov");
					СтруктураПоиска.Вставить("НоменклатураСтрокой", СокрЛП(Стр.Номенклатура));
				
					НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;	
				
			КонецЕсли;
							
		КонецЕсли;
		
		Если НайдСтроки.Количество() = 0 Тогда
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Поступление товаров и услуг";
			НОвСтр.ДокументФин = "ДОКУМЕНТ НЕ НАЙДЕН";
			НовСтр.ДокументБух = Стр.Документ;
			НовСтр.СуммаФин = 0;
			НовСтр.СуммаБух = Стр.Сумма;
			НовСтр.НоменклатураФин = "<---->";
			НовСтр.НоменклатураБух = Стр.Номенклатура;
			//
			НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);

			Продолжить;
			
		Иначе			
		
			Если НСтрокиТОвары = Неопределено ИЛИ НСтрокиТовары.Количество() = 0 Тогда
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Поступление товаров и услуг";
				НОвСтр.ДокументФин = НайдСтроки[0].Док;
				НовСтр.ДокументБух = Стр.Документ;
				НовСтр.СуммаФин = 0;
				НовСтр.СуммаБух = Стр.Сумма;
				НовСтр.НоменклатураФин = "<---->";
				НовСтр.НоменклатураБух = Стр.Номенклатура;
				//
				НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);
				Продолжить;
			КонецЕсли;
		
			// 	Для Каждого НСтр Из НСтрокиТОвары Цикл
			НСтр = НСтрокиТОвары[0];
			
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Поступление товаров и услуг";
				НОвСтр.ДокументФин = Стр.Документ;
				НовСтр.ДокументБух = НСтр.Док;
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = НСтр.Сумма;
				НовСтр.НоменклатураФин = Стр.Номенклатура;
				НовСтр.НоменклатураБух = НСтр.Номенклатура;	
				//
				НовСтр.СчетДТФин = НСтр.СчетДт;
				НовСтр.СчетКТФин = НСтр.СчетКт;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);
				
			//	КонецЦикла;
			
			
		КонецЕсли;
		
	КонецЦикла;	
		
	КонецЕсли;

	Если ДР Тогда
				
		ДанныеБух.Очистить();
		ТаблицаФинансы.Очистить();

		ТекстЗапроса="ВЫБРАТЬ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор) КАК Документ,
				|	ХозрасчетныйОбороты.Регистратор КАК ДокументСсылка,
				|	ХозрасчетныйОбороты.Регистратор.Дата КАК ДатаПоиска,
				|	ХозрасчетныйОбороты.Регистратор.Номер КАК НомерПоиска,
				|	СУММА(ХозрасчетныйОбороты.СуммаОборот) КАК Сумма,
				|	ХозрасчетныйОбороты.СубконтоДт1 КАК НоменклатураСсылка,
				|	ХозрасчетныйОбороты.СубконтоДт1.ИД КАК id_tov,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоДт1) КАК Номенклатура,
				|	ХозрасчетныйОбороты.СчетДт.Код КАК СчетДт,
				|	ХозрасчетныйОбороты.СчетКт.Код КАК СчетКт
				|ПОМЕСТИТЬ СводнаяТаблица
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&СписокСчетов), , , , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов

				|СГРУППИРОВАТЬ ПО
				|	ХозрасчетныйОбороты.СубконтоДт1,
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.СчетКт.Код,
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ХозрасчетныйОбороты.Регистратор.Номер,
				|	ХозрасчетныйОбороты.СубконтоДт1.ИД,
				|	ХозрасчетныйОбороты.СчетДт,
				|	ХозрасчетныйОбороты.СчетКт

				|ОБЪЕДИНИТЬ ВСЕ

				|ВЫБРАТЬ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор),
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ХозрасчетныйОбороты.Регистратор.Номер,
				|	СУММА(ХозрасчетныйОбороты.СуммаОборот),
				|	ХозрасчетныйОбороты.СубконтоКт1,
				|	ХозрасчетныйОбороты.СубконтоКт1.ИД,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоКт1),
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.СчетКт.Код
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&СписокСчетов), , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов

				|СГРУППИРОВАТЬ ПО
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.СубконтоКт1,
				|	ХозрасчетныйОбороты.СчетКт.Код,
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ХозрасчетныйОбороты.СубконтоКт1.ИД,
				|	ХозрасчетныйОбороты.Регистратор.Номер,
				|	ХозрасчетныйОбороты.СчетДт,
				|	ХозрасчетныйОбороты.СчетКт
				|;

				|////////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				|	СводнаяТаблица.Документ,
				|	СводнаяТаблица.ДокументСсылка,
				|	СводнаяТаблица.ДатаПоиска,
				|	СводнаяТаблица.НомерПоиска,
				|	СводнаяТаблица.Сумма,
				|	СводнаяТаблица.НоменклатураСсылка КАК НоменклатураСсылка,
				|	СводнаяТаблица.id_tov,
				|	СводнаяТаблица.Номенклатура,
				|	СводнаяТаблица.СчетДт,
				|	СводнаяТаблица.СчетКт,
				|	ЕСТЬNULL(ПервоначальныеСведенияОСБухгалтерскийУчетСрезПоследних.ИнвентарныйНомер, """") КАК ИнвентарныйНомер,
				|	ВЫБОР
				|		КОГДА СводнаяТаблица.СчетДт = ""01.01""
				|			ТОГДА СводнаяТаблица.НоменклатураСсылка.ЗаводскойНомер
				|		ИНАЧЕ """"
				|	КОНЕЦ КАК ЗаводскойНомер
				|ИЗ
				|	СводнаяТаблица КАК СводнаяТаблица
				|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПервоначальныеСведенияОСБухгалтерскийУчет.СрезПоследних КАК ПервоначальныеСведенияОСБухгалтерскийУчетСрезПоследних
				|		ПО СводнаяТаблица.НоменклатураСсылка = ПервоначальныеСведенияОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство";
	
	Запрос.Текст=ТекстЗапроса;
	
	МассивСчетов=v82.NewObject("Массив");
	МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ОСвОрганизации);
	МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПриобретениеОбъектовОсновныхСредств);
	МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ИнвентарьИХозяйственныеПринадлежности);
	МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПрочиеМатериалы);	
	//
	Запрос.УстановитьПараметр("СписокСчетов", МассивСчетов);
					
	Выборка=Запрос.Выполнить().Выбрать();
		
	Пока Выборка.Следующий() Цикл
		НС=ДанныеБух.Добавить();
		ЗаполнитьЗначенияСвойств(НС, Выборка);
		НС.НомерПоиска = СокрЛП(НС.НомерПоиска);		
		НС.ГУИД = v82.XMLСтрока(Выборка.ДокументСсылка);
		НС.Раздел = "ДР";		
		
		Если Выборка.СчетДТ = "01.01" И ЗначениеЗаполнено(выборка.Номенклатура) Тогда
			НС.ГуидОС = v82.XMLСтрока(Выборка.НоменклатураСсылка); 
		КонецЕсли;
		
	КонецЦикла;	
		
		МассивСчетов = Новый Массив;	
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредств);
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредствДо100000);
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.Инвентарь);
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПрочиеМатериалы);
		
		ЗапросДанныеФинансов.УстановитьПараметр("Счета", МассивСчетов);
	  	
		ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ
		                             |	ФинансовыйОбороты.Регистратор КАК Док,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ КАК Номенклатура,
		                             |	ФинансовыйОбороты.СубконтоДт1 КАК ОС,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""01.1""
		                             |			ТОГДА """"
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ КАК id_tov,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
		                             |	ФинансовыйОбороты.СчетДт КАК СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |ПОМЕСТИТЬ Сводная
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СубконтоДт1,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""01.1""
		                             |			ТОГДА """"
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |ОБЪЕДИНИТЬ ВСЕ
		                             |
		                             |ВЫБРАТЬ
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ФинансовыйОбороты.СубконтоДт1.Номенклатура,
		                             |	ФинансовыйОбороты.СубконтоДт1,
		                             |	0,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт.Код = ""01.1"", , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт,
		                             |	ФинансовыйОбороты.СубконтоДт1,
		                             |	ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |;
		                             |
		                             |////////////////////////////////////////////////////////////////////////////////
		                             |ВЫБРАТЬ
		                             |	СводнаяНекорректные.Док,
		                             |	СводнаяНекорректные.ОС
		                             |ПОМЕСТИТЬ СводнаяНекорректные
		                             |ИЗ
		                             |	Сводная КАК СводнаяНекорректные
		                             |ГДЕ
		                             |	СводнаяНекорректные.СчетДт.Код = ""01.1""
		                             |;
		                             |
		                             |////////////////////////////////////////////////////////////////////////////////
		                             |ВЫБРАТЬ
		                             |	Сводная.Док,
		                             |	Сводная.Номенклатура,
		                             |	ВЫБОР
		                             |		КОГДА Сводная.СчетДт.Код = ""01.1""
		                             |			ТОГДА Сводная.ОС
		                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
		                             |	КОНЕЦ КАК ОС,
		                             |	Сводная.id_tov,
		                             |	СУММА(Сводная.Сумма) КАК Сумма,
		                             |	Сводная.СчетДт,
		                             |	Сводная.СчетКт
		                             |ИЗ
		                             |	Сводная КАК Сводная
		                             |		ЛЕВОЕ СОЕДИНЕНИЕ СводнаяНекорректные КАК СводнаяНекорректные
		                             |		ПО Сводная.ОС = СводнаяНекорректные.ОС
		                             |			И Сводная.Док = СводнаяНекорректные.Док
		                             |ГДЕ
		                             |	ВЫБОР
		                             |			КОГДА Сводная.СчетДт.Код = ""08.4""
		                             |					И НЕ СводнаяНекорректные.ОС ЕСТЬ NULL 
		                             |				ТОГДА ЛОЖЬ
		                             |			ИНАЧЕ ИСТИНА
		                             |		КОНЕЦ
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	Сводная.Док,
		                             |	Сводная.Номенклатура,
		                             |	ВЫБОР
		                             |		КОГДА Сводная.СчетДт.Код = ""01.1""
		                             |			ТОГДА Сводная.ОС
		                             |		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка)
		                             |	КОНЕЦ,
		                             |	Сводная.id_tov,
		                             |	Сводная.СчетДт,
		                             |	Сводная.СчетКт";
								 
		ТаблицаФинансы.Загрузить(ЗапросДанныеФинансов.Выполнить().Выгрузить());
	
		Для Каждого Стр Из ТаблицаФинансы Цикл		
			Стр.ГУИД = Строка(Стр.Док.УникальныйИдентификатор());
			Стр.Раздел = "ДР";
		КонецЦикла; 
		
		// сопоставляем
		Для Каждого Стр Из ТаблицаФинансы Цикл
		
		НСтрокиТОвары = Неопределено;
		
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Раздел", "ДР");
		СтруктураПоиска.Вставить("ГУИД", Стр.ГУИД);
		СтруктураПоиска.Вставить("Обработан", Ложь);
				
		НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
		Если НайдСтроки.Количество() <> 0 Тогда
			
			// теперь ищем в разрезе товаров		
			
			Если Стр.СчетДТ.Код = "01.1" Тогда
				
				ГуидПоиска1 = Стр.ОС.АК_ID_Buh;
				ГуидПоиска2 = Стр.ОС.УникальныйИдентификатор();
			
				ЗаводскойНомер = Стр.ОС.ЗаводскойНомер;
				НаименованиеОС = СокрЛП(Стр.ОС.Наименование);
				ИНвНомер = СокрЛП(Стр.ОС.ИнвентарныйНомер);
				
				НСтрокиТовары = Новый Массив;
							
				//1
				Если ЗначениеЗаполнено(ГуидПоиска1) Тогда
					СтруктураПоиска.Вставить("ГуидОС", ГуидПоиска1);
			
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				КонецЕсли;
			
				//2
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Вставить("ГуидОС", ГуидПоиска2);
				
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;
			
				//3
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("ГуидОС");
					СтруктураПоиска.Вставить("ИнвентарныйНомер", ИнвНомер);
					
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
					
				КонецЕсли;
			
				//4
				Если НСтрокиТовары.Количество() = 0 Тогда				
					СтруктураПоиска.Удалить("ИнвентарныйНомер");
					СтруктураПоиска.Вставить("ЗаводскойНомер", ЗаводскойНомер);
					СтруктураПоиска.Вставить("Номенклатура", СокрЛП(Стр.Номенклатура.Наименование));
				
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;
				
			Иначе	
						
				СтруктураПоиска.Вставить("id_tov", Стр.id_tov);				
			
				НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
			
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("id_tov");
					СтруктураПоиска.Вставить("Номенклатура", СокрЛП(Стр.Номенклатура.Наименование));
				
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;		
				
			КонецЕсли;
				
		Иначе			
										
		КонецЕсли;
		
		Если НайдСтроки.Количество() <> 0 Тогда
			
			Если НСтрокиТОвары = Неопределено ИЛИ НСтрокиТовары.Количество() = 0 Тогда
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Поступление доп. расходов";
				НОвСтр.ДокументФин = Стр.Док;
				НовСтр.ДокументБух = НайдСтроки[0].Документ;
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = 0;
				НовСтр.НоменклатураФин = Стр.Номенклатура;
				НовСтр.НоменклатураБух = "<---->";
				//
				НовСтр.СчетДТФин = Стр.СчетДТ;
				НовСтр.СчетКТФин = Стр.СчетКТ;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
				Продолжить;
			КонецЕсли;	
		
			//Для Каждого НСтр Из НСтрокиТовары Цикл	
					
				НСтр = НСтрокиТовары[0];
			
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Поступление доп. расходов";
				НОвСтр.ДокументФин = Стр.Док;
				НовСтр.ДокументБух = НСтр.Документ;
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = НСтр.Сумма;
				НовСтр.НоменклатураФин = Стр.Номенклатура;
				НовСтр.НоменклатураБух = НСтр.Номенклатура;
				//
				НовСтр.СчетДТФин = Стр.СчетДТ;
				НовСтр.СчетКТФин = Стр.СчетКТ;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетКт);
		
				НСтр.Обработан = Истина;
			
			//КонецЦикла;
			
		Иначе
			
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Поступление доп. расходов";
			НОвСтр.ДокументФин = Стр.Док;
			НовСтр.ДокументБух = "ДОКУМЕНТ НЕ НАЙДЕН";
			НовСтр.СуммаФин = Стр.Сумма;
			НовСтр.СуммаБух = 0;
			НовСтр.НоменклатураФин = Стр.Номенклатура;
			НовСтр.НоменклатураБух = "<---->";
			//
			НовСтр.СчетДТФин = Стр.СчетДТ;
			НовСтр.СчетКТФин = Стр.СчетКТ;
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();

			Продолжить;

		КонецЕсли;
		
		Стр.Обработан = Истина;
		
	КонецЦикла;	
	
	Для Каждого Стр Из ДанныеБух Цикл
			
		Если НЕ Стр.Обработан Тогда
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Поступление доп. расходов";
			НОвСтр.ДокументФин = "ДОКУМЕНТ НЕ НАЙДЕН";
			НовСтр.ДокументБух = Стр.Документ;
			НовСтр.СуммаФин = 0;
			НовСтр.СуммаБух = Стр.Сумма;
			НовСтр.НоменклатураФин = "<---->";
			НовСтр.НоменклатураБух = Стр.Номенклатура;
			//
			НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);

		КонецЕсли;
			
	КонецЦикла;

			
	КонецЕсли; 

    //Авансовые
	Если Авансовые Тогда		
			
		ДанныеБух.Очистить();
		ТаблицаФинансы.Очистить();
	
		ТекстЗапроса="ВЫБРАТЬ
					|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор) КАК Документ,
					|	ХозрасчетныйОбороты.Регистратор КАК ДокументСсылка,
					|	ХозрасчетныйОбороты.Регистратор.Дата КАК ДатаПоиска,
					|	ХозрасчетныйОбороты.Регистратор.Номер КАК НомерПоиска,
					|	ХозрасчетныйОбороты.СуммаОборот КАК Сумма,
					|	ХозрасчетныйОбороты.СубконтоДт1 КАК НоменклатураСсылка,
					|	ХозрасчетныйОбороты.СубконтоДт1.ИД КАК id_tov,
					|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоДт1) КАК Номенклатура,
					|	ХозрасчетныйОбороты.СчетДт.Код КАК СчетДт,
					|	ХозрасчетныйОбороты.СчетКт.Код КАК СчетКт
					|ИЗ
					|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&СписокСчетов), , , , ) КАК ХозрасчетныйОбороты
					|ГДЕ
					|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет

					|ОБЪЕДИНИТЬ ВСЕ

					|ВЫБРАТЬ
					|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор),
					|	ХозрасчетныйОбороты.Регистратор,
					|	ХозрасчетныйОбороты.Регистратор.Дата,
					|	ХозрасчетныйОбороты.Регистратор.Номер,
					|	ХозрасчетныйОбороты.СуммаОборот,
					|	ХозрасчетныйОбороты.СубконтоКт1,
					|	ХозрасчетныйОбороты.СубконтоКт1.ИД,
					|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоКт1),
					|	ХозрасчетныйОбороты.СчетДт.Код,
					|	ХозрасчетныйОбороты.СчетКт.Код
					|ИЗ
					|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&СписокСчетов), , ) КАК ХозрасчетныйОбороты
					|ГДЕ
					|	ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет

					|УПОРЯДОЧИТЬ ПО
					|	СчетДт
					|АВТОУПОРЯДОЧИВАНИЕ";
	
		Запрос.Текст=ТекстЗапроса;
		
		МассивСчетов=v82.NewObject("Массив");
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПриобретениеОбъектовОсновныхСредств);
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ИнвентарьИХозяйственныеПринадлежности);
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПрочиеМатериалы);
		//
		Запрос.УстановитьПараметр("СписокСчетов", МассивСчетов);
						
		Выборка=Запрос.Выполнить().Выбрать();
			
		Пока Выборка.Следующий() Цикл
			НС=ДанныеБух.Добавить();
			ЗаполнитьЗначенияСвойств(НС, Выборка);
			НС.Номенклатура = СокрЛП(Нс.Номенклатура);
			НС.НомерПоиска = СокрЛП(НС.НомерПоиска);					
			НС.ГУИД = v82.XMLСтрока(Выборка.ДокументСсылка); 
			НС.Раздел = "Авансовые";
		КонецЦикла;			
		
		МассивСчетов = Новый Массив;	
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредств);		
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.Инвентарь);
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПрочиеМатериалы);	
		
		ЗапросДанныеФинансов.УстановитьПараметр("Счета", МассивСчетов);
		
		ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ
		                             |	ФинансовыйОбороты.Регистратор КАК Док,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ КАК Номенклатура,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ КАК id_tov,
		                             |	ФинансовыйОбороты.СчетДт КАК СчетДт,
		                             |	ФинансовыйОбороты.СчетКт КАК СчетКт
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет
		                             |	И ФинансовыйОбороты.Регистратор.ВыгружатьВ_БП
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |ОБЪЕДИНИТЬ ВСЕ
		                             |
		                             |ВЫБРАТЬ
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&Счета), , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	ФинансовыйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет
		                             |	И ФинансовыйОбороты.Регистратор.ВыгружатьВ_БП
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |УПОРЯДОЧИТЬ ПО
		                             |	СчетДт,
		                             |	СчетКт
		                             |АВТОУПОРЯДОЧИВАНИЕ";
								 
	ТаблицаФинансы.Загрузить(ЗапросДанныеФинансов.Выполнить().Выгрузить());
	
	Для Каждого Стр Из ТаблицаФинансы Цикл
		Стр.ГУИД = Стр.Док.УникальныйИдентификатор();		
		Стр.ДатаПоиска = Стр.Док.Дата;
		Стр.НомерПоиска = СокрЛП(Стр.Док.Номер);
		Стр.НоменклатураСтрокой = СокрЛП(Стр.Номенклатура.Наименование);
		Стр.Раздел = "Авансовые";
	КонецЦикла;
		
	// сопоставляем
	Для Каждого Стр Из ТаблицаФинансы Цикл
		
		НСтрокиТОвары = Неопределено;
		
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Раздел", "Авансовые");
		СтруктураПоиска.Вставить("ГУИД", Стр.ГУИД);					
				
		НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
		Если НайдСтроки.Количество() <> 0 Тогда
			
			// теперь ищем в разрезе товаров				
			СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
			СтруктураПоиска.Вставить("Обработан", Ложь);
			
			НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
			
			Если НСтрокиТовары.Количество() = 0 Тогда
				СтруктураПоиска.Удалить("id_tov");
				СтруктураПоиска.Вставить("Номенклатура", СокрЛП(Стр.Номенклатура.Наименование));
				
				НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);			
				
			КонецЕсли;		
				
		Иначе		
			
			СтруктураПоиска = Новый Структура;
			СтруктураПоиска.Вставить("Раздел", "Авансовые");
			СтруктураПоиска.Вставить("ДатаПоиска", Стр.Док.Дата);
			СтруктураПоиска.Вставить("НомерПоиска", СокрЛП(Стр.Док.Номер));
			
			НайдСтроки = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
			Если НайдСтроки.Количество() <> 0 Тогда
				
				// теперь ищем в разрезе товаров				
				СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
				СтруктураПоиска.Вставить("Обработан", Ложь);
			
				НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
			
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("id_tov");
					СтруктураПоиска.Вставить("Номенклатура", СокрЛП(Стр.Номенклатура.Наименование));
				
					НСтрокиТовары = ДанныеБух.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;	
				
			КонецЕсли;
							
		КонецЕсли;
		
		Если НайдСтроки.Количество() = 0 Тогда
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Авансовый отчет";
			НОвСтр.ДокументФин = Стр.Док;
			НовСтр.ДокументБух = "ДОКУМЕНТ НЕ НАЙДЕН";
			НовСтр.СуммаФин = Стр.Сумма;
			НовСтр.СуммаБух = 0;
			НовСтр.НоменклатураФин = Стр.Номенклатура;
			НовСтр.НоменклатураБух = "<---->";
			//
			НовСтр.СчетДТФин = Стр.СчетДТ;
			НовСтр.СчетКТФин = Стр.СчетКТ;
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
			Продолжить;
		Иначе
		
			Если НСтрокиТОвары = Неопределено ИЛИ НСтрокиТовары.Количество() = 0 Тогда
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Авансовый отчет";
				НОвСтр.ДокументФин = Стр.Док;
				НовСтр.ДокументБух = НайдСтроки[0].Документ;
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = 0;
				НовСтр.НоменклатураФин = Стр.Номенклатура;
				НовСтр.НоменклатураБух = "<---->";
				//
				НовСтр.СчетДТФин = Стр.СчетДТ;
				НовСтр.СчетКТФин = Стр.СчетКТ;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
				Продолжить;
			КонецЕсли;
		
			НСтр = НстрокиТовары[0];
			//Для Каждого НСтр Из НСтрокиТовары Цикл
			
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Авансовый отчет";
				НОвСтр.ДокументФин = Стр.Док;
				НовСтр.ДокументБух = НСтр.Документ;
				НовСтр.СуммаФин = Стр.Сумма;
				НовСтр.СуммаБух = НСтр.Сумма;
				НовСтр.НоменклатураФин = Стр.Номенклатура;
				НовСтр.НоменклатураБух = НСтр.Номенклатура;
				//
				НовСтр.СчетДТФин = Стр.СчетДТ;
				НовСтр.СчетКТФин = Стр.СчетКТ;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(НСтр.СчетКт);
					
				НСтр.Обработан = Истина;
			
			//КонецЦикла;
			
		КонецЕсли;
		
		Стр.Обработан = Истина;
		
	КонецЦикла;	
	
	// сопоставляем
	Для Каждого Стр Из ДанныеБух Цикл
		
		Если Стр.Обработан Тогда
			Продолжить;
		КонецЕсли;
		
		НСтрокиТОвары = Неопределено;
		
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Раздел", "Авансовые");					
		СтруктураПоиска.Вставить("ГУИД", Стр.ГУИД);					
				
		НайдСтроки = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
		Если НайдСтроки.Количество() <> 0 Тогда
			
			// теперь ищем в разрезе товаров				
			СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
			СтруктураПоиска.Вставить("Обработан", Ложь);
			
			НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
			
			Если НСтрокиТовары.Количество() = 0 Тогда
				СтруктураПоиска.Удалить("id_tov");
				СтруктураПоиска.Вставить("НоменклатураСтрокой", СокрЛП(Стр.Номенклатура));
				
				НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
			КонецЕсли;		
				
		Иначе		
			
			СтруктураПоиска = Новый Структура;
			СтруктураПоиска.Вставить("Раздел", "Авансовые");
			СтруктураПоиска.Вставить("ДатаПоиска", Стр.ДатаПоиска);
			СтруктураПоиска.Вставить("НомерПоиска", СокрЛП(Стр.НомерПоиска));
			
			НайдСтроки = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
			Если НайдСтроки.Количество() <> 0 Тогда
				
				// теперь ищем в разрезе товаров				
				СтруктураПоиска.Вставить("id_tov", Стр.id_tov);
				СтруктураПоиска.Вставить("Обработан", Ложь);
			
				НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
			
				Если НСтрокиТовары.Количество() = 0 Тогда
					СтруктураПоиска.Удалить("id_tov");
					СтруктураПоиска.Вставить("НоменклатураСтрокой", СокрЛП(Стр.Номенклатура));
				
					НСтрокиТовары = ТаблицаФинансы.НайтиСтроки(СтруктураПоиска);
				
				КонецЕсли;	
				
			КонецЕсли;
							
		КонецЕсли;
		
		Если НайдСтроки.Количество() = 0 Тогда
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Авансовый отчет";
			НОвСтр.ДокументФин = "ДОКУМЕНТ НЕ НАЙДЕН";
			НовСтр.ДокументБух = Стр.Документ;
			НовСтр.СуммаФин = 0;
			НовСтр.СуммаБух = Стр.Сумма;
			НовСтр.НоменклатураФин = "<---->";
			НовСтр.НоменклатураБух = Стр.Номенклатура;
			//
			НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);

			Продолжить;
			
		Иначе			
		
			Если НСтрокиТОвары = Неопределено ИЛИ НСтрокиТовары.Количество() = 0 Тогда
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Авансовый отчет";
				НОвСтр.ДокументФин = НайдСтроки[0].Док;
				НовСтр.ДокументБух = Стр.Документ;
				НовСтр.СуммаФин = 0;
				НовСтр.СуммаБух = Стр.Сумма;
				НовСтр.НоменклатураФин = "<---->";
				НовСтр.НоменклатураБух = Стр.Номенклатура;
				//
				НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);
				Продолжить;
			КонецЕсли;
		
			//Для Каждого НСтр Из НСтрокиТовары Цикл
			НСтр = НСтрокиТовары[0];
			
				НовСтр = СводнаяТаблица.Добавить();
				НовСтр.Раздел = "Авансовый отчет";
				НОвСтр.ДокументФин = НСтр.Док;
				НовСтр.ДокументБух = Стр.Документ;
				НовСтр.СуммаФин = НСтр.Сумма;
				НовСтр.СуммаБух = Стр.Сумма;
				НовСтр.НоменклатураФин = НСтр.Номенклатура;
				НовСтр.НоменклатураБух = Стр.Номенклатура;	
				//
				НовСтр.СчетДТФин = НСтр.СчетДт;
				НовСтр.СчетКТФин = НСтр.СчетКт;
				НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
				НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);
			
			//КонецЦикла;
			
		КонецЕсли;
		
	КонецЦикла;
	
	КонецЕсли;
	
    //прочее
	Если Прочее Тогда		
		
		ДанныеБух.Очистить();
		ТаблицаФинансы.Очистить();
		
		ТекстЗапроса="ВЫБРАТЬ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор) КАК Документ,
				|	ХозрасчетныйОбороты.Регистратор КАК ДокументСсылка,
				|	ХозрасчетныйОбороты.Регистратор.Дата КАК ДатаПоиска,
				|	ХозрасчетныйОбороты.Регистратор.Номер КАК НомерПоиска,
				|	ХозрасчетныйОбороты.СуммаОборот КАК Сумма,
				|	ХозрасчетныйОбороты.СубконтоДт1 КАК НоменклатураСсылка,
				|	ХозрасчетныйОбороты.СубконтоДт1.ИД КАК id_tov,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоДт1) КАК Номенклатура,
				|	ХозрасчетныйОбороты.СчетДт.Код КАК СчетДт,
				|	ХозрасчетныйОбороты.СчетКт.Код КАК СчетКт
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&СписокСчетов), , , , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПринятиеКУчетуОС
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет

				|ОБЪЕДИНИТЬ ВСЕ

				|ВЫБРАТЬ
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.Регистратор),
				|	ХозрасчетныйОбороты.Регистратор,
				|	ХозрасчетныйОбороты.Регистратор.Дата,
				|	ХозрасчетныйОбороты.Регистратор.Номер,
				|	ХозрасчетныйОбороты.СуммаОборот,
				|	ХозрасчетныйОбороты.СубконтоКт1,
				|	ХозрасчетныйОбороты.СубконтоКт1.ИД,
				|	ПРЕДСТАВЛЕНИЕ(ХозрасчетныйОбороты.СубконтоКт1),
				|	ХозрасчетныйОбороты.СчетДт.Код,
				|	ХозрасчетныйОбороты.СчетКт.Код
				|ИЗ
				|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&СписокСчетов), , ) КАК ХозрасчетныйОбороты
				|ГДЕ
				|	НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ПринятиеКУчетуОС
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная
				|	И НЕ ХозрасчетныйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет

				|УПОРЯДОЧИТЬ ПО
				|	СчетДт
				|АВТОУПОРЯДОЧИВАНИЕ";
		
		Запрос.Текст=ТекстЗапроса;
		
		МассивСчетов=v82.NewObject("Массив");
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПриобретениеОбъектовОсновныхСредств);
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ИнвентарьИХозяйственныеПринадлежности);
		МассивСчетов.Добавить(v82.ПланыСчетов.Хозрасчетный.ПрочиеМатериалы);
		//
		Запрос.УстановитьПараметр("СписокСчетов", МассивСчетов);
		
		Выборка=Запрос.Выполнить().Выбрать();
		
		Пока Выборка.Следующий() Цикл
			НС=ДанныеБух.Добавить();
			ЗаполнитьЗначенияСвойств(НС, Выборка);
			НС.НомерПоиска = СокрЛП(НС.НомерПоиска);					
			НС.ГУИД = v82.XMLСтрока(Выборка.ДокументСсылка); 
			НС.Раздел = "Прочее";
		КонецЦикла;			
		
		МассивСчетов = Новый Массив;	
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПриобретениеОсновныхСредств);		
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.Инвентарь);
		МассивСчетов.Добавить(ПланыСчетов.Финансовый.ПрочиеМатериалы);	
		
		ЗапросДанныеФинансов.УстановитьПараметр("Счета", МассивСчетов);
		
		ЗапросДанныеФинансов.Текст = "ВЫБРАТЬ
		                             |	ФинансовыйОбороты.Регистратор КАК Док,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот) КАК Сумма,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ КАК Номенклатура,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ КАК id_tov,
		                             |	ФинансовыйОбороты.СчетДт КАК СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (&Счета), , , , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетДт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоДт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоДт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |ОБЪЕДИНИТЬ ВСЕ
		                             |
		                             |ВЫБРАТЬ
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	СУММА(ФинансовыйОбороты.СуммаОборот),
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |ИЗ
		                             |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (&Счета), , ) КАК ФинансовыйОбороты
		                             |ГДЕ
		                             |	НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ВводВЭксплуатацию
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.ТребованиеНакладная
		                             |	И НЕ ФинансовыйОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет
		                             |
		                             |СГРУППИРОВАТЬ ПО
		                             |	ФинансовыйОбороты.Регистратор,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура
		                             |	КОНЕЦ,
		                             |	ВЫБОР
		                             |		КОГДА ФинансовыйОбороты.СчетКт.Код = ""10.6""
		                             |			ТОГДА ФинансовыйОбороты.СубконтоКт1.id_tov
		                             |		ИНАЧЕ ФинансовыйОбороты.СубконтоКт1.Номенклатура.id_tov
		                             |	КОНЕЦ,
		                             |	ФинансовыйОбороты.СчетДт,
		                             |	ФинансовыйОбороты.СчетКт
		                             |
		                             |УПОРЯДОЧИТЬ ПО
		                             |	СчетДт
		                             |АВТОУПОРЯДОЧИВАНИЕ";
		
		ТаблицаФинансы.Загрузить(ЗапросДанныеФинансов.Выполнить().Выгрузить());
		
		// без сопоставления
		Для Каждого Стр Из ТаблицаФинансы Цикл
			
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Прочее";
			НовСтр.ДокументФин = Стр.Док;
			НовСтр.ДокументБух = "<>";
			НовСтр.СуммаФин = Стр.Сумма;
			НовСтр.СуммаБух = 0;
			НовСтр.НоменклатураФин = Стр.Номенклатура;
			НовСтр.НоменклатураБух = "<---->";		
			//
			НовСтр.СчетДТФин = Стр.СчетДТ;
			НовСтр.СчетКТФин = Стр.СчетКТ;
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.ПустаяСсылка();
		КонецЦикла;	
		
		Для Каждого Стр Из ДанныеБух Цикл
			
			НовСтр = СводнаяТаблица.Добавить();
			НовСтр.Раздел = "Прочее";
			НовСтр.ДокументФин = "<>";
			НовСтр.ДокументБух = Стр.Документ;
			НовСтр.СуммаФин = 0;
			НовСтр.СуммаБух = Стр.Сумма;
			НовСтр.НоменклатураФин = "<---->";
			НовСтр.НоменклатураБух = Стр.Номенклатура;
			//
			НовСтр.СчетДТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетКТФин = ПланыСчетов.Финансовый.ПустаяСсылка();
			НовСтр.СчетДтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетДт);
			НовСтр.СчетКтБух = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Стр.СчетКт);
			
		КонецЦикла;	
		
	КонецЕсли;
	
	//Списание ОС	
	Если СписаниеОС ИЛИ РеализацияОС ИЛИ КоррПТУ Тогда		
		
		ТекстЗапроса = "";
		
		Если КоррПТУ Тогда
			ТекстЗапроса = "ВЫБРАТЬ
			               |	ФинансовыйОборотыДтКт.Регистратор КАК Регистратор,
			               |	ПРЕДСТАВЛЕНИЕ(ВЫБОР
			               |		КОГДА ФинансовыйОборотыДтКт.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы)
			               |			ТОГДА СпрНоменклатура.Ссылка
			               |		ИНАЧЕ СпрНоменклатураОС.Ссылка
			               |	КОНЕЦ) КАК ОСНоменклатура,
			               |	ВЫБОР
			               |		КОГДА ФинансовыйОборотыДтКт.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы)
			               |			ТОГДА СпрНоменклатура.id_tov
			               |		ИНАЧЕ СпрНоменклатураОС.id_tov
			               |	КОНЕЦ КАК id_tov,
			               |	СУММА(ФинансовыйОборотыДтКт.СуммаОборот) КАК Сумма,
			               |	""КоррПТУ"" КАК Раздел,
			               |	0 КАК КодОС,
			               |	"""" КАК НаименованиеОС,
			               |	"""" КАК ЗаводскойНомерОС,
			               |	ЗНАЧЕНИЕ(Справочник.ОсновныеСредства.ПустаяСсылка) КАК ОССсылка,
			               |	ФинансовыйОборотыДтКт.СчетДт,
			               |	ФинансовыйОборотыДтКт.СчетКт
			               |ИЗ
			               |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПриобретениеОсновныхСредств), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПриобретениеОсновныхСредствДо100000), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.Инвентарь)), , , , ) КАК ФинансовыйОборотыДтКт
			               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
			               |		ПО ФинансовыйОборотыДтКт.СубконтоДт1 = СпрНоменклатура.Ссылка
			               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ОсновныеСредства КАК ОсновныеСредства
			               |			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатураОС
			               |			ПО ОсновныеСредства.Номенклатура = СпрНоменклатураОС.Ссылка
			               |		ПО ФинансовыйОборотыДтКт.СубконтоДт1 = ОсновныеСредства.Ссылка
			               |ГДЕ
			               |	ФинансовыйОборотыДтКт.Регистратор ССЫЛКА Документ.КорректировкаПоступления
			               |
			               |СГРУППИРОВАТЬ ПО
			               |	ФинансовыйОборотыДтКт.Регистратор,
			               |	ВЫБОР
			               |		КОГДА ФинансовыйОборотыДтКт.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы)
			               |			ТОГДА СпрНоменклатура.id_tov
			               |		ИНАЧЕ СпрНоменклатураОС.id_tov
			               |	КОНЕЦ,
			               |	ФинансовыйОборотыДтКт.СчетДт,
			               |	ФинансовыйОборотыДтКт.СчетКт,
			                |	ПРЕДСТАВЛЕНИЕ(ВЫБОР
			               |		КОГДА ФинансовыйОборотыДтКт.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы)
			               |			ТОГДА СпрНоменклатура.Ссылка
			               |		ИНАЧЕ СпрНоменклатураОС.Ссылка
			               |	КОНЕЦ)
						   |";
		КонецЕсли;
		
		Если СписаниеОС Или РеализацияОС Тогда
			ТекстЗапроса = ТекстЗапроса + ?(КоррПТУ, "ОБЪЕДИНИТЬ ВСЕ
													  |", "") + "ВЫБРАТЬ
													            |	ФинансовыйОборотыДтКт.Регистратор КАК Регистратор,
													            |	ПРЕДСТАВЛЕНИЕ(ЕСТЬNULL(СпрНоменклатура.Ссылка, СпрНоменклатураОС.Ссылка)) КАК ОСНоменклатура,
													            |	ВЫБОР
													            |		КОГДА ФинансовыйОборотыДтКт.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы)
													            |			ТОГДА СпрНоменклатура.id_tov
													            |		КОГДА ФинансовыйОборотыДтКт.СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваВОрганизации))
													            |			ТОГДА СпрНоменклатураОС.id_tov
													            |		ИНАЧЕ ЕСТЬNULL(СпрНоменклатура.id_tov, СпрНоменклатураОС.id_tov)
													            |	КОНЕЦ КАК id_tov,
													            |	СУММА(ФинансовыйОборотыДтКт.СуммаОборот) КАК Сумма,
													            |	ВЫБОР
													            |		КОГДА ФинансовыйОборотыДтКт.Регистратор ССЫЛКА Документ.СписаниеОС
													            |			ТОГДА ВЫБОР
													            |					КОГДА ФинансовыйОборотыДтКт.СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваВОрганизации))
													            |						ТОГДА ""СписаниеОС""
													            |					ИНАЧЕ ""ТН""
													            |				КОНЕЦ
													            |		ИНАЧЕ ВЫБОР
													            |				КОГДА ФинансовыйОборотыДтКт.СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваВОрганизации))
													            |					ТОГДА ""ПередачаОС""
													            |				ИНАЧЕ ""РТУ""
													            |			КОНЕЦ
													            |	КОНЕЦ КАК Раздел,
													            |	ОсновныеСредства.Код КАК КодОС,
													            |	ВЫРАЗИТЬ(ОсновныеСредства.Наименование КАК СТРОКА(100)) КАК НаименованиеОС,
													            |	ВЫРАЗИТЬ(ОсновныеСредства.ЗаводскойНомер КАК СТРОКА(50)) КАК ЗаводскойНомерОС,
													            |	ОсновныеСредства.Ссылка КАК ОССсылка,
													            |	ФинансовыйОборотыДтКт.СчетДт,
													            |	ФинансовыйОборотыДтКт.СчетКт
													            |ИЗ
													            |	РегистрБухгалтерии.Финансовый.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПриобретениеОсновныхСредствДо100000), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.Инвентарь), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПриобретениеОсновныхСредств), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваВОрганизации), ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваДо100000)), , ) КАК ФинансовыйОборотыДтКт
													            |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
													            |		ПО ФинансовыйОборотыДтКт.СубконтоКт1 = СпрНоменклатура.Ссылка
													            |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ОсновныеСредства КАК ОсновныеСредства
													            |			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатураОС
													            |			ПО ОсновныеСредства.Номенклатура = СпрНоменклатураОС.Ссылка
													            |		ПО ФинансовыйОборотыДтКт.СубконтоКт1 = ОсновныеСредства.Ссылка
													            |ГДЕ
													            |	&Условие2
													            |
													            |СГРУППИРОВАТЬ ПО
													            |	ФинансовыйОборотыДтКт.Регистратор,
													            |	ВЫБОР
													            |		КОГДА ФинансовыйОборотыДтКт.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрочиеМатериалы)
													            |			ТОГДА СпрНоменклатура.id_tov
													            |		КОГДА ФинансовыйОборотыДтКт.СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваВОрганизации))
													            |			ТОГДА СпрНоменклатураОС.id_tov
													            |		ИНАЧЕ ЕСТЬNULL(СпрНоменклатура.id_tov, СпрНоменклатураОС.id_tov)
													            |	КОНЕЦ,													            
													            |	ВЫБОР
													            |		КОГДА ФинансовыйОборотыДтКт.Регистратор ССЫЛКА Документ.СписаниеОС
													            |			ТОГДА ВЫБОР
													            |					КОГДА ФинансовыйОборотыДтКт.СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваВОрганизации))
													            |						ТОГДА ""СписаниеОС""
													            |					ИНАЧЕ ""ТН""
													            |				КОНЕЦ
													            |		ИНАЧЕ ВЫБОР
													            |				КОГДА ФинансовыйОборотыДтКт.СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваВОрганизации))
													            |					ТОГДА ""ПередачаОС""
													            |				ИНАЧЕ ""РТУ""
													            |			КОНЕЦ
													            |	КОНЕЦ,
													            |	ОсновныеСредства.Код,
													            |	ВЫРАЗИТЬ(ОсновныеСредства.Наименование КАК СТРОКА(100)),
													            |	ВЫРАЗИТЬ(ОсновныеСредства.ЗаводскойНомер КАК СТРОКА(50)),
													            |	ОсновныеСредства.Ссылка,
													            |	ФинансовыйОборотыДтКт.СчетДт,
													            |	ФинансовыйОборотыДтКт.СчетКт,
													            |	ПРЕДСТАВЛЕНИЕ(ЕСТЬNULL(СпрНоменклатура.Ссылка, СпрНоменклатураОС.Ссылка))";

		КонецЕсли;

		Условие2 = "";
		
		Если СписаниеОС ИЛИ РеализацияОС Тогда
			Если СписаниеОС Тогда
				Условие2 = "(ФинансовыйОборотыДтКт.Регистратор ССЫЛКА Документ.СписаниеОС И НЕ ФинансовыйОборотыДтКт.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредстваДо100000))";
			КонецЕсли;
			
			Если РеализацияОС Тогда
				Условие2 = Условие2 + ?(СписаниеОС, " ИЛИ ", "") + "ФинансовыйОборотыДтКт.Регистратор ССЫЛКА Документ.РеализацияОС";
			КонецЕсли;
		Иначе
			Условие2 = "ЛОЖЬ";
		КонецЕсли;
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Условие2", Условие2);		
		ЗапросДанныеФинансов.Текст = ТекстЗапроса;
		
		Выборка = ЗапросДанныеФинансов.Выполнить().Выбрать();
		
		ТаблицаДанныхФин = Новый ТаблицаЗначений;
		ТаблицаДанныхФин.Колонки.Добавить("ДокФин", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(400)));	
		ТаблицаДанныхФин.Колонки.Добавить("ГуидОС", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(36)));	
		ТаблицаДанныхФин.Колонки.Добавить("ГуидДок", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(36)));			
		ТаблицаДанныхФин.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15,2)));
		ТаблицаДанныхФин.Колонки.Добавить("ОСКод", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(9)));
		ТаблицаДанныхФин.Колонки.Добавить("ОСНаименование", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(100)));
		ТаблицаДанныхФин.Колонки.Добавить("ОСЗаводскойНомер", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(50)));
		ТаблицаДанныхФин.Колонки.Добавить("НоменклатураПредставление", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(100)));
		ТаблицаДанныхФин.Колонки.Добавить("НоменклатураИД", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(10,0)));
		ТаблицаДанныхФин.Колонки.Добавить("Раздел", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(36)));	
		ТаблицаДанныхФин.Колонки.Добавить("Обработан", Новый ОписаниеТипов("Булево"));
		ТаблицаДанныхФин.Колонки.Добавить("СчетДт", Новый ОписаниеТипов("ПланСчетовСсылка.Финансовый"));
		ТаблицаДанныхФин.Колонки.Добавить("СчетКт", Новый ОписаниеТипов("ПланСчетовСсылка.Финансовый"));
		
		Пока Выборка.Следующий() Цикл
			НовСтр = ТаблицаДанныхФин.Добавить();
			НовСтр.ГуидОС = Строка(Выборка.ОССсылка.УникальныйИдентификатор()); 
			НовСтр.ГуидДок = Строка(Выборка.Регистратор.УникальныйИдентификатор()); 
			НовСтр.Сумма = Выборка.Сумма;
			НовСтр.ОСКод = Выборка.КодОС; 
			НовСтр.ОСНаименование = Выборка.НаименованиеОС;
			НовСтр.ОСЗаводскойНомер = Выборка.ЗаводскойНомерОС;
			НовСтр.НоменклатураПредставление = Выборка.ОСНоменклатура; 
			НовСтр.Раздел = Выборка.Раздел;
			НовСтр.НоменклатураИД = Выборка.id_tov;
			НовСтр.Обработан = Ложь;
			НовСтр.ДокФин = Строка(Выборка.Регистратор);
			НовСтр.СчетДт = ПланыСчетов.Финансовый.НайтиПоКоду(Выборка.СчетДт);
			НовСтр.СчетКт = ПланыСчетов.Финансовый.НайтиПоКоду(Выборка.СчетКт);
		КонецЦикла;		
		
		//Бух данные
		ТекстБух = "";
		
		Если СписаниеОС Тогда
			ТекстБух = "ВЫБРАТЬ
			|	ХозрасчетныйОборотыДтКт.Регистратор,
			|	ХозрасчетныйОборотыДтКт.СчетДт.Код КАК СчетДт,
			|	ХозрасчетныйОборотыДтКт.СчетКт.Код КАК СчетКт,
			|	СписаниеОС.ИД_Фин КАК ГуидРег,
			|	ХозрасчетныйОборотыДтКт.СубконтоДт1 КАК ОС,
			|	ОсновныеСредства.Код,
			|	ВЫРАЗИТЬ(ОсновныеСредства.ЗаводскойНомер КАК СТРОКА(50)) КАК ЗаводскойНомер,
			|	ВЫРАЗИТЬ(ОсновныеСредства.Наименование КАК СТРОКА(100)) КАК Наименование,
			|	ХозрасчетныйОборотыДтКт.СуммаОборот КАК Сумма,
			|	""СписаниеОС"" КАК Раздел,
			|	СпрНоменклатураОС.ИД КАК ИД_номенклатуры
			|ПОМЕСТИТЬ Сводная
			|ИЗ
			|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОСвОрганизации)), , ) КАК ХозрасчетныйОборотыДтКт
			|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СписаниеОС КАК СписаниеОС
			|		ПО ХозрасчетныйОборотыДтКт.Регистратор = СписаниеОС.Ссылка
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ОсновныеСредства КАК ОсновныеСредства
			|		ПО ХозрасчетныйОборотыДтКт.СубконтоКт1 = ОсновныеСредства.Ссылка
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатураОС
			|		ПО ХозрасчетныйОборотыДтКт.СубконтоДт1 = СпрНоменклатураОС.Ссылка
			|ГДЕ
			|	ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.СписаниеОС
			|";
		КонецЕсли;
		
		Если КоррПТУ ИЛИ РеализацияОС Тогда
			
			ТекстБух = ТекстБух + ?(СписаниеОС, "ОБЪЕДИНИТЬ ВСЕ
			|", "") + 
		"ВЫБРАТЬ
		|	ХозрасчетныйОборотыДтКт.Регистратор,
		|	ХозрасчетныйОборотыДтКт.СчетДт.Код КАК СчетДт,
		|	ХозрасчетныйОборотыДтКт.СчетКт.Код КАК СчетКт,
		|	"""" КАК ГуидРег,
		|	НЕОПРЕДЕЛЕНО КАК ОС,
		|	"""" КАК Код,
		|	"""" КАК ЗаводскойНомер,
		|	ПРЕДСТАВЛЕНИЕ(Номенклатура.Ссылка) КАК Наименование,
		|	ХозрасчетныйОборотыДтКт.СуммаОборот КАК Сумма,
		|	ВЫБОР
		|		КОГДА ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.ТребованиеНакладная
		|			ТОГДА ""ТН""
		|		КОГДА ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.КорректировкаПоступления
		|			ТОГДА ""КоррПТУ""
		|		КОГДА ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
		|			ТОГДА ""РТУ""
		|	КОНЕЦ КАК Раздел,
		|	Номенклатура.ИД КАК ИД_номенклатуры
		|" + ?(НЕ СписаниеОС, "ПОМЕСТИТЬ Сводная
		|", "") + "
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПриобретениеОбъектовОсновныхСредств), ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ИнвентарьИХозяйственныеПринадлежности)), , ) КАК ХозрасчетныйОборотыДтКт
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК Номенклатура
		|		ПО ХозрасчетныйОборотыДтКт.СубконтоКт1 = Номенклатура.Ссылка
		|ГДЕ
		|	(" + ?(СписаниеОС, "ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.ТребованиеНакладная", "") + "		
		|			" + ?(РеализацияОС, ?(СписаниеОС, "ИЛИ ", "") + "ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг", "") + ?(Не СписаниеОС И Не РеализацияОС, "ЛОЖЬ", "") + ")
		|" + ?(КоррПТУ, "ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ
		|	ХозрасчетныйОборотыДтКт.Регистратор,
		|	ХозрасчетныйОборотыДтКт.СчетДт.Код КАК СчетДт,
		|	ХозрасчетныйОборотыДтКт.СчетКт.Код КАК СчетКт,
		|	"""" КАК ГуидРег,
		|	Неопределено КАК ОС,
		|	"""" КАК Код,
		|	"""" КАК ЗаводскойНомер,
		|	ПРЕДСТАВЛЕНИЕ(СпрНоменклатура.Ссылка) КАК Наименование,
		|	ХозрасчетныйОборотыДтКт.СуммаОборот КАК Сумма,
		|	""КоррПТУ"" КАК Раздел,
		|	СпрНоменклатура.ИД КАК ИД_номенклатуры
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, СчетДт В иерархии (ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.Материалы)), , , , ) КАК ХозрасчетныйОборотыДтКт
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО ХозрасчетныйОборотыДтКт.СубконтоДт1 = СпрНоменклатура.Ссылка
		|ГДЕ
		|	ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.КорректировкаПоступления
		|", "
		|") + "
		|" + ?(РеализацияОС, "ОБЪЕДИНИТЬ ВСЕ
		|ВЫБРАТЬ
		|	ХозрасчетныйОборотыДтКт.Регистратор,
		|	ХозрасчетныйОборотыДтКт.СчетДт.Код КАК СчетДт,
		|	ХозрасчетныйОборотыДтКт.СчетКт.Код КАК СчетКт,
		|	ПередачаОС.ИД_Фин КАК ГуидРег,
		|	ХозрасчетныйОборотыДтКт.СубконтоДт1 КАК ОС,
		|	ОсновныеСредства.Код,
		|	ВЫРАЗИТЬ(ОсновныеСредства.ЗаводскойНомер КАК СТРОКА(50)) КАК ЗаводскойНомер,
		|	ВЫРАЗИТЬ(ОсновныеСредства.Наименование КАК СТРОКА(100)) КАК Наименование,
		|	ХозрасчетныйОборотыДтКт.СуммаОборот КАК Сумма,
		|	""ПередачаОС"" КАК Раздел,
		|	СпрНоменклатураОС.ИД КАК ИД_номенклатуры
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.ОборотыДтКт(&НачалоПериода, &КонецПериода, Регистратор, , , СчетКт В (ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОСвОрганизации)), , ) КАК ХозрасчетныйОборотыДтКт
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПередачаОС КАК ПередачаОС
		|		ПО ХозрасчетныйОборотыДтКт.Регистратор = ПередачаОС.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ОсновныеСредства КАК ОсновныеСредства
		|		ПО ХозрасчетныйОборотыДтКт.СубконтоКт1 = ОсновныеСредства.Ссылка
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатураОС
		|		ПО ХозрасчетныйОборотыДтКт.СубконтоДт1 = СпрНоменклатураОС.Ссылка
		|ГДЕ
		|	ХозрасчетныйОборотыДтКт.Регистратор ССЫЛКА Документ.ПередачаОС
		|", "
		|") + "
		|";
		КонецЕсли;
		
		ТекстБух = ТекстБух + ";

		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Сводная.Регистратор,
		|	Сводная.СчетДт,
		|	Сводная.СчетКт,
		|	ПРЕДСТАВЛЕНИЕ(Сводная.Регистратор) КАК ДокБух,
		|	Сводная.ГуидРег,
		|	Сводная.ОС,
		|	Сводная.Код,
		|	Сводная.ЗаводскойНомер,
		|	Сводная.Наименование,
		|	СУММА(Сводная.Сумма) КАК Сумма,
		|	Сводная.Раздел,
		|	Сводная.ИД_номенклатуры
		|ИЗ
		|	Сводная КАК Сводная

		|СГРУППИРОВАТЬ ПО
		|	Сводная.Регистратор,
		|	Сводная.СчетДт,
		|	Сводная.СчетКт,
		|	ПРЕДСТАВЛЕНИЕ(Сводная.Регистратор),
		|	Сводная.ГуидРег,
		|	Сводная.ОС,
		|	Сводная.Код,
		|	Сводная.ЗаводскойНомер,
		|	Сводная.Наименование,
		|	Сводная.Раздел,
		|	Сводная.ИД_номенклатуры";
		
		ТаблицаДанныхБух = Новый ТаблицаЗначений;
		ТаблицаДанныхБух.Колонки.Добавить("ДокБух", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(400)));	
		ТаблицаДанныхБух.Колонки.Добавить("ГуидОС", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(36)));	
		ТаблицаДанныхБух.Колонки.Добавить("ГуидДок", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(36)));			
		ТаблицаДанныхБух.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15,2)));
		ТаблицаДанныхБух.Колонки.Добавить("ОСКод", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(9)));
		ТаблицаДанныхБух.Колонки.Добавить("ОСНаименование", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(100)));
		ТаблицаДанныхБух.Колонки.Добавить("ОСЗаводскойНомер", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(50)));
		ТаблицаДанныхБух.Колонки.Добавить("НоменклатураПредставление", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(100)));
		ТаблицаДанныхБух.Колонки.Добавить("НоменклатураИД", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(10,0)));
		ТаблицаДанныхБух.Колонки.Добавить("Раздел", Новый ОписаниеТипов("Строка", Новый КвалификаторыСтроки(36)));	
		ТаблицаДанныхБух.Колонки.Добавить("Обработан", Новый ОписаниеТипов("Булево"));
		ТаблицаДанныхБух.Колонки.Добавить("СчетДт", Новый ОписаниеТипов("ПланСчетовСсылка.Хозрасчетный"));
		ТаблицаДанныхБух.Колонки.Добавить("СчетКт", Новый ОписаниеТипов("ПланСчетовСсылка.Хозрасчетный"));
		
		Запрос.Текст = ТекстБух;
		
		Выборка = Запрос.Выполнить().Выбрать();
		
		Пока Выборка.Следующий() Цикл
			
			НовСтр = ТаблицаДанныхБух.Добавить();
			НовСтр.ГуидОС = v82.xmlСтрока(Выборка.ОС);
			НовСтр.ГуидДок = ?(ЗначениеЗаполнено(Выборка.ГуидРег), Выборка.ГуидРег, v82.xmlСтрока(Выборка.Регистратор));
			НовСтр.Сумма = Выборка.Сумма;
			НовСтр.ОСКод = Выборка.Код;
			НовСтр.ОСНаименование = Выборка.Наименование;
			НовСтр.ОСЗаводскойНомер = Выборка.ЗаводскойНомер;
			НовСтр.НоменклатураПредставление = Выборка.Наименование;
			НовСтр.НоменклатураИД = Выборка.ИД_Номенклатуры;
			НовСтр.Раздел = Выборка.Раздел;
			НовСтр.Обработан = Ложь;
			НовСтр.ДокБух = Выборка.ДокБух;
			НовСтр.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Выборка.СчетДт);
			НовСтр.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду(Выборка.СчетКт);
			
		КонецЦикла;
		
		//Сверка по номенклатуре
		ЗапросОбщий = Новый Запрос;
		ЗапросОБщий.УстановитьПараметр("ТаблицаФИн", ТаблицаДанныхФин);
		ЗапросОБщий.УстановитьПараметр("ТаблицаБух", ТаблицаДанныхБух);
		
		РазделыПономенклатуре = Новый Массив;
		РазделыПономенклатуре.Добавить("КоррПТУ");
		РазделыПономенклатуре.Добавить("РТУ");
		РазделыПономенклатуре.Добавить("ТН");
		ЗапросОбщий.УстановитьПараметр("РазделыПоНоменклатуре", РазделыПономенклатуре);
		
		ЗапросОбщий.Текст = "ВЫБРАТЬ
		                    |	ТаблицаФин.Раздел,
		                    |	ТаблицаФин.НоменклатураИД,
		                    |	ТаблицаФин.НоменклатураПредставление,
		                    |	ТаблицаФин.Сумма,
		                    |	ТаблицаФин.ГуидДок,
		                    |	ТаблицаФин.СчетДт,
		                    |	ТаблицаФин.СчетКт,
		                    |	ТаблицаФин.ДокФин
		                    |ПОМЕСТИТЬ ТаблицаФин
		                    |ИЗ
		                    |	&ТаблицаФин КАК ТаблицаФин
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |ВЫБРАТЬ
		                    |	ТаблицаБух.Раздел,
		                    |	ТаблицаБух.НоменклатураИД,
		                    |	ТаблицаБух.НоменклатураПредставление,
		                    |	ТаблицаБух.Сумма,
		                    |	ТаблицаБух.ГуидДок,
		                    |	ТаблицаБух.СчетДт,
		                    |	ТаблицаБух.СчетКт,
		                    |	ТаблицаБух.ДокБух
		                    |ПОМЕСТИТЬ ТаблицаБух
		                    |ИЗ
		                    |	&ТаблицаБух КАК ТаблицаБух
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |ВЫБРАТЬ
		                    |	ТаблицаФин.Раздел,
		                    |	ТаблицаФин.НоменклатураИД,
		                    |	ТаблицаФин.НоменклатураПредставление,
		                    |	СУММА(ТаблицаФин.Сумма) КАК Сумма,
		                    |	ТаблицаФин.ГуидДок,
		                    |	ТаблицаФин.СчетДт,
		                    |	ТаблицаФин.СчетКт,
		                    |	ТаблицаФин.ДокФин
		                    |ПОМЕСТИТЬ ТаблицаФинПодготовленная
		                    |ИЗ
		                    |	ТаблицаФин КАК ТаблицаФин
		                    |ГДЕ
		                    |	ТаблицаФин.Раздел В(&РазделыПоНоменклатуре)
		                    |
		                    |СГРУППИРОВАТЬ ПО
		                    |	ТаблицаФин.Раздел,
		                    |	ТаблицаФин.НоменклатураИД,
		                    |	ТаблицаФин.НоменклатураПредставление,
		                    |	ТаблицаФин.ГуидДок,
		                    |	ТаблицаФин.СчетДт,
		                    |	ТаблицаФин.СчетКт,
		                    |	ТаблицаФин.ДокФин
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |ВЫБРАТЬ
		                    |	ТаблицаБух.Раздел,
		                    |	ТаблицаБух.НоменклатураИД,
		                    |	ТаблицаБух.НоменклатураПредставление,
		                    |	СУММА(ТаблицаБух.Сумма) КАК Сумма,
		                    |	ТаблицаБух.ГуидДок,
		                    |	ТаблицаБух.ДокБух,
		                    |	ТаблицаБух.СчетКт,
		                    |	ТаблицаБух.СчетДт
		                    |ПОМЕСТИТЬ ТаблицаБухПодготовленная
		                    |ИЗ
		                    |	ТаблицаБух КАК ТаблицаБух
		                    |ГДЕ
		                    |	ТаблицаБух.Раздел В(&РазделыПоНоменклатуре)
		                    |
		                    |СГРУППИРОВАТЬ ПО
		                    |	ТаблицаБух.Раздел,
		                    |	ТаблицаБух.НоменклатураИД,
		                    |	ТаблицаБух.НоменклатураПредставление,
		                    |	ТаблицаБух.ГуидДок,
		                    |	ТаблицаБух.ДокБух,
		                    |	ТаблицаБух.СчетКт,
		                    |	ТаблицаБух.СчетДт
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |УНИЧТОЖИТЬ ТаблицаФин
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |УНИЧТОЖИТЬ ТаблицаБух
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |ВЫБРАТЬ
		                    |	ЕСТЬNULL(ТаблицаФинПодготовленная.Раздел, ТаблицаБухПодготовленная.Раздел) КАК Раздел,
		                    |	ЕСТЬNULL(ТаблицаФинПодготовленная.НоменклатураПредставление, """") КАК НоменклатураФин,
		                    |	ЕСТЬNULL(ТаблицаБухПодготовленная.НоменклатураПредставление, """") КАК НоменклатураБух,
		                    |	ЕСТЬNULL(ТаблицаФинПодготовленная.Сумма, 0) КАК СуммаФин,
		                    |	ЕСТЬNULL(ТаблицаБухПодготовленная.Сумма, 0) КАК СуммаБух,
		                    |	ЕСТЬNULL(ТаблицаФинПодготовленная.ДокФин, """") КАК ДокФин,
		                    |	ЕСТЬNULL(ТаблицаБухПодготовленная.ДокБух, ""Документ не найден!!!"") КАК ДокБух,
		                    |	ЕСТЬNULL(ТаблицаФинПодготовленная.СчетДт, ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПустаяСсылка)) КАК СчетДтФин,
		                    |	ЕСТЬNULL(ТаблицаФинПодготовленная.СчетКт, ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПустаяСсылка)) КАК СчетКтФин,
		                    |	ЕСТЬNULL(ТаблицаБухПодготовленная.СчетДт, ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)) КАК СчетДтБух,
		                    |	ЕСТЬNULL(ТаблицаБухПодготовленная.СчетКт, ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка)) КАК СчетКтБух
		                    |ПОМЕСТИТЬ Сводная
		                    |ИЗ
		                    |	ТаблицаФинПодготовленная КАК ТаблицаФинПодготовленная
		                    |		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаБухПодготовленная КАК ТаблицаБухПодготовленная
		                    |		ПО ТаблицаФинПодготовленная.Раздел = ТаблицаБухПодготовленная.Раздел
		                    |			И ТаблицаФинПодготовленная.НоменклатураИД = ТаблицаБухПодготовленная.НоменклатураИД
		                    |			И ТаблицаФинПодготовленная.ГуидДок = ТаблицаБухПодготовленная.ГуидДок
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |УНИЧТОЖИТЬ ТаблицаФинПодготовленная
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |УНИЧТОЖИТЬ ТаблицаБухПодготовленная
		                    |;
		                    |
		                    |////////////////////////////////////////////////////////////////////////////////
		                    |ВЫБРАТЬ
		                    |	ВЫБОР
		                    |		КОГДА Сводная.Раздел = ""КоррПТУ""
		                    |			ТОГДА ""Корректировка ПТУ""
		                    |		КОГДА Сводная.Раздел = ""СписаниеОС""
		                    |				ИЛИ Сводная.Раздел = ""ТН""
		                    |			ТОГДА ""Списание ОС""
		                    |		КОГДА Сводная.Раздел = ""ПередачаОС""
		                    |				ИЛИ Сводная.Раздел = ""РТУ""
		                    |			ТОГДА ""Реализация ОС""
		                    |		ИНАЧЕ """"
		                    |	КОНЕЦ КАК Раздел,
		                    |	Сводная.НоменклатураФин,
		                    |	Сводная.НоменклатураБух,
		                    |	Сводная.СуммаФин,
		                    |	Сводная.СуммаБух,
		                    |	Сводная.ДокФин КАК ДокументФин,
		                    |	Сводная.ДокБух КАК ДокументБух,
		                    |	Сводная.СчетДтФин,
		                    |	Сводная.СчетКтФин,
		                    |	Сводная.СчетДтБух,
		                    |	Сводная.СчетКтБух
		                    |ИЗ
		                    |	Сводная КАК Сводная";
		
		 Выборка = ЗапросОБщий.Выполнить().Выбрать();
		 
		 Пока Выборка.Следующий() ЦИкл
			 НовСтр = СводнаяТаблица.Добавить();
			 ЗаполнитьЗначенияСвойств(НовСтр, Выборка);
		 КонецЦикла;
		 
		 //Разделы по ОС
		 СтруктураПоиска = Новый Структура;
		 
		 Для Каждого Стр Из ТаблицаДанныхФин Цикл
			 
			 Если НЕ Стр.Раздел = "ПередачаОС" И НЕ Стр.Раздел = "СписаниеОС" Тогда
				 Продолжить;
			 Конецесли;
			 
			 НайдСтр = Неопределено; 
			 
			 СтруктураПоиска.Вставить("Раздел", Стр.Раздел);
			 СтруктураПоиска.Вставить("Обработан", Ложь);
			 
			 //1.Гуид
			 СтруктураПоиска.Вставить("ГуидОС", Стр.ГуидОС);
			 
			 НайдСтроки = ТаблицаДанныхБух.НайтиСтроки(СтруктураПоиска);
			 
			 //2.Заводской, наименование
			 Если НайдСтроки.Количество() = 0 Тогда
				 СтруктураПоиска.Удалить("ГуидОС");			 
				 
				 Если ЗначениеЗаполнено(Стр.ОСЗаводскойНомер) Тогда
					 СтруктураПоиска.Вставить("ОСЗаводскойНомер", Стр.ОСЗаводскойНомер);
					 СтруктураПоиска.Вставить("ОСНаименование", Стр.ОСНаименование);
					 
					 НайдСтроки = ТаблицаДанныхБух.НайтиСтроки(СтруктураПоиска);
				 КонецЕсли;
				 
				 //3.Код, наименование
				 Если НайдСтроки.Количество() = 0 Тогда
					 
					 СтруктураПоиска.Удалить("ОСЗаводскойНомер");
					 СтруктураПоиска.Вставить("ОСКод", Стр.ОСКод);
					 СтруктураПоиска.Вставить("ОСНаименование", Стр.ОСНаименование);
					 
					 НайдСтроки = ТаблицаДанныхБух.НайтиСтроки(СтруктураПоиска);
					 
					 //4.Код
					 Если НайдСтроки.Количество() = 0 Тогда			
						 СтруктураПоиска.Удалить("ОСНаименование", Стр.ОСНаименование);
						 НайдСтр = ТаблицаДанныхБух.Найти(Стр.ОСКод, "ОСКод");
					 Иначе
						 НайдСтр = НайдСтроки[0];
					 КонецЕсли;
				 Иначе
					 НайдСтр = НайдСтроки[0];
				 КонецЕсли;
			 Иначе
				 НайдСтр = НайдСтроки[0];
			 КонецЕсли;
			 
			 НовСтр = СводнаяТаблица.Добавить();
			 НовСтр.ДокументФИн = Стр.ДокФин;
			 НовСтр.СуммаФин = Стр.Сумма;
			 НовСтр.НоменклатураФин = Стр.ОСНаименование;
			 НовСтр.Раздел = Стр.Раздел;
			 НовСтр.СчетДтФин = Стр.СчетДт;
			 НовСтр.СчетКтФин = Стр.СчетКт;
			 
			 Если НЕ НайдСтр = Неопределено Тогда
				 
				 НовСтр.ДокументБух = НайдСтр.ДокБух;
				 НовСтр.СуммаБух = НайдСтр.сумма;
				 НовСтр.НоменклатураБух = НайдСтр.ОСНаименование;
				 НовСтр.СчетДтБух = НайдСтр.СчетДт;
				 НовСтр.СчетКтБух = НайдСтр.СчетКт;
				 
				 НайдСтр.Обработан = Истина;
				 
			 Иначе
				 
				 НовСтр.ДокументБух = "Документ не найден!!!";
				 НовСтр.СуммаБух = 0;
				 
			 КонецЕсли;
			 
		 КонецЦикла;			
					
	КонецЕсли;	
		
	//Из схемы возьмем настройки по умолчанию
	Настройки = КомпоновщикНастроек.Настройки;

	//Помещаем в переменную данные о расшифровке данных
	ДанныеРасшифровки = Новый ДанныеРасшифровкиКомпоновкиДанных;

	//Формируем макет, с помощью компоновщика макета
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;

	//Передаем в макет компоновки схему, настройки и данные расшифровки
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных,
											Настройки, ДанныеРасшифровки);

	ВнешниеНаборыДанных=Новый Структура;

	ВнешниеНаборыДанных.Вставить("СводнаяТаблица",СводнаяТаблица);										
											
	//Выполним компоновку с помощью процессора компоновки
	ПроцессорКомпоновкиДанных = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки,ВнешниеНаборыДанных,
													   ДанныеРасшифровки);

	//Очищаем поле табличного документа

	//Выводим результат в табличный документ
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ДокументРезультат);

	ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);

КонецПроцедуры

