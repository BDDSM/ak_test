
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ОбОтч=Отчеты.АК_ПересортицаПоДнОтгрузкам.Создать();
	Макет = ОбОтч.ПолучитьМакет("Расшифровка");
	ТабДок.Очистить();
	Область = Макет.ПолучитьОбласть("Шапка");
	ТабДок.Вывести(Область);
	Сумма=0;
	ТЗИтог=ХранилищеОбщихНастроек.Загрузить("АК_ТЗИтогИзб");
	МасБезПересчета=ХранилищеОбщихНастроек.Загрузить("МасБезПересчета");
	Если ТЗИтог<>Неопределено Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	РасходныйОрдерСклад.Ссылка,
			|	РасходныйОрдерСклад.СборкаТерминаломЗакончена
			|ИЗ
			|	Документ.РасходныйОрдерСклад КАК РасходныйОрдерСклад
			|ГДЕ
			|	РасходныйОрдерСклад.Ссылка В(&Ссылка)";

		Запрос.УстановитьПараметр("Ссылка", ТЗИтог.ВыгрузитьКолонку("Расходник"));

		ТЗРасходники = Запрос.Выполнить().Выгрузить();
	КонецЕсли;
	
	
	Если ТЗИтог<>Неопределено Тогда
		Для каждого СтрокаДанных Из ТЗИтог Цикл
			Если Параметры.Режим=1 Тогда
				Если СтрокаДанных.ПриемкаТовараБезПересчета=Истина Тогда
					Продолжить;
				КонецЕсли; 
			ИначеЕсли Параметры.Режим=2 Тогда
	
				Если СтрокаДанных.ПриемкаТовараБезПересчета=Ложь ИЛИ 
					(СтрокаДанных.ПриемкаТовараБезПересчета=Истина И Не МасБезПересчета.Найти(СтрокаДанных.ТорговаяТочка)=Неопределено) Тогда
					Продолжить;
				КонецЕсли; 
			ИначеЕсли Параметры.Режим=3 Тогда
	
				Если СтрокаДанных.ПриемкаТовараБезПересчета=Ложь ИЛИ 
					(СтрокаДанных.ПриемкаТовараБезПересчета=Истина И МасБезПересчета.Найти(СтрокаДанных.ТорговаяТочка)=Неопределено) Тогда
					Продолжить;
				КонецЕсли; 
				
			КонецЕсли; 
			Сумма=Сумма+СтрокаДанных.НехваткаКоробок;
			Область = Макет.ПолучитьОбласть("Строка");
			Область.Параметры.Заполнить(СтрокаДанных);
			Попытка
				Область.Параметры.СоСканером=ТЗРасходники.НайтиСтроки(Новый Структура("Ссылка",СтрокаДанных.Расходник))[0].СборкаТерминаломЗакончена;
			Исключение
			КонецПопытки;
			ТабДок.Вывести(Область);
		КонецЦикла;
	КонецЕсли;
КонецПроцедуры
