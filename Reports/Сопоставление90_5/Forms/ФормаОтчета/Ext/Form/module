
Процедура МесяцСтрокойОчистка(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	МесяцСверки = НачалоМесяца(ТекущаяДата());
	МесяцСтрокой = Формат(МесяцСверки, "ДФ='MMMM yy'");
	
КонецПроцедуры

Процедура МесяцСтрокойРегулирование(Элемент, Направление, СтандартнаяОбработка)
	
	МесяцСверки = ДобавитьМесяц(МесяцСверки, Направление);
	МесяцСтрокой = Формат(МесяцСверки, "ДФ='MMMM yy'");
	
КонецПроцедуры

Процедура ДействияФормыСформировать(Кнопка)
	
	Если НЕ ЗначениеЗаполнено(Организация) Тогда
		Сообщить("Не выбрана организация для сверки");
		Возврат;
	КонецЕсли;	
	
	ЭлементыФормы.ПолеОтчета.Очистить();
	
	Макет = ПолучитьМакет("Отчет");
	Область = Макет.ПолучитьОбласть("Шапка");
	Область.Параметры.МесяцСверки = МесяцСтрокой;
	ЭлементыФормы.ПолеОтчета.Вывести(Область);
	
	СтрокаПодключения=ПолныеПрава.ПолучитьСтрокуПодключения_Бух();
	
	v82COMОбъект = Новый COMОбъект(ПолныеПрава.ПолучитьВерсиюКомОбъекта_Бух() + ".COMConnector");
	Попытка
		v82 = v82COMОбъект.Connect(СтрокаПодключения);
		ПодключениеУстановлено=Истина;
	Исключение
		ПодключениеУстановлено=Ложь;
		Сообщить("Не удалось подключиться к базе бухгалтерии!");
		Возврат;
	КонецПопытки;
	
	//+++АК Susk (Суслин К.В.) 2018.06.05 ИП-00018793	 
	МДНом = v82.XMLTypeOf(v82.Справочники.Номенклатура.ПустаяСсылка());
	МДПДР = v82.XMLTypeOf(v82.Справочники.ПрочиеДоходыИРасходы.ПустаяСсылка());
	//---АК Susk (Суслин К.В.) 
	
	ТабСопоставление = Новый ТаблицаЗначений();
	ТабСопоставление.Колонки.Добавить("Вид");
	ТабСопоставление.Колонки.Добавить("СуммаБух");
	ТабСопоставление.Колонки.Добавить("СуммаФин");
	ТабСопоставление.Колонки.Добавить("ТипФин");
	
	ЗапросБухия = v82.NewObject("Запрос");
	ЗапросБухия.УстановитьПараметр("ДатаНач", НачалоМесяца(МесяцСверки));
	ЗапросБухия.УстановитьПараметр("ДатаКон", КонецМесяца(МесяцСверки));
	//+++АК Susk (Суслин К.В.) 2018.05.22 ИП-00018793
	//+оптимизация
	ЗапросБухия.УстановитьПараметр("Орг", ПолучитьОрганизациюБух(Организация, v82)); 
	ЗапросБухия.УстановитьПараметр("СчетДт", v82.ПланыСчетов.Хозрасчетный.РасчетыСПокупателями); //62.01
	ЗапросБухия.УстановитьПараметр("СчетКт", v82.ПланыСчетов.Хозрасчетный.ВыручкаНеЕНВД); //90.01.1
	ЗапросБухия.УстановитьПараметр("Свойство1", v82.ПланыВидовХарактеристик.СвойстваОбъектов.НайтиПоНаименованию("Это документ перепродажи", Истина));
	ЗапросБухия.УстановитьПараметр("Свойство2", v82.ПланыВидовХарактеристик.СвойстваОбъектов.НайтиПоНаименованию("Это документ перепродажи по 10.01", Истина));	
	
	ЗапросБухия.УстановитьПараметр("ЭтоОрганизацияТилси", ЭтоОрганизацияТилси());
	ЗапросБухия.УстановитьПараметр("СтатьяРеализацияОС", v82.XMLValue(v82.FromXMLType(МДПДР), "047452b5-f6ee-11df-9731-001e5848397d")); //Доходы (расходы), связанные с реализацией основных средств
		
	МассивАренда = v82.NewObject("Массив");
	МассивАренда.Добавить(v82.XMLValue(v82.FromXMLType(МДНом),"6c6750ae-d70b-11e1-8a91-000c29e4e694")); //Аренда помещений, код 00000001174
	
	ЗапросБухия.УстановитьПараметр("Аренда", МассивАренда);
	ЗапросБухия.УстановитьПараметр("ДоходыПоАренде", v82.XMLValue(v82.FromXMLType(МДПДР),"047452b0-f6ee-11df-9731-001e5848397d")); //Доходы (расходы), связанные со сдачей имущества в аренду (субаренду)	
	ЗапросБухия.УстановитьПараметр("Счет91_01", v82.ПланыСчетов.Хозрасчетный.ПрочиеДоходы); //91.01
	ЗапросБухия.УстановитьПараметр("Счет91_02", v82.ПланыСчетов.Хозрасчетный.ПрочиеРасходы); //91.02
	ЗапросБухия.УстановитьПараметр("Счет76_03", v82.ПланыСчетов.Хозрасчетный.РасчетыПоПричитающимсяДивидендам); //76.03
	ЗапросБухия.УстановитьПараметр("Счет76_02", v82.ПланыСчетов.Хозрасчетный.РасчетыПоПретензиям); //76.02
	//---АК Susk (Суслин К.В.) 
	
	ЗапросБухия.Текст = "ВЫБРАТЬ
						|	СУММА(ХозрасчетныйДвиженияССубконто.Сумма) КАК Сумма,
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор) КАК Тип,						
						|	ЕСТЬNULL(ЗначенияСвойствОбъектов.Значение, ЛОЖЬ) КАК ЭтоПерепродажа,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоСубАренда,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоДепозиты
						|ИЗ
						|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|			&ДатаНач,
						|			&ДатаКон,
						|			Организация = &Орг
						|				И СчетДт = &СчетДт
						|				И СчетКт = &СчетКт,
						|			,
						|			) КАК ХозрасчетныйДвиженияССубконто
						|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
						|		ПО ХозрасчетныйДвиженияССубконто.Регистратор = ЗначенияСвойствОбъектов.Объект
						|			И (ЗначенияСвойствОбъектов.Свойство В (&Свойство1, &Свойство2))
						|ГДЕ НЕ ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.ВозвратТоваровОтПокупателя
                        |
						|СГРУППИРОВАТЬ ПО
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор),
						|	ЕСТЬNULL(ЗначенияСвойствОбъектов.Значение, ЛОЖЬ)
						|
						|ОБЪЕДИНИТЬ ВСЕ
						|
						|ВЫБРАТЬ
						|	СУММА(ХозрасчетныйДвиженияССубконто.Сумма) КАК Сумма,
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор) КАК Тип,
						|	ЕСТЬNULL(ЗначенияСвойствОбъектов.Значение, ЛОЖЬ) КАК ЭтоПерепродажа,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоСубАренда,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоДепозиты
						|ИЗ
						|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|			&ДатаНач,
						|			&ДатаКон,
						|			Организация = &Орг
						|				И СчетДт = &Счет76_02
						|				И СчетКт = &Счет91_01,
						|			,
						|			) КАК ХозрасчетныйДвиженияССубконто
						|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
						|		ПО ХозрасчетныйДвиженияССубконто.Регистратор = ЗначенияСвойствОбъектов.Объект
						|			И (ЗначенияСвойствОбъектов.Свойство В (&Свойство1, &Свойство2))
						|ГДЕ ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
                        |
						|СГРУППИРОВАТЬ ПО
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор),
						|	ЕСТЬNULL(ЗначенияСвойствОбъектов.Значение, ЛОЖЬ)
						
						//+++АК Susk (Суслин К.В.) 2018.05.22 ИП-00018793
						|ОБЪЕДИНИТЬ ВСЕ
						|
						|ВЫБРАТЬ
						|	-СУММА(ХозрасчетныйДвиженияССубконто.Сумма) КАК Сумма,
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор) КАК Тип,
						|	ЛОЖЬ КАК ЭтоПерепродажа,
						|	ЛОЖЬ КАК ЭтоСубАренда,
						|	ЛОЖЬ КАК ЭтоДепозиты
						|ИЗ
						|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|			&ДатаНач,
						|			&ДатаКон,
						|			Организация = &Орг 
						//+++АК Susk (Суслин К.В.) 2018.11.21 костыли												   
						//|			И &ЭтоОрганизацияТилси
						//---АК Susk (Суслин К.В.) 
						|				И СчетДт = &СчетДт
						|				И СчетКт = &СчетКт,
						|			,
						|			) КАК ХозрасчетныйДвиженияССубконто						
						|ГДЕ ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.ВозвратТоваровОтПокупателя 
                        |
						|СГРУППИРОВАТЬ ПО
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор)
						//---АК Susk (Суслин К.В.) 						 
						
						|
						|ОБЪЕДИНИТЬ ВСЕ
						|
						|ВЫБРАТЬ
						|	СУММА(ХозрасчетныйДвиженияССубконто.Сумма) КАК Сумма,
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор) КАК Тип,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоПерепродажа,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоСубАренда,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоДепозиты
						|ИЗ
						|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|			&ДатаНач,
						|			&ДатаКон,
						|			Организация = &Орг
						|				И СчетКт = &Счет91_01,
						|			,
						|			) КАК ХозрасчетныйДвиженияССубконто
						|ГДЕ ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.ПередачаОС
                        |
						|СГРУППИРОВАТЬ ПО
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор)
                        |
						|ОБЪЕДИНИТЬ ВСЕ
						|
						|ВЫБРАТЬ
						|	СУММА(ХозрасчетныйДвиженияССубконто.Сумма) КАК Сумма,
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор) КАК Тип,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоПерепродажа,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоСубАренда,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоДепозиты
						|ИЗ
						|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|			&ДатаНач,
						|			&ДатаКон,
						|			Организация = &Орг
						|				И СчетДт = &СчетДт
						|				И СчетКт = &Счет91_01,
						|			,
						|			) КАК ХозрасчетныйДвиженияССубконто
                        |
						|ГДЕ ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
						|	И НЕ (СубконтоКт1 = &ДоходыПоАренде
						//+++АК Susk (Суслин К.В.) 2018.06.05 ИП-00018793						 
						|					И СубконтоКт2 В (&Аренда)) И НЕ СубконтоКт1 = &СтатьяРеализацияОС
						//---АК Susk (Суслин К.В.) 
						|
						|СГРУППИРОВАТЬ ПО
						|	ТИПЗНАЧЕНИЯ(ХозрасчетныйДвиженияССубконто.Регистратор)
						
						//+++АК Susk (Суслин К.В.) 2018.06.05 ИП-00018793
						|ОБЪЕДИНИТЬ ВСЕ
                        |
						|ВЫБРАТЬ
						|	СУММА(ХозрасчетныйДвиженияССубконто.Сумма) КАК Сумма,
						|	ТИПЗНАЧЕНИЯ(ЗНАЧЕНИЕ(Документ.ПередачаОС.ПустаяСсылка)) КАК Тип,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоПерепродажа,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоСубАренда,
						|	МАКСИМУМ(ЛОЖЬ) КАК ЭтоДепозиты
						|ИЗ
						|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|			&ДатаНач,
						|			&ДатаКон,
						|			Организация = &Орг
						|				И СчетДт = &СчетДт
						|				И СчетКт = &Счет91_01,
						|			,
						|			) КАК ХозрасчетныйДвиженияССубконто
                        |
						|ГДЕ ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
						|	И СубконтоКт1 = &СтатьяРеализацияОС 
						|
						|СГРУППИРОВАТЬ ПО
						|	ТИПЗНАЧЕНИЯ(ЗНАЧЕНИЕ(Документ.ПередачаОС.ПустаяСсылка))
						//---АК Susk (Суслин К.В.) 						 
						|
						|ОБЪЕДИНИТЬ ВСЕ
                        |
						|ВЫБРАТЬ
						|	СУММА(ВЗ_Запрос.Сумма),
						|	МАКСИМУМ(НЕОПРЕДЕЛЕНО),
						|	МАКСИМУМ(ЛОЖЬ),
						|	МАКСИМУМ(ИСТИНА),
						|	МАКСИМУМ(ЛОЖЬ)
						|ИЗ
						|	(ВЫБРАТЬ
						|		ХозрасчетныйДвиженияССубконто.Сумма КАК Сумма
						|	ИЗ
						|		РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|				&ДатаНач,
						|				&ДатаКон,
						|				Организация = &Орг
						|					И СчетКт = &Счет91_01
						|					И СубконтоКт1 = &ДоходыПоАренде
						|					И СубконтоКт2 В (&Аренда),
						|				,
						|				) КАК ХозрасчетныйДвиженияССубконто
						|	ГДЕ
						|		ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
						|	
						|	ОБЪЕДИНИТЬ ВСЕ
						|	
						|	ВЫБРАТЬ
						|		ХозрасчетныйДвиженияССубконто.Сумма * -1
						|	ИЗ
						|		РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|				&ДатаНач,
						|				&ДатаКон,
						|				Организация = &Орг
						|					И СчетДт = &Счет91_02
						|					И СубконтоДт1 = &ДоходыПоАренде
						|					И СубконтоДт2 В (&Аренда),
						|				,
						|				) КАК ХозрасчетныйДвиженияССубконто
						|	ГДЕ
						|		ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг) КАК ВЗ_Запрос
						|
						|ОБЪЕДИНИТЬ ВСЕ
						|
						|ВЫБРАТЬ
						|	СУММА(ХозрасчетныйДвиженияССубконто.Сумма) КАК Сумма,
						//+++АК Susk (Суслин К.В.) 2018.07.16 						 
						//|	МАКСИМУМ(НЕОПРЕДЕЛЕНО),
						|	ХозрасчетныйДвиженияССубконто.Регистратор,
						//---АК Susk (Суслин К.В.) 
						|	МАКСИМУМ(ЛОЖЬ),
						|	МАКСИМУМ(ЛОЖЬ),
						|	МАКСИМУМ(ИСТИНА)
						|ИЗ
						|	РегистрБухгалтерии.Хозрасчетный.ДвиженияССубконто(
						|			&ДатаНач,
						|			&ДатаКон,
						|			Организация = &Орг
						|				И СчетДт = &Счет76_03
						|				И СчетКт = &Счет91_01,
						|			,
						|			) КАК ХозрасчетныйДвиженияССубконто
						|ГДЕ
						|	ХозрасчетныйДвиженияССубконто.Регистратор ССЫЛКА Документ.ОперацияБух
						|СГРУППИРОВАТЬ ПО
						|	ХозрасчетныйДвиженияССубконто.Регистратор";
						
	ВыборкаБух = ЗапросБухия.Выполнить().Выбрать();
	Пока ВыборкаБух.Следующий() Цикл
		Если ВыборкаБух.Сумма = Null Тогда
			Продолжить;
		КонецЕсли;	
		ТипБух = v82.String(ВыборкаБух.Тип);
		Если ТипБух = "Реализация товаров и услуг"
			И ВыборкаБух.ЭтоПерепродажа Тогда
			СтрокаСопоставление = ТабСопоставление.Найти("Реализация (внутренняя перепродажа)", "Вид");
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = "Реализация (внутренняя перепродажа)";
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;
			СтрокаСопоставление.СуммаБух = СтрокаСопоставление.СуммаБух + ВыборкаБух.Сумма;
		ИначеЕсли ТипБух = "Передача ОС" Тогда
			СтрокаСопоставление = ТабСопоставление.Найти("Реализация ОС", "Вид");
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = "Реализация ОС";
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;
			СтрокаСопоставление.СуммаБух = СтрокаСопоставление.СуммаБух + ВыборкаБух.Сумма;
		ИначеЕсли ВыборкаБух.ЭтоСубАренда Тогда
			СтрокаСопоставление = ТабСопоставление.Найти("Начисление арендной платы арендаторам", "Вид");
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = "Начисление арендной платы арендаторам";
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;
			СтрокаСопоставление.СуммаБух = СтрокаСопоставление.СуммаБух + ВыборкаБух.Сумма;
		ИначеЕсли ВыборкаБух.ЭтоДепозиты Тогда
			
			//+++АК Susk (Суслин К.В.) 2018.06.01 ИП-00018793
			ГуидБП = v82.String(ВыборкаБух.Тип.УникальныйИдентификатор());
			ДокНП = Документы.НачислениеПроцентовПоДоговорам.ПолучитьСсылку(Новый УникальныйИдентификатор(ГуидБП));
			ВидДок = Неопределено;
			
			Если ДокНП.ПолучитьОбъект() = Неопределено Тогда
				ДокНп = Документы.Операция.ПолучитьСсылку(Новый УникальныйИдентификатор(ГуидБП));
				
				Если ДокНП.ПолучитьОбъект() = Неопределено Тогда
					ВидДок = "Операция";					
				КонецЕсли;                                  		
				
			КонецЕсли;

			Если ВидДок = Неопределено Тогда
				ВидДок = ?(НачалоМесяца(МесяцСверки) >= Дата("20171031"), "Начисление процентов по договорам", "Операция");
			КонецЕсли;
						
			//СтрокаСопоставление = ТабСопоставление.Найти("Операция", "Вид");
			СтрокаСопоставление = ТабСопоставление.Найти(ВидДок, "Вид");
			//---АК Susk (Суслин К.В.) 
			
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = ВидДок; // "Операция"; +++AK susk
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;
			СтрокаСопоставление.СуммаБух = СтрокаСопоставление.СуммаБух + ВыборкаБух.Сумма;	
		Иначе
			СтрокаСопоставление = ТабСопоставление.Найти(ТипБух, "Вид");
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = ТипБух;
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;	
			СтрокаСопоставление.СуммаБух = СтрокаСопоставление.СуммаБух + ВыборкаБух.Сумма;
		КонецЕсли;	
	КонецЦикла;
	
	ЗапросФин = Новый Запрос();
	ЗапросФин.УстановитьПараметр("Орг", Организация);
	ЗапросФин.УстановитьПараметр("ДатаНач", НачалоМесяца(МесяцСверки));
	ЗапросФин.УстановитьПараметр("ДатаКон", КонецМесяца(МесяцСверки));
	
	//+++АК Susk (Суслин К.В.) 2018.05.22 ИП-00018793	
	 
	//ЗапросФин.УстановитьПараметр("Счет1", ПланыСчетов.Финансовый.НайтиПоКоду("90.5"));
	ЗапросФин.УстановитьПараметр("Счет1", Возврат90СчетаВЗависимостиОтОрганизации());  //90.4
	ЗапросФин.УстановитьПараметр("ЭтоОрганизацияТилси", ЭтоОрганизацияТилси());
	ЗапросФин.УстановитьПараметр("Счет621", ПланыСчетов.Финансовый.РасчетыСПокупателямиПрочие); //62.1
	ЗапросФин.УстановитьПараметр("Счет904", ПланыСчетов.Финансовый.ВыручкаТорговыхТочек); //62.1
	//---АК Susk (Суслин К.В.) 	
	
	ЗапросФин.УстановитьПараметр("Счет2", ПланыСчетов.Финансовый.НайтиПоКоду("96.1"));
	ЗапросФин.Текст = "ВЫБРАТЬ
	                  |	СУММА(ФинансовыйДвиженияССубконто.Сумма) КАК Сумма,
					  //+++АК Susk (Суслин К.В.) 2018.05.22 ИП-00018793
					  |	ВЫБОР
	                  |		КОГДА ФинансовыйДвиженияССубконто.Регистратор ССЫЛКА Документ.Операция
	                  |			ТОГДА ВЫБОР
	                  |					КОГДА Операция.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДокументаОперация.НачислениеПроцентовПоДепозитамЗаймам)
	                  |						ТОГДА ТИПЗНАЧЕНИЯ(ЗНАЧЕНИЕ(Документ.НачислениеПроцентовПоДоговорам.ПустаяСсылка))
	                  |					ИНАЧЕ ТИПЗНАЧЕНИЯ(ЗНАЧЕНИЕ(Документ.Операция.ПустаяСсылка))
	                  |				КОНЕЦ
	                  |		ИНАЧЕ ТИПЗНАЧЕНИЯ(ФинансовыйДвиженияССубконто.Регистратор)
	                  |	КОНЕЦ КАК Тип,
					  //---АК Susk (Суслин К.В.) 
	                  |	ВЫБОР
	                  |		КОГДА ФинансовыйДвиженияССубконто.Регистратор ССЫЛКА Документ.ЗакрытиеМесяца
	                  |				И ВЫРАЗИТЬ(ФинансовыйДвиженияССубконто.Регистратор КАК Документ.ЗакрытиеМесяца).ВидЗакрытия = 11
	                  |			ТОГДА ИСТИНА
	                  |		ИНАЧЕ ЛОЖЬ
	                  |	КОНЕЦ КАК ЭтоПерепродажа
	                  |ИЗ
	                  |	РегистрБухгалтерии.Финансовый.ДвиженияССубконто(
	                  |			&ДатаНач,
	                  |			&ДатаКон,
					   //+++АК Susk (Суслин К.В.) 2018.05.22 ИП-00018793
					  |			ВЫБОР
	                  |					КОГДА &ЭтоОрганизацияТилси
	                  |						ТОГДА ВЫБОР
	                  |								КОГДА Регистратор ССЫЛКА Документ.ВозвратТоваровОтПокупателя
	                  |									ТОГДА СчетДт В (&Счет1, &Счет2)
	                  |								ИНАЧЕ СчетКт В (&Счет1, &Счет2)
	                  |							КОНЕЦ
					  //+++АК Susk (Суслин К.В.) 2018.11.21 костыли					   
					  |					КОГДА НЕ &ЭтоОрганизацияТилси 
					  |						ТОГДА ВЫБОР
	                  |								КОГДА Регистратор ССЫЛКА Документ.ВозвратТоваровОтПокупателя
	                  |									ТОГДА СчетДт В (&Счет1) И СчетКт В (&Счет621)
					  |								КОГДА Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
					  |									ТОГДА ВЫБОР КОГДА ВЫРАЗИТЬ(СубконтоДт2 КАК Справочник.Контрагенты).ИДКурьераПоДоставке <> 0 ТОГДА
					  |										СчетДт В (&Счет621) И СчетКт В (&Счет904) ИНАЧЕ СчетКт В (&Счет1, &Счет2) КОНЕЦ
	                  |								ИНАЧЕ СчетКт В (&Счет1, &Счет2)
	                  |							КОНЕЦ
					  //---АК Susk (Суслин К.В.) 
	                  |					ИНАЧЕ СчетКт В (&Счет1, &Счет2)
	                  |				КОНЕЦ
					  //---АК Susk (Суслин К.В.) 
	                  |				И Организация = &Орг,
	                  |			,
	                  |			) КАК ФинансовыйДвиженияССубконто
	                  |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.Операция КАК Операция
	                  |		ПО ФинансовыйДвиженияССубконто.Регистратор = Операция.Ссылка
	                  |ГДЕ
	                  |	НЕ ФинансовыйДвиженияССубконто.Регистратор ССЫЛКА Документ.ДисконтированиеДепозитовПоАрендеНедвижимости
	                  |
	                  |СГРУППИРОВАТЬ ПО
	                  |	ВЫБОР
	                  |		КОГДА ФинансовыйДвиженияССубконто.Регистратор ССЫЛКА Документ.ЗакрытиеМесяца
	                  |				И ВЫРАЗИТЬ(ФинансовыйДвиженияССубконто.Регистратор КАК Документ.ЗакрытиеМесяца).ВидЗакрытия = 11
	                  |			ТОГДА ИСТИНА
	                  |		ИНАЧЕ ЛОЖЬ
	                  |	КОНЕЦ,
	                  |	ВЫБОР
	                  |		КОГДА ФинансовыйДвиженияССубконто.Регистратор ССЫЛКА Документ.Операция
	                  |			ТОГДА ВЫБОР
	                  |					КОГДА Операция.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийДокументаОперация.НачислениеПроцентовПоДепозитамЗаймам)
	                  |						ТОГДА ТИПЗНАЧЕНИЯ(ЗНАЧЕНИЕ(Документ.НачислениеПроцентовПоДоговорам.ПустаяСсылка))
	                  |					ИНАЧЕ ТИПЗНАЧЕНИЯ(ЗНАЧЕНИЕ(Документ.Операция.ПустаяСсылка))
	                  |				КОНЕЦ
	                  |		ИНАЧЕ ТИПЗНАЧЕНИЯ(ФинансовыйДвиженияССубконто.Регистратор)
	                  |	КОНЕЦ";			
						
	Выборка = ЗапросФин.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		Если Выборка.ЭтоПерепродажа Тогда
			СтрокаСопоставление = ТабСопоставление.Найти("Реализация (внутренняя перепродажа)", "Вид");
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = "Реализация (внутренняя перепродажа)";
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;	
			СтрокаСопоставление.СуммаФин = СтрокаСопоставление.СуммаФин + Выборка.Сумма;
		Иначе	
			СтрокаСопоставление = ТабСопоставление.Найти(Строка(Выборка.Тип), "Вид");
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = Строка(Выборка.Тип);
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;	
			СтрокаСопоставление.СуммаФин = СтрокаСопоставление.СуммаФин + Выборка.Сумма;
		КонецЕсли;
		СтрокаСопоставление.ТипФин = Выборка.Тип;
	КонецЦикла;
	
	ТабСопоставление.Сортировать("Вид");
	
	ЗапросДокПерепродажи = Новый Запрос();
	ЗапросДокПерепродажи.УстановитьПараметр("Месяц", НачалоДня(МесяцСверки));
	ЗапросДокПерепродажи.Текст = "ВЫБРАТЬ
	                             |	ЗакрытиеМесяца.Ссылка,
	                             |	ЗакрытиеМесяца.СуммаКорректировкиПерепродажи
	                             |ИЗ
	                             |	Документ.ЗакрытиеМесяца КАК ЗакрытиеМесяца
	                             |ГДЕ
	                             |	НАЧАЛОПЕРИОДА(ЗакрытиеМесяца.Дата, МЕСЯЦ) = &Месяц
	                             |	И ЗакрытиеМесяца.Проведен = ИСТИНА
	                             |	И ЗакрытиеМесяца.ВидЗакрытия = 11";
	
	ТабДокиПерепродажи = ЗапросДокПерепродажи.Выполнить().Выгрузить();
	
	ОргВкусвилл = Справочники.Организации.НайтиПоРеквизиту("ИНН", "7734675810");
	
	//по проводкам однозначно сумму корректировки мы поймать не можем, могут влезть другие лишние проводки, поэтому берем прям из документа
	Если ОргВкусвилл = Организация Тогда
		Для Каждого СтрокаПерепродажа Из ТабДокиПерепродажи Цикл
			СтрокаСопоставление = ТабСопоставление.Найти("Реализация (внутренняя перепродажа)", "Вид");
			Если СтрокаСопоставление = Неопределено Тогда
				СтрокаСопоставление = ТабСопоставление.Добавить();
				СтрокаСопоставление.Вид = "Реализация (внутренняя перепродажа)";
				СтрокаСопоставление.СуммаБух = 0;
				СтрокаСопоставление.СуммаФин = 0;
			КонецЕсли;	
			СтрокаСопоставление.СуммаФин = СтрокаСопоставление.СуммаФин + СтрокаПерепродажа.СуммаКорректировкиПерепродажи;
		КонецЦикла;	
	КонецЕсли;	
	
	Для Каждого СтрокаСопоставление Из ТабСопоставление Цикл
		Область = Макет.ПолучитьОбласть("Строка");
		Область.Параметры.ВидДокумента = СтрокаСопоставление.Вид;
		Область.Параметры.СуммаВБухгалтерии = СтрокаСопоставление.СуммаБух;
		Область.Параметры.СуммаВФинансах = СтрокаСопоставление.СуммаФин;
		Область.Параметры.Разница = СтрокаСопоставление.СуммаФин - СтрокаСопоставление.СуммаБух;
		Если СтрокаСопоставление.Вид = "Реализация товаров и услуг" Тогда
			Область.Параметры.Расшифровка = Новый Структура("Вид, Тип", "Реализации");
		ИначеЕсли СтрокаСопоставление.Вид = "Реализация (внутренняя перепродажа)" Тогда
			Если ТабДокиПерепродажи.Количество() > 0 Тогда
				Область.Параметры.Расшифровка = ТабДокиПерепродажи[0].Ссылка;
			КонецЕсли;	
		ИначеЕсли СтрокаСопоставление.Вид = "Начисление арендной платы арендаторам" Тогда		
			Область.Параметры.Расшифровка = Новый Структура("Вид, Тип", "Начисление арендной платы арендаторам", СтрокаСопоставление.ТипФин);
		ИначеЕсли СтрокаСопоставление.Вид = "Операция" Тогда		
			Область.Параметры.Расшифровка = Новый Структура("Вид, Тип", "Операция", СтрокаСопоставление.ТипФин);
		ИначеЕсли СтрокаСопоставление.Вид = "Реализация ОС" Тогда		
			Область.Параметры.Расшифровка = Новый Структура("Вид, Тип", "Реализация ОС", СтрокаСопоставление.ТипФин);	
		//+++АК Susk (Суслин К.В.) 2018.05.22 ИП-00018793
		ИначеЕсли СтрокаСопоставление.Вид = "Возврат товаров от покупателя" Тогда		
			Область.Параметры.Расшифровка = Новый Структура("Вид, Тип", "Возврат товаров от покупателя", СтрокаСопоставление.ТипФин);	
		//---АК Susk (Суслин К.В.)
		//+++АК Susk (Суслин К.В.) 2018.06.04 ИП-00018793		 
		ИначеЕсли СтрокаСопоставление.Вид = "Начисление процентов по договорам" Тогда
			Область.Параметры.Расшифровка = Новый Структура("Вид, Тип", "Начисление процентов по договорам", СтрокаСопоставление.ТипФин);	
		//---АК Susk (Суслин К.В.) 
		Иначе
			Область.Параметры.Расшифровка = Новый Структура("Вид, Тип", "Иное", СтрокаСопоставление.ТипФин);
		КонецЕсли;	
		ЭлементыФормы.ПолеОтчета.Вывести(Область);
	КонецЦикла;	
	
КонецПроцедуры

Процедура ПолеОтчетаОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Если ТипЗнч(Расшифровка) = Тип("ДокументСсылка.ЗакрытиеМесяца") Тогда
		ОткрытьЗначение(Расшифровка);
		Возврат;
	КонецЕсли;	
	Если ТипЗнч(Расшифровка) <> Тип("Структура") Тогда
		Сообщить("Для данного показателя не предусмотрена расшифровка");
		Возврат;
	КонецЕсли;
	
	//+++АК Susk (Суслин К.В.) 2018.05.22 ИП-00018793
	 	 
	//Форма = Отчеты.Сопоставление90_5.ПолучитьФорму("Расшифровка",, Новый УникальныйИдентификатор());
	Форма = ПолучитьФорму("Расшифровка");
	
	Форма.Счет90 = Возврат90СчетаВЗависимостиОтОрганизации();
	//---АК Susk (Суслин К.В.) 
	
	Форма.МесяцСверки = МесяцСверки;
	Форма.Организация = Организация;
	Форма.СтруктураРасшифровки = Расшифровка;
	Форма.Открыть();
	
КонецПроцедуры

	
	
 