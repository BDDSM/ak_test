
&НаКлиенте
Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
Перем ЗначениеРасшифровки;
	
	СтруктураРасшифровки = ПолучитьЗначениеРасшифровки(Расшифровка);
	Если СтруктураРасшифровки.Свойство("КлючЗаписиОбращенияПокупателей", ЗначениеРасшифровки) Тогда
		СтандартнаяОбработка = Ложь;
		ОткрытьФорму("РегистрСведений.ОбращенияПокупателей.ФормаЗаписи", Новый Структура("Ключ", ЗначениеРасшифровки));
		
	ИначеЕсли СтруктураРасшифровки.Свойство("НомерКартыПокупателя", ЗначениеРасшифровки) Тогда
		СтандартнаяОбработка = Ложь;
		СтруктураПараметровФормы = Новый Структура("Email", ЗначениеРасшифровки);	
		//СтруктураПараметровФормы.Вставить("ЦельНачисления", СокрЛП(Запись.Примечание));
		ОткрытьФорму("Обработка.ОтчетыПоКартам.Форма.КарточкаКлиента", СтруктураПараметровФормы,, ЭтаФорма.УникальныйИдентификатор);
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьЗначениеРасшифровки(Расшифровка)
	
	СтруктураРасшифровки = Новый Структура;
	КоллекцияРасшифровки = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	
	КоллекцияПолей = КоллекцияРасшифровки.Элементы[Расшифровка].ПолучитьПоля();
	Если КоллекцияПолей.Количество() Тогда
		
		Если КоллекцияПолей[0].Поле = "id_OK" Тогда
			
			Запрос = Новый Запрос(
				"ВЫБРАТЬ ПЕРВЫЕ 1
				|	ОбращенияПокупателей.id_OK,
				|	ОбращенияПокупателей.GUID_Загрузки,
				|	ОбращенияПокупателей.ДатаДок
				|ИЗ
				|	РегистрСведений.ОбращенияПокупателей КАК ОбращенияПокупателей
				|ГДЕ
				|	ОбращенияПокупателей.id_OK = &id_OK");
			Запрос.УстановитьПараметр("id_OK", КоллекцияПолей[0].Значение);
			
			РезультатЗапроса = Запрос.Выполнить();
			Если РезультатЗапроса.Пустой() Тогда Возврат Неопределено; КонецЕсли;
			
			ВыборкаЗапроса = РезультатЗапроса.Выбрать();
			ВыборкаЗапроса.Следующий();
			
			СтруктураКлючЗаписи = Новый Структура("id_OK,GUID_Загрузки,ДатаДок");
			ЗаполнитьЗначенияСвойств(СтруктураКлючЗаписи, ВыборкаЗапроса);
			
			КлючЗаписи = РегистрыСведений.ОбращенияПокупателей.СоздатьКлючЗаписи(СтруктураКлючЗаписи);
			СтруктураРасшифровки.Вставить("КлючЗаписиОбращенияПокупателей", КлючЗаписи);
			
			Возврат СтруктураРасшифровки;
			
		ИначеЕсли КоллекцияПолей[0].Поле = "НомерКартыПокупателя" Тогда
			
			СтруктураРасшифровки.Вставить("НомерКартыПокупателя", КоллекцияПолей[0].Значение);
			
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат СтруктураРасшифровки;
	
КонецФункции
