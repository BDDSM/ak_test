

Процедура ДействияФормыЗаполнить(Кнопка)
	Если ЭтаФорма.НастройкаApi.Пустая() Тогда
		Сообщить("Выберите настройку API");
	Иначе
		Прокси = ОбменССистемойВетис.ПолучитьПроксиDictionary(ЭтаФорма.НастройкаApi);
		ListOptions = ОбменССистемойВетис.ПолучитьListOptionsИзПрокси(Прокси);
		ListOptions.count = 4;
		Смещение = 0;
		СписокЕдиницИзмерения= новый Структура("UUID,GUID,name,fullName,commonUnitGuid,factor");
		
		ТЗ =Новый ТаблицаЗначений;
		ТЗ.Колонки.Добавить("UUID", Новый ОписаниеТипов("Строка"));
		ТЗ.Колонки.Добавить("GUID", Новый ОписаниеТипов("Строка"));
		ТЗ.Колонки.Добавить("name", Новый ОписаниеТипов("Строка"));
		ТЗ.Колонки.Добавить("fullName", Новый ОписаниеТипов("Строка"));
		ТЗ.Колонки.Добавить("commonUnitGuid", Новый ОписаниеТипов("Строка"));
		ТЗ.Колонки.Добавить("factor", Новый ОписаниеТипов("Число"));
		
		
		Пока Истина Цикл
			ListOptions.offset = Смещение;	
			СписокВетис = Прокси.GetUnitList(ListOptions);
			Если ТипЗнч(СписокВетис) <> Тип("ОбъектXDTO") Тогда Прервать; КонецЕсли;
			Если СписокВетис.count = 0 Тогда Прервать; КонецЕсли;
			Для Каждого стр из СписокВетис.unit Цикл
				Новаястрока = ТЗ.Добавить();
				//стр1 = СписокЕдиницИзмерения.Добавить();
				ЗаполнитьЗначенияСвойств(Новаястрока, стр);
				//стр1.ЕдиницаИзмерения = ОбменССистемойВетис.ПолучитьОбъект1сПоGUID(стр1.GUID);
			КонецЦикла;
			Если СписокВетис.count + Смещение >= СписокВетис.total Тогда Прервать; КонецЕсли;
			Смещение = Смещение + ListOptions.Count;
		КонецЦикла;
		Для Каждого Элемент Из тз Цикл
			Запрос = Новый Запрос;
			Запрос.Текст = 
			"ВЫБРАТЬ
			|	МЙ_СоответствиеЕдиницИзмерения.Ссылка,
			|	МЙ_СоответствиеЕдиницИзмерения.ВерсияДанных,
			|	МЙ_СоответствиеЕдиницИзмерения.ПометкаУдаления,
			|	МЙ_СоответствиеЕдиницИзмерения.Предопределенный,
			|	МЙ_СоответствиеЕдиницИзмерения.Код,
			|	МЙ_СоответствиеЕдиницИзмерения.Наименование,
			|	МЙ_СоответствиеЕдиницИзмерения.UUID,
			|	МЙ_СоответствиеЕдиницИзмерения.GUID,
			|	МЙ_СоответствиеЕдиницИзмерения.Name,
			|	МЙ_СоответствиеЕдиницИзмерения.fullName,
			|	МЙ_СоответствиеЕдиницИзмерения.commonUnitGuid,
			|	МЙ_СоответствиеЕдиницИзмерения.factor,
			|	МЙ_СоответствиеЕдиницИзмерения.ЕдиницаИзмерения,
			|	МЙ_СоответствиеЕдиницИзмерения.Представление
			|ИЗ
			|	Справочник.МЙ_СоответствиеЕдиницИзмерения КАК МЙ_СоответствиеЕдиницИзмерения
			|ГДЕ
			|	МЙ_СоответствиеЕдиницИзмерения.GUID = &GUID";
			
			Запрос.УстановитьПараметр("GUID", Элемент.GUID);
			
			РезультатЗапроса = Запрос.Выполнить();
			
			ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
			Если  ВыборкаДетальныеЗаписи.Количество()=0 Тогда
				НовыйЭл=справочники.МЙ_СоответствиеЕдиницИзмерения.СоздатьЭлемент();
				ЗаполнитьЗначенияСвойств(НовыйЭл,Элемент);
				НовыйЭл.Наименование=Элемент.FullName;
				НовыйЭл.Записать();
			Иначе
				
				Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
					// Вставить обработку выборки ВыборкаДетальныеЗаписи
				КонецЦикла;
			КонецЕсли;
			
			
			
			
		КонецЦикла;
	КонецЕсли;	
КонецПроцедуры

