#Область АК_ОтключенныйКод
Функция ПолучитьИмяФайлаДляОбъекта_Прев(Ссылка) Экспорт
	
	Каталог = Константы.КаталогХраненияФайлов.Получить();
	Если Прав(Каталог, 1) <> "\" Тогда
		Каталог = Каталог + "\";
	КонецЕсли;
	СоздатьКаталог(Каталог + Ссылка.ИмяПодкаталога);
	//++ АК LUZA 07.02.2018
	//из за каталогов со слэщем на конце появилась ошибка
	//добавил проверку
	//Возврат Каталог + Ссылка.ИмяПодкаталога + "\" + Ссылка.УникальныйИдентификатор() + ?(Лев(Ссылка.Расширение, 1) = ".", "", ".") + Ссылка.Расширение;
	Возврат Каталог + Ссылка.ИмяПодкаталога +  ?(Прав(Ссылка.ИмяПодкаталога, 1) = "\", "", "\") + Ссылка.УникальныйИдентификатор() + ?(Лев(Ссылка.Расширение, 1) = ".", "", ".") + Ссылка.Расширение;
	//-- АК LUZA 07.02.2018
КонецФункции
#КонецОбласти

//+++АК sole 2018.06.04 ИП-00018850
Функция ПолучитьИмяФайлаДляОбъекта(Ссылка) Экспорт
	
	FSO = Новый COMОбъект("Scripting.FileSystemObject");
	
	Каталог = FSO.BuildPath
		(
			Константы.КаталогХраненияФайлов.Получить(), 
			Ссылка.ИмяПодкаталога
		);
		
	Если НЕ FSO.FolderExists(Каталог) Тогда
		СоздатьКаталог(Каталог);
	КонецЕсли;
	
	ИмяФайла = Строка(Ссылка.УникальныйИдентификатор()) + ?(Лев(Ссылка.Расширение, 1) = ".", "", ".") + Ссылка.Расширение;
	
	Возврат FSO.BuildPath(Каталог, ИмяФайла); 
	
КонецФункции

//++ АК LUZA 20170731 ИП-00016332
Функция ПолучитьИмяФайлаДляРаспознаванияОбъекта(Ссылка) Экспорт
	
	Каталог = Константы.АК_КаталогДляРаспознаванияФайлов.Получить();
	Если Прав(Каталог, 1) <> "\" Тогда
		Каталог = Каталог + "\";
	КонецЕсли;
	Возврат Каталог + Ссылка.УникальныйИдентификатор() + ?(Лев(Ссылка.Расширение, 1) = ".", "", ".") + Ссылка.Расширение;
	
КонецФункции
//-- АК LUZA 20170731 ИП-00016332

//++ АК LUZA 20170731 ИП-00016332
Функция ПолучитьИмяФайлаДляРаспознанногоОбъекта(Ссылка) Экспорт
	
	Каталог = Константы.АК_КаталогРаспознанныхФайлов.Получить();
	Если Прав(Каталог, 1) <> "\" Тогда
		Каталог = Каталог + "\";
	КонецЕсли;
	Возврат Каталог + Ссылка.УникальныйИдентификатор() + ".txt";
	
КонецФункции
//-- АК LUZA 20170731 ИП-00016332


//++ АК LUZA 20171127 ИП-00017231
Функция ПолучитьИмяФайлаДляРаспознаванияОбъектаФилин(Ссылка) Экспорт
	
	Каталог = Константы.КаталогДляРаспознаванияФайловFillin.Получить();
	Если Прав(Каталог, 1) <> "\" Тогда
		Каталог = Каталог + "\";
	КонецЕсли;
	Возврат Каталог + Ссылка.УникальныйИдентификатор() + ?(Лев(Ссылка.Расширение, 1) = ".", "", ".") + Ссылка.Расширение;
	
КонецФункции
//-- АК LUZA 20171127 ИП-00017231

//++ АК LUZA 20171127 ИП-00017231
Функция ПолучитьИмяФайлаДляРаспознанногоОбъектаФилин(Ссылка) Экспорт
	
	Каталог = Константы.КаталогРаспознанныхФайловFillin.Получить();
	Если Прав(Каталог, 1) <> "\" Тогда
		Каталог = Каталог + "\";
	КонецЕсли;
	Возврат Каталог + Ссылка.УникальныйИдентификатор() + ".xml";

КонецФункции
//-- АК LUZA 20171127 ИП-00017231

//+++АК sole 2018.06.04 ИП-00018850
Функция ПолучитьРасширениеФайла(ИмяФайла)
	FSO = Новый COMОбъект("Scripting.FileSystemObject");
	Возврат FSO.GetExtensionName(ИмяФайла);
КонецФункции 

//+++АК sole 2018.06.04 ИП-00018850
Процедура ПриЗаписи_ФайлВХранилище(Ссылка, ДополнительныеСвойства) Экспорт
	
	Если АК_Инструменты.ЭтоКлиент() Тогда
		мПараметры = Новый Массив();
		мПараметры.Добавить(Ссылка);
		мПараметры.Добавить(ДополнительныеСвойства);
		
		АК_Инструменты.ВыполнитьПроцедуруНаСервере("Справочники.Файлы.ПриЗаписи_ФайлВХранилище", мПараметры);	
		Возврат	
	КонецЕсли;
	
	ЗначениеВХранилище = ДополнительныеСвойства.Хранилище.Получить();

	// Код перенесён из процедуры "ПриЗаписи" модуля объекта
	Если ТипЗнч(ЗначениеВХранилище) = Тип("Картинка") Тогда
		ЗначениеВХранилище.Записать(Справочники.Файлы.ПолучитьИмяФайлаДляОбъекта(Ссылка));
		//++ АК LUZA 20170731 ИП-00016332
		Если ДополнительныеСвойства.Свойство("ОтправлятьНаРаспознование") Тогда
			Запись = РегистрыСведений.АК_ОчередьРаспознаванияФайлов.СоздатьМенеджерЗаписи();
			Запись.Период = ТекущаяДата();
			Запись.Файл = Ссылка;
			Запись.Записать();
			
			ЗначениеВХранилище.Записать(Справочники.Файлы.ПолучитьИмяФайлаДляРаспознаванияОбъекта(Ссылка));
		ИначеЕсли ДополнительныеСвойства.Свойство("ОтправлятьНаРаспознованиеФилин") Тогда
			Запись = РегистрыСведений.АК_ОчередьРаспознаванияФайлов.СоздатьМенеджерЗаписи();
			Запись.ДатаДобавления = ТекущаяДата();
			Запись.Файл = Ссылка;
			Запись.ОбъектСравнения = Неопределено;
			Запись.Автор = ПараметрыСеанса.ТекущийПользователь;
			Запись.РаспознаватьЧерезFillin = Истина;
			Запись.Распознан = Ложь;
			Запись.Обработан = Ложь;
			Запись.Записать();
			
			ЗначениеВХранилище.Записать(Справочники.Файлы.ПолучитьИмяФайлаДляРаспознаванияОбъектаФилин(Ссылка));	
		КонецЕсли;	
		//-- АК LUZA 20170731 ИП-00016332
	Иначе
		ЗначениеВХранилище.Записать(Справочники.Файлы.ПолучитьИмяФайлаДляОбъекта(Ссылка));
	КонецЕсли;	
	
КонецПроцедуры


