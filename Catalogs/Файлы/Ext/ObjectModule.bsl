Перем ИмяФайла Экспорт; // Имя Файла на клиенте
Перем ИмяФайлаНаСервере Экспорт; // Имя временного файла, загруженного с клиента на сервер
Перем ПредФайлВХранилищеФайлов Экспорт; 

Процедура ПередЗаписью(Отказ)
	
	Если ЗначениеЗаполнено(ЭтотОбъект.Ссылка) Тогда
		ПредФайлВХранилищеФайлов = Справочники.Файлы.ПолучитьИмяФайлаДляОбъекта(ЭтотОбъект.Ссылка);
	КонецЕсли;
	
	Если ПустаяСтрока(ЭтотОбъект.ИмяПодкаталога) Тогда
		 ЭтотОбъект.ИмяПодкаталога = Формат(ТекущаяДата(), "ДФ=yyyyMM");
	КонецЕсли;	
	
	Если ЗначениеЗаполнено(ЭтотОбъект.ИмяФайла) Тогда
		ЭтотОбъект.Расширение = АК_Инструменты.ПолучитьРасширениеФайла(ЭтотОбъект.ИмяФайла);
		ЭтотОбъект.Наименование = АК_Инструменты.ПолучитьИмяФайла(ЭтотОбъект.ИмяФайла);
	КонецЕсли;	
	
КонецПроцедуры 

//+++АК sole 2018.06.09 ИП-00018850
Процедура ПриЗаписи(Отказ)
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;	
	
	Если ДополнительныеСвойства.Свойство("Хранилище") Тогда
		Справочники.Файлы.ПриЗаписи_ФайлВХранилище(ЭтотОбъект.Ссылка, ЭтотОбъект.ДополнительныеСвойства);
		Возврат;
	КонецЕсли;	
	
	Если ИмяФайлаНаСервере = Неопределено Тогда
		//+++АК sole 2018.06.13 ИП-00018850
		// Код отключен, так как обработке "ЭДО_Интерфейс" требуется создавать элементы пустышки в справочнике файлов.
		//Отказ = Истина;
		//---АК sole 2018.06.13 ИП-00018850
		
		Возврат;
	КонецЕсли;
	
	ИмяФайлаВХранилищеФайлов = Справочники.Файлы.ПолучитьИмяФайлаДляОбъекта(ЭтотОбъект.Ссылка);	
	
	УдалитьПредыдущийФайлПередЗаписью();
	
	ПереместитьФайл(ИмяФайлаНаСервере, ИмяФайлаВХранилищеФайлов);
	
КонецПроцедуры

//+++АК sole 2018.06.09 ИП-00018850
Процедура УдалитьПредыдущийФайлПередЗаписью()
	
	Перем FSO;	
	
	Если НЕ ЗначениеЗаполнено(ПредФайлВХранилищеФайлов) Тогда
		Возврат;
	КонецЕсли;
	
	FSO = Новый COMОбъект("Scripting.FileSystemObject");
		
	Если FSO.FileExists(ПредФайлВХранилищеФайлов) Тогда
		FSO.DeleteFile(ПредФайлВХранилищеФайлов, Истина);
	КонецЕсли;
		
КонецПроцедуры

//


