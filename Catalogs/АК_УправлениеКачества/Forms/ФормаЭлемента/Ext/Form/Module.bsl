
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	СписокНаименованийРегионов=Справочники.АК_ПоступающиеПредложения.ПолучитьСписокНаименованийРегионовКЛАДР();

	Для Каждого Регион из СписокНаименованийРегионов Цикл

		СтрокаСостава=Состав.Добавить();
		
		СтрокаСостава.КодКладр = Регион.Значение;
		СтрокаСостава.Наименование = Регион.Представление;
		
	КонецЦикла;
	
	Для Каждого СтрокаСоставаСправочника из Объект.Состав цикл
		СтрокиСостава=Состав.НайтиСтроки(Новый Структура("КодКладр",СтрокаСоставаСправочника.КодКладр));
		Для Каждого СтрокаСостава из СтрокиСостава цикл
			СтрокаСостава.Отметка=Истина;
			прервать;
		КонецЦикла;
	КонецЦикла;
	
	ИзменилиСостав=Ложь;
	
	ЗаполнитьКатегорииНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	Если ИзменилиСостав тогда
		Объект.Состав.Очистить();
		СтрокиСостава=Состав.НайтиСтроки(Новый Структура("Отметка",Истина));
		Для Каждого СтрокаСостава из СтрокиСостава цикл
			СтрокаСоставаСправочника=Объект.Состав.Добавить();
			СтрокаСоставаСправочника.КодКладр=СтрокаСостава.КодКладр;
		КонецЦикла;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СоставОтметкаПриИзменении(Элемент)
	ИзменилиСостав=Истина;
	ЭтаФорма.Модифицированность=Истина;
КонецПроцедуры

&НаКлиенте
Процедура ТехнологиПриИзменении(Элемент)
	ЗаполнитьКатегорииНаСервере();
КонецПроцедуры
&НаСервере
Процедура ЗаполнитьКатегорииНаСервере()

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТаблицаТехнологов.Технолог КАК Технолог
		|ПОМЕСТИТЬ Технологи
		|ИЗ
		|	&ТаблицаТехнологов КАК ТаблицаТехнологов
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Технолог
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СправочникПользователи.Ссылка КАК Пользователь,
		|	СправочникПользователи.ФизЛицо КАК ФизЛицо
		|ПОМЕСТИТЬ Пользователи
		|ИЗ
		|	Справочник.Пользователи КАК СправочникПользователи
		|ГДЕ
		|	СправочникПользователи.Ссылка В
		|			(ВЫБРАТЬ
		|				Технологи.Технолог
		|			ИЗ
		|				Технологи)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	Пользователь,
		|	ФизЛицо
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РолиПользователейСоставРоли.Ссылка КАК Категория,
		|	РолиПользователейСоставРоли.Ссылка.Наименование КАК КатегорияТекст,
		|	Пользователи.Пользователь КАК Технолог
		|ИЗ
		|	Пользователи КАК Пользователи
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.СоставРоли КАК РолиПользователейСоставРоли
		|		ПО Пользователи.ФизЛицо = РолиПользователейСоставРоли.Сотрудник
		|ГДЕ
		|	РолиПользователейСоставРоли.Сотрудник В
		|			(ВЫБРАТЬ
		|				Пользователи.ФизЛицо
		|			ИЗ
		|				Пользователи)
		|	И РолиПользователейСоставРоли.Ссылка.ТипРоли = &ТипРолиТехнолог
		|	И РолиПользователейСоставРоли.Ссылка.Наименование ПОДОБНО &НаименованиеУК
		|
		|УПОРЯДОЧИТЬ ПО
		|	Технолог,
		|	Категория,
		|	КатегорияТекст
		|АВТОУПОРЯДОЧИВАНИЕ";

	УК=врег(сокрлп(Объект.Наименование));
		
	Запрос.УстановитьПараметр("ФизЛицоПустаяСсылка", Справочники.ФизическиеЛица.ПустаяСсылка());
	Запрос.УстановитьПараметр("ТаблицаТехнологов", Объект.Технологи.Выгрузить());
	Запрос.УстановитьПараметр("НаименованиеУК", "%"+УК+"%");
	Запрос.УстановитьПараметр("ТипРолиТехнолог", Перечисления.ТипыРолейПользователейМОС.Технолог);

	Категории.Загрузить(Запрос.Выполнить().Выгрузить());
	
	Для Каждого Категория из Категории цикл
		Т=Категория.КатегорияТекст;
		Поз=Найти(Т,"-");
		Если Поз>0 тогда
			Категория.КатегорияТекст=сокрлп(лев(Т,Поз-1));
		иначе
		Поз=Найти(Т,УК);
			Если Поз>0 тогда
				Категория.КатегорияТекст=сокрлп(лев(Т,Поз-1));
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;

КонецПроцедуры