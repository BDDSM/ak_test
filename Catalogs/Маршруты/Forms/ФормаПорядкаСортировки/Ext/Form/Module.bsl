
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	СпрМаршруты.Ссылка КАК Маршрут
	|ИЗ
	|	Справочник.Маршруты КАК СпрМаршруты
	|ГДЕ
	|	СпрМаршруты.ПометкаУдаления = ЛОЖЬ
	|
	|УПОРЯДОЧИТЬ ПО
	|	СпрМаршруты.ПорядокСортировки,
	|	СпрМаршруты.Наименование";
				   
	ТаблицаМаршрутов.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры

&НаСервере
Процедура ЗаписатьНаСервере()
	
	Порядок = 0;
	Для Каждого СтрокаПорядок Из ТаблицаМаршрутов Цикл
		СпрОбъект = СтрокаПорядок.Маршрут.ПолучитьОбъект();
		СпрОбъект.ПорядокСортировки = Порядок;
		Попытка
			СпрОбъект.Записать();
			Порядок = Порядок + 1;
		Исключение
		КонецПопытки;
	КонецЦикла;	
	
КонецПроцедуры	

&НаКлиенте
Процедура Записать(Команда)
	
	ЗаписатьНаСервере();
	Закрыть();
	
КонецПроцедуры

&НаСервере
Процедура СортироватьПоВремениВыездаСервер()
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	СпрМаршруты.Ссылка КАК Маршрут,
	|	ВЫБОР
	|		КОГДА СпрМаршруты.ПланируемоеВремяВыездаПоМаршруту ССЫЛКА Справочник.ВремяВыездаПоМаршруту
	|			ТОГДА СпрМаршруты.ПланируемоеВремяВыездаПоМаршруту.ВремяВыезда
	|		ИНАЧЕ СпрМаршруты.ПланируемоеВремяВыездаПоМаршруту
	|	КОНЕЦ КАК ПланируемоеВремяВыездаПоМаршруту
	|ИЗ
	|	Справочник.Маршруты КАК СпрМаршруты
	|
	|УПОРЯДОЧИТЬ ПО
	|	СпрМаршруты.ПланируемоеВремяВыездаПоМаршруту,
	|	СпрМаршруты.ПорядокСортировки,
	|	СпрМаршруты.Наименование";
				   
	ТаблицаМаршрутов.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры

&НаКлиенте
Процедура СортироватьПоВремениВыезда(Команда)
	
	СортироватьПоВремениВыездаСервер();
	
КонецПроцедуры
