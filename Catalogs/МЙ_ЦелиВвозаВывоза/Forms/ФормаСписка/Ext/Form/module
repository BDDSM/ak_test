
Процедура ДействияФормыОбновитьСправочник(Кнопка)
	Если ЭтаФорма.НастройкаApi.Пустая() Тогда
		Сообщить("Выберите настройку API");
	Иначе
		
		Прокси = ОбменССистемойВетис.ПолучитьПроксиDictionary(ЭтаФорма.НастройкаApi);
		ListOptions = ОбменССистемойВетис.ПолучитьListOptionsИзПрокси(Прокси);
		//ListOptions.count = 4;
		Смещение = 0;
		Пока Истина Цикл
			ListOptions.offset = Смещение;	
			СписокВетис = Прокси.GetPurposeList(ListOptions);
			//Если ТипЗнч(СписокВетис) <> Тип("ОбъектXDTO") Тогда Прервать; КонецЕсли;
			//Если СписокВетис.count = 0 Тогда Прервать; КонецЕсли;
			ОбработкаПрерыванияПользователя();
			Для Каждого стр из СписокВетис.purpose Цикл
				Эл=справочники.МЙ_ЦелиВвозаВывоза.НайтиПоРеквизиту("GUID",стр.GUID);
				Если Эл.Ссылка.Пустая() Тогда
					эл=справочники.МЙ_ЦелиВвозаВывоза.СоздатьЭлемент();
					
				Иначе
					Эл=эл.ПолучитьОбъект();
				КонецЕсли;
				Эл.GUID=стр.Guid;
				Эл.UUID=стр.UUID;
				Эл.Активность=стр.active;
				Эл.Статус=Стр.status;
				Эл.Предыдущий=стр.previous;
				Эл.Наименование=стр.name;
				Эл.Записать();
				Состояние(эл.Наименование);
				
			КонецЦикла;
			Если СписокВетис.count + Смещение >= СписокВетис.total Тогда Прервать; КонецЕсли;
			Смещение = Смещение + ListOptions.Count;
		КонецЦикла;
	КонецЕсли;	
КонецПроцедуры
