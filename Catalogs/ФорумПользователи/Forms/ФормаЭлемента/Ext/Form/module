
Процедура ВидимостьEmail()
	
	ЭлементыФормы.Email.Доступность = ЭтотОбъект.ПосылатьУведомленияПоEmail;
	
КонецПроцедуры


Процедура ИзменитьНажатие(Элемент)
	
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДиалогОткрытияФайла.ПолноеИмяФайла		= "";
	ДиалогОткрытияФайла.Фильтр				= "Любые файлы(*.*)|*.*";
	ДиалогОткрытияФайла.МножественныйВыбор	= Ложь;
	ДиалогОткрытияФайла.Заголовок			= "Выберите файл картинки(Аватар)";
	Если ДиалогОткрытияФайла.Выбрать() Тогда
		МасФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;
		Для каждого ТекФайл Из МасФайлов цикл
			ПутьКФайлу = ТекФайл;
		конецЦикла;
	конецЕсли;
	Если СокрЛП(ПутьКФайлу) = "" тогда 
		Сообщить("Не выбран файл !", СтатусСообщения.Важное);
		Возврат;
	КонецЕсли;
	
	Попытка
		АватарП = Новый Картинка(ПутьКФайлу);
	Исключение
	    Сообщить("Выбран неудачный файл картинки!", СтатусСообщения.Важное);
		Возврат;
	КонецПопытки;
	ЭлементыФормы.ПолеКартинки1.Картинка = АватарП;
	ИмяФайла = Прав(ДиалогОткрытияФайла.ПолноеИмяФайла, СтрДлина(ДиалогОткрытияФайла.ПолноеИмяФайла) - СтрДлина(ДиалогОткрытияФайла.Каталог));
	ИмяФайлаАватара = ИмяФайла;
	Аватар = Новый ХранилищеЗначения(АватарП, Новый СжатиеДанных(6));
	ЭтаФорма.Модифицированность = Истина;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	АватарП = ЭтотОбъект.Аватар.Получить();
	ЭлементыФормы.ПолеКартинки1.Картинка = ?(АватарП = Неопределено, БиблиотекаКартинок.NoAvatar, АватарП);
	
	ВидимостьEmail();
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	
	Текст = ЭлементыФормы.ПолеHTMLДокумента1.ПолучитьТекст();
	
	Инд = Найти(Текст, "<BODY>");
	Если Инд Тогда
		Текст = Прав(Текст, СтрДлина(Текст) - Инд - 5);
		Инд = Найти(Текст, "</BODY>");
		Если Инд Тогда
			Текст = Лев(Текст, Инд - 1);
		КонецЕсли;	
	КонецЕсли;	
	Подпись = Текст;
	
КонецПроцедуры

//+++ AK suvv 19.06.2018 ИП-00018230
//Процедура ПоказыватьУведомленияВТрееПриИзменении(Элемент)
//	
//	Если ПоказыватьУведомленияВТрее Тогда
//		
//		Если ОбработкаФорум.TrayIcon = Неопределено Тогда
//			ОбработкаФорум.ЗагрузитьКомпоненту();
//		КонецЕсли;	
//		
//	Иначе
//		Попытка
//			ОбработкаФорум.TrayIcon.ShowTrayIcon(Ложь);
//			ОбработкаФорум.TrayIcon = Неопределено;
//		Исключение
//		КонецПопытки;
//		ОтключитьОбработчикОжидания("УведомленияТрея");
//	КонецЕсли;
//	
//КонецПроцедуры
//--- AK suvv

Процедура ПосылатьУведомленияПоEmailПриИзменении(Элемент)
	
	ВидимостьEmail();
	
КонецПроцедуры
