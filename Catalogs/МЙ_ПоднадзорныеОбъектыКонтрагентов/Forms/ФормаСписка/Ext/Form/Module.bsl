Перем Прокси;
Перем ФабрикаXD;

Перем ПроксиEnterprise;


&НаКлиенте
Процедура ЗагрузитьОбновитьСписок(Команда)
	ЗагрузитьОбновитьСписокНаСервере();
	
КонецПроцедуры


&НаСервере
Процедура ЗагрузитьОбновитьСписокНаСервере()
	
	НастройкаАПИ = ОбменССистемойВетис.ОсновнаяНастройкаАПИ();
	ПроксиEnterprise = ОбменССистемойВетис.ПолучитьПроксиEnterprise(НастройкаАПИ);		
	
	GUID = НастройкаАПИ.issuerId;
	
	
	Попытка
		Ответ = ПроксиEnterprise.GetBusinessEntityByGuid();
	Исключение
		Сообщить(ОписаниеОшибки());
		Возврат;
	КонецПопытки;
	
	ТЗГуидПлощадок = Новый ТаблицаЗначений; 	
	ТЗГуидПлощадок.Колонки.Добавить("ГУИД", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(36)));
	
	Если ТипЗнч(Ответ) = Тип("ОбъектXDTO") Тогда
		Список = ОбменССистемойВетис.ПолучитьСвойствоОбъектаXDTO(Ответ, "activityLocation"); 	
		
		Если ТипЗнч(Список) = Тип("СписокXDTO") Тогда
			
			Для каждого ЗначСписка Из Список Цикл
				Нстр = ТЗГуидПлощадок.Добавить();
				Нстр.ГУИД = ЗначСписка.enterprise.guid;
			КонецЦикла;
			
		КонецЕсли;		
	КонецЕсли;
	
	
		
	
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры = Неопределено Тогда
		
	КонецЕсли;	
КонецПроцедуры
