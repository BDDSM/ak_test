&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	НастройкаЭлементовУправленияФормы();
	
КонецПроцедуры

&НаКлиенте
Процедура ТипРолиПриИзменении(Элемент)
	
	Объект.Расчетчик_СтруктурнаяЕдиница = Неопределено;
	НастройкаЭлементовУправленияФормы();
	
КонецПроцедуры

&НаКлиенте
Процедура ТипРолиОчистка(Элемент, СтандартнаяОбработка)
	
	Объект.Расчетчик_СтруктурнаяЕдиница = Неопределено;
	НастройкаЭлементовУправленияФормы();
	
КонецПроцедуры


//&НаКлиенте
Процедура НастройкаЭлементовУправленияФормы()
	
	Элемент1 = Элементы.Расчетчик_СтруктурнаяЕдиница;
	Если ЗначениеЗаполнено(Объект.Родитель) Тогда
		Элементы.ТипРоли.ТолькоПросмотр = Истина;
		Если Объект.ТипРоли <> Объект.Родитель.ТипРоли Тогда
			Объект.ТипРоли = Объект.Родитель.ТипРоли;
			Объект.Расчетчик_СтруктурнаяЕдиница = Неопределено;
		КонецЕсли;
	Иначе
		Элементы.ТипРоли.ТолькоПросмотр = Ложь;
	КонецЕсли;
	Элемент1.Доступность = Истина;
	Если Объект.ТипРоли = ПредопределенноеЗначение("Перечисление.ТипыРолейПользователейМОС.Расчетчик") Тогда
		Элемент1.Заголовок = "Расчетчик";
		Элемент1.ОграничениеТипа = Новый ОписаниеТипов("СправочникСсылка.Расчетчики");
		Объект.Расчетчик_СтруктурнаяЕдиница = Элемент1.ОграничениеТипа.ПривестиЗначение(Объект.Расчетчик_СтруктурнаяЕдиница);
	ИначеЕсли Объект.ТипРоли = ПредопределенноеЗначение("Перечисление.ТипыРолейПользователейМОС.Прочее")
			ИЛИ НЕ ЗначениеЗаполнено(Объект.ТипРоли) Тогда
		Элемент1.Заголовок = " ";
		Объект.Расчетчик_СтруктурнаяЕдиница = Неопределено;
		Элемент1.Доступность = Ложь;
	Иначе
		Элемент1.Заголовок = "Структ. единица";
		Элемент1.ОграничениеТипа = Новый ОписаниеТипов("СправочникСсылка.СтруктурныеЕдиницы");
		Объект.Расчетчик_СтруктурнаяЕдиница = Элемент1.ОграничениеТипа.ПривестиЗначение(Объект.Расчетчик_СтруктурнаяЕдиница);
		ПараметрВыбора = Неопределено;
		Если Объект.ТипРоли = ПредопределенноеЗначение("Перечисление.ТипыРолейПользователейМОС.Магазин") Тогда
			ПараметрВыбора = Новый ПараметрВыбора("Отбор.ТипСтруктурнойЕдиницы", ПредопределенноеЗначение("Перечисление.ТипыСтруктурныхЕдиниц.Розница"));
		ИначеЕсли Объект.ТипРоли = ПредопределенноеЗначение("Перечисление.ТипыРолейПользователейМОС.Склад") Тогда
			ПараметрВыбора = Новый ПараметрВыбора("Отбор.ТипСтруктурнойЕдиницы", ПредопределенноеЗначение("Перечисление.ТипыСтруктурныхЕдиниц.Склад"));
		КонецЕсли;
		
		Если ПараметрВыбора <> Неопределено Тогда
			Массив1 = Новый Массив;
			Массив1.Добавить(ПараметрВыбора);
			Элемент1.ПараметрыВыбора = Новый ФиксированныйМассив(Массив1);
		КонецЕсли;
		
	КонецЕсли;

	Если Объект.ТипРоли = ПредопределенноеЗначение("Перечисление.ТипыРолейПользователейМОС.Технолог") Тогда
		Элементы.ГруппаНоменклатураИПроизводители.Видимость = Истина;
	Иначе
		Элементы.ГруппаНоменклатураИПроизводители.Видимость = Ложь;
	КонецЕсли; 
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если РольДоступна(Метаданные.Роли.ПолныеПрава) Тогда
		Элементы.Код.ОтображениеПредупрежденияПриРедактировании = ОтображениеПредупрежденияПриРедактировании.НеОтображать;
	КонецЕсли;
	
КонецПроцедуры
