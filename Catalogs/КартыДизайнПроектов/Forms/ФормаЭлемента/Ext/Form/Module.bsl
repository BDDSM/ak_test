
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	//Вставить содержимое обработчика
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если Объект.ТипПродукции = 0 Тогда
		ВыбратьФормуЭлемента(Отказ);
	Иначе
		//ПриОткрытииЗавершение(Отказ);
		ОбработкаВыбора(Новый Структура("Значение", Объект.ТипПродукции) , "ОбщаяФорма.Вопрос");
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытииЗавершение(Отказ = Ложь)
	
	Модифицированность = Ложь;
	
	Если НЕ Отказ Тогда
		Отказ = Истина;
		Закрыть();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбратьФормуЭлемента(Отказ)
	СписокКнопок = Новый СписокЗначений;
	СписокКнопок.Добавить("1", "Продовольственные товары");
	СписокКнопок.Добавить("2", "Непродовольственные товары (нон-фуд)");
	СписокКнопок.Добавить("КодВозвратаДиалога.Отмена", "Отмена");
	ОбщегоНазначенияКлиент.ПоказатьВопросПользователю("Выберите тип продукции", СписокКнопок,,,,,,ЭтаФорма);
	//Отказ = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаВыбора(ВыбранноеЗначение, ИсточникВыбора)
Перем ОписаниеОповещения;
	
	Если ТипЗнч(ВыбранноеЗначение) = Тип("Структура") И (ИсточникВыбора = "ОбщаяФорма.Вопрос" ИЛИ ИсточникВыбора.ИмяФормы = "ОбщаяФорма.Вопрос") Тогда
		ВыбранноеЗначениеРезультат = Строка(ВыбранноеЗначение.Значение);
		Если ВыбранноеЗначениеРезультат = "Отмена" Тогда
			ПриОткрытииЗавершение();
			Возврат;
		КонецЕсли;
		
		Объект.ТипПродукции = Число(ВыбранноеЗначениеРезультат);
		ЗначенияЗаполнения = "";
		ПараметрыНовойФормы = Новый Структура("Ключ,Основание,ЗначениеКопирования,ЗначенияЗаполнения,ТипПродукции");
		ЗаполнитьЗначенияСвойств(ПараметрыНовойФормы, Параметры);
		//ЗаполнитьЗначенияСвойств(ПараметрыНовойФормы, ЭтаФорма, "ВладелецФормы,Окно");
		ЗаполнитьЗначенияСвойств(ПараметрыНовойФормы, Объект, "ТипПродукции");
		ПараметрыНовойФормы.Свойство("ЗначенияЗаполнения", ЗначенияЗаполнения);
		Если ТипЗнч(ЗначенияЗаполнения) <> Тип("Структура") Тогда
			ЗначенияЗаполнения = Новый Структура;
		КонецЕсли;
		ЗначенияЗаполнения.Вставить("ТипПродукции", Объект.ТипПродукции);
		ПараметрыНовойФормы.Вставить("ЗначенияЗаполнения", ЗначенияЗаполнения);
		
		ОткрытьФорму("Справочник.КартыДизайнПроектов.Форма.ФормаЭлемента" + Формат(Объект.ТипПродукции, "ЧГ="), ПараметрыНовойФормы, ЭтаФорма, Новый УникальныйИдентификатор);
		
	ИначеЕсли Найти(ИсточникВыбора.ИмяФормы, "Справочник.КартыДизайнПроектов.Форма.ФормаЭлемента") = 1 Тогда
		
		Закрыть();
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	//Если ВыбранноеЗначениеРезультат = Неопределено И Объект.ТипПродукции = 0 Тогда
	//	Отказ = Истина;
	//КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии()
	
	//Если ВыбранноеЗначениеРезультат <> "Отмена" Тогда
	//	ЗначенияЗаполнения = "";
	//	ПараметрыНовойФормы = Новый Структура("Ключ,Основание,ЗначениеКопирования,ЗначенияЗаполнения,ВладелецФормы,Окно,ТипПродукции");
	//	ЗаполнитьЗначенияСвойств(ПараметрыНовойФормы, Параметры);
	//	ЗаполнитьЗначенияСвойств(ПараметрыНовойФормы, ЭтаФорма, "ВладелецФормы,Окно");
	//	ЗаполнитьЗначенияСвойств(ПараметрыНовойФормы, Объект, "ТипПродукции");
	//	ПараметрыНовойФормы.Свойство("ЗначенияЗаполнения", ЗначенияЗаполнения);
	//	Если ТипЗнч(ЗначенияЗаполнения) <> Тип("Структура") Тогда
	//		ЗначенияЗаполнения = Новый Структура;
	//	КонецЕсли;
	//	ЗначенияЗаполнения.Вставить("ТипПродукции", Объект.ТипПродукции);
	//	ПараметрыНовойФормы.Вставить("ЗначенияЗаполнения", ЗначенияЗаполнения);
	//	
	//	//ОткрытьФорму("Справочник.КартыДизайнПроектов.Форма.ФормаЭлемента" + Формат(Объект.ТипПродукции, "ЧГ="), ПараметрыНовойФормы, ЭтаФорма.ВладелецФормы, Новый УникальныйИдентификатор, ЭтаФорма.Окно);
	//КонецЕсли;
	
КонецПроцедуры
