
&НаКлиенте
Процедура ЗагрузитьИзФайла(Команда)
	
	//СпрОбработкаЗагрузкиСсылка = Справочники.ВнешниеОбработки.НайтиПоНаименованию("Загрузка планового ассортимента из Excel");
	//Если НЕ ЗначениеЗаполнено(СпрОбработкаЗагрузкиСсылка) Тогда
	//	Предупреждение("Не найдена дополнительная обработка!");
	//	Возврат;
	//КонецЕсли;
	//
	//ИмяВремФайла = ПолучитьИмяВременногоФайла("epf");
	//ДвоичныеДанные = СпрОбработкаЗагрузкиСсылка.ХранилищеВнешнейОбработки.Получить();
	//ДвоичныеДанные.Записать(ИмяВремФайла);
	//ОбработкаЗагрузки = ВнешниеОбработки.Создать(ИмяВремФайла);
	//ФормаОбработкиЗагрузки = ОбработкаЗагрузки.ПолучитьФорму("Форма");                                 
	//ФормаОбработкиЗагрузки.Открыть();
	
КонецПроцедуры

&НаКлиенте
Процедура СтатусОтборПриИзменении(Элемент)
	//АК БЕЛН 31.05.2017+
	//Кол=Список.Отбор.Элементы.Количество();
	//Для Сч=0 По Кол-1 Цикл
	//	Список.Отбор.Элементы.Удалить(Кол-1-Сч);
	//КонецЦикла; 
	//Если ЗначениеЗаполнено(СтатусОтбор) Тогда
	//	ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	//	ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("Статус");
	//	ЭлементОтбора.Использование 	= Истина;
	//	ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
	//	ЭлементОтбора.ПравоеЗначение 	= СтатусОтбор;
	//
	//КонецЕсли; 
	//АК БЕЛН 31.05.2017-
КонецПроцедуры

//АК БЕЛН 31.05.2017+
&НаКлиенте
Процедура УстановитьОтбор(Команда)
	Кол=Список.Отбор.Элементы.Количество();
	Для Сч=0 По Кол-1 Цикл
		Список.Отбор.Элементы.Удалить(Кол-1-Сч);
	КонецЦикла; 
	Если ЗначениеЗаполнено(СтатусОтбор) Тогда
		ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("Статус");
		ЭлементОтбора.Использование 	= Истина;
		ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение 	= СтатусОтбор;
	
	КонецЕсли; 
	//+++АК BELN 2017.11.07 ИП-00017153
	Если ЗначениеЗаполнено(ДатаЗапускаОтбор) Тогда
		ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("ПлановаяДатаЗапуска");
		ЭлементОтбора.Использование 	= Истина;
		ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.МеньшеИлиРавно;
		ЭлементОтбора.ПравоеЗначение 	= ДатаЗапускаОтбор.ДатаОкончания;
		
		ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("ПлановаяДатаЗапуска");
		ЭлементОтбора.Использование 	= Истина;
		ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.БольшеИлиРавно;
		ЭлементОтбора.ПравоеЗначение 	= ДатаЗапускаОтбор.ДатаНачала;
	КонецЕсли; 
	
	Если ЗначениеЗаполнено(ТехнологОтбор) Тогда
		ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("Технолог");
		ЭлементОтбора.Использование 	= Истина;
		ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение 	=  ТехнологОтбор;
		
	КонецЕсли; 
	Если ЗначениеЗаполнено(ОсобенностьОтбор) Тогда
		ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("Особенность");
		ЭлементОтбора.Использование 	= Истина;
		ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение 	=  ОсобенностьОтбор;
		
	КонецЕсли; 
	//---АК BELN 2017.11.07 
КонецПроцедуры

//+++АК BELN 2017.11.07 ИП-00017153
&НаСервере
Функция ПолучитьЭлементыТехнолога()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПлановыйАссортиментДегустация.Ссылка
		|ИЗ
		|	Справочник.ПлановыйАссортимент.Дегустация КАК ПлановыйАссортиментДегустация
		|ГДЕ
		|	ПлановыйАссортиментДегустация.ТехнологФЛ = &ТехнологФЛ
		|
		|СГРУППИРОВАТЬ ПО
		|	ПлановыйАссортиментДегустация.Ссылка";
	
	Запрос.УстановитьПараметр("ТехнологФЛ", ТехнологОтбор);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	СписокОтб=Новый СписокЗначений;
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		СписокОтб.Добавить(ВыборкаДетальныеЗаписи.Ссылка);	
	КонецЦикла;
	Возврат СписокОтб;
КонецФункции // ()
//---АК BELN 2017.11.07 

&НаКлиенте
Процедура УстановитьСтатус(Команда)
	Если Не ЗначениеЗаполнено(СтатусОтбор) Тогда
		Сообщить(НСтр("ru = ""Выберите значение статуса"""));	
		Возврат;
	КонецЕсли; 
	Если (Элементы.Список.ТекущиеДанные)<>Неопределено Тогда
		
		мМассив = Новый Массив;
		Для Каждого СтрокаСписка Из Элементы.Список.ВыделенныеСтроки Цикл	
			мМассив.Добавить(СтрокаСписка);
		КонецЦикла;
		УстановитьСтатусСервер(мМассив);
		Элементы.Список.Обновить();
	КонецЕсли; 
КонецПроцедуры

Процедура УстановитьСтатусСервер(мМассив)
	Для каждого Ссылка Из мМассив Цикл
		Если НЕ Ссылка.ЭтоГруппа Тогда
			ОбСпр=Ссылка.ПолучитьОбъект();
			ОбСпр.Статус=СтатусОтбор;
		    ОбСпр.Записать();
		КонецЕсли; 
	КонецЦикла; 
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если РольДоступна("Продавец") Тогда
		Сообщить("Недостаточно прав");
		Отказ=Истина;
	КонецЕсли; 
КонецПроцедуры


//АК БЕЛН 31.05.2017-
