
Процедура ФайлыПередНачаломДобавления(Элемент, Отказ, Копирование)
	
	Отказ = Истина;
	СтруктураВозврат = ОткрытьФормуМодально("Справочник.Номенклатура.Форма.ФормаВыбораФайла");
	Если СтруктураВозврат <> Неопределено
		И СтруктураВозврат.БылВыборФайла Тогда
		Файл = Новый Файл(СтруктураВозврат.ИмяФайла);
		СтрокаДоб = Файлы.Добавить();
		СтрокаДоб.ИД = ОбщегоНазначенияСервер.ПолучитьНовыйУникальныйИдентификатор("Номенклатура.Файлы", "ИД") + СтрокаДоб.НомерСтроки;
		СтрокаДоб.КраткоеИмяФайла = Файл.ИмяБезРасширения;
		СтрокаДоб.Расширение = Файл.Расширение;
		СтрокаДоб.ВнесеныИзменения = Истина;
		СтрокаДоб.КлючСтроки = Строка(Новый УникальныйИдентификатор);
		СтрокаДоб.ХранилищеКЗаписи = Новый ХранилищеЗначения(Новый ДвоичныеДанные(СтруктураВозврат.ИмяФайла));
		СтрокаДоб.Размер = Файл.Размер();
	КонецЕсли;

КонецПроцедуры


Функция ПолучитьПолноеИмяФайла(ТекСтрока)
	
	КаталогКЗаписи = Константы.КаталогХраненияФайлов.Получить();
	Если Прав(КаталогКЗаписи, 1) <> "\" Тогда
		КаталогКЗаписи = КаталогКЗаписи + "\";
	КонецЕсли;	
	
	ИмяФайла = КаталогКЗаписи + Строка(Ссылка.УникальныйИдентификатор()) + "_" + Строка(ТекСтрока.КлючСтроки) + ?(Лев(ТекСтрока.Расширение, 1) = ".", "", ".") + ТекСтрока.Расширение;
	
	Возврат ИмяФайла;
	
КонецФункции


Процедура ФайлыПередНачаломИзменения(Элемент, Отказ)
	ТекСтрока = ЭлементыФормы.Файлы.ТекущиеДанные;
	Если ТекСтрока <> Неопределено Тогда
		Если ТекСтрока.ВнесеныИзменения Тогда
			Предупреждение("Сначала запишите элемент, файл ещё не записан в базу.");
		Иначе
			ЗапуститьПриложение(ПолучитьПолноеИмяФайла(ТекСтрока));
		КонецЕсли;	
		
	КонецЕсли;
	Отказ=истина;
КонецПроцедуры
