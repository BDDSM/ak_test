
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если НЕ Параметры.Свойство("Склад") Тогда
		Список.ТекстЗапроса =
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СправочникНоменклатура.Ссылка КАК Ссылка,
		|	СправочникНоменклатура.ЭтоГруппа,
		|	СправочникНоменклатура.Родитель,
		|	СправочникНоменклатура.Наименование
		|ИЗ
		|	РегистрСведений.ЦеныПоставщиков.СрезПоследних КАК ЦеныПоставщиковСрезПоследних
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура
		|		ПО ЦеныПоставщиковСрезПоследних.Номенклатура = СправочникНоменклатура.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СоответствиеТиповРозничныхТочекИТорговыхМарок КАК СоответствиеТиповРозничныхТочекИТорговыхМарок
		|		ПО СправочникНоменклатура.ТорговаяМарка = СоответствиеТиповРозничныхТочекИТорговыхМарок.ТорговаяМарка
		|ГДЕ
		|	ЦеныПоставщиковСрезПоследних.Поставщик = &Поставщик
		|	И
		|	Выбор когда &ЭтоПродавец ТОгда 
		|	ВЫбор когда СправочникНоменклатура.ЭтоГруппа Тогда Истина Иначе
		|	Выбор когда СправочникНоменклатура.ВидНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ВидыНоменклатуры.Товар) ТОгда
		|	СоответствиеТиповРозничныхТочекИТорговыхМарок.ТипРозничнойТочки = &ТипРозничнойТочки Иначе Истина Конец Конец	
		|	Иначе Истина Конец
		|
		|СГРУППИРОВАТЬ ПО
		|	СправочникНоменклатура.Ссылка,
		|	СправочникНоменклатура.ЭтоГруппа,
		|	СправочникНоменклатура.Родитель,
		|	СправочникНоменклатура.Наименование";
		Список.Параметры.УстановитьЗначениеПараметра("Поставщик", Параметры.Поставщик);					  
	Иначе						  
		Список.Параметры.УстановитьЗначениеПараметра("Склад"			, Параметры.Склад);
		Список.Параметры.УстановитьЗначениеПараметра("СкладНеОптовый"	, Параметры.Склад.ВидСклада <> Перечисления.ВидыСкладов.Оптовый);
		Список.Параметры.УстановитьЗначениеПараметра("Поставщик"		, Параметры.Поставщик);
		Список.Параметры.УстановитьЗначениеПараметра("Пользователь"		, ПараметрыСеанса.ТекущийПользователь);
	КонецЕсли;
	
	//+++АК KIRN 2018.03.20 ИП-00018103
	ОбщиеПроцедуры.НоменклатураФормаУпрПриСозданииНаСервере(ЭтаФорма, "Список");
	//---АК KIRN 
КонецПроцедуры
