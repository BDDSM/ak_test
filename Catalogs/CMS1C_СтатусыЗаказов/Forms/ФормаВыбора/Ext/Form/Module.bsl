
&НаКлиенте
Процедура СписокПередУдалением(Элемент, Отказ)
	Отказ = Истина;
КонецПроцедуры

&НаКлиенте
Процедура КомандаЗагрузитьСтатусыИзСайта(Команда)
	//Вставить содержимое обработчика.
	//ПараметрыФормы = Новый Структура("", );
	//ОткрытьФорму("Справочник.CMS1C_СтатусыЗаказов.ФормаСписка", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник, ПараметрыВыполненияКоманды.Уникальность, ПараметрыВыполненияКоманды.Окно);
	
	ТекущаяНастройка = Неопределено;
	ПолеКомпоновкиНастройкаСайта = Новый ПолеКомпоновкиДанных("Владелец");
	Для Каждого СтрТз из Список.Отбор.Элементы Цикл
		Если СтрТз.ЛевоеЗначение = ПолеКомпоновкиНастройкаСайта
			И СтрТз.Использование = ИСтина
			и СтрТз.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно
			И ЗначениеЗаполнено(СтрТз.ПравоеЗначение) Тогда
			ТекущаяНастройка = СтрТз.ПравоеЗначение;
		КонецЕсли;
	КонецЦикла;
	
	Если ТекущаяНастройка = Неопределено Тогда
		МассивНастроекСайтов = ПолучитьСписокНастроекСайтов();
		
		Если МассивНастроекСайтов.Количество() = 0 Тогда
			Возврат;
		КонецЕсли;
		
		Если МассивНастроекСайтов.Количество() = 1 Тогда
			ТекущаяНастройка = МассивНастроекСайтов[0];
		Иначе
			НачальноеЗначение = МассивНастроекСайтов[0];
			Результат = ВвестиЗначение(НачальноеЗначение,"Выберите настройку сайта для загрузки статусов");
			Если НЕ Результат Тогда
				Возврат;
			КонецЕсли;
			
			ТекущаяНастройка = НачальноеЗначение;
		КонецЕсли;
	Конецесли;
	
	ЗагрузитьСтатусыИзСайта(ТекущаяНастройка);
	ЭтаФорма.ОбновитьОтображениеДанных();
	Элементы.Список.Обновить();
КонецПроцедуры


Функция ПолучитьСписокНастроекСайтов()
	Запрос = Новый Запрос();
	Запрос.Текст = "ВЫБРАТЬ
	               |	CMS1C_НастройкиСайтов.Ссылка
	               |ИЗ
	               |	Справочник.CMS1C_НастройкиСайтов КАК CMS1C_НастройкиСайтов
	               |ГДЕ
	               |	НЕ CMS1C_НастройкиСайтов.ПометкаУдаления";
				   Возврат Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
				   
КонецФУнкции


Процедура ЗагрузитьСтатусыИзСайта(Настройка)
	Обработка = CMS1C_ПроцедурыОбменаССайтомСервер.ПолучитьОбработкуПоСистемеУправленияСайтом(Настройка);
	Обработка.ЗагрузитьСтатусыИзСайта();
КонецПроцедуры