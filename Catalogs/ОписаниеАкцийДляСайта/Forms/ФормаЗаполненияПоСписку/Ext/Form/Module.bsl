
Функция ЗагрузитьТовары()
	
	МассивВозврат = Новый Массив();
	Запрос = Новый Запрос();
	Запрос.Текст = "ВЫБРАТЬ
	               |	Номенклатура.Ссылка,
	               |	Номенклатура.Наименование,
	               |	Номенклатура.id_tov
	               |ИЗ
	               |	Справочник.Номенклатура КАК Номенклатура
	               |ГДЕ
	               |	Номенклатура.ЭтоГруппа = ЛОЖЬ
	               |	И Номенклатура.ПометкаУдаления = ЛОЖЬ";
				   
	ТабКеш = Запрос.Выполнить().Выгрузить();
	Для н = 1 По ТабКЗагрузке.ВысотаТаблицы Цикл
		Если НЕ ЗначениеЗаполнено(ТабКЗагрузке.Область(н, 1, н, 1).Текст) Тогда
			Продолжить;
		КонецЕсли;	
		БылаНайденаНоменклатура = Ложь;
		Для Каждого СтрокаКеш Из ТабКеш Цикл
			Если СокрЛП(НРег(СтрокаКеш.Наименование)) = СокрЛП(НРег(ТабКЗагрузке.Область(н, 1, н, 1).Текст)) Тогда
				БылаНайденаНоменклатура = Истина;
				МассивВозврат.Добавить(СтрокаКеш.Ссылка);
				Прервать;
			КонецЕсли;	
		КонецЦикла;
		Если Не БылаНайденаНоменклатура Тогда
			Сообщить("Не найдена номенклатура: " + ТабКЗагрузке.Область(н, 1, н, 1).Текст);
			ЕстьОшибки = Истина;
		КонецЕсли;	
	КонецЦикла;	
	
	Возврат МассивВозврат;
	
КонецФункции	

&НаКлиенте
Процедура Загрузить(Команда)
	
	ЕстьОшибки = Ложь;
	МассивВозврат = ЗагрузитьТовары();
	Если ЕстьОшибки Тогда
		Ответ = Вопрос("Не все товары из списка были найдены. Продолжить?", РежимДиалогаВопрос.ДаНет);
		Если Ответ = КодВозвратаДиалога.Да Тогда
			ОповеститьОВыборе(Новый Структура("Режим, Товары", "ИзСписка", МассивВозврат));
		КонецЕсли;	
	Иначе
		ОповеститьОВыборе(Новый Структура("Режим, Товары", "ИзСписка", МассивВозврат));
	КонецЕсли;	
	
КонецПроцедуры
