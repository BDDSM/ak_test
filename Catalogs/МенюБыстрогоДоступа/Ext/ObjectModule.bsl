Перем РежимРедактированияНеЗаписанногоОбъекта Экспорт;

Процедура ПередЗаписью(Отказ)
	
	Если ЭтоНовый() Тогда 
		Если Владелец = Неопределено ИЛИ Владелец.Пустая() Тогда
			Владелец = ПараметрыСеанса.ТекущийПользователь;	
		КонецЕсли;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(РеквизитСортировки) Тогда
		Запрос = Новый Запрос();
		Запрос.УстановитьПараметр("Владелец", Владелец);
		Запрос.Текст = "ВЫБРАТЬ
		               |	МАКСИМУМ(МенюБыстрогоДоступа.РеквизитСортировки) КАК РеквизитСортировки
		               |ИЗ
		               |	Справочник.МенюБыстрогоДоступа КАК МенюБыстрогоДоступа
		               |ГДЕ
		               |	МенюБыстрогоДоступа.Владелец = &Владелец";
					   
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			РеквизитСортировки = Выборка.РеквизитСортировки;
		КонецЕсли;	
		
		РеквизитСортировки = РеквизитСортировки + 1;
	КонецЕсли;	
	
КонецПроцедуры

Функция ПоместитьДанныеВСтруктуруИВхранилище(ТипЭлемента, ИмяМетаданных, РазделМетаданных, ВидФормы, Значение, Настройки, ФайлНастроекОтчета = "")Экспорт
	
	СтруктураРезультат = Новый Структура;
	СтруктураРезультат.Вставить("ТипЭлемента", ТипЭлемента);
	СтруктураРезультат.Вставить("ИмяМетаданных", ИмяМетаданных);
	СтруктураРезультат.Вставить("РазделМетаданных", РазделМетаданных);
	СтруктураРезультат.Вставить("ВидФормы", ВидФормы);
	СтруктураРезультат.Вставить("Значение", Значение);
	СтруктураРезультат.Вставить("Настройки", Настройки);	
	СтруктураРезультат.Вставить("ИмяФайлаНастроек", ФайлНастроекОтчета);	
	
	Возврат СтруктураРезультат;
			
КонецФункции

Процедура ПриКопировании(ОбъектКопирования)
	
	Перем СохраненнаяНастройка;
	Перем СтарыеНастройки;
	
	ЭтотОбъект.Владелец = Неопределено;
	
	СохраненнаяНастройка = ОбъектКопирования.ХранилищеНастроек.Получить();
			
	Если ТипЗнч(СохраненнаяНастройка) = Тип("Структура") И СохраненнаяНастройка.РазделМетаданных = "Отчеты" Тогда
		
		ЭтотОбъект.ХранилищеНастроек = Новый ХранилищеЗначения(СохраненнаяНастройка);
				
	КонецЕсли;
			
	//ОбъектКопирования = ЭлементМенюСсылка.ПолучитьОбъект();
	ЗаполнитьЗначенияСвойств(ЭтотОбъект, ОбъектКопирования,,"ХранилищеНастроек, Код, Владелец");
	//ЭтотОбъект.ХранилищеНастроек = Новый ХранилищеЗначения(СтарыеНастройки);
		
	//ФормаЭлемента = ЭтотОбъект.ПолучитьФорму("ФормаЭлемента");
	ЭтотОбъект.РежимРедактированияНеЗаписанногоОбъекта = Истина;
	//ФормаЭлемента.Открыть();
	
	РеквизитСортировки = 0;
	
		//Попытка
		//	НовыйЭлемент.Записать();
		//	Сообщить("Настройки отчета успешно сохранены в новую копию отчета!");
		//Исключение
		//	Сообщить(ОписаниеОшибки());
		//КонецПопытки;
	//КонецЕсли;
	
КонецПроцедуры

РежимРедактированияНеЗаписанногоОбъекта = Ложь;
