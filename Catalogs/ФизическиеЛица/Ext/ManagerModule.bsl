
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//ФУНКЦИИ И ПРОЦЕДУРЫ МОДУЛЯ МЕНЕДЖЕРА

Процедура ОбработкаПолученияДанныхВыбора(ДанныеВыбора, Параметры, СтандартнаяОбработка)
	
	ВариантПодбора = Неопределено;
	
	Параметры.Свойство("ВариантПодбора", ВариантПодбора);
	
	Если ВариантПодбора = "ПодборПомощниковТУ" Тогда
		
		СтандартнаяОбработка = Ложь;
		
		ДанныеВыбора = Новый СписокЗначений;
		
		Запрос = Новый Запрос;
		
		Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	РолиПользователейСоставРоли.Сотрудник КАК Ссылка
		|ИЗ
		//+++ AK suvv 2018.06.08 ИП-00018376.01 
		//|	РегистрСведений.СоответствиеОбъектРоль.СрезПоследних(&ТекущаяДата, ТипРолиID = ""PomoshnikTerrUpravlyushego"") КАК СоответствиеОбъектРольСрезПоследних
		|	РегистрСведений.СоответствиеОбъектРоль.СрезПоследних(&ТекущаяДата, ТипРолиID = ""PomoshnikTerrUpravlyushego"" или ТипРолиID = ""PomoshnikStorRozn"") КАК СоответствиеОбъектРольСрезПоследних
		//--- AK suvv
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.РолиПользователей.СоставРоли КАК РолиПользователейСоставРоли
		|		ПО СоответствиеОбъектРольСрезПоследних.РольПользователя = РолиПользователейСоставРоли.Ссылка
		|ГДЕ
		|	ЕСТЬNULL(РолиПользователейСоставРоли.Сотрудник.Наименование, """") <> """"
		|	И РолиПользователейСоставРоли.Сотрудник.Наименование ПОДОБНО &Наименование
		|
		|СГРУППИРОВАТЬ ПО
		|	РолиПользователейСоставРоли.Сотрудник
		|
		|УПОРЯДОЧИТЬ ПО
		|	Ссылка
		|АВТОУПОРЯДОЧИВАНИЕ";
		
		Запрос.УстановитьПараметр("ТекущаяДата", ТекущаяДата());
		
		Запрос.УстановитьПараметр("Наименование", "%" + Параметры.ТекстПоиска + "%");
		
		Выборка = Запрос.Выполнить().Выбрать();
		
		Пока Выборка.Следующий() Цикл
			ДанныеВыбора.Добавить(Выборка.Ссылка);
		КонецЦикла;
		
	ИначеЕсли ВариантПодбора = "ПодборРуководителей" Тогда
		
		СтандартнаяОбработка = Ложь;
		
		//+++ AK suvv 17.04.2018 ИП-00018442
		//ДанныеВыбора = Новый СписокЗначений;
		//ДанныеВыбора.ТипЗначения = Новый ОписаниеТипов("СправочникСсылка.ФизическиеЛица");
		//
		//МассивРуководителей = РегистрыСведений.ПраваПользователейНаРедактированиеГрафиков.СоздатьНаборЗаписей();
		//МассивРуководителей.Прочитать();
		//
		//Для каждого СтрокаМассиваРуководителей Из МассивРуководителей Цикл
		//	ДанныеВыбора.Добавить(СтрокаМассиваРуководителей.Пользователь.ФизЛицо);	
		//КонецЦикла;		
		
		ДанныеВыбора = Новый СписокЗначений;	
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПраваПользователейНаРедактированиеГрафиков.Пользователь.ФизЛицо КАК ФизЛицо
		|ИЗ
		|	РегистрСведений.ПраваПользователейНаРедактированиеГрафиков КАК ПраваПользователейНаРедактированиеГрафиков
		|ГДЕ
		|	(НЕ ПраваПользователейНаРедактированиеГрафиков.Пользователь.ФизЛицо.РоумингТолькоСвоиЗаявки
		|			ИЛИ ПраваПользователейНаРедактированиеГрафиков.Пользователь.ФизЛицо.РоумингТолькоСвоиЗаявки
		|				И ПраваПользователейНаРедактированиеГрафиков.Пользователь = &ТекущийПользователь)";
		Запрос.УстановитьПараметр("ТекущийПользователь", ПараметрыСеанса.ТекущийПользователь);
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Следующий() Цикл
			ДанныеВыбора.Добавить(Выборка.ФизЛицо);
		КонецЦикла;
	//--- AK suvv 17.04.2018 ИП-00018442
	ИначеЕсли ВариантПодбора = "ПодборПоДолжности" Тогда //+++АК mika 2018.10.31 ИП-00020041
		
		СтандартнаяОбработка = Ложь;
		
		ДанныеВыбора = Новый СписокЗначений;
		
		Запрос = Новый Запрос;
		
		Запрос.Текст = "ВЫБРАТЬ
		|	ФизическиеЛица.Ссылка
		|ИЗ
		|	Справочник.ФизическиеЛица КАК ФизическиеЛица
		|ГДЕ
		|	ФизическиеЛица.Наименование ПОДОБНО &Наименование
		|	И ФизическиеЛица.Должность = &Должность
		|	И НЕ ФизическиеЛица.ПометкаУдаления";
		
		Запрос.УстановитьПараметр("Должность", Параметры.Должность);
		Запрос.УстановитьПараметр("Наименование", СтрЗаменить("%ТекстПоиска%","ТекстПоиска", Параметры.ТекстПоиска));
		
		Результат = Запрос.Выполнить();
		
		Если НЕ Результат.Пустой() Тогда
			Выборка = Результат.Выбрать();
			Пока Выборка.Следующий() Цикл
				ДанныеВыбора.Добавить(Выборка.Ссылка);
			КонецЦикла;
		КонецЕсли;
		
	КонецЕсли;	
	
КонецПроцедуры
