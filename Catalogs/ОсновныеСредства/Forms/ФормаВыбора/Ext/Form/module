
Перем СписокПриОткрытии Экспорт;


Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Если СписокПриОткрытии<>Неопределено Тогда
		СправочникСписок.Отбор.Ссылка.ВидСравнения	= ВидСравнения.ВСписке;
		СправочникСписок.Отбор.Ссылка.Значение		= СписокПриОткрытии;
		СправочникСписок.Отбор.Ссылка.Использование	= Истина;	
	КонецЕсли;
	
КонецПроцедуры


Процедура ИнвентарныйНомерПриИзменении(Элемент)
	
	Если СокрЛП(Элемент.Значение) = "" Тогда
		СправочникСписок.Отбор.ИнвентарныйНомер.Использование 	= Ложь;
		СправочникСписок.Отбор.ИнвентарныйНомер.Значение 		= "";
	Иначе
		СправочникСписок.Отбор.ИнвентарныйНомер.Значение 		= Элемент.Значение;
		СправочникСписок.Отбор.ИнвентарныйНомер.Использование 	= Истина;
	КонецЕсли;
	
	СправочникСписок.Обновить();
	
КонецПроцедуры

Процедура ЗаводскойНомерПриИзменении(Элемент)
	
	Если СокрЛП(Элемент.Значение) = "" Тогда
		СправочникСписок.Отбор.ЗаводскойНомер.Использование = Ложь;
		СправочникСписок.Отбор.ЗаводскойНомер.Значение 		= "";
	Иначе
		СправочникСписок.Отбор.ЗаводскойНомер.Значение 		= Элемент.Значение;
		СправочникСписок.Отбор.ЗаводскойНомер.Использование = Истина;
	КонецЕсли;
	
	СправочникСписок.Обновить();
	
КонецПроцедуры


Процедура СправочникСписокПриПолученииДанных(Элемент, ОформленияСтрок)
	
	//Если НЕ ЗначениеЗаполнено(ЭтаФорма.ДатаОстатков) Тогда
	//	//Возврат;
	//КонецЕсли;
	
	мСписокОС = Новый СписокЗначений;
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		мСписокОС.Добавить(ОформлениеСтроки.ДанныеСтроки.Ссылка);
	КонецЦикла;
	
	Запрос = Новый Запрос;
	//Запрос.УстановитьПараметр("Дата"	, ЭтаФорма.ДатаОстатков);
	Запрос.УстановитьПараметр("Склад"	, ЭтаФорма.Склад);
	Запрос.УстановитьПараметр("ЦФО"		, ЭтаФорма.ЦФО);
	Запрос.УстановитьПараметр("СписокОС", мСписокОС);
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	МАКСИМУМ(ФинансовыйОстатки.Счет) КАК СчетУчета,
	|	ФинансовыйОстатки.Субконто3 КАК ОсновноеСредство,
	|	СУММА(ФинансовыйОстатки.СуммаОстаток) КАК СуммаОстаток
	|ИЗ
	|	РегистрБухгалтерии.Финансовый.Остатки(
	|			,
	|			Счет В ИЕРАРХИИ (ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ОсновныеСредства)),
	|			,
	|			Субконто1 = &ЦФО
	|				И Субконто2 = &Склад
	|				И Субконто3 В (&СписокОС)) КАК ФинансовыйОстатки
	|
	|СГРУППИРОВАТЬ ПО
	|	ФинансовыйОстатки.Субконто3";
	тзОС = Запрос.Выполнить().Выгрузить();
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		
		пСтрока = тзОС.Найти(ОформлениеСтроки.ДанныеСтроки.Ссылка, "ОсновноеСредство");
		Если пСтрока = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		ОформлениеСтроки.Ячейки.СчетУчета.УстановитьТекст(СокрЛП(пСтрока.СчетУчета.Код));	
		ОформлениеСтроки.Ячейки.ОстаточнаяСтоимость.УстановитьТекст(Формат(пСтрока.СуммаОстаток, "ЧДЦ=2"));	
		
	КонецЦикла;
	
КонецПроцедуры
