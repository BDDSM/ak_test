
&НаКлиенте
Процедура ПерейтиКОтчету(Команда)
	Если НовыйЭлемент Тогда
		Режим = РежимДиалогаВопрос.ДаНет;
		Ответ = Вопрос(НСтр("ru = 'Для продолжения, отчет должен быть записан. Продолжить выполнение операции?';"), Режим, 0);
		Если Ответ = КодВозвратаДиалога.Нет Тогда
			Возврат;
		КонецЕсли;
		ДобавитьНовыйОтчет();
	КонецЕсли;
	П = Новый Структура("Ключ", Объект.Ссылка);
	ОткрытьФорму("Справочник.ОтчетМСФО.Форма.ФормаЭлемента",П);		
КонецПроцедуры

&НаСервере
Процедура ДобавитьНовыйОтчет()
	СправочникОбъект = РеквизитФормыВЗначение("Объект");
	СправочникОбъект.Записать();
	ЗначениеВРеквизитФОрмы(СправочникОбъект,"Объект");
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	НовыйЭлемент = Объект.Ссылка.Пустая();
	Если НовыйЭлемент Тогда 
		Объект.ДатаНачало = НачалоГода(ТекущаяДата());
		Объект.ДатаКонец = КонецГода(ТекущаяДата());
	КонецЕсли;
	Год = Формат(Объект.ДатаНачало,"ДФ=yyyy");
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Год = Формат(Объект.ДатаНачало,"ДФ=yyyy");
	ТекПользователь = Справочники.Пользователи.НайтиПоРеквизиту("ИдентификаторПользователяИБ",ПользователиИнформационнойБазы.ТекущийПользователь().УникальныйИдентификатор);
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ЗначенияДополнительныхПравПользователя.Пользователь,
	               |	ЗначенияДополнительныхПравПользователя.Право,
	               |	ЗначенияДополнительныхПравПользователя.Значение КАК ДоступностьРедактирования
	               |ИЗ
	               |	РегистрСведений.ЗначенияДополнительныхПравПользователя КАК ЗначенияДополнительныхПравПользователя
	               |ГДЕ
	               |	ЗначенияДополнительныхПравПользователя.Пользователь = &Пользователь
	               |	И ЗначенияДополнительныхПравПользователя.Право = &Право";
	Запрос.УстановитьПараметр("Пользователь", ТекПользователь);
	Запрос.УстановитьПараметр("Право", ПредопределенноеЗначение("ПланВидовХарактеристик.ПраваПользователей.ДоступКОтчетамМСФО"));
	Рез = Запрос.Выполнить();
	Если НЕ Рез.Пустой() Тогда
		ДопПрава = Рез.Выгрузить();
		ЭтаФорма.Доступность = ДопПрава[0].ДоступностьРедактирования;
	Иначе
		ЭтаФорма.Доступность = Ложь;
	КонецЕсли;
	//Если РольДоступна("ПолныеПрава") Тогда
	//	ЭтаФорма.Доступность = Истина;
	//КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ГодПредыдущий(Команда)
	Объект.ДатаНачало = НачалоГода(Объект.ДатаКонец - 3600*24*366);
	Объект.ДатаКонец = КонецГода(Объект.ДатаНачало);
	Год = Формат(Объект.ДатаНачало,"ДФ=yyyy");
КонецПроцедуры

&НаКлиенте
Процедура ГодСледующий(Команда)
	Объект.ДатаНачало = НачалоГода(Объект.ДатаНачало + 3600*24*366);
	Объект.ДатаКонец = КонецГода(Объект.ДатаНачало);
	Год = Формат(Объект.ДатаНачало,"ДФ=yyyy");
КонецПроцедуры
