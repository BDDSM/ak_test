
Процедура ОбновитьНажатие(Элемент)
	
	ОбновитьТЗ();
	
КонецПроцедуры

Процедура ОбновитьТЗ()
	УстановитьПривилегированныйРежим(Истина);
	//Запрос = Новый Запрос;
	//Запрос.Текст = 
	//"ВЫБРАТЬ
	//|	ДанныеПоОтпускамСотрудниковИзЗУП.Сотрудник,
	//|	ДанныеПоОтпускамСотрудниковИзЗУП.КонтактыЗаместителя,
	//|	ДанныеПоОтпускамСотрудниковИзЗУП.Заместитель,
	//|	ДанныеПоОтпускамСотрудниковИзЗУП.ДатаС,
	//|	ДанныеПоОтпускамСотрудниковИзЗУП.ДатаПо
	//|ИЗ
	//|	РегистрСведений.ДанныеПоОтпускамСотрудниковИзЗУП КАК ДанныеПоОтпускамСотрудниковИзЗУП
	//|ГДЕ
	//|	ДанныеПоОтпускамСотрудниковИзЗУП.ДатаС <= &ТекДатаПлюсДвеНедели
	//|	И ДанныеПоОтпускамСотрудниковИзЗУП.ДатаПо >= &ТекДата";
	//
	//Запрос.УстановитьПараметр("ТекДата", ТекущаяДата());
	//Запрос.УстановитьПараметр("ТекДатаПлюсДвеНедели", ТекущаяДата() + 1209600);
	
	//ХранилищеСистемныхНастроек.Удалить(ЭтаФорма);
	
	ТекДата = ТекущаяДата();
	ЭтаФорма.Заголовок = "Данные об отпусках за "+ Формат(ТекДата, "ДФ=ММММ");

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДанныеПоОтпускамСотрудниковИзЗУП.Сотрудник,
		|	ДанныеПоОтпускамСотрудниковИзЗУП.КонтактыЗаместителя,
		|	ДанныеПоОтпускамСотрудниковИзЗУП.Заместитель,
		|	ДанныеПоОтпускамСотрудниковИзЗУП.ДатаС КАК ДатаС,
		|	ДанныеПоОтпускамСотрудниковИзЗУП.ДатаПо,
		|	ДанныеПоОтпускамСотрудниковИзЗУП.РуководительСотрудника,
		|	ДанныеПоОтпускамСотрудниковИзЗУП.КонтактыРуководителя
		|ИЗ
		|	РегистрСведений.ДанныеПоОтпускамСотрудниковИзЗУП КАК ДанныеПоОтпускамСотрудниковИзЗУП
		|ГДЕ
		|	(ДанныеПоОтпускамСотрудниковИзЗУП.ДатаС МЕЖДУ &НачМесяц И &КонМесяц
		|			ИЛИ ДанныеПоОтпускамСотрудниковИзЗУП.ДатаПо МЕЖДУ &НачМесяц И &КонМесяц)
		|
		|УПОРЯДОЧИТЬ ПО
		|	ДатаС";

	Запрос.УстановитьПараметр("НачМесяц", НачалоМесяца(ТекДата));
	Запрос.УстановитьПараметр("КонМесяц", КонецМесяца(ТекДата));
     
	ТЗ_Отпусков.Очистить();
	ТЗ_Отпусков = Запрос.Выполнить().Выгрузить().Скопировать();	
	ЭтаФорма.Обновить();
	
КонецПроцедуры


Процедура ПриОткрытии()
	
	ОбновитьТЗ();
	ПодключитьОбработчикОжидания("ОбновитьТЗ", 120);	
	
КонецПроцедуры


Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	ОтключитьОбработчикОжидания("ОбновитьТЗ");
КонецПроцедуры

