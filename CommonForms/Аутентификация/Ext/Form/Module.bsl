
&НаСервереБезКонтекста
Функция СохранитьВыборНаСервере(Пароль)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ПерсоналККМ.Ссылка
	               |ИЗ
	               |	Справочник.ПерсоналККМ КАК ПерсоналККМ
	               |ГДЕ
	               |	ПерсоналККМ.Пароль = &Пароль";
				   
	Запрос.УстановитьПараметр("Пароль", СокрЛП(Пароль));
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		ПараметрыСеанса.ТекущийПродавец = Выборка.Ссылка;
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура СохранитьВыбор(Команда)
	
	Если НЕ СохранитьВыборНаСервере(Пароль) Тогда
		Предупреждение("Не найден пользователь с таким паролем. Вход в систему не произведен.");
	Иначе
		Закрыть(Истина);
	КонецЕсли;		
		
КонецПроцедуры

&НаКлиенте
Процедура ЗакрытьФорму(Команда)
	
	Закрыть(Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если ПриОткрытииНаСервере() Тогда
		//ЭтаФорма.Закрыть(0);
	КонецЕсли;	
		
КонецПроцедуры

&НаСервереБезКонтекста
Функция ПриОткрытииНаСервере()
	
	Возврат РольДоступна("ПолныеПрава");
	
КонецФункции

&НаКлиенте
Процедура ПарольПриИзменении(Элемент)
	
	Если НЕ СохранитьВыборНаСервере(Пароль) Тогда
		Предупреждение("Не найден пользователь с таким паролем. Вход в систему не произведен.");
		Пароль = "";
	Иначе
		Закрыть(Истина);
	КонецЕсли;	
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если НЕ Параметры.ОткрытаПриНачале Тогда
		Элементы.Закрыть.Заголовок = "Отмена";
	КонецЕсли;	
	
КонецПроцедуры

&НаКлиенте
Процедура ВнешнееСобытие(Источник, Событие, Данные)
	
	Если Источник = "KeyboardHook" Тогда
		Если Данные = "00122" Тогда
			ШтрихКодОбработанФормой = Истина;
		КонецЕсли;	
	КонецЕсли;
	
КонецПроцедуры
