
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Если НЕ ЗначениеЗаполнено(ДействуетС) Тогда
		Сообщить("Перед установкой следует заполнить дату начала действия");
		Возврат;
	КонецЕсли;	
	
	ПостроительОтчета.Параметры.Вставить("ДатаC", ДействуетС);
	
	ЗапросКлассы = Новый Запрос();
	ЗапросКлассы.Текст = "ВЫБРАТЬ
	                     |	КоличествоПродавцовНаТочкахСрезПоследних.ТорговаяТочка,
	                     |	КоличествоПродавцовНаТочкахСрезПоследних.ВРабочиеДни,
	                     |	КоличествоПродавцовНаТочкахСрезПоследних.ВВыходныеДни
	                     |ИЗ
	                     |	РегистрСведений.КоличествоПродавцовНаТочках.СрезПоследних(&ДатаСреза, ) КАК КоличествоПродавцовНаТочкахСрезПоследних";
						 
	ЗапросКлассы.УстановитьПараметр("ДатаСреза",  НачалоДня(ДействуетС) - 1);
	
	ТабКлассы = ЗапросКлассы.Выполнить().Выгрузить();
	
	ПостроительОтчета.Выполнить();
	
	Выборка = ПостроительОтчета.Результат.Выбрать();
	Пока Выборка.Следующий() Цикл
		Запись = РегистрыСведений.КоличествоПродавцовНаТочках.СоздатьМенеджерЗаписи();
		Запись.Период = ДействуетС;
		Запись.ТорговаяТочка = Выборка.Ссылка;
		Запись.ВРабочиеДни = КлассВРабочие;
		Запись.ВВыходныеДни = КлассВВыходные;
		Запись.Записать();
		Если ЗначениеЗаполнено(ДействуетДо) Тогда
			СтрокаСтарое = ТабКлассы.Найти(Выборка.Ссылка, "ТорговаяТочка");
			Если СтрокаСтарое <> Неопределено Тогда
				Запись = РегистрыСведений.КоличествоПродавцовНаТочках.СоздатьМенеджерЗаписи();
				Запись.Период = ДействуетДо + 86400;
				Запись.ТорговаяТочка = Выборка.Ссылка;
				Запись.ВРабочиеДни = СтрокаСтарое.ВРабочиеДни;
				Запись.ВВыходныеДни =СтрокаСтарое.ВВыходныеДни;
				Запись.Записать();
			КонецЕсли;	
		КонецЕсли;	
	КонецЦикла;
	
	Предупреждение("Значения успешно установлены");
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	ДействуетС = ТекущаяДата();
	КлассВРабочие = 10;
	КлассВВыходные = 10;
	
КонецПроцедуры

ПостроительОтчета.Текст = "ВЫБРАТЬ
                          |	СтруктурныеЕдиницы.Ссылка
                          |ИЗ
                          |	Справочник.СтруктурныеЕдиницы КАК СтруктурныеЕдиницы
                          |ГДЕ
                          |	СтруктурныеЕдиницы.НомерТочки > 0
                          |	И СтруктурныеЕдиницы.ДатаЗакрытия < &ДатаC
                          |{ГДЕ
                          |	СтруктурныеЕдиницы.Ссылка.* КАК ТТ}";
						  
ПостроительОтчета.Отбор.Добавить("ТТ");