
/////////////////////////////////////////////////////////////////////////////
// ФОРМА, ЭЛЕМЕНТЫ
////////////////////////////////////////////////////////////////////////////

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЗагрузитьОсновныеТаблицыСервер();	
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаЗаписиНового(НовыйОбъект, Источник, СтандартнаяОбработка)
	
	ЗагрузитьОсновныеТаблицыСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура Обновить(Команда)
	
	ЗагрузитьОсновныеТаблицыСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура PromoВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ОткрытьФормуРедактированияСтроки(Элементы.text_kkm_main.ТекущиеДанные.id_text_kkm_main);
		
КонецПроцедуры

&НаКлиенте
Процедура РедактироватьТекущееПромо(Команда)
	
	ОткрытьФормуРедактированияСтроки(Элементы.text_kkm_main.ТекущиеДанные.id_text_kkm_main);
	
КонецПроцедуры


/////////////////////////////////////////////////////////////////////////////
// ОСТАЛЬНОЕ
/////////////////////////////////////////////////////////////////////////////

&НаСервере
Процедура ЗагрузитьОсновныеТаблицыСервер()
	
	Об = РеквизитФормыВЗначение("Объект");
	Об.ЗаполнитьОсновнуюТаблицу();
	ЗначениеВРеквизитФормы(Об, "Объект");
	
КонецПроцедуры

&НаСервере
Функция ВыгрузитьДанныеСервер(ИмяТЧ, УИД)
	
	Если ИмяТЧ = "text_kkm_main" Тогда
		ТЗ = Объект.text_kkm_main.Выгрузить();
	КонецЕсли;
	
	Возврат ПоместитьВоВременноеХранилище(ТЗ, УИД);
	
КонецФункции

&НаКлиенте
Процедура ДобавитьНовоеПромо(Команда)
	
	ОткрытьФормуРедактированияСтроки(0);		
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуРедактированияСтроки(id_text_kkm_main)
	
	АдресХранилищаtext_kkm_main = ВыгрузитьДанныеСервер("text_kkm_main", ЭтаФорма.УникальныйИдентификатор);
		
	фрм = ПолучитьФорму("Обработка.РаботаСТекстамиЕЛУ.Форма.РедактированиеСтроки", Новый Структура("id_text_kkm_main", id_text_kkm_main), ЭтаФорма);
	фрм.АдресХранилищаtext_kkm_main = АдресХранилищаtext_kkm_main; 	
	фрм.Открыть();

КонецПроцедуры


&НаКлиенте
Процедура УдалитьСтроку(Команда)
	
	ТекДанные = Элементы.text_kkm_main.ТекущиеДанные;
	
	Если ТекДанные = Неопределено Тогда
		ОбщегоНазначения.СообщитьОбОшибке("Для удаления необходимо выделить строку, которую необходимо пересчитать.");
		Возврат;
	КонецЕсли;
	
	ВыполнитьУдалениеСтрокиСервер(текДанные.id_text_kkm_main);
	
	ЗагрузитьОсновныеТаблицыСервер();
	
КонецПроцедуры

&НаСервере
Процедура ВыполнитьУдалениеСтрокиСервер(id_text_kkm_main)
	
	Об = РеквизитФормыВЗначение("Объект");
	Об.УдалитьСтроку(id_text_kkm_main);
	ЗначениеВРеквизитФормы(Об, "Объект");
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Элементы.text_kkm_mainУдалитьСтроку.Доступность = ВернутьДоступностьРолиПолныеПрава();
	
КонецПроцедуры

&НаСервере
Функция ВернутьДоступностьРолиПолныеПрава()
	
	Возврат РольДоступна("ПолныеПрава");
	
КонецФункции




