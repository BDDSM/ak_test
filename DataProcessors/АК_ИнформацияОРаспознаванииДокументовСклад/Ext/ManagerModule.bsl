
//+++ АК LUZA 2017.10.25 ИП-00016964
Функция ПолучитьТаблицуПриходныхОрдеров(Знач Ответсвенный = Неопределено) Экспорт
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	РолиПользователейСоставРоли.Ссылка
	|ПОМЕСТИТЬ ВТ_Роли
	|ИЗ
	|	Справочник.РолиПользователей.СоставРоли КАК РолиПользователейСоставРоли
	|ГДЕ
	|	РолиПользователейСоставРоли.Ссылка.ПометкаУдаления = ЛОЖЬ
	|	И РолиПользователейСоставРоли.Сотрудник = &Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения,
	|	МАКСИМУМ(АК_ОчередьРаспознаванияФайлов.РезультатСравнения) КАК РезультатСравнения
	|ПОМЕСТИТЬ ВТ_Предв
	|ИЗ
	|	РегистрСведений.АК_ОчередьРаспознаванияФайлов КАК АК_ОчередьРаспознаванияФайлов
	|ГДЕ
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения ССЫЛКА Документ.ПриходныйОрдерСклад
	|	И АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Дата >= &Дата
	|	И АК_ОчередьРаспознаванияФайлов.Обработан = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения
	|
	|ИМЕЮЩИЕ
	|	МАКСИМУМ(АК_ОчередьРаспознаванияФайлов.РезультатСравнения) = ЛОЖЬ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения КАК ПриходныйОрдер,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Поставщик.ИНН КАК ИНН_В_ПО,
	|	МАКСИМУМ(ЗначенияСвойствОбъектов.Значение) КАК ИНН_В_Файле,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Поставщик,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Поставщик.ЮрФизЛицо КАК ЮрФизЛицо,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Склад,
	|	ЛОЖЬ КАК ИННКоректен
	|ИЗ
	|	РегистрСведений.АК_ОчередьРаспознаванияФайлов КАК АК_ОчередьРаспознаванияФайлов
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Предв КАК ВТ_Предв
	|		ПО АК_ОчередьРаспознаванияФайлов.ОбъектСравнения = ВТ_Предв.ОбъектСравнения
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
	|		ПО АК_ОчередьРаспознаванияФайлов.Файл = ЗначенияСвойствОбъектов.Объект
	|			И (ЗначенияСвойствОбъектов.Свойство = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СвойстваОбъектов.Файлы_Склад_ПоставщикИНН))
	|ГДЕ
	|	ЗначенияСвойствОбъектов.Значение <> """"
	|	И ЗначенияСвойствОбъектов.Значение <> НЕОПРЕДЕЛЕНО
	|	И ВЫБОР
	|			КОГДА &ЕстьОтборПОАвтору = ИСТИНА
	|				ТОГДА АК_ОчередьРаспознаванияФайлов.Автор = &Автор
	|						ИЛИ АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Автор = &Автор
	|						ИЛИ ВЫБОР
	|							КОГДА АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Склад = &Склад
	|									И &ФункцРоль В
	|										(ВЫБРАТЬ
	|											ВТ_Роли.Ссылка
	|										ИЗ
	|											ВТ_Роли)
	|								ТОГДА ИСТИНА
	|							ИНАЧЕ ЛОЖЬ
	|						КОНЕЦ
	|			ИНАЧЕ ИСТИНА
	|		КОНЕЦ
	|
	|СГРУППИРОВАТЬ ПО
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Поставщик,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Поставщик.ИНН,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Поставщик.ЮрФизЛицо,
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Склад
	|
	|УПОРЯДОЧИТЬ ПО
	|	АК_ОчередьРаспознаванияФайлов.ОбъектСравнения.Дата";
	
	Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.Файлы_Склад_ПоставщикИНН);
	Запрос.УстановитьПараметр("Дата", НачалоДня(ТекущаяДата() - 10*24*60*60));
	
	Запрос.УстановитьПараметр("Автор", Ответсвенный);       	
	
	Запрос.УстановитьПараметр("Склад", Справочники.Склады.НайтиПоКоду("000000295"));      //Кавказский
	
	Запрос.УстановитьПараметр("ФункцРоль", Справочники.РолиПользователей.НайтиПоКоду("00080"));        	
	       	 	
	
	Если ЗначениеЗаполнено(Ответсвенный) = Ложь ИЛИ Ответсвенный = Неопределено Тогда		
		Запрос.УстановитьПараметр("ЕстьОтборПОАвтору", Ложь);
		Запрос.УстановитьПараметр("Сотрудник", Справочники.ФизическиеЛица.ПустаяСсылка());		
	Иначе
		Запрос.УстановитьПараметр("ЕстьОтборПОАвтору", Истина);		
		Запрос.УстановитьПараметр("Сотрудник", Ответсвенный.ФизЛицо);						
	КонецЕсли;	
	
	ТЗ = Запрос.Выполнить().Выгрузить();
	
	Для каждого Стр ИЗ ТЗ Цикл		
		Стр.ИННКоректен = Макс(РегламентированнаяОтчетность.ИННСоответствуетТребованиям(Стр.ИНН_В_Файле, Перечисления.ЮрФизЛицо.ФизЛицо)
		,РегламентированнаяОтчетность.ИННСоответствуетТребованиям(Стр.ИНН_В_Файле, Перечисления.ЮрФизЛицо.ЮрЛицо));		
	КонецЦикла;
	
	Фильтр = Новый Структура("ИННКоректен", Истина);
	
	ТЗРезультат = ТЗ.Скопировать(Фильтр);
	
	Возврат ТЗРезультат;
	
КонецФункции
//--- АК LUZA 2017.10.25 ИП-00016964