
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Объект.access_token = РаботаССайтомВКонтакте.access_tokenПолучить();
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбратьФайл(Команда)
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Если Диалог.Выбрать() Тогда
		Объект.file_name = Диалог.ПолноеИмяФайла;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура РазместитьЗапись(Команда)
	
	Если Не ПустаяСтрока(Объект.file_name) Тогда
		
		Попытка
			Параметрыизображения = РаботаССайтомВКонтакте.ЗагрузитьФотографиюНаСтену(Объект.access_token, Объект.owner_id,, Новый ДвоичныеДанные(Объект.file_name));
			attachments = РаботаССайтомВКонтакте.СохранитьЗагруженнуюФотографиюНаСтене(Объект.access_token,
								Параметрыизображения.server, Параметрыизображения.photo, Параметрыизображения.hash, Объект.owner_id).id;
		Исключение
			Сообщить("Ошибка при загрузке изображения на стену: " + ОписаниеОшибки());
			Возврат;
		КонецПопытки;
		
	КонецЕсли;
	
	Попытка
		comment_id = РаботаССайтомВКонтакте.ДобавитьКомментарийКЗаписиНаСтене(Объект.access_token, Объект.owner_id, Объект.post_id, Объект.message,, attachments);
		Сообщить("Комментарий успешно размещён. comment_id = " + comment_id);
	Исключение
		Сообщить("Ошибка при размещении комментария на стене: " + ОписаниеОшибки());
	КонецПопытки;
	
КонецПроцедуры
