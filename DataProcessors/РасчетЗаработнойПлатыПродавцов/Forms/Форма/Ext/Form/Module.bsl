
&НаКлиенте
Процедура Расчитать(Команда)
	
	Если Не ПроверитьЗаполнение()Тогда
		Возврат;
	КонецЕсли;
	
	Если Объект.НачалоПериода > Объект.КонецПериода Тогда
		Предупреждение("Начало периода расчета больше окончания! Расчет не выполнен!");
		Возврат;
	КонецЕсли;
	
	ГраницаЗапретаРасчетаЗП = ПолучитьГраницуЗапретаРасчетаЗП();
	Если ЗначениеЗаполнено(ГраницаЗапретаРасчетаЗП) И ГраницаЗапретаРасчетаЗП > Объект.НачалоПериода Тогда
		Предупреждение("Начало расчета з/п должно быть не менше " + Формат(ГраницаЗапретаРасчетаЗП+86400, "ДФ=dd.MM.yyyy") + "! Расчет не выполнен!");
		Возврат;
	КонецЕсли;
	
	Состояние("Выполняется расчет ЗП...");
	ВыполнитьРасчетНаСервере();
	Предупреждение("Расчет ЗП выполнен", 10);
	
КонецПроцедуры

&НаСервере
Процедура ВыполнитьРасчетНаСервере()
	
	ОбъектОбработки = РеквизитФормыВЗначение("Объект");
	ОбъектОбработки.РасчитатьЗарплатуПродавцов();
		
КонецПроцедуры

&НаСервере
Функция ПолучитьГраницуЗапретаРасчетаЗП()
	Возврат Константы.ГраницаЗапретаРасчетаЗППродавцов.Получить();
КонецФункции

&НаКлиенте
Процедура УстановитьКонстанты(Команда)
	
	ОткрытьФорму("Обработка.РасчетЗаработнойПлатыПродавцов.Форма.ФормаКонстанты");
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Элементы.ФормаУстановитьКонстанты.Доступность = УправлениеДопПравамиПользователей.ПолучитьПравоПользователяУпр(ПланыВидовХарактеристик.ПраваПользователей.РедактированиеКонстантыГранизаЗапретаРасчетаЗППродавцов, Ложь);
	
КонецПроцедуры
