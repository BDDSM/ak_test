//+++АК sole 2018.07.13 ИП-00018320.04
&НаКлиенте
Процедура СформирорватьДокументы(Команда)
	
	Перем МассивСсылок;
		
	// проверка на существование документов "Маршрутный лист" (Возврат Поставщику) в этот день. Если существуют - удалять совсем.
	МассивСсылок = ПолучитьСозданныеДокументы_НаСервере();
	Если МассивСсылок.Количество() > 0 Тогда
		Если Вопрос("В указанную дату есть созданные документы ""Рейс"" (Возврат Поставщику). Пометить на удаление?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
			Возврат;
		КонецЕсли;
		
		УдалитьСуществующиеДокументы_НаСервере(МассивСсылок);
	КонецЕсли;
		
	// создание новых документов "Маршрутный лист" (Возврат Поставщику)
	СформирорватьДокументы_НаСервере();	
КонецПроцедуры

//+++АК sole 2018.07.13 ИП-00018320.04
&НаСервере
Функция ПолучитьСозданныеДокументы_НаСервере()
	
	Перем ЭтотОбъект;
	
	ЭтотОбъект = РеквизитФормыВЗначение("Объект");
	Возврат ЭтотОбъект.ПолучитьСозданныеДокументы();
	
КонецФункции

//+++АК sole 2018.07.13 ИП-00018320.04
&НаСервере
Функция УдалитьСуществующиеДокументы_НаСервере(МассивСсылок)
	
	Перем ЭтотОбъект;
	
	ЭтотОбъект = РеквизитФормыВЗначение("Объект");
	ЭтотОбъект.УдалитьСуществующиеДокументы(МассивСсылок, Истина);
	
КонецФункции
	
//+++АК sole 2018.07.13 ИП-00018320.04
&НаСервере
Процедура СформирорватьДокументы_НаСервере()
	
	Перем ЭтотОбъект;
	
	ЭтотОбъект = РеквизитФормыВЗначение("Объект");
	ЭтотОбъект.СформироватьДокументы(Истина);
КонецПроцедуры


//+++АК sole 2018.07.13 ИП-00018320.04
&НаКлиенте
Процедура ПеревозчикНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь; 
	ФормаВыбора = ОткрытьФорму("Справочник.Контрагенты.Форма.ФормаВыбораУправляемая",, Элемент);
	ОсновнойОтбор = ФормаВыбора.Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОсновнойОтбор.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	ОсновнойОтбор.Использование = Истина;
	ОсновнойОтбор.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Родитель");
	ОсновнойОтбор.ПравоеЗначение = ПолучитьСсылкуГруппаКонтрагентовТранспорт();
	
	ФормаВыбора.Элементы.Список.Отображение = ОтображениеТаблицы.Список;
КонецПроцедуры

//+++АК sole 2018.07.13 ИП-00018320.04
&НаСервере
Функция ПолучитьСсылкуГруппаКонтрагентовТранспорт()
	Возврат Справочники.Контрагенты.НайтиПоКоду("000000519");		
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ЭтаФорма.Объект.ДатаРейсов = ТекущаяДата();
	ЭтаФорма.Объект.Организация = Справочники.Организации.НайтиПоКоду("000000006"); //Вкусвилл
КонецПроцедуры
