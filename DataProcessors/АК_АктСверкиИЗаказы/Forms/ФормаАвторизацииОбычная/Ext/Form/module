
Процедура КнопкаВыполнитьНажатие(Кнопка)
	Если Не ЗначениеЗаполнено(Логин) Тогда
	    Сообщить("Введите ИНН");
		Возврат;
	КонецЕсли; 
	Если ВведенПароль() Тогда
		ФормаСверки=ЭтотОбъект.ПолучитьФорму("ФормаСверкиОбычная");
		ФормаСверки.Организация=Справочники.Организации.НайтиПоРеквизиту("ИНН",Логин);
		
		ФормаСверки.Открыть();
		Закрыть();
	КонецЕсли; 
	
КонецПроцедуры

Функция ВведенПароль()
	//Возврат Истина;
	Прокси = ПолучитьПрокси();
	
	Если Прокси = Неопределено Тогда
		Сообщить(НСтр("ru='Не удалось установить соединение с информационной базой.';en='Could not establish a connection to the database.'"));
		Возврат Ложь;
	КонецЕсли;
	
	СтруктураДанных = Новый Структура("ИНН, Пароль", Логин, Пароль);
	ДанныеМП = Новый ХранилищеЗначения(СтруктураДанных, Новый СжатиеДанных(9));
	
	Попытка 
		СтруктураОтвета = Прокси.ВведенПароль(ДанныеМП);	
	Исключение
		Сообщить("Не удалось получить данные по причине: " + ОписаниеОшибки());
		Возврат Ложь;
	КонецПопытки; 
	Если СтруктураОтвета Тогда
		Возврат Истина;
	Иначе
		Сообщить ("Не удалось авторизоваться в центральной базе") ;
		Возврат Ложь;
	КонецЕсли; 	
КонецФункции 

Процедура СохранитьНастройки()
	ХранилищеОбщихНастроек.Сохранить("ИННДляОбработкиАктСверки",,Логин);
	СоотПароль=Новый Соответствие;
	СоотПароль.Вставить(Логин, Пароль);
	ХранилищеОбщихНастроек.Сохранить("ПарольДляОбработкиАктСверки",,СоотПароль);	
КонецПроцедуры
//
Процедура ПриОткрытии()
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Организации.ИНН
		|ИЗ
		|	Справочник.Организации КАК Организации
		|ГДЕ
		|	НЕ Организации.ПометкаУдаления";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		ЭлементыФормы.Логин.СписокВыбора.Добавить(ВыборкаДетальныеЗаписи.ИНН);
		Если ВыборкаДетальныеЗаписи.Количество()=1 Тогда
		     Логин=ВыборкаДетальныеЗаписи.ИНН;
		КонецЕсли; 
	КонецЦикла;
	ИНН=ХранилищеОбщихНастроек.Загрузить("ИННДляОбработкиАктСверки");
	Если ЗначениеЗаполнено(ИНН) Тогда
		Логин=ИНН;	
	КонецЕсли;
	СоотПароль=ХранилищеОбщихНастроек.Загрузить("ПарольДляОбработкиАктСверки");
	Если ЗначениеЗаполнено(СоотПароль) Тогда
		Пароль=СоотПароль[Логин];	
	КонецЕсли; 

КонецПроцедуры

Процедура ПриЗакрытии()
	СохранитьНастройки();
КонецПроцедуры
