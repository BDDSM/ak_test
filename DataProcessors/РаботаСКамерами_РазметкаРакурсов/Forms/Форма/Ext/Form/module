
Процедура УстановитьТекстHTML(ИмяФайла)

	
	//
	ТекстHTML = ПолучитьМакет("МакетHTML").ПолучитьТекст();
	ТекстHTML = СтрЗаменить(ТекстHTML, "&file", "'" + ИмяФайла + "'");
	
	//
	ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(ТекстHTML);
	
КонецПроцедуры


Процедура ПолеHTMLДокумента_onclick(Элемент, pEvtObj)
	
	//
	ДанныеВыделения = pEvtObj.data;

	//
	стрДанныеВыделения = СтрЗаменить(ДанныеВыделения, "{", "");
	стрДанныеВыделения = СтрЗаменить(стрДанныеВыделения, "}", "");
	стрДанныеВыделения = СтрЗаменить(стрДанныеВыделения, ",", Символы.ПС);
	
	//
	СтруктураКоординат = Новый Структура;
	
	//
	Для Сч = 1 По СтрЧислоСтрок(стрДанныеВыделения) Цикл
		
		//
		Строка = СтрПолучитьСтроку(стрДанныеВыделения, Сч);
		
		//
		ПозицияРазделителя = Найти(Строка, ":");
		
		//
		Значение = Прав(Строка, СтрДлина(Строка) - ПозицияРазделителя);
		Попытка
			Значение = Число(Значение);
		Исключение
			Значение = -1;
		КонецПопытки;	
		
		//
		Если Значение = -1 Тогда
			Возврат;
		КонецЕсли;	
		
		//
		Если Сч = 1 Тогда
			СтруктураКоординат.Вставить("X1", Значение);
		ИначеЕсли Сч = 2 Тогда
			СтруктураКоординат.Вставить("Y1", Значение);
		ИначеЕсли Сч = 3 Тогда
			СтруктураКоординат.Вставить("X2", СтруктураКоординат.X1 + Значение);
			СтруктураКоординат.Вставить("X3", СтруктураКоординат.X1 + Значение);
			СтруктураКоординат.Вставить("X4", СтруктураКоординат.X1);
		ИначеЕсли Сч = 4 Тогда
			СтруктураКоординат.Вставить("Y2", СтруктураКоординат.Y1);
			СтруктураКоординат.Вставить("Y3", СтруктураКоординат.Y1 + Значение);
			СтруктураКоординат.Вставить("Y4", СтруктураКоординат.Y1 + Значение);
		ИначеЕсли Сч = 5 Тогда	
			СтруктураКоординат.Вставить("image_left", Значение);
		ИначеЕсли Сч = 6 Тогда	
			СтруктураКоординат.Вставить("image_top", Значение);	
		ИначеЕсли Сч = 7 Тогда	
			СтруктураКоординат.Вставить("image_bottom", Значение);		
		ИначеЕсли Сч = 8 Тогда	
			СтруктураКоординат.Вставить("image_right", Значение);			
		КонецЕсли;	
		
	КонецЦикла;
	
	//
	ШиринаИзображения = (СтруктураКоординат.image_right - СтруктураКоординат.image_left);
	ВысотаИзображения = (СтруктураКоординат.image_bottom - СтруктураКоординат.image_top);
	
	//
	X1 = СтруктураКоординат.X1/ШиринаИзображения;
	X2 = СтруктураКоординат.X2/ШиринаИзображения;
	X3 = СтруктураКоординат.X3/ШиринаИзображения;
	X4 = СтруктураКоординат.X4/ШиринаИзображения;
	
	//
	Y1 = СтруктураКоординат.Y1/ВысотаИзображения;
	Y2 = СтруктураКоординат.Y2/ВысотаИзображения;
	Y3 = СтруктураКоординат.Y3/ВысотаИзображения;
	Y4 = СтруктураКоординат.Y4/ВысотаИзображения;
	
	//
	Если ВладелецФормы <> Неопределено Тогда
		
		//
		Форма = ПолучитьФорму("ФормаПодтвержденияКоординат");
		
		//
		Форма.X1 = X1; 
		Форма.X2 = X2;
		Форма.X3 = X3;
		Форма.X4 = X4;
		
		//
		Форма.Y1 = Y1; 
		Форма.Y2 = Y2;
		Форма.Y3 = Y3;
		Форма.Y4 = Y4;
		
		//
		Если Форма.ОткрытьМодально() = Истина Тогда
			
			//
			Структура = Новый Структура;
			
			//
			Структура.Вставить("Магазин", ТекущийМагазин);
			Структура.Вставить("Камера", ТекущаяКамера);
			Структура.Вставить("ОбъектНаблюдения", ТекущийОбъектНаблюдения);
			
			//
			Структура.Вставить("X1", Форма.X1);
			Структура.Вставить("Y1", Форма.Y1);
			
			Структура.Вставить("X2", Форма.X2);
			Структура.Вставить("Y2", Форма.Y2);
			
			Структура.Вставить("X3", Форма.X3);
			Структура.Вставить("Y3", Форма.Y3);
			
			Структура.Вставить("X4", Форма.X4);
			Структура.Вставить("Y4", Форма.Y4);
			
			//
			Закрыть(Структура);
			
		Иначе
			УстановитьТекстHTML(ПутьКИзображению);
		КонецЕсли;	
		
	Иначе
	
		//
		ПараметрыФормы = Новый Структура;
		ПараметрыФормы.Вставить("РежимВыбора", Истина);
		
		//
		ТЗ = "ВЫБРАТЬ
		     |	Таблица.ОбъектНаблюдения
		     |ИЗ
		     |	РегистрСведений.АК_ПривязкаКамерыКОбъектуНаблюдения КАК Таблица
		     |ГДЕ
		     |	Таблица.IDКамеры = &ТекущаяКамера";
			 
		//
		ПЗ = Новый ПостроительЗапроса;
		ПЗ.Текст = ТЗ;
		
		//
		ПЗ.Параметры.Вставить("ТекущаяКамера", ТекущаяКамера);
		
		//
		ПЗ.Выполнить();
		
		//
		Если НЕ ПЗ.Результат.Пустой() Тогда
		
			//
			ФормаСписка = ПолучитьФорму("РегистрСведений.АК_ПривязкаКамерыКОбъектуНаблюдения.Форма.ФормаСпискаУпр", ПараметрыФормы);
		
			//
			ФормаСписка.ОтборКамера = ТекущаяКамера;
		    ФормаСписка.ПризнакНеИгнорироватьПустыеОбъектыНаблюдения = Истина;
			
			//
			ФормаСписка.X1 = X1;
			ФормаСписка.X2 = X2;
			ФормаСписка.X3 = X3;
			ФормаСписка.X4 = X4;
			
			//
			ФормаСписка.Y1 = Y1;
			ФормаСписка.Y2 = Y2;
			ФормаСписка.Y3 = Y3;
			ФормаСписка.Y4 = Y4;
			
			//
			ЗначениеВыбора = ФормаСписка.ОткрытьМодально();
			
		Иначе
			
			//
			ЗначениеВыбора = РегистрыСведений.АК_ПривязкаКамерыКОбъектуНаблюдения.СоздатьМенеджерЗаписи();
			
			//
			ЗначениеВыбора.Период = ТекущаяДата();
			ЗначениеВыбора.IDКамеры = ТекущаяКамера;
			
		КонецЕсли;	
		
		//
		Если ЗначениеВыбора <> Неопределено Тогда
			
			
			//
			Форма = РегистрыСведений.АК_ПривязкаКамерыКОбъектуНаблюдения.ПолучитьФорму("ФормаЗаписи",,ЗначениеВыбора);  
			
			//
			Форма.РегистрСведенийМенеджерЗаписи = РегистрыСведений.АК_ПривязкаКамерыКОбъектуНаблюдения.СоздатьМенеджерЗаписи();
			
			//
			ЗаполнитьЗначенияСвойств(Форма.РегистрСведенийМенеджерЗаписи, ЗначениеВыбора);
			Форма.РегистрСведенийМенеджерЗаписи.Прочитать();
			
			//
			Форма.РегистрСведенийМенеджерЗаписи.IDКамеры = ТекущаяКамера;
			Форма.РегистрСведенийМенеджерЗаписи.ОбъектНаблюдения = ЗначениеВыбора.ОбъектНаблюдения;
			
			//
			Если НЕ ЗначениеЗаполнено(Форма.РегистрСведенийМенеджерЗаписи.ОбъектНаблюдения) Тогда
				Форма.РегистрСведенийМенеджерЗаписи.ОбъектНаблюдения = Справочники.МП_Ракурсы.ПустаяСсылка();
			КонецЕсли;	
			
			//
			Форма.РегистрСведенийМенеджерЗаписи.X1 = X1;
			Форма.РегистрСведенийМенеджерЗаписи.X2 = X2;
			Форма.РегистрСведенийМенеджерЗаписи.X3 = X3;
			Форма.РегистрСведенийМенеджерЗаписи.X4 = X4;
			
			//
			Форма.РегистрСведенийМенеджерЗаписи.Y1 = Y1;
			Форма.РегистрСведенийМенеджерЗаписи.Y2 = Y2;
			Форма.РегистрСведенийМенеджерЗаписи.Y3 = Y3;
			Форма.РегистрСведенийМенеджерЗаписи.Y4 = Y4;
			
			//
			_Результат = Форма.ОткрытьМодально();
			
		КонецЕсли;	
		
		//
		УстановитьТекстHTML(ПутьКИзображению);
		
	КонецЕсли;	
	
	
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	//
	//+++АК ЛЕБВ ПутьКИзображению = "http://10.0.0.190/photos/" + ТекущаяКамера.IDКамеры;
	ПутьКИзображению = "file://10.0.0.51/1c$/MagazinBudush/Work/" + СтрЗаменить(СокрЛП(ТекущаяКамера.IDКамеры),".","-") + ".jpg";
	//---АК ЛЕБВ
	
	//
	УстановитьТекстHTML(ПутьКИзображению);
	
КонецПроцедуры

