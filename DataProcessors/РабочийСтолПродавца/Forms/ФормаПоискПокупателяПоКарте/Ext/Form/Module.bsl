
&НаСервере
Процедура НайтиДанные()
	
	ADOСоединение = ВнешниеДанные.ПолучитьADOСоединение();
	
	ТекстЗапроса = "SELECT [FullName]
				  |	,[Phone]
				  |	
				  |FROM [Loyalty].[dbo].[Customer] (nolock)
				  |WHERE [EMail] = " + ВнешниеДанные.ФорматПоля(НомерКарты);


	rs = ADOСоединение.Execute(ТекстЗапроса);
	Пока rs <> Неопределено И rs.Fields.Count <= 0 Цикл
		rs=rs.NextRecordSet();
	КонецЦикла;
	
	Попытка
		rs.MoveFirst();
		
		Пока НЕ rs.EOF() Цикл
			ФИО = СокрЛП(Rs.Fields("FullName").Value);
			Телефон = СокрЛП(Rs.Fields("Phone").Value);
			rs.MoveNext();
		КонецЦикла;
	Исключение
	КонецПопытки;
	ADOСоединение.Close();
	ADOСоединение = Неопределено;
	
КонецПроцедуры	

&НаКлиенте
Процедура НайтиПоНомеру(Команда)
	
	ФИО = "";
	Телефон = "";
	
	Если НЕ ЗначениеЗаполнено(НомерКарты) Тогда
		Сообщить("Заполните номер карты для поиска");
		Возврат;
	КонецЕсли;	
	
	НайтиДанные();
	
КонецПроцедуры
