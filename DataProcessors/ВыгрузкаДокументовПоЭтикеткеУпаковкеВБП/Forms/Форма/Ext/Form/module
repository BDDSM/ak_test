
Процедура ПриОткрытии()
	
	//+++АК SHEP 2018.05.14 ИП-00018453
	ОтборПостроителя = Построитель.Отбор;
	мЭлементОтбора = ОтборПостроителя.Найти("Организация");
	Если мЭлементОтбора = Неопределено Тогда
		ДоступныеПоляОтбора = ОтборПостроителя.ПолучитьДоступныеПоля();
		ПолеОтбора = ДоступныеПоляОтбора.Добавить("Организация",, Новый ОписаниеТипов("СправочникСсылка.Организации"));
		ПолеОтбора.Отбор = Истина;
		мЭлементОтбора = ОтборПостроителя.Добавить("Организация");
	КонецЕсли;
	мЭлементОтбора.ВидСравнения = ВидСравнения.Равно;
	мЭлементОтбора.Использование = Ложь;
	//---АК SHEP 2018.05.14
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал 	= Истина;
	НастройкаПериода.РедактироватьКакПериод 	= Истина;
	НастройкаПериода.ВариантНастройки 			= ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(ЭтотОбъект.ДатаНачала,
										?(ЭтотОбъект.ДатаОкончания = '0001-01-01', ЭтотОбъект.ДатаОкончания, КонецДня(ЭтотОбъект.ДатаОкончания)));
	Если НастройкаПериода.Редактировать() Тогда
		ЭтотОбъект.ДатаНачала 		= НастройкаПериода.ПолучитьДатуНачала();
		ЭтотОбъект.ДатаОкончания 	= НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
	
КонецПроцедуры

Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	//+++АК Susk (Суслин К.В.) 2018.12.03 полность переписал выгрузку в рамках ИП-00020496	 
	Перем ТекОрганизация, ТекВидСравненияОрг, ТекСтрЕдиница, ТекВидСравненияСтрЕдиница;
	
	Если НЕ (ЗначениеЗаполнено(ДатаНачала)) Тогда
		Предупреждение("Не указан месяц выполнения обработки!");
		Возврат;
	КонецЕсли;
	
	Если ДатаНачала < Дата("20181101") Тогда
		Предупреждение("Выгрузка данных возможна только с 1 ноября 2018 года!");
		Возврат;
	КонецЕсли;
	
	ДатаОкончания = КонецМесяца(ДатаНачала);
	
	Если НЕ (ВыгружатьТребованиеНакладнаяИзПоступленияТоваровУслуг ИЛИ СозданиеИнвентаризацииЭтикеткиУпаковки) Тогда
		Предупреждение("Ничего не выбрано для выгрузки. Выгрузка отменена");
		Возврат;
	КонецЕсли;
	
	ТекОрганизация = Справочники.Организации.ПустаяСсылка();
	
	//+++АК SHEP 2018.05.14 ИП-00018453	
	мЭлементОтбора = Построитель.Отбор.Найти("Организация");
	Если мЭлементОтбора = Неопределено Тогда
		ЕстьОтборПоОрганизации = Ложь;                                          		
	Иначе
		ЕстьОтборПоОрганизации = (мЭлементОтбора.Использование = Истина);
		Если ЕстьОтборПоОрганизации Тогда
			ТекОрганизация 		= мЭлементОтбора.Значение;
			ТекВидСравненияОрг 	= мЭлементОтбора.ВидСравнения;
			Если ТекВидСравненияОрг <> ВидСравнения.Равно Тогда
				 ОбщегоНазначения.СообщитьОбОшибке("Вид сравнения у организации должно быть только на равенство! Выгрузка отменена");
				Возврат;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	//---АК SHEP 2018.05.14	
	
	ВыполнитьВыгрузкуМодульОбъекта(ТекОрганизация);
	
КонецПроцедуры
