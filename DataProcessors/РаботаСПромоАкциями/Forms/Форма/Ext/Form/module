
/////////////////////////////////////////
// Обработчики
////////////////////////////////////////////

Процедура кнПодключитьсяНажатие(Элемент)
	
	мСоединение = АДОКоннекшн_СоздатьОбъект();
    
    Если 0 = АДОДБ_УстановитьСоединение(мСоединение, "база", "сервер", "логин", "пассворд") Тогда
        Предупреждение("Не удалось подключиться...", 30);
        Возврат;
    КонецЕсли;                                        
    
    мРекордсет = АДОРекордсет_СоздатьОбъект(мСоединение);
	
	ЭлементыФормы.тСостояние.ЦветТекста = WebЦвета.ЗеленаяЛужайка;
	ЭлементыФормы.тСостояние.Заголовок = "Подключено к серверу";			
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	ЭлементыФормы.тСостояние.ЦветТекста = WebЦвета.Красный;
	ЭлементыФормы.тСостояние.Заголовок = "Отключено от сервера";
	
КонецПроцедуры

Процедура кнОтключитьсяНажатие(Элемент)
	
	Попытка
		мСоединение.Close();
	Исключение
		Возврат;
	КонецПопытки;
	
	ЭлементыФормы.тСостояние.ЦветТекста = WebЦвета.Красный;
	ЭлементыФормы.тСостояние.Заголовок = "Отключено от сервера";
	
КонецПроцедуры

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	Попытка
		мСоединение.Close();
	Исключение
	КонецПопытки;
	
КонецПроцедуры

Процедура Кнопка1Нажатие(Элемент)
	
	//Fields_znach
	//field
	//name_f
	//Promo_type
	
	
	//Promo
	//id_promo
	//is_active
	//name_sms
	//descr_pr
	//Date_st_pok
	//Date_fi_pok
	//Date_st_pr
	//Date_fi_pr
	//Promo_type
	//Type_perc
	//Sum_cratn
	//weekdays
	//Proc_pr_B
	//Min_fact_B
	
	//Promo_nabor
	//id_promo
	//nabor
	//All_tovar
	//is_fact
	//is_rasch
	//is_nachisl
	
	//Promo_tovar
	//id_promo
	//nabor
	//id_tov
	
	//Promo_nach
	//id_promo
	//param
	//Proc_nach
	
	//Promo_tt
	//id_promo
	//id_tt
	//is_pok
	//plan_pr
	
	//Promo_eLU
	//id_promo
	//text_eLu
	//shapka_elu
	//rn
	 
	ЗагрузитьВТаблицуPromo();
	ЗагрузитьВТаблицуFields_znach();
	
	
КонецПроцедуры

///////////////////////////////////////////////////////////////////////////////////////
// ЗАГРУЗКА
///////////////////////////////////////////////////////////////////////////////////////


Процедура ЗагрузитьВТаблицуPromo()
	
	СтруктураПолей = "id_promo, is_active, name_sms, descr_pr, Date_st_pok, Date_fi_pok, Date_st_pr, Date_fi_pr, Promo_type, Type_perc, Sum_cratn, weekdays, Proc_pr_B, Min_fact_B";
	ИмяТаблицы = "Promo";
	
	РеквизитыТЧ = Новый Массив;
	РеквизитыТч.Добавить("id_promo");
	РеквизитыТч.Добавить("is_active");
	РеквизитыТч.Добавить("name_sms");
	РеквизитыТч.Добавить("descr_pr");
	РеквизитыТч.Добавить("Date_st_pok");
	РеквизитыТч.Добавить("Date_fi_pok");
	РеквизитыТч.Добавить("Date_st_pr");
	РеквизитыТч.Добавить("Date_fi_pr");
	РеквизитыТч.Добавить("Promo_type");
	РеквизитыТч.Добавить("Type_perc");
	РеквизитыТч.Добавить("Sum_cratn");
	РеквизитыТч.Добавить("weekdays");
	РеквизитыТч.Добавить("Proc_pr_B");
	РеквизитыТч.Добавить("Min_fact_B");
	
	ЗаполнитьТаблицу(Promo, СтруктураПолей, ИмяТаблицы, РеквизитыТЧ);
	
КонецПроцедуры

Процедура ЗагрузитьВТаблицуFields_znach()
	
	СтруктураПолей = "field, znach_f, name_f, Promo_type";
	ИмяТаблицы = "Fields_znach";
	
	РеквизитыТЧ = Новый Массив;
	РеквизитыТч.Добавить("field");
	РеквизитыТч.Добавить("znach_f");
	РеквизитыТч.Добавить("name_f");
	РеквизитыТч.Добавить("Promo_type");
	
	ЗаполнитьТаблицу(fields_znach, СтруктураПолей, ИмяТаблицы, РеквизитыТЧ);
	
	Для Каждого Стр Из fields_znach Цикл
		Стр.field = СокрЛП(Стр.field);
	КонецЦикла;
	
КонецПроцедуры


Процедура КоманднаяПанельПромоДобавить(Кнопка)
	
	
	
КонецПроцедуры


Процедура PromoПередНачаломИзменения(Элемент, Отказ)
	
	Отказ = Истина;
	
	фрм = ПолучитьФорму("РедактированиеСтрокиПромо");
	фрм.идПромо = ЭлементыФормы.Promo.ТекущиеДанные.id_promo;
	фрм.Открыть();
	
	
КонецПроцедуры

	

