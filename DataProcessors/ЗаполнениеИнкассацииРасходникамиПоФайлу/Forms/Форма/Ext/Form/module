
Процедура КнопкаВыполнитьНажатие(Кнопка)
	Док = СопоставляемыйДокумент.ПолучитьОбъект();
	Док.Инкассация.Очистить();
	Для каждого Стр Из Инкассация Цикл
	
		НС = Док.Инкассация.Добавить();
		ЗаполнитьЗначенияСвойств(НС,Стр);
	
	КонецЦикла; 
	//Док.Записать();
	Док.ПолучитьФорму().Открыть();
КонецПроцедуры

Процедура КоманднаяПанель1Прочитать(Кнопка)
	ДатаНач = Дата(1,1,1);
	ДатаКон = Дата(1,1,1);
		
	ДанныеФайлов.Очистить();
	
	Если ЗначениеЗаполнено(ИмяФайла) Тогда
		//ВыбФайл = Новый Файл(ИмяФайла);
		ПрочитатьФайл(ИмяФайла);
	КонецЕсли;
	
	ДанныеФайлов.Свернуть("Дата,ОборотДт,ОборотКт,НомерДок,НомерСумки,ДатаИнкассации,РасходИзКассы,НазначениеПлатежа","Сумма");
КонецПроцедуры


Процедура ПрочитатьФайл(ИмяФайлаФ)
	ДатаНач = ТекущаяДата();
	ДатаКон = Дата(1,1,1);

	Если НРег(Прав(ИмяФайлаФ,3)) = "txt" Тогда
		текст=Новый ТекстовыйДокумент;
		Текст.Прочитать(ИмяФайлаФ);
		
		ВсегоСтрок = Текст.КоличествоСтрок();
		
		НомерПервойСтроки=15;
		Назначение = "";
		НоваяСтрока = "";
		Для Счетчик = НомерПервойСтроки По ВсегоСтрок Цикл
			Строка=Текст.ПолучитьСтроку(Счетчик);
			СтрМасс=ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(Строка, "¦");
			Если СтрМасс.Количество()=9 ИЛИ Счетчик + 5 = ВсегоСтрок Тогда   //+++АК LAGP 2018.02.15 ИП-00017210 Добавил "ИЛИ Счетчик + 5 = ВсегоСтрок", без этого не берет в расчёт я/к, если она в конце файла.
				/// заполнение остального в предыдущей строке
				//сумка №   26375808  для, (инкассация   28.04.2017 )
				Если Назначение <> "" И НЕ ТипЗнч(НоваяСтрока) = Тип("Строка") Тогда
					Если ЗначениеЗаполнено(НоваяСтрока) Тогда
						НоваяСтрока.НазначениеПлатежа = СокрЛП(СтрЗаменить(Назначение, "¦", ""));
						Назначение = СокрЛП(СтрЗаменить(НоваяСтрока.НазначениеПлатежа,"¦",""));
						Симв = Лев(Назначение,1);
						Пока Найти("1234567890",Симв)> 0 И СтрДлина(Назначение) > 0 Цикл
							
							НоваяСтрока.НомерСумки = НоваяСтрока.НомерСумки + Симв;
							Назначение = Сред(Назначение,2);
							Симв = Лев(Назначение,1);
						КонецЦикла;	
					КонецЕсли;	
					Если Не ЗначениеЗаполнено(НоваяСтрока.НомерСумки) Тогда
						Назначение = СтрЗаменить(Назначение,"¦","");
						Назначение = СтрЗаменить(Назначение," ","");
						ПозицияСумка = Найти(НРег(Назначение),"сумка№");
						
						//+++АК LAGP 2017.11.16 ИП-00017210 Сдача инкассации через банкомат
						ПозицияЯК1	 = Найти(НРег(Назначение),"я/к"); 
						ПозицияЯК2	 = Найти(НРег(Назначение),"я.к.");
						ПозицияЯК3 	 = ?(ПозицияЯК1 + ПозицияЯК2 > 0, 0, Найти(НРег(Назначение),"як"));
						Если ПозицияЯК3 > 0 Тогда
							ПоследнееВхождениеЯК = Ложь;
							Пока НЕ ПоследнееВхождениеЯК Цикл //продолжим поиск
								СледующаяПозицияЯК = Найти(НРег(Прав(Назначение, СтрДлина(Назначение) - ПозицияЯК3)),"як");
								Если СледующаяПозицияЯК > 0 Тогда
									ПозицияЯК3 = ПозицияЯК3 + СледующаяПозицияЯК;
								Иначе
									ПоследнееВхождениеЯК = Истина;
								КонецЕсли; 	 						
							КонецЦикла;
						КонецЕсли;		
						
						ПозицияЯК 	 = ПозицияЯК1 + ПозицияЯК2 + ПозицияЯК3;
						Понеслась 	 = Ложь;
						Если ПозицияЯК > 0 Тогда
							СтрокаНомерЯК = "";
							СтрокаПроверки = Прав(Назначение, СтрДлина(Назначение) - ПозицияЯК);
							Для Ном = 1 По СтрДлина(СтрокаПроверки) Цикл
								КодСимвола = КодСимвола(Сред(СтрокаПроверки, Ном, 1));
								ЦифраВНомерЯК = Сред(СтрокаПроверки, Ном, 1);
								Если КодСимвола >= 48 И КодСимвола <= 57 Тогда
									СтрокаНомерЯК = СтрокаНомерЯК + ЦифраВНомерЯК;
									Понеслась = Истина;
								ИначеЕсли Понеслась Тогда
									Прервать;
								КонецЕсли;	
							КонецЦикла;	
							НоваяСтрока.НомерСумки = СокрЛП(СтрокаНомерЯК);
						КонецЕсли;	
						//---АК LAGP
						
						Если ПозицияСумка>0 Тогда
							ПозицияДля = Найти(Назначение,"длязачисле");
							Если ПозицияДля<>0 Тогда
								НомерСумки = Сред(Назначение,ПозицияСумка+6,ПозицияДля-ПозицияСумка-6);
								Пока Лев(НомерСумки,1)="0" И СтрДлина(НомерСумки)>0 Цикл
									НомерСумки = Прав(НомерСумки,СтрДлина(НомерСумки)-1);
								КонецЦикла;	
								НоваяСтрока.НомерСумки = СокрЛП(НомерСумки);
							КонецЕсли;		
						КонецЕсли;
					КонецЕсли;	
					ПозицияНач = Найти(НРег(Назначение),"(инкассация");
					Если ПозицияНач>0 Тогда
						ПозицияКон = Найти(НРег(Назначение),")общество");
						Если ПозицияКон<>0 Тогда
							ДатаИнкассации = СокрЛП(Сред(Назначение,ПозицияНач+11,ПозицияКон-ПозицияНач-11));
							НоваяСтрока.ДатаИнкассации = Дата(Число(Прав(ДатаИнкассации,4)),Число(Сред(ДатаИнкассации,4,2)),Число(Лев(ДатаИнкассации,2)));
							ДатаНач = Мин(ДатаНач,НоваяСтрока.ДатаИнкассации);
							ДатаКон = Макс(ДатаКон,НоваяСтрока.ДатаИнкассации);
						КонецЕсли;	
					КонецЕсли;
				КонецЕсли;	
				
				Попытка
					Если Число(СтрМасс[7])=0 Тогда
						Продолжить;
					КонецЕсли;	
					НоваяСтрока = ДанныеФайлов.Добавить();
					НоваяСтрока.Дата = Дата(Число("20"+Прав(СтрМасс[1],2)),Число(Сред(СтрМасс[1],4,2)),Число(Лев(СтрМасс[1],2)));
					НоваяСтрока.ОборотДт = СтрМасс[6];
					НоваяСтрока.ОборотКт = СтрМасс[7];
					НоваяСтрока.Сумма = СтрМасс[7];
					НоваяСтрока.НомерДок = СтрМасс[3];
					ДатаНач = Мин(ДатаНач,НоваяСтрока.Дата);
					ДатаКон = Макс(ДатаКон,НоваяСтрока.Дата);
					Назначение = "";
				Исключение
					
				КонецПопытки;
			Иначе
				Назначение = Назначение + Строка;
			КонецЕсли;	
			
		КонецЦикла;
		НоваяСтрока.НазначениеПлатежа = СокрЛП(СтрЗаменить(Назначение, "¦", ""));
	//+++АК POZM 2018.09.11 ИП-00018684.01 
	ИначеЕсли НРег(Прав(ИмяФайлаФ,3)) = "xls" ИЛИ НРег(Прав(ИмяФайлаФ,4)) = "xlsx" Тогда
		ТЗ=ПрочитатьЛистExcel(ИмяФайлаФ,2);
		й=0;
		Пока й<=ТЗ.Количество()-1 Цикл	
			
			//Если НЕ ЗначениеЗаполнено(СокрЛП(ТЗ[й][5])) Тогда
			//	Продолжить;
			//КонецЕсли;
			ДатаСтрокой = ТЗ[й][0];
			Если НЕ ЗначениеЗаполнено(ДатаСтрокой) Тогда
				Прервать;
			КонецЕсли;	
			НоваяСтрока = ДанныеФайлов.Добавить();
			//НоваяСтрока.Дата = Дата(Число("20"+Прав(СтрМасс[1],2)),Число(Сред(СтрМасс[1],4,2)),Число(Лев(СтрМасс[1],2)));
			
			НоваяСтрока.Дата = Дата(Число("20"+Прав(ДатаСтрокой,2)),Число(Сред(ДатаСтрокой,4,2)),Число(Лев(ДатаСтрокой,2)));
			ДатаНач = Мин(ДатаНач,НоваяСтрока.Дата);
			ДатаКон = Макс(ДатаКон,НоваяСтрока.Дата);
			НоваяСтрока.ДатаИнкассации = НоваяСтрока.Дата;
			НоваяСтрока.НазначениеПлатежа = ТЗ[й][6];
			НоваяСтрока.НомерДок = ТЗ[й][1];
			
			НоваяСтрока.ОборотДт = Число(ТЗ[й][4]);
			НоваяСтрока.ОборотКт = Число(ТЗ[й][5]);
			НоваяСтрока.Сумма = НоваяСтрока.ОборотКт;
									
			Назначение = СокрЛП(СтрЗаменить(НоваяСтрока.НазначениеПлатежа,"¦",""));
			Симв = Лев(Назначение,1);
			Пока Найти("1234567890",Симв)> 0 И СтрДлина(Назначение) > 0 Цикл
				
				НоваяСтрока.НомерСумки = НоваяСтрока.НомерСумки + Симв;
				Назначение = Сред(Назначение,2);
				Симв = Лев(Назначение,1);
			КонецЦикла;	
			
			Если Не ЗначениеЗаполнено(НоваяСтрока.НомерСумки) Тогда
					Назначение = СокрЛП(СтрЗаменить(НоваяСтрока.НазначениеПлатежа,"¦",""));
					Назначение = СтрЗаменить(Назначение," ","");
					ПозицияСумка = Найти(НРег(Назначение),"сумка№");
						
					
					ПозицияЯК1	 = Найти(НРег(Назначение),"я/к"); 
					ПозицияЯК2	 = Найти(НРег(Назначение),"я.к.");
					ПозицияЯК3 	 = ?(ПозицияЯК1 + ПозицияЯК2 > 0, 0, Найти(НРег(Назначение),"як"));
					Если ПозицияЯК3 > 0 Тогда
						ПоследнееВхождениеЯК = Ложь;
						Пока НЕ ПоследнееВхождениеЯК Цикл //продолжим поиск
							СледующаяПозицияЯК = Найти(НРег(Прав(Назначение, СтрДлина(Назначение) - ПозицияЯК3)),"як");
							Если СледующаяПозицияЯК > 0 Тогда
								ПозицияЯК3 = ПозицияЯК3 + СледующаяПозицияЯК;
							Иначе
								ПоследнееВхождениеЯК = Истина;
							КонецЕсли; 	 						
						КонецЦикла;
					КонецЕсли;		
						
					ПозицияЯК 	 = ПозицияЯК1 + ПозицияЯК2 + ПозицияЯК3;
					Понеслась 	 = Ложь;
					Если ПозицияЯК > 0 Тогда
						СтрокаНомерЯК = "";
						СтрокаПроверки = Прав(Назначение, СтрДлина(Назначение) - ПозицияЯК);
						Для Ном = 1 По СтрДлина(СтрокаПроверки) Цикл
							КодСимвола = КодСимвола(Сред(СтрокаПроверки, Ном, 1));
							ЦифраВНомерЯК = Сред(СтрокаПроверки, Ном, 1);
							Если КодСимвола >= 48 И КодСимвола <= 57 Тогда
								СтрокаНомерЯК = СтрокаНомерЯК + ЦифраВНомерЯК;
								Понеслась = Истина;
							ИначеЕсли Понеслась Тогда
								Прервать;
							КонецЕсли;	
						КонецЦикла;	
						НоваяСтрока.НомерСумки = СокрЛП(СтрокаНомерЯК);
					КонецЕсли;	
					//---АК LAGP
						
					//Если ПозицияСумка>0 Тогда
					//	ПозицияДля = Найти(Назначение,"длязачисле");
					//	Если ПозицияДля<>0 Тогда
					//		НомерСумки = Сред(Назначение,ПозицияСумка+6,ПозицияДля-ПозицияСумка-6);
					//		Пока Лев(НомерСумки,1)="0" И СтрДлина(НомерСумки)>0 Цикл
					//			НомерСумки = Прав(НомерСумки,СтрДлина(НомерСумки)-1);
					//		КонецЦикла;	
					//		НоваяСтрока.НомерСумки = СокрЛП(НомерСумки);
					//	КонецЕсли;		
					//КонецЕсли;
            КонецЕсли;
			
			й = й + 1;
		КонецЦикла;	
	Иначе
		Сообщить("Неизвестный формат файла "+ИмяФайлаФ);
	КонецЕсли;	
	//---АК POZM 
КонецПроцедуры	

Функция ПрочитатьЛистExcel( ИмяФайлаФ, НомерПервойСтроки = 1, НомерПервойКолонки = 1, ВсегоСтрок = 0, ВсегоКолонок = 0) Экспорт
	
	ТЗ = Неопределено;	
	
	Excel = Новый COMОбъект("Excel.Application");
	Excel.WorkBooks.Open(ИмяФайлаФ);
	Состояние("Обработка файла Microsoft Excel..."+ИмяФайлаФ);
	ЛистЭксель = Excel.Sheets(1);
	Если ВсегоСтрок = 0 Тогда
		ВсегоСтрок = ЛистЭксель.Cells.SpecialCells(11).Row;
	КонецЕсли;
	Если ВсегоКолонок = 0 Тогда
		ВсегоКолонок = ЛистЭксель.Cells.SpecialCells(11).Column;
	КонецЕсли;
	Если ТЗ = Неопределено Тогда
		ТЗ =  Новый ТаблицаЗначений;
		Для Счетчик = 1 По ВсегоКолонок Цикл
			ТЗ.Колонки.Добавить("Колонка"+Счетчик, Новый ОписаниеТипов("Строка"));
		КонецЦикла;
	КонецЕсли;
	
	Для Счетчик = НомерПервойСтроки По ВсегоСтрок Цикл
		НоваяСтрока = ТЗ.Добавить();
	КонецЦикла;
	
	Область = ЛистЭксель.Range(ЛистЭксель.Cells(НомерПервойСтроки,НомерПервойКолонки), ЛистЭксель.Cells(ВсегоСтрок,ВсегоКолонок));
	ДанныеТЗ = Область.Value.Выгрузить();
	
	Для Счетчик = 0 По ВсегоКолонок-1 Цикл
		ТЗ.ЗагрузитьКолонку(ДанныеТЗ[Счетчик], Счетчик);
	КонецЦикла;
	ЛистЭксель = Неопределено;
	Excel.WorkBooks.Close();
	Excel = 0;
	Возврат ТЗ;
	
КонецФункции

Процедура ПолеВвода1НачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Режим = РежимДиалогаВыбораФайла.Открытие;
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(Режим);
	ДиалогОткрытияФайла.Каталог =  "D:\Izbenka\Общая\Бухгалтерия\Полухонова Ю.И\БАНК\ИНКАССАЦИЯ\ФИНЧЕР\Выписки Финчер\";
	//Текст = "ru = ""Текст""; en = ""Text""";
	//Фильтр = НСтр(Текст)+"(*.txt)|*.txt";
	//ДиалогОткрытияФайла.Фильтр = Фильтр;
	ДиалогОткрытияФайла.МножественныйВыбор = Ложь;
	ДиалогОткрытияФайла.Заголовок = "Выберите файл";
	Если ДиалогОткрытияФайла.Выбрать() Тогда
		МассивФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;
		Для Каждого ИмяФайла Из МассивФайлов Цикл
			
		КонецЦикла;
	Иначе
		Текст = "ru = ""Файл(ы) не выбран!""; en = ""File(s) not selected!""";
		Предупреждение(НСтр(Текст));
	КонецЕсли;
КонецПроцедуры

Процедура КоманднаяПанель1НайтиРасходники(Кнопка)
	//Если прав(ИмяФайла,3)="xls" Тогда
		ТекстЗапроса = "ВЫБРАТЬ
		               |	РасходИзКассы.Ссылка КАК ДокументРасхода,
		               |	РасходИзКассы.СтруктурнаяЕдиница,
		              // |	Выбор Когда РасходИзКассы.СтруктурнаяЕдиница.НомерПТК <> """" ТОГДА РасходИзКассы.СтруктурнаяЕдиница.НомерПТК ИНАЧЕ РасходИзКассы.СтруктурнаяЕдиница.НомерЯвочнойКартыДляИнкассации КОНЕЦ КАК АДМ,
					   |	РасходИзКассы.СтруктурнаяЕдиница.НомерПТК  КАК АДМ,
		               |	РасходИзКассы.СуммаДокумента КАК Сумма,
		               |	НАЧАЛОПЕРИОДА(РасходИзКассы.Дата, ДЕНЬ) КАК Дата
		               |ИЗ
		               |	Документ.РасходИзКассы КАК РасходИзКассы
		               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеВБанк.Инкассация КАК ПоступлениеВБанкИнкассация
		               |		ПО (ПоступлениеВБанкИнкассация.ДокументРасхода = РасходИзКассы.Ссылка)
		               |ГДЕ
		               |	РасходИзКассы.Проведен
		               |	И (ПоступлениеВБанкИнкассация.Ссылка ЕСТЬ NULL
		               |			ИЛИ ПоступлениеВБанкИнкассация.Ссылка = &ТекущийДокумент ИЛИ НачалоПериода(ПоступлениеВБанкИнкассация.Ссылка.Дата,День) > &Дата)
		               |	И РасходИзКассы.Дата <= НАЧАЛОПЕРИОДА(&Дата, ДЕНЬ)
		               |	И РасходИзКассы.Дата >= ДОБАВИТЬКДАТЕ(&Дата, МЕСЯЦ, -1)
		               |	И РасходИзКассы.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРКО.Инкассация)
		               //|	И РасходИзКассы.СтруктурнаяЕдиница.НомерПТК <> """"
		               |	И РасходИзКассы.Организация = &Организация
		               |	И РасходИзКассы.СуммаДокумента <> 0
		               |
					   |ОБЪЕДИНИТЬ ВСЕ
					   |
					   |ВЫБРАТЬ
					   |	РасходИзКассы.Ссылка,
					   |	РасходИзКассы.СтруктурнаяЕдиница,
					   |	РасходИзКассы.СтруктурнаяЕдиница.НомерЯвочнойКартыДляИнкассации,
					   |	РасходИзКассы.СуммаДокумента,
					   |	НАЧАЛОПЕРИОДА(РасходИзКассы.Дата, ДЕНЬ)
					   |ИЗ
					   |	Документ.РасходИзКассы КАК РасходИзКассы
					   |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеВБанк.Инкассация КАК ПоступлениеВБанкИнкассация
					   |		ПО (ПоступлениеВБанкИнкассация.ДокументРасхода = РасходИзКассы.Ссылка)
					   |ГДЕ
					   |	РасходИзКассы.Проведен
					   |	И (ПоступлениеВБанкИнкассация.Ссылка ЕСТЬ NULL
		               |			ИЛИ ПоступлениеВБанкИнкассация.Ссылка = &ТекущийДокумент ИЛИ НачалоПериода(ПоступлениеВБанкИнкассация.Ссылка.Дата,День) > &Дата)
					   |	И РасходИзКассы.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРКО.Инкассация)
					   |	И РасходИзКассы.Дата <= &Дата
					   |	И РасходИзКассы.Дата >= ДОБАВИТЬКДАТЕ(&Дата, МЕСЯЦ, -1)
					   //|	И РасходИзКассы.СтруктурнаяЕдиница.НомерЯвочнойКартыДляИнкассации <> """"
					   |
		               |УПОРЯДОЧИТЬ ПО
		               |	АДМ,
		               |	Дата";

	
	Запрос = Новый Запрос(ТекстЗапроса);
	Запрос.УстановитьПараметр("Дата",СопоставляемыйДокумент.Дата);
	Запрос.УстановитьПараметр("Организация",СопоставляемыйДокумент.Организация);
	Запрос.УстановитьПараметр("ТекущийДокумент",СопоставляемыйДокумент);
	
	ТЗКандидатов = Запрос.Выполнить().Выгрузить();
	Для каждого Стр Из ТЗКандидатов Цикл
	
		Стр.АДМ = СокрЛП(Стр.АДМ);
	
	КонецЦикла; 
	Инкассация.Очистить();
	ВсегоСтрок = ДанныеФайлов.Количество();
	Для каждого СтрокаДляПоиска  Из ДанныеФайлов Цикл
	    Состояние("Строка "+СтрокаДляПоиска.НомерСтроки + " из "+ВсегоСтрок);
		Отбор = Новый Структура("Сумма,АДМ",СтрокаДляПоиска.ОборотКт,СтрокаДляПоиска.НомерСумки);
		СтрокиКандидаты = ТЗКандидатов.НайтиСтроки(Отбор);
		
		Если СтрокиКандидаты.Количество()>0 Тогда
			Стр = СтрокиКандидаты[0];
			НС = ЭтотОбъект.Инкассация.Добавить();
			НС.ДокументРасхода = Стр.ДокументРасхода;
			НС.НомерСумки = Стр.АДМ;
			НС.Сумма = Стр.Сумма;
			Стр.Сумма = 0;
			СтрокаДляПоиска.РасходИзКассы = Стр.ДокументРасхода;
			Продолжить;
		КонецЕсли;	
		
		ЗаданнаяСумма = СтрокаДляПоиска.Сумма;
		Отбор = Новый Структура("АДМ",СтрокаДляПоиска.НомерСумки);
	
		Для й=1 По 100 Цикл
			ТЗ = ТЗКандидатов.Скопировать(Отбор);
			ГСЧ= новый ГенераторСлучайныхЧисел();
			ТЗ.Колонки.Добавить("СЧ");
			Для Каждого Стр ИЗ ТЗ Цикл
				Стр.СЧ = ГСЧ.СлучайноеЧисло();
			КонецЦикла;	
			ТЗ.Сортировать("СЧ Возр");
			Пока ТЗ.Итог("Сумма")>ЗаданнаяСумма Цикл
				ТЗ.Удалить(0);
				Если ТЗ.Итог("Сумма")=ЗаданнаяСумма Тогда
					Прервать;
				КонецЕсли;	
			КонецЦикла;	
			Если ТЗ.Итог("Сумма")=ЗаданнаяСумма Тогда
				Прервать;
			КонецЕсли;	
			
		КонецЦикла;	
		
		Если ТЗ.Итог("Сумма")=ЗаданнаяСумма Тогда
			Для Каждого Стр ИЗ ТЗ Цикл
				НС = ЭтотОбъект.Инкассация.Добавить();
				НС.ДокументРасхода = Стр.ДокументРасхода;
				НС.НомерСумки = Стр.АДМ;
				НС.Сумма = Стр.Сумма;
				СтрокаДляПоиска.РасходИзКассы = Стр.ДокументРасхода;
			КонецЦикла;	
			
		КонецЕсли;	
	КонецЦикла;
		//+++АК POZM 2018.12.17 ИП-00020428 
		
		 ОставшиесяАДМ = ДанныеФайлов.Выгрузить();
		 ОставшиесяАДМ = ОставшиесяАДМ.Скопировать(Новый Структура("РасходИзКассы",Документы.РасходИзКассы.ПустаяСсылка()));
		 ОставшиесяАДМ.Свернуть("НомерСумки","Сумма");
		 Для каждого СтрокаАДМ Из ОставшиесяАДМ Цикл
			 
			КандидатыПоАДМ = ТЗКандидатов.Скопировать(Новый Структура("АДМ",СтрокаАДМ.НомерСумки));
			Для каждого КандидатПоАДМ Из КандидатыПоАДМ Цикл
			
				ЗаданнаяСумма = КандидатПоАДМ.Сумма;
				Если ЗаданнаяСумма = 0 Тогда
					
					Продолжить;
					
				КонецЕсли;	
				Отбор = Новый Структура("НомерСумки,РасходИзКассы",СтрокаАДМ.НомерСумки,Документы.РасходИзКассы.ПустаяСсылка());
				ТЗДанныеФайлов = ДанныеФайлов.Выгрузить();
				Для й=1 По 100 Цикл
					ТЗ = ТЗДанныеФайлов.Скопировать(Отбор);
					ГСЧ= новый ГенераторСлучайныхЧисел();
					ТЗ.Колонки.Добавить("СЧ");
					Для Каждого Стр ИЗ ТЗ Цикл
						Стр.СЧ = ГСЧ.СлучайноеЧисло();
					КонецЦикла;	
					ТЗ.Сортировать("СЧ Возр");
					Пока ТЗ.Итог("Сумма")>ЗаданнаяСумма Цикл
						ТЗ.Удалить(0);
						Если ТЗ.Итог("Сумма")=ЗаданнаяСумма Тогда
							Прервать;
						КонецЕсли;	
					КонецЦикла;	
					Если ТЗ.Итог("Сумма")=ЗаданнаяСумма Тогда
						Прервать;
					КонецЕсли;	
					
				КонецЦикла;	

				Если ТЗ.Итог("Сумма")=ЗаданнаяСумма Тогда
					Для Каждого Стр ИЗ ТЗ Цикл
						НС = ЭтотОбъект.Инкассация.Добавить();
						НС.ДокументРасхода = КандидатПоАДМ.ДокументРасхода;
						НС.НомерСумки = СтрокаАДМ.НомерСумки;
						НС.Сумма = Стр.Сумма;
						
						Отбор = Новый Структура("Сумма,НомерСумки,Дата,НомерДок");
						ЗаполнитьЗначенияСвойств(Отбор, Стр);
						ИсхСтроки = ДанныеФайлов.НайтиСтроки(Отбор);
						ИсхСтроки[0].РасходИзКассы = КандидатПоАДМ.ДокументРасхода;
						
					КонецЦикла;	
					
				КонецЕсли;	
				
			КонецЦикла; 
	 
		 КонецЦикла; 
		//---АК POZM 
		
		
		

	
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
КонецПроцедуры

//ИмяФайла = "D:\Izbenka\Общая\Бухгалтерия\Полухонова Ю.И\БАНК\ИНКАССАЦИЯ\ФИНЧЕР\Выписки Финчер\сентябрь 18\";