
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	//+++ AK suvv 2018.08.30 ИП-00019673
	ТипОбъекта = Параметры.ТипОбъекта;
	
	ЗаданПараметрПользователи           = ?(Параметры.Пользователи <> "",           Истина, Ложь);
	ЗаданПараметрТипыРолейПользователей = ?(Параметры.ТипыРолейПользователей <> "", Истина, Ложь);
	
	Если ЗаданПараметрПользователи или ЗаданПараметрТипыРолейПользователей Тогда 
		
		Если ?(ЗаданПараметрПользователи, Найти(Параметры.Пользователи, ", ") <> 0, Найти(Параметры.ТипыРолейПользователей, ", ") <> 0) Тогда
			ТекстПользователи = ?(ЗаданПараметрПользователи, СтрЗаменить(Параметры.Пользователи,", ",Символы.ПС), СтрЗаменить(Параметры.ТипыРолейПользователей,", ",Символы.ПС));
			
			Для НомСтр = 1 По СтрЧислоСтрок(ТекстПользователи) Цикл
				
				Пользователь = ?(ЗаданПараметрПользователи, Справочники.Пользователи.НайтиПоКоду(СокрЛП(СтрПолучитьСТроку(ТекстПользователи, НомСтр))), ПланыВидовХарактеристик.ТипыРолейПользователя.НайтиПоКоду(СокрЛП(СтрПолучитьСТроку(ТекстПользователи, НомСтр))));
				
				Если ЗначениеЗаполнено(Пользователь) Тогда
					СтрПользователь = СписокПользователей.Добавить();
					СтрПользователь.Пользователь = Пользователь;
				КонецЕсли;
			КонецЦикла;
		Иначе
			Пользователь = ?(ЗаданПараметрПользователи, Справочники.Пользователи.НайтиПоКоду(СокрЛП(Параметры.Пользователи)), ПланыВидовХарактеристик.ТипыРолейПользователя.НайтиПоКоду(СокрЛП(Параметры.ТипыРолейПользователей)));
			Если ЗначениеЗаполнено(Пользователь) Тогда
				СтрПользователь = СписокПользователей.Добавить();
				СтрПользователь.Пользователь = Пользователь;
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;	
	//--- AK suvv
	
КонецПроцедуры

&НаКлиенте
Процедура Выбрать(Команда)
	Закрыть(ПользователиВСтроку());
КонецПроцедуры

&НаСервере
Функция ПользователиВСтроку()
	Рез = "";
	Для каждого Стр из СписокПользователей Цикл
		//+++ AK suvv 2018.09.05 ИП-00019673
		Если ТипЗнч(Стр.Пользователь) = Тип("СправочникСсылка.Пользователи") Тогда
			Рез = Рез + ", " + Стр.Пользователь;
		ИначеЕсли ТипЗнч(Стр.Пользователь) = Тип("ПланВидовХарактеристикСсылка.ТипыРолейПользователя") Тогда 
			Рез = Рез + ", " + Стр.Пользователь.Код;
		КонецЕсли;
		//--- AK suvv
	КонецЦикла;
	Возврат Сред(Рез,3); 
КонецФункции

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	//+++ AK suvv 2018.08.30 ИП-00019673
	Элементы.СписокПользователейПользователь.ОграничениеТипа = Новый ОписаниеТипов(ТипОбъекта);
	//--- AK suvv
	
КонецПроцедуры
