
&НаКлиенте
Процедура ДействиеЗагрузить(Команда)
	ПередатьФайлНаСервер();
КонецПроцедуры

&НаКлиенте
Процедура ПередатьФайлНаСервер()
	МассивФайлов = Новый Массив;

	МассивФайлов.Добавить(Новый ОписаниеПередаваемогоФайла( ЭтаФорма.ФайлДляЗагрузки, ));
	
	Оповещение = Новый ОписаниеОповещения("ПередатьФайлНаСерверЗавершение", ЭтаФорма);
	
	НачатьПомещениеФайлов(Оповещение, МассивФайлов,,Ложь, ЭтаФорма.УникальныйИдентификатор);
КонецПроцедуры

Процедура ПередатьФайлНаСерверЗавершение(Результат, ДополнительныеПараметры) Экспорт
	ДействиеЗагрузить_НаСервере(Результат)	
КонецПроцедуры


&НаСервере
Процедура ДействиеЗагрузить_НаСервере(МассивФайловВХранилище)
	МО = РеквизитФормыВЗначение("Объект");
	МО.ВыполнитьОбработку(МассивФайловВХранилище);
КонецПроцедуры


&НаКлиенте
Процедура ФайлДляЗагрузкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Диалог.Заголовок = "Выберите файл";
	Диалог.ПолноеИмяФайла = ""; 
	Фильтр = "*.xls"; 
	Диалог.Фильтр = Фильтр; 
    Диалог.МножественныйВыбор = Ложь;
	Оповещение = Новый ОписаниеОповещения("ФайлДляЗагрузкиНачалоВыбораЗавершение", ЭтаФорма);
	Диалог.Показать(Оповещение);
КонецПроцедуры


&НаКлиенте
Процедура ФайлДляЗагрузкиНачалоВыбораЗавершение(Результат, ДополнительныеПараметры) Экспорт
    Если Результат = Неопределено Тогда
        Возврат;
    КонецЕсли;
    
    ЭтаФорма.ФайлДляЗагрузки = Результат[0];
	УстановитьДоступностьКнопкиЗагрузить();
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	УстановитьДоступностьКнопкиЗагрузить();	
КонецПроцедуры

&НаКлиенте
Процедура ФайлДляЗагрузкиПриИзменении(Элемент)
	УстановитьДоступностьКнопкиЗагрузить();
КонецПроцедуры

&НаКлиенте
Процедура УстановитьДоступностьКнопкиЗагрузить()
	ЭтаФорма.Элементы.кнЗагрузить.Доступность = ЗначениеЗаполнено(ЭтаФорма.ФайлДляЗагрузки);
КонецПроцедуры



