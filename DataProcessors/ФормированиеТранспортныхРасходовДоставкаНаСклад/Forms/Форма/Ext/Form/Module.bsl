
// Проверяет на наличие уже созданных в заданный день документов "Транспортные услуги".
//
// Возврат:
//   Массив ссылок на документы.
//
Функция ПолучитьСозданныеТранспортныеРасходыСервер()
	
	Перем ОбъектОбработки, МассивСсылок;
	
	ОбъектОбработки = РеквизитФормыВЗначение("Объект");
	МассивСсылок = ОбъектОбработки.ПолучитьСозданныеТранспортныеРасходы();
	ЗначениеВРеквизитФормы(ОбъектОбработки, "Объект");
	
	Возврат МассивСсылок;
	
КонецФункции

// Проверяет на наличие уже созданных в заданный день документов "Маршрутный лист" (доставка на склад).
//
// Возврат:
//   Массив ссылок на документы.
//
Функция ПолучитьСозданныеМаршрутныеЛистыСервер()
	
	Перем ОбъектОбработки, МассивСсылок;
	
	ОбъектОбработки = РеквизитФормыВЗначение("Объект");
	МассивСсылок = ОбъектОбработки.ПолучитьСозданныеМаршрутныеЛисты();
	ЗначениеВРеквизитФормы(ОбъектОбработки, "Объект");
	
	Возврат МассивСсылок;
	
КонецФункции

// Удаляет документы, полученные в результате запроса.
//
// Параметры:
// 	 МассивСсылок - Массив ссылок на документы.
//
Процедура УдалитьСуществующиеДокументыСервер(МассивСсылок)
	
	Перем ОбъектОбработки;
	
	ОбъектОбработки = РеквизитФормыВЗначение("Объект");
	ОбъектОбработки.УдалитьСуществующиеДокументы(МассивСсылок);
	ЗначениеВРеквизитФормы(ОбъектОбработки, "Объект");
	
КонецПроцедуры

Процедура СоздатьДокументыСервер()
	
	Перем ОбъектОбработки;
	
	// создание новых документов "Транспортные расходы"
	ОбъектОбработки = РеквизитФормыВЗначение("Объект");
	ОбъектОбработки.СоздатьДокументы(Объект.ФормироватьТранспортныеРасходы, Объект.ФормироватьМаршрутныеЛисты);
	ЗначениеВРеквизитФормы(ОбъектОбработки, "Объект");
	
КонецПроцедуры


&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	Объект.ДатаСоздания = ТекущаяДата();
	//Объект.Организация 	= УправлениеПользователями.ПолучитьЗначениеПоУмолчанию(глЗначениеПеременной("глТекущийПользователь"), "ОсновнаяОрганизация");
	
КонецПроцедуры


&НаКлиенте
Процедура СоздатьДокументы(Команда)
	
	Перем МассивСсылок;
		
	Если Объект.ФормироватьТранспортныеРасходы Тогда
		// проверка на существование документов "Транспортные расходы" в этот день. Если существуют - удалять совсем.
		МассивСсылок = ПолучитьСозданныеТранспортныеРасходыСервер();
		Если МассивСсылок.Количество() > 0 Тогда
			Если Вопрос("В указанную дату есть созданные документы ""Транспортные расходы"". Пометить на удаление?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
				Возврат;
			КонецЕсли;
			
			УдалитьСуществующиеДокументыСервер(МассивСсылок);
		КонецЕсли;
	КонецЕсли;
		
	Если Объект.ФормироватьМаршрутныеЛисты Тогда
		// проверка на существование документов "Маршрутный лист" (доставка на склад) в этот день. Если существуют - удалять совсем.
		МассивСсылок = ПолучитьСозданныеМаршрутныеЛистыСервер();
		Если МассивСсылок.Количество() > 0 Тогда
			Если Вопрос("В указанную дату есть созданные документы ""Маршрутный лист"" (доставка на склад). Пометить на удаление?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
				Возврат;
			КонецЕсли;
			
			УдалитьСуществующиеДокументыСервер(МассивСсылок);
		КонецЕсли;
	КонецЕсли;

	// создание новых документов
	СоздатьДокументыСервер();
	
КонецПроцедуры
