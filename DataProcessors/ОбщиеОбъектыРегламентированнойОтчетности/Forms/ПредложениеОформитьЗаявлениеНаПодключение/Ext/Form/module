

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	РежимВыбора = Ложь;
	
	ПрорисовкаПередОткрытием();
	
	Если НЕ ЭлементыФормы.ОсновныеДействияФормы.Кнопки.БольшеНеПоказывать.Доступность Тогда
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Удалить(ЭлементыФормы.ОсновныеДействияФормы.Кнопки.БольшеНеПоказывать);
	КонецЕсли;	
	
КонецПроцедуры

Процедура ПрорисовкаПередОткрытием()
	
	ТекстHTML = ПолучитьМакет("ПредложениеОформитьЗаявлениеНаПодключение").ПолучитьТекст();
	ЭлементыФормы.ПолеHTMLДокумента.УстановитьТекст(ТекстHTML);
	
КонецПроцедуры

Процедура ПолеHTMLДокументаonclick(Элемент, pEvtObj)
	
	Попытка
		Ссылка = pEvtObj.srcElement.href;
	Исключение
		Попытка
			Ссылка = pEvtObj.srcElement.parentElement.href;
		Исключение
			Попытка
				Ссылка = pEvtObj.srcElement.parentElement.parentElement.href;
			Исключение
				Возврат;
			КонецПопытки;
		КонецПопытки;
	КонецПопытки;
	
	Если Найти(Ссылка, "&ОформлениеЗаявления") <> 0 Тогда
		Если КонтекстЭДО <> Неопределено Тогда 
			ФормаМастера = КонтекстЭДО.ПолучитьФорму("Документ_ЗаявлениеАбонентаСпецоператораСвязи_ФормаМастера");
			
			ФормаМастера.ОрганизацияПриВызовеИзСправочникаОрганизаций = Организация;
			
			Закрыть();
			ФормаМастера.Открыть();
		Иначе
			Предупреждение("Необходимо назначить текущему пользователю роль ""Право на защищенный документооборот с контролирующими органами"",
							|чтобы получить возможность сформировать и отправить заявление на подключение из программы.");
		КонецЕсли;
	Иначе
		ПоказатьВебСтраницу(Ссылка);
	КонецЕсли;
	
	pEvtObj.returnValue = Ложь;
	
КонецПроцедуры

Процедура ПоказатьВебСтраницу(АдресСтраницы) 
	
	Попытка
	
		ЗапуститьПриложение(АдресСтраницы);

	Исключение
		
		ОбработкаИсключения(ИнформацияОбОшибке());
		
	КонецПопытки;
	
КонецПроцедуры

Процедура ОбработкаИсключения(ИнформацияОбОшибке)
	
	ПричинаОшибки = ИнформацияОбОшибке().Причина;
	
	Предупреждение(?(ПричинаОшибки.Описание = Неопределено,
					 "При выполенении действия произошла ошибка.",
					 ПричинаОшибки.Описание));
	
КонецПроцедуры // ОбработкаИсключения()        

Процедура СохранитьЗначениеБольшеНеПоказывать(БольшеНеПоказывать)
	
	СохранитьЗначение("роНеПоказыватьПодключениеК1СОтчетность", БольшеНеПоказывать);
	
КонецПроцедуры

Процедура ОсновныеДействияФормыБольшеНеПоказывать(Кнопка)
	
	СохранитьЗначениеБольшеНеПоказывать(Истина);
		
	Закрыть();
	
КонецПроцедуры
