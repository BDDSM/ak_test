
Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура КоманднаяПанель1Отбор(Кнопка)
	Кнопка.Пометка = НЕ Кнопка.Пометка;
	ЭлементыФормы.ПанельОтбор.Свертка = ?(Кнопка.Пометка, РежимСверткиЭлементаУправления.Нет, РежимСверткиЭлементаУправления.Верх);
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ДокументыДляОбработкиПриИзмененииФлажка(Элемент, Колонка)
	ТекДанные = ЭлементыФормы.ДокументыДляОбработки.ТекущиеДанные;
	Для каждого СтрокаТЧ Из ЭлементыФормы.ДокументыДляОбработки.ВыделенныеСтроки Цикл
		СтрокаТЧ.Пометка = ТекДанные.Пометка;
	КонецЦикла; 
КонецПроцедуры

Процедура КоманднаяПанель1УстановитьФлажки(Кнопка)
	 ПтичкиПрилетели(Истина);
КонецПроцедуры

Процедура ПтичкиПрилетели(Значение)
	Для каждого СтрокаТЧ Из ДокументыДляОбработки Цикл
		СтрокаТЧ.Пометка = Значение;
	КонецЦикла;
КонецПроцедуры

Процедура КоманднаяПанель1СнятьФлажки(Кнопка)
	ПтичкиПрилетели(Ложь);
КонецПроцедуры

Процедура Инициализация()
	Построитель.Текст = "ВЫБРАТЬ
	                    |	ИСТИНА КАК Пометка,
	                    |	ВетСвидетельстваПоступлений.ДокПоступления КАК ПриходныйОрдер,
	                    |	ВетСвидетельстваПоступлений.ВСД,
	                    |	ВетСвидетельстваПоступлений.ДокПоступления.Поставщик КАК Поставщик,
	                    |	ВетСвидетельстваПоступлений.ВСД.Номенклатура КАК Номенклатура,
	                    |	ВетСвидетельстваПоступлений.ДокПоступления.Организация КАК Организация,
	                    |	ВетСвидетельстваПоступлений.ДокПоступления.Склад КАК Склад,
	                    |	ВетСвидетельстваПоступлений.ДокПоступления.Склад.Владелец КАК СтруктурноеПодразделение
	                    |ИЗ
	                    |	РегистрСведений.ВетСвидетельстваПоступлений КАК ВетСвидетельстваПоступлений
	                    |ГДЕ
	                    |	ВетСвидетельстваПоступлений.ДокПоступления.Дата МЕЖДУ &НачалоПериода И &ОкончаниеПериода
	                    |	И ВетСвидетельстваПоступлений.ДокПоступления.Проведен
	                    |	И ВетСвидетельстваПоступлений.ДокПоступления.ПриемкаТерминаломЗакончена
	                    |	И НЕ ВетСвидетельстваПоступлений.ВСД.status = ЗНАЧЕНИЕ(Справочник.МЙ_СтатусВСД.UTILIZED)";
	Построитель.ЗаполнитьНастройки();
	Построитель.Отбор.Добавить("Поставщик", "Поставщик", "Поставщик").Использование = Ложь;
	Построитель.Отбор.Добавить("Организация", "Организация", "Организация").Использование = Ложь;
	Построитель.Отбор.Добавить("Склад", "Склад", "Склад").Использование = Ложь;
	Построитель.Отбор.Добавить("СтруктурноеПодразделение", "СтруктурноеПодразделение", "Структурное подразделение").Использование = Ложь;
КонецПроцедуры

Процедура ПриОткрытии()
	Инициализация();
КонецПроцедуры

Процедура КоманднаяПанель1Заполнить(Кнопка)
	Если ДокументыДляОбработки.Количество() > 0 И Вопрос("Перезаполнить список документов?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли; 
	Построитель.Параметры.Вставить("НачалоПериода", НачалоДня(НачПериода));
	Построитель.Параметры.Вставить("ОкончаниеПериода", КонецДня(КонПериода));
	Построитель.Выполнить();
	ДокументыДляОбработки.Загрузить(Построитель.Результат.Выгрузить());
КонецПроцедуры

Процедура КоманднаяПанель1ВыполнитьОбмен(Кнопка)
	ИскСтроки = ДокументыДляОбработки.НайтиСтроки(Новый Структура("Пометка", Истина));
	Если ИскСтроки.Количество() = 0 ИЛИ Вопрос("Отправить статус ""Погашено"" для отмеченных ВСД?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли;
	
	МассивУдСтрок = Новый Массив;
	
	Для каждого СладкаяПара Из ИскСтроки Цикл
		ВСДОбъект = СладкаяПара.ВСД.ПолучитьОбъект();
		Если ВСДОбъект.ОтправитьОтветВМркурий(СладкаяПара.ПриходныйОрдер) = Истина Тогда
			МассивУдСтрок.Добавить(СладкаяПара);
		КонецЕсли; 
	КонецЦикла;
	
	Для каждого СтрокаТЧ Из МассивУдСтрок Цикл
		ДокументыДляОбработки.Удалить(СтрокаТЧ);
	КонецЦикла;
	
	Предупреждение("Передача выполнена!", 5, "Выполнено");
	
КонецПроцедуры
