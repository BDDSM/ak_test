
Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(ДатаНач, ?(ДатаКон='0001-01-01', ДатаКон, КонецДня(ДатаКон)));
	Если НастройкаПериода.Редактировать() Тогда
		ДатаНач = НастройкаПериода.ПолучитьДатуНачала();
		ДатаКон = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ПриОткрытии()
	
	УчитыватьКорректировкуМСФО = истина;
	ДатаНач = НачалоКвартала(ДобавитьМесяц(ТекущаяДата(), -3));
	ДатаКон = КонецКвартала(ДобавитьМесяц(ТекущаяДата(), -3));
	
КонецПроцедуры

Процедура ДействияФормыСформировать(Кнопка)
	
	ЭлементыФормы.ПолеОтчета.Очистить();
	Макет = ПолучитьМакет("Макет");
	
	ВсеОрганизацииСписок = Новый СписокЗначений;
	ВсеОрганизации = Справочники.Организации.Выбрать();
	Пока ВсеОрганизации.Следующий() Цикл
		
		ВсеОрганизацииСписок.Добавить(ВсеОрганизации.Ссылка);	
		
	КонецЦикла;	

	ПараметрОрганизации = ?( Организации.Количество()=0,ВсеОрганизацииСписок,Организации);
	
	Запрос = Новый Запрос();
	Запрос.УстановитьПараметр("ДатаНачГр", Новый Граница(НачалоДня(ДатаНач), ВидГраницы.Включая));
	Запрос.УстановитьПараметр("ДатаКонГр", Новый Граница(КонецДня(ДатаКон), ВидГраницы.Включая));
	Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
	Запрос.УстановитьПараметр("Орг", ПараметрОрганизации);
	Запрос.УстановитьПараметр("ОргВкусвилл", Справочники.Организации.НайтиПоРеквизиту("ИНН", "7734675810"));
	Запрос.УстановитьПараметр("Счет84", ПланыСчетов.Финансовый.НайтиПоКоду("84"));
	Запрос.УстановитьПараметр("Счет80_83", ПланыСчетов.Финансовый.НайтиПоКоду("80.83"));
	Запрос.УстановитьПараметр("МСФО", УчитыватьКорректировкуМСФО);
	Запрос.УстановитьПараметр("Консолидированный", Консолидированный);
	                                          
	Запрос.Текст = "ВЫБРАТЬ
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ЗаймУчредителя)
	               |								И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ЗаймУчредителя)
	               |							И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_2,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрибыльПрошлыхМесяцев)
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрибыльПрошлыхМесяцев)
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_3,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = &Счет84
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = &Счет84
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма84,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = &Счет80_83
	               |								И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = &Счет80_83
	               |							И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_83
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Остатки(&ДатаНач, , , Организация В (&Орг) И (НЕ &Консолидированный ИЛИ Организация.Код = ""000000006"" ИЛИ Организация.Код = ""000000004"")) КАК ФинансовыйОстатки
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ЗаймУчредителя)
	               |								И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ЗаймУчредителя)
	               |							И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_2,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрибыльПрошлыхМесяцев)
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрибыльПрошлыхМесяцев)
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_3,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = &Счет84
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = &Счет84
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма84,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОстатки.Счет = &Счет80_83
	               |								И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |							ТОГДА (ФинансовыйОстатки.СуммаОстаток + ФинансовыйОстатки.СуммаМСФООстаток) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОстатки.Счет = &Счет80_83
	               |							И (НЕ &Консолидированный ИЛИ ФинансовыйОстатки.Организация = &ОргВкусвилл)
	               |						ТОГДА ФинансовыйОстатки.СуммаОстаток * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_83
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Остатки(&ДатаКонГр, , , Организация В (&Орг) И (НЕ &Консолидированный ИЛИ Организация.Код = ""000000006"" ИЛИ Организация.Код = ""000000004"")) КАК ФинансовыйОстатки
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОбороты.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ЗаймУчредителя)
	               |								И (НЕ &Консолидированный ИЛИ ФинансовыйОбороты.Организация = &ОргВкусвилл)
	               |							ТОГДА (ФинансовыйОбороты.СуммаОборот + ФинансовыйОбороты.СуммаМСФООборот) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОбороты.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ЗаймУчредителя)
	               |							И (НЕ &Консолидированный ИЛИ ФинансовыйОбороты.Организация = &ОргВкусвилл)
	               |						ТОГДА ФинансовыйОбороты.СуммаОборот * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_2,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОбороты.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрибыльПрошлыхМесяцев)
	               |							ТОГДА (ФинансовыйОбороты.СуммаОборот + ФинансовыйОбороты.СуммаМСФООборот) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОбороты.Счет = ЗНАЧЕНИЕ(ПланСчетов.Финансовый.ПрибыльПрошлыхМесяцев)
	               |						ТОГДА ФинансовыйОбороты.СуммаОборот * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_3,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОбороты.Счет = &Счет84
	               |							ТОГДА (ФинансовыйОбороты.СуммаОборот + ФинансовыйОбороты.СуммаМСФООборот) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА ФинансовыйОбороты.Счет = &Счет84
	               |						ТОГДА ФинансовыйОбороты.СуммаОборот * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма84,
	               |	СУММА(ВЫБОР
	               |			КОГДА &МСФО
	               |				ТОГДА ВЫБОР
	               |						КОГДА ФинансовыйОбороты.Счет = &Счет80_83
	               |								И (НЕ &Консолидированный ИЛИ ФинансовыйОбороты.Организация = &ОргВкусвилл)
	               |							ТОГДА (ФинансовыйОбороты.СуммаОборот + ФинансовыйОбороты.СуммаМСФООборот) * -1
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ ВЫБОР
	               |					КОГДА (НЕ &Консолидированный ИЛИ ФинансовыйОбороты.Организация = &ОргВкусвилл)
	               |							И ФинансовыйОбороты.Организация = &ОргВкусвилл
	               |						ТОГДА ФинансовыйОбороты.СуммаОборот * -1
	               |					ИНАЧЕ 0
	               |				КОНЕЦ
	               |		КОНЕЦ) КАК Сумма80_83
	               |ИЗ
	               |	РегистрБухгалтерии.Финансовый.Обороты(&ДатаНачГр, &ДатаКонГр, , , , Организация В (&Орг) И (НЕ &Консолидированный ИЛИ Организация.Код = ""000000006"" ИЛИ Организация.Код = ""000000004""), , ) КАК ФинансовыйОбороты";
				   
	Результаты = Запрос.ВыполнитьПакет();
	ТабНачОст = Результаты[0].Выгрузить();
	ТабКонОст = Результаты[1].Выгрузить();
	ТабОбороты = Результаты[2].Выгрузить();
	
	Область = Макет.ПолучитьОбласть("Отчет");
	Область.Параметры.Орг = Организация.Наименование;
	Область.Параметры.ДатаНач = Формат(ДатаНач, "ДЛФ=DD");
	Область.Параметры.ДатаКон = Формат(ДатаКон, "ДЛФ=DD");
	
	Если ТабНачОст.Количество() > 0 Тогда
		Область.Параметры.Нач1 = Формат(ТабНачОст[0].Сумма80_2, "ЧДЦ=2");
		Область.Параметры.Нач2 = Формат(ТабНачОст[0].Сумма80_83, "ЧДЦ=2");
		Область.Параметры.Нач7 = Формат(ТабНачОст[0].Сумма80_3 + ТабНачОст[0].Сумма84, "ЧДЦ=2");
		Область.Параметры.Нач8 = Формат(ТабНачОст[0].Сумма80_2 + ТабНачОст[0].Сумма80_83 + ТабНачОст[0].Сумма80_3 + ТабНачОст[0].Сумма84, "ЧДЦ=2");
		Область.Параметры.Нач10 = Формат(ТабНачОст[0].Сумма80_2 + ТабНачОст[0].Сумма80_83 + ТабНачОст[0].Сумма80_3 + ТабНачОст[0].Сумма84, "ЧДЦ=2");
	КонецЕсли;
	
	Если ТабОбороты.Количество() > 0 Тогда
		Область.Параметры.Пр1 = Формат(ТабОбороты[0].Сумма80_2, "ЧДЦ=2");
		Область.Параметры.Пр2 = Формат(ТабОбороты[0].Сумма80_83, "ЧДЦ=2");
		Область.Параметры.Пр7 = Формат(ТабОбороты[0].Сумма84 + ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		Область.Параметры.Пр8 = Формат(ТабОбороты[0].Сумма80_2 + ТабОбороты[0].Сумма80_83 + ТабОбороты[0].Сумма84 + ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		Область.Параметры.Пр10 = Формат(ТабОбороты[0].Сумма80_2 + ТабОбороты[0].Сумма80_83 + ТабОбороты[0].Сумма84 + ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		
		Область.Параметры.СовДох1 = Формат(ТабОбороты[0].Сумма80_2, "ЧДЦ=2");
		Область.Параметры.СовДох2 = Формат(ТабОбороты[0].Сумма80_83, "ЧДЦ=2");
		Область.Параметры.СовДох7 = Формат(ТабОбороты[0].Сумма84 + ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		Область.Параметры.СовДох8 = Формат(ТабОбороты[0].Сумма80_2 + ТабОбороты[0].Сумма80_83 + ТабОбороты[0].Сумма84 + ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		Область.Параметры.СовДох10 = Формат(ТабОбороты[0].Сумма80_2 + ТабОбороты[0].Сумма80_83 + ТабОбороты[0].Сумма84 + ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		
		//Область.Параметры.СовДох7 = Формат(ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		//Область.Параметры.СовДох8 = Формат(ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
		//Область.Параметры.СовДох10 = Формат(ТабОбороты[0].Сумма80_3, "ЧДЦ=2");
	КонецЕсли;
	
	Если ТабКонОст.Количество() > 0 Тогда
		Область.Параметры.Кон1 = Формат(ТабКонОст[0].Сумма80_2, "ЧДЦ=2");
		Область.Параметры.Кон2 = Формат(ТабКонОст[0].Сумма80_83, "ЧДЦ=2");
		Область.Параметры.Кон7 = Формат(ТабКонОст[0].Сумма80_3 + ТабКонОст[0].Сумма84, "ЧДЦ=2");
		Область.Параметры.Кон8 = Формат(ТабКонОст[0].Сумма80_2 + ТабКонОст[0].Сумма80_83 + ТабКонОст[0].Сумма80_3 + ТабКонОст[0].Сумма84, "ЧДЦ=2");
		Область.Параметры.Кон10 = Формат(ТабКонОст[0].Сумма80_2 + ТабКонОст[0].Сумма80_83 + ТабКонОст[0].Сумма80_3 + ТабКонОст[0].Сумма84, "ЧДЦ=2");
	КонецЕсли;
	
	ЭлементыФормы.ПолеОтчета.Вывести(Область);
	ЭлементыФормы.ПолеОтчета.ПовторятьПриПечатиСтроки = ЭлементыФормы.ПолеОтчета.Область("R4:R4");
	ЭлементыФормы.ПолеОтчета.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
	ЭлементыФормы.ПолеОтчета.ПолеСлева = 5;
	ЭлементыФормы.ПолеОтчета.ПолеСправа = 5;
	
КонецПроцедуры
