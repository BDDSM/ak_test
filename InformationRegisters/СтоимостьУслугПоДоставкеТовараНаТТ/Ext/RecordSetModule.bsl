
Процедура ПроверитьДубльКонтрагентаВЗаписи(ТекЗапись, Отказ)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Период"		, ТекЗапись.Период);
	Запрос.УстановитьПараметр("Контрагент"	, ТекЗапись.Контрагент);
	Запрос.УстановитьПараметр("ТТ"			, ТекЗапись.ТТ);
	Запрос.УстановитьПараметр("ГруппаДоставкиНоменклатуры", ТекЗапись.ГруппаДоставкиНоменклатуры);
	 
	Запрос.Текст =
	"ВЫБРАТЬ
	|	1 КАК Поле1
	|ИЗ
	|	РегистрСведений.СтоимостьУслугПоДоставкеТовараНаТТ КАК СтоимостьУслугПоДоставкеТовараНаТТ
	|ГДЕ
	|	СтоимостьУслугПоДоставкеТовараНаТТ.Период = &Период
	|	И СтоимостьУслугПоДоставкеТовараНаТТ.ТТ = &ТТ
	|	И СтоимостьУслугПоДоставкеТовараНаТТ.ГруппаДоставкиНоменклатуры = &ГруппаДоставкиНоменклатуры
	|	И НЕ СтоимостьУслугПоДоставкеТовараНаТТ.Контрагент = &Контрагент";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Отказ = НЕ РезультатЗапроса.Пустой();
	
КонецПроцедуры


Процедура ПередЗаписью(Отказ, Замещение)
	
	//+++АК sole 2018.07.06 ИП-00019019
	Если Не ЭтотОбъект.ОбменДанными.Загрузка Тогда
	    
		НетПравНаЗапись = Не РегистрыСведений.СтоимостьУслугПоДоставкеТовараНаТТ.ПроверитьПраваНаЗапись(ЭтотОбъект.ВыгрузитьКолонку("ТТ"));
	
		Если НетПравНаЗапись Тогда
			Отказ = Истина;
			Возврат;
		КонецЕсли;
	КонецЕсли;
	//---АК sole 2018.07.06 ИП-00019019
	
	Для Каждого ТекЗапись Из ЭтотОбъект Цикл
		//ПроверитьДубльКонтрагентаВЗаписи(ТекЗапись, Отказ);
		//Если Отказ Тогда
		//	Сообщить("Для данной ТТ и группы доставки номенклатуры уже есть запись для данного периода записи (" + Формат(ТекЗапись.Период, "ДЛФ=Д") + ")!");
		//	Продолжить;
		//КонецЕсли;
		ТекЗапись.ДатаЗаписи = ТекущаяДата();
	КонецЦикла;
	
КонецПроцедуры

