
Процедура ДобавитьПодчинённыеОтборы(ТекСтрРодитель, НовыйОтборРодитель)
	
	Для каждого ТекСтр Из ТекСтрРодитель.Элементы Цикл
	    		
	    НовыйОтбор = НовыйОтборРодитель.Элементы.Добавить(ТипЗнч(ТекСтр));
		ЗаполнитьЗначенияСвойств(НовыйОтбор, ТекСтр);
		
		Попытка
		Если ТекСтр.Элементы.Количество() > 0 Тогда
			ДобавитьПодчинённыеОтборы(ТекСтр, НовыйОтбор);	
		КонецЕсли;	
		Исключение
		КонецПопытки;
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура СписокПриАктивизацииСтроки(Элемент)
	
	ТекДанные = Элементы.Список.ТекущиеДанные;
	Если ТекДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;	
	
	ЭлементыОтбора = СписокОбращенийКПокупателям.Отбор.Элементы;
	
	ЭлементыОтбора.Очистить();
	ЭлементОтбора = ЭлементыОтбора.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("GUID_Жалобы");
	ЭлементОтбора.ПравоеЗначение 	= ТекДанные.GUID_Загрузки;
	ЭлементОтбора.Использование 	= Истина;	
	
КонецПроцедуры

&НаКлиенте
Процедура Отмена(Команда)
	
	ЭтаФорма.Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбратьОбращение(Команда)
	
	ТекДанные = Элементы.Список.ТекущиеДанные;
	Если ТекДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ТекДанные.ДатаСобытия = '00010101' Тогда
		Сообщить("В данном обращении не заполнена дата события!");
		Возврат;
	КонецЕсли;
	
	Если Вопрос("Будет создано " + Формат(ЭтаФорма.КоличествоВВыборку, "ЧГ=") + " новых обращений к покупателю. Продолжить?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет	Тогда
		Возврат;
	КонецЕсли;
	
	//
	НомерПродавца = 1;
	Если ВвестиЧисло(НомерПродавца, "Введите порядковый номер продавца", 1, 0) Тогда 
		
		Если НомерПродавца <> 1
				И НомерПродавца <> 2
				И НомерПродавца <> 3 Тогда
			Предупреждение("Неверный номер продаца! Можно указать 1, 2 или 3.");		
			Возврат;
		КонецЕсли;
		
		ПараметрыСоздания = Новый Структура;
		ПараметрыСоздания.Вставить("МаксКол"				, КоличествоВВыборку);
		ПараметрыСоздания.Вставить("ИмяКассира"				, ТекДанные["Продавец" + НомерПродавца]);
		ПараметрыСоздания.Вставить("ТТ"						, ТекДанные.СтруктурнаяЕдиница);
		ПараметрыСоздания.Вставить("ДатаСобытия"			, ТекДанные.ДатаСобытия);
		ПараметрыСоздания.Вставить("ИспользоватьПриоритеты"	, Истина);
		ПараметрыСоздания.Вставить("GUID_Жалобы"			, ТекДанные.GUID_Загрузки);	
		ПараметрыСоздания.Вставить("НомерКартыЖалобы"		, СокрЛП(ТекДанные.email));	
		
		Если CRM.ПостроитьТаблицуРассылкиПоЖалобамНаКассира(ПараметрыСоздания) Тогда
			ЭтаФорма.Закрыть();
		КонецЕсли;	
				
	КонецЕсли;	
	
КонецПроцедуры


&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	ТекДанные = Элементы.Список.ТекущиеДанные;
	
	ЭлементыОтбора = СписокОбращенийКПокупателям.Отбор.Элементы;
	ЭлементыОтбора.Очистить();
	
	ЭлементОтбора = ЭлементыОтбора.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("GUID_Жалобы");
	ЭлементОтбора.ПравоеЗначение 	= ?(НЕ ТекДанные = Неопределено, ТекДанные.GUID_Загрузки, "йййййй");
	ЭлементОтбора.Использование 	= Истина;
	
КонецПроцедуры


&НаКлиенте
Процедура ПродавецПриИзменении(Элемент)
	
	Если ЗначениеЗаполнено(Продавец) Тогда
		ОтборПоПродавцу = ОбщегоНазначенияКлиентСервер.НайтиЭлементОтбораПоПредставлению(Список.Отбор.Элементы, "Продавец");
		Если ОтборПоПродавцу = Неопределено Тогда
			ОбщегоНазначенияКлиентСервер.ДобавитьЭлементКомпоновки(Список.Отбор, "Продавец1", ВидСравненияКомпоновкиДанных.Равно, Продавец, "Продавец");
		Иначе
			ОтборПоПродавцу.ПравоеЗначение = Продавец;
		КонецЕсли;	
	Иначе
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Список.Отбор,, "Продавец");
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДатаОбращенияПриИзменении(Элемент)
	
	Если ЗначениеЗаполнено(ДатаОбращения) Тогда
		ОтборПоДате = ОбщегоНазначенияКлиентСервер.НайтиЭлементОтбораПоПредставлению(Список.Отбор.Элементы, "ДатаОбращения");
		Если ОтборПоДате = Неопределено Тогда
			ОбщегоНазначенияКлиентСервер.ДобавитьЭлементКомпоновки(Список.Отбор, "ДатаДок", ВидСравненияКомпоновкиДанных.Равно, ДатаОбращения, "ДатаОбращения");
		Иначе
			ОтборПоДате.ПравоеЗначение = ДатаОбращения;
		КонецЕсли;	
	Иначе
		ОбщегоНазначенияКлиентСервер.УдалитьЭлементыГруппыОтбора(Список.Отбор,, "ДатаОбращения");
	КонецЕсли;
	
КонецПроцедуры

