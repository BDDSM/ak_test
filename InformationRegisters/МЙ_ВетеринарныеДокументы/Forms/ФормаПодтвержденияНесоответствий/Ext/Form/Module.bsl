
&НаКлиенте
Процедура ОК(Команда)
	Если ПустаяСтрока(ПричинаАкта) Тогда
		Сообщить("Необходимо указать причину!");
	Иначе 
		Закрыть(ПричинаАкта);
	КонецЕсли; 
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Заголовок = Параметры.Продукция;
	
	
	ТекстЗаголовка =  "При гашении ВСД обнаружены следующие несоответствия:" + Символы.ПС;	
	
	Для Каждого Элемент ИЗ Параметры.ОписаниеНесоответствий Цикл
		ЗначениеДокумент = Элемент.Значение.Документ;
		ЗначениеВСД = Элемент.Значение.ВСД;
		
		Если ТипЗнч(ЗначениеДокумент) = Тип("Число") Тогда
			ЗначениеДокумент = Формат(ЗначениеДокумент, "ЧДЦ=3; ЧН=");
			ЗначениеВСД = Формат(ЗначениеВСД, "ЧДЦ=3; ЧН=");
		ИначеЕсли ТипЗнч(ЗначениеДокумент) = Тип("Дата") Тогда
			ЗначениеДокумент = Формат(ЗначениеДокумент, "ЧДЦ=3; ЧН=; ДФ=dd.MM.yyyy");
			ЗначениеВСД = Формат(ЗначениеВСД, "ЧДЦ=3; ЧН=; ДФ=dd.MM.yyyy");
		КонецЕсли; 
		
		ТекстЗаголовка =  ТекстЗаголовка + Символы.ПС + Элемент.Значение.Представление + ". Значение в документе: " + ЗначениеДокумент + ". Значение в ВСД: " + ЗначениеВСД + ".";  		
	КонецЦикла;  
	
	ТекстЗаголовка =  ТекстЗаголовка + Символы.ПС + Символы.ПС + "Введите причину для акта несоответствия:";	
	
	Элементы.ТекстНесоответствия.Заголовок =  ТекстЗаголовка;
	
	
	ОсновнаяНастройкаАПИ = ОбменССистемойВетис.ОсновнаяНастройкаАПИ();
	
	Если ОсновнаяНастройкаАПИ <> Неопределено Тогда
		ПричинаАкта = ОсновнаяНастройкаАПИ.ОсновнаяПричинаАктаНесоответствия;
	КонецЕсли; 
	
КонецПроцедуры
