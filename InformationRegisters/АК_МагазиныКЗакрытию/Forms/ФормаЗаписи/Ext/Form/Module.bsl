
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	СтараяДата = ЭтаФорма.Запись.ДатаПланируемогоЗакрытия;
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	//+++AK GREK 01.07.2018 ИП-00018742
	Если ЗначениеЗаполнено(Запись.ДатаПланируемогоОткрытия) И Запись.ДатаПланируемогоОткрытия < Запись.ДатаПланируемогоЗакрытия Тогда
		Сообщить("Дата планируемого открытия должна быть позже, даты закрытия", СтатусСообщения.Внимание);
		Отказ = Истина;
	Иначе
		Если НЕ СтараяДата =  ТекущийОбъект.ДатаПланируемогоЗакрытия тогда
			ИзменитьСтатусОтправки(Ложь, ТекущийОбъект.Магазин);
		КонецЕсли;
	КонецЕсли;
	//---AK
КонецПроцедуры

&НаСервере
Процедура ИзменитьСтатусОтправки(Статус, Магазин)
	НЗ = РегистрыСведений.АК_ОтправкаПоМагазинам.СоздатьНаборЗаписей();
	НЗ.Отбор.Магазин.Установить(Магазин);
	НЗ.Прочитать();
	Для Каждого Записи из НЗ цикл
		Записи.Отправлено = Ложь;
	КонецЦикла;	
	НЗ.Записать(Истина);
КонецПроцедуры

