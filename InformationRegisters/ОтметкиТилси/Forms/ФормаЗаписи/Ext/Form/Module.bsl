
&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	СтрокаФото = "";
	Для каждого Стр Из ТаблицаФото Цикл
		Фото = Стр.Фото;
		Если Не ЗначениеЗаполнено(Фото) Тогда
			Продолжить;
		КонецЕсли;
		УИД = Строка(Фото.УникальныйИдентификатор());
		СтрокаФото = СтрокаФото + ?(ЗначениеЗаполнено(СтрокаФото), ",", "") + УИД;
	КонецЦикла;
	
	ТекущийОбъект.МассивФото = СтрокаФото;
	
	Запись.Автор = ПараметрыСеанса.ТекущийПользователь; //+++АК mika 2018.09.18 ИП-00019442
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	МФ = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(Запись.МассивФото);
	Для каждого Стр Из МФ Цикл	
		Если НЕ СтрДлина(Стр)=36 Тогда Продолжить КонецЕсли;
		Попытка
			Фото = Справочники.Файлы.ПолучитьСсылку(Новый УникальныйИдентификатор(Стр));
		Исключение
		Продолжить;
		КонецПопытки;
		Если ЗначениеЗаполнено(Фото) Тогда
			НоваяСтрока = ТаблицаФото.Добавить();
			НоваяСтрока.Фото = Фото;
		КонецЕсли;
	КонецЦикла; 
КонецПроцедуры

