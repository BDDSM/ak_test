
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	//
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	СтруктурныеЕдиницы.Ссылка
	|ИЗ
	|	Справочник.СтруктурныеЕдиницы КАК СтруктурныеЕдиницы
	|ГДЕ
	|	СтруктурныеЕдиницы.ПометкаУдаления = ЛОЖЬ
	|	И СтруктурныеЕдиницы.ДатаЗакрытия = ДАТАВРЕМЯ(1, 1, 1)
	|	И СтруктурныеЕдиницы.ТипРозничнойТочки = ЗНАЧЕНИЕ(Перечисление.ТипыРозничныхТочек.Магазин)
	|
	|УПОРЯДОЧИТЬ ПО
	|	СтруктурныеЕдиницы.НомерТочки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МестаВыкладки.Ссылка
	|ИЗ
	|	Справочник.МестаВыкладки КАК МестаВыкладки
	|ГДЕ
	|	МестаВыкладки.ЭтоГруппа = ИСТИНА
	|	И МестаВыкладки.ПометкаУдаления = ЛОЖЬ
	|
	|УПОРЯДОЧИТЬ ПО
	|	МестаВыкладки.Наименование";
				   
	Результаты = Запрос.ВыполнитьПакет();
	
	//
	Выборка = Результаты[0].Выбрать();
	Пока Выборка.Следующий() Цикл
		СтрокаДоб = ТабМагазины.Добавить();
		СтрокаДоб.Магазин = Выборка.Ссылка;
	КонецЦикла;
	
	Выборка = Результаты[1].Выбрать();
	Пока Выборка.Следующий() Цикл
		СтрокаДоб = ТабГруппы.Добавить();
		СтрокаДоб.Включать 	= Истина;
		СтрокаДоб.Группа 	= Выборка.Ссылка;
	КонецЦикла;
	 
КонецПроцедуры

&НаКлиенте
Процедура ВключитьВсе_Магазины(Команда)
	
	Для Каждого СтрокаТаб Из ТабМагазины Цикл
		СтрокаТаб.Включать = Истина;
	КонецЦикла;	
	
КонецПроцедуры

&НаКлиенте
Процедура ВыключитьВсе_Магазины(Команда)
	
	Для Каждого СтрокаТаб Из ТабМагазины Цикл
		СтрокаТаб.Включать = Ложь;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыключитьВсе_Группы(Команда)
	
	Для Каждого СтрокаТаб Из ТабГруппы Цикл
		СтрокаТаб.Включать = Ложь;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ВключитьВсе_Группы(Команда)
	
	Для Каждого СтрокаТаб Из ТабГруппы Цикл
		СтрокаТаб.Включать = Истина;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура Записать(Команда)
	
	СтруктураВозврат = Новый Структура;
	МассивМагазины = Новый Массив;
	Для Каждого СтрокаТаб Из ТабМагазины Цикл
		Если СтрокаТаб.Включать Тогда
			МассивМагазины.Добавить(СтрокаТаб.Магазин);
		КонецЕсли;	
	КонецЦикла;
	СтруктураВозврат.Вставить("Магазины", МассивМагазины);
	
	МассивГруппы = Новый Массив;
	Для Каждого СтрокаТаб Из ТабГруппы Цикл
		Если СтрокаТаб.Включать Тогда
			МассивГруппы.Добавить(СтрокаТаб.Группа);
		КонецЕсли;	
	КонецЦикла;
	СтруктураВозврат.Вставить("Группы"	, МассивГруппы);
	
	ЭтаФорма.Закрыть(СтруктураВозврат);
	
КонецПроцедуры
