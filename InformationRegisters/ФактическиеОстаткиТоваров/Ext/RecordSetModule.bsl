
Процедура ПередЗаписью(Отказ, Замещение)
	
	ЕстьНеЗаполненныеId = Ложь;
	Для Каждого Запись Из ЭтотОбъект Цикл
		Если Запись.id_TT = 0 Тогда
			ЕстьНеЗаполненныеId = Истина;
		КонецЕсли;	
	КонецЦикла;	
	
	Если ЕстьНеЗаполненныеId Тогда
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("ТТ", ЭтотОбъект.Выгрузить().ВыгрузитьКолонку("ТорговаяТочка"));
		Запрос.Текст =
		"ВЫБРАТЬ
		|	СтруктурныеЕдиницы.Ссылка,
		|	СтруктурныеЕдиницы.id_TT
		|ИЗ
		|	Справочник.СтруктурныеЕдиницы КАК СтруктурныеЕдиницы
		|ГДЕ
		|	СтруктурныеЕдиницы.Ссылка В(&ТТ)";
					   
		ТабКеш = Запрос.Выполнить().Выгрузить();
		
		Для Каждого Запись Из ЭтотОбъект Цикл
			Если Запись.id_TT = 0 Тогда
				СтрокаКеш = ТабКеш.Найти(Запись.ТорговаяТочка, "Ссылка");
				Если НЕ СтрокаКеш = Неопределено Тогда
					Запись.id_TT = СтрокаКеш.id_TT;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;	
	КонецЕсли;	
	
КонецПроцедуры
