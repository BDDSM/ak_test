&НаКлиенте
Процедура ПоказатьВсеДокументы(Команда)
	
	Элементы.ДокументыПоказатьВсеДокументы.Пометка = НЕ Элементы.ДокументыПоказатьВсеДокументы.Пометка;
	
	ПолеОтбора = Новый ПолеКомпоновкиДанных("Ссылка");
	
	ПолеОтбора1 = Новый ПолеКомпоновкиДанных("ВыводитьПоУмолчанию");
	
	Для Каждого ТекущийЭлементОтбора Из ДС_Документы.Отбор.Элементы Цикл
		Если ТекущийЭлементОтбора.ЛевоеЗначение = ПолеОтбора ИЛИ ТекущийЭлементОтбора.ЛевоеЗначение = ПолеОтбора1 Тогда
			ТекущийЭлементОтбора.Использование = НЕ Элементы.ДокументыПоказатьВсеДокументы.Пометка;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьДокумент(Команда)
	
	Если Элементы.ДС_Документы.ТекущиеДанные <> Неопределено Тогда
		СсылкаНаДокумент = Элементы.ДС_Документы.ТекущиеДанные.Ссылка;
		
		Если ТипЗнч(СсылкаНаДокумент) = Тип("ДокументСсылка.ЗаявкаНаУслугиМатериалы") Тогда
			ОткрытьФорму("Документ.ЗаявкаНаУслугиМатериалы.ФормаОбъекта", Новый Структура("Ключ", СсылкаНаДокумент));
		ИначеЕсли ТипЗнч(СсылкаНаДокумент) = Тип("ДокументСсылка.ПредпоступлениеПоКомплектации") Тогда
			ОткрытьФорму("Документ.ПредпоступлениеПоКомплектации.ФормаОбъекта", Новый Структура("Ключ", СсылкаНаДокумент));
		КонецЕсли; 

	КонецЕсли; 
КонецПроцедуры

&НаКлиенте
Процедура ДокументыВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	
	ТД = Элемент.ТекущиеДанные;
	//Закрыть(Элемент.ТекущиеДанные.Ссылка);
	ВыборЗаявки(ТД.Ссылка, ТД.ИдентификаторПакета);

КонецПроцедуры

&НаКлиенте
Процедура ВыбратьЗаявку(Команда)
	
	Если  Элементы.ДС_Документы.ТекущиеДанные = Неопределено Тогда
		Закрыть();
	Иначе			
		ТД = Элементы.ДС_Документы.ТекущиеДанные;
		
		ВыборЗаявки(ТД.Ссылка, ТД.ИдентификаторПакета);
		
		//Закрыть(Элементы.ДС_Документы.ТекущиеДанные.Ссылка);
	КонецЕсли; 

КонецПроцедуры

&НаКлиенте
Процедура ВыборЗаявки(Заявка, ИДПакета)
	Если ТекущаяЗаявка = Заявка Тогда
		Закрыть(Заявка);
	Иначе		
		Если ЗначениеЗаполнено(ИДПакета) = Истина Тогда
			Ответ = Вопрос("Данная заявка уже прикреплена к другому пакету ЭДО. При продолжении заявка будет открпелена от текущего пакета ЭДО. Продолжить?", РежимДиалогаВопрос.ДаНет);
			Если Ответ = КодВозвратаДиалога.Да Тогда
				Запись = РегистрыСведений.ЭДО_Пакеты.СоздатьМенеджерЗаписи();
				Запись.ИдентификаторПакета = ИДПакета;
				Запись.Прочитать();
				Запись.Заявка = Документы.ЗаявкаНаУслугиМатериалы.ПустаяСсылка();
				Запись.Записать();			
				Закрыть(Заявка);
			КонецЕсли;	
		Иначе
			Закрыть(Заявка);
		КонецЕсли;
	КонецЕсли;
		
КонецПроцедуры	



&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("ОснованиеВДокументеЭДО") Тогда
		ОснованиеВДокументеЭДО = Параметры.ОснованиеВДокументеЭДО;
	КонецЕсли;
	
	Если Параметры.Свойство("ТекСумма") Тогда
		Сумма = Параметры.ТекСумма;
	КонецЕсли;
	
	Если Параметры.Свойство("Контрагент") Тогда
		ЭлементОтбора = ДС_Документы.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		
		ЭлементОтбора.Использование = Истина;	
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Ссылка.Контрагент");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		ЭлементОтбора.ПравоеЗначение = Параметры.Контрагент;
	КонецЕсли;
	
	Если Параметры.Свойство("СписокДокументов") Тогда
		ЭлементОтбора = ДС_Документы.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		
		ЭлементОтбора.Использование = Истина;	
		ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Ссылка");
		ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.ВСписке;
		ЭлементОтбора.ПравоеЗначение = Параметры.СписокДокументов;
	КонецЕсли;
	
	ЭлементОтбора = ДС_Документы.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	
	ЭлементОтбора.Использование = Истина;	
	ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("ВыводитьПоУмолчанию");
	ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	ЭлементОтбора.ПравоеЗначение = Истина;

	
	Если Параметры.Свойство("ТекЗаявка") И ЗначениеЗаполнено(Параметры.ТекЗаявка) Тогда
	//	Элемент = УсловноеОформление.Элементы.Добавить();
	//	КомпоновкаДанныхКлиентСервер.ДобавитьОформляемоеПоле(Элемент.Поля, "ДС_Документы");
	//	ОбщегоНазначенияКлиентСервер.ДобавитьЭлементКомпоновки(Элемент.Отбор, "ДС_Документы.Ссылка", ВидСравненияКомпоновкиДанных.Равно, Параметры.ТекЗаявка);
	//	Элемент.Оформление.УстановитьЗначениеПараметра("ЦветФона", WebЦвета.СветлоЗеленый);	
	//	
		ДС_Документы.Параметры.УстановитьЗначениеПараметра("ТекЗаявка", Параметры.ТекЗаявка); 		
		ТекущаяЗаявка = Параметры.ТекЗаявка;
	Иначе
		ДС_Документы.Параметры.УстановитьЗначениеПараметра("ТекЗаявка", Документы.ЗаявкаНаУслугиМатериалы.ПустаяСсылка()); 
	КонецЕсли;	
	
	Если Параметры.Свойство("СписокНомеров") Тогда
	   СписокНомеров = Параметры.СписокНомеров;
	КонецЕсли;
	
	ДС_Документы.Параметры.УстановитьЗначениеПараметра("СписокНомеров", СписокНомеров); 


	
КонецПроцедуры

