
Процедура ПриОткрытии()
	
	Если НЕ УправлениеДопПравамиПользователей.ПолучитьПравоПользователяУпр(ПланыВидовХарактеристик.ПраваПользователей.РедактированиеРегистраГраницЗапрета, Ложь) Тогда
		ЭтаФорма.ТолькоПросмотр = Истина;
	КонецЕсли;	
	
КонецПроцедуры

Функция ПолучитьМассивПодчиненных()
	
	ЗапросПодчиненных = Новый Запрос();
	ЗапросПодчиненных.Текст = "ВЫБРАТЬ
							  |	ПользователиПодчиненныеПользователи.Пользователь
							  |ИЗ
							  |	Справочник.Пользователи.ПодчиненныеПользователи КАК ПользователиПодчиненныеПользователи
							  |ГДЕ
							  |	ПользователиПодчиненныеПользователи.Ссылка = &Ссылка";
							  
	ЗапросПодчиненных.УстановитьПараметр("Ссылка", ПараметрыСеанса.ТекущийПользователь);
	Возврат ЗапросПодчиненных.Выполнить().Выгрузить().ВыгрузитьКолонку("Пользователь");
	
КонецФункции	

Процедура РегистрСведенийСписокПередНачаломИзменения(Элемент, Отказ)
	
	МассивПодчиненных = ПолучитьМассивПодчиненных();
	Если МассивПодчиненных.Количество() > 0 Тогда
		Отказ = Истина;
		Если МассивПодчиненных.Найти(ЭлементыФормы.РегистрСведенийСписок.ТекущиеДанные.Пользователь) = Неопределено Тогда
			Сообщить("Этого пользователя нет в настройке ваших подчиненных");
			Возврат;
		КонецЕсли;
		ОткрытьФорму("РегистрСведений.ГраницыЗапретаИзмененияДанных.Форма.ФормаРедактированияПодчиненных");
	КонецЕсли;	
	
КонецПроцедуры

Процедура РегистрСведенийСписокПередНачаломДобавления(Элемент, Отказ, Копирование)
	
	МассивПодчиненных = ПолучитьМассивПодчиненных();
	Если МассивПодчиненных.Количество() > 0 Тогда
		Отказ = Истина;
		ОткрытьФорму("РегистрСведений.ГраницыЗапретаИзмененияДанных.Форма.ФормаРедактированияПодчиненных");
	КонецЕсли;
	
КонецПроцедуры

Процедура РегистрСведенийСписокПередУдалением(Элемент, Отказ)
	
	МассивПодчиненных = ПолучитьМассивПодчиненных();
	Если МассивПодчиненных.Количество() > 0 Тогда
		Если МассивПодчиненных.Найти(ЭлементыФормы.РегистрСведенийСписок.ТекущиеДанные.Пользователь) = Неопределено Тогда
			Сообщить("Этого пользователя нет в настройке ваших подчиненных");
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
