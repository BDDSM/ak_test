
//Перем БылоДобавлениеИзПроверки;

Процедура ПриЗаписи(Отказ, Замещение)
	
	//Если НЕ БылоДобавлениеИзПроверки Тогда
	//	Если ЭтотОбъект.Количество() = 0 Тогда //значит запись удаляют
	//		Попытка
	//			Запись = РегистрыСведений.ЖурналРаботыСРегистромЦФОСтруктурныхЕдиниц.СоздатьМенеджерЗаписи();
	//			Запись.Период = ТекущаяДата();
	//			Запись.Пользователь = ПараметрыСеанса.ТекущийПользователь;
	//			Запись.СтруктурнаяЕдиница = ЭтотОбъект.Отбор.СтруктурнаяЕдиница.Значение;
	//			Запись.ДатаИзмененнойЗаписи = ЭтотОбъект.Отбор.Период.Значение;
	//			Запись.ЦФО = Неопределено;
	//			Запись.Организация = Неопределено;
	//			Запись.Записать();
	//		Исключение
	//		КонецПопытки;	
	//	КонецЕсли;
	//КонецЕсли;
	
	МожноОставлятьПустуюОрганизацию = УправлениеДопПравамиПользователей.ПолучитьПравоПользователяУпр(ПланыВидовХарактеристик.ПраваПользователей.МожетОставлятьНеЗаполненнуюОрганизациюВЦФО, Ложь);
	Для Каждого ЗаписьНабора Из ЭтотОбъект Цикл
		
		Если НЕ ЗначениеЗаполнено(ЗаписьНабора.Организация) и НЕ МожноОставлятьПустуюОрганизацию Тогда
			Отказ = Истина;
			Сообщить("Нет прав для записи с пустой организацией");
			Возврат;
		КонецЕСли;
		Попытка
			Запись = РегистрыСведений.ЖурналРаботыСРегистромЦФОСтруктурныхЕдиниц.СоздатьМенеджерЗаписи();
			Запись.Период = ТекущаяДата();
			Запись.Пользователь = ПараметрыСеанса.ТекущийПользователь;
			Запись.СтруктурнаяЕдиница = ЗаписьНабора.СтруктурнаяЕдиница;
			Запись.ДатаИзмененнойЗаписи = ЗаписьНабора.Период;
			Запись.ЦФО = ЗаписьНабора.ЦФО;
			Запись.Организация = ЗаписьНабора.Организация;
			Запись.Записать();
			//БылоДобавлениеИзПроверки = Истина;
		Исключение
		КонецПопытки;
		
	КонецЦикла;	

	
	МассивТТ = Новый Массив();
	МассивТТ.Добавить(ЭтотОбъект.Отбор.СтруктурнаяЕдиница.Значение);
	Для Каждого Запись Из ЭтотОбъект Цикл
		МассивТТ.Добавить(Запись.СтруктурнаяЕдиница);
	КонецЦикла;
	
	Запрос = Новый Запрос();
	Запрос.УстановитьПараметр("ТТ", МассивТТ);
	Запрос.Текст = "ВЫБРАТЬ
	               |	ЦФОСтруктурныхЕдиницСрезПоследних.СтруктурнаяЕдиница,
	               |	ЦФОСтруктурныхЕдиницСрезПоследних.ЦФО.id_ЦФО КАК id_ЦФО
	               |ИЗ
	               |	РегистрСведений.ЦФОСтруктурныхЕдиниц.СрезПоследних(, СтруктурнаяЕдиница В (&ТТ)) КАК ЦФОСтруктурныхЕдиницСрезПоследних
	               |ГДЕ
	               |	ЦФОСтруктурныхЕдиницСрезПоследних.СтруктурнаяЕдиница.Id_group <> ЦФОСтруктурныхЕдиницСрезПоследних.ЦФО.id_ЦФО";
				   
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		ТтОб = Выборка.СтруктурнаяЕдиница.ПолучитьОбъект();
		ТтОб.Id_group = Выборка.id_ЦФО;
		ТтОб.ОбменДанными.Загрузка = Истина;
		ТтОб.Записать();
	КонецЦикла;	
	
КонецПроцедуры

//+++ AK suvv 18.06.2018 ИП-00018658
// при записи справочника "Структурные единицы" в РС записывается весь набор данных, даже если записи не были изменены
////+++ AK suvv 10.05.2017 ИП-00018658
//Процедура ПередЗаписью(Отказ, Замещение)
//	
//	Для Каждого ТекЗапись из ЭтотОбъект Цикл
//		ТекЗапись.АвторИзменений = ПараметрыСеанса.ТекущийПользователь;
//		ТекЗапись.ДатаИзменений = ТекущаяДата();
//	КонецЦикла;
//	
//КонецПроцедуры //AK suvv
//--- AK suvv

//БылоДобавлениеИзПроверки = Ложь;

